"use strict";function cov_1xb8gzqef8(){var path="/parse-server/lib/LiveQuery/Subscription.js";var hash="6d6b6e3bbccc7e1038cd0663644b6295af48bbe4";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/LiveQuery/Subscription.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:30}},"2":{start:{line:8,column:14},end:{line:8,column:58}},"3":{start:{line:10,column:39},end:{line:10,column:93}},"4":{start:{line:15,column:4},end:{line:15,column:31}},"5":{start:{line:16,column:4},end:{line:16,column:23}},"6":{start:{line:17,column:4},end:{line:17,column:26}},"7":{start:{line:18,column:4},end:{line:18,column:38}},"8":{start:{line:22,column:4},end:{line:24,column:5}},"9":{start:{line:23,column:6},end:{line:23,column:46}},"10":{start:{line:26,column:23},end:{line:26,column:58}},"11":{start:{line:27,column:4},end:{line:27,column:31}},"12":{start:{line:31,column:23},end:{line:31,column:58}},"13":{start:{line:33,column:4},end:{line:37,column:5}},"14":{start:{line:34,column:6},end:{line:34,column:74}},"15":{start:{line:36,column:6},end:{line:36,column:13}},"16":{start:{line:39,column:18},end:{line:39,column:47}},"17":{start:{line:41,column:4},end:{line:45,column:5}},"18":{start:{line:42,column:6},end:{line:42,column:101}},"19":{start:{line:44,column:6},end:{line:44,column:13}},"20":{start:{line:47,column:4},end:{line:47,column:32}},"21":{start:{line:49,column:4},end:{line:51,column:5}},"22":{start:{line:50,column:6},end:{line:50,column:45}},"23":{start:{line:55,column:4},end:{line:55,column:42}},"24":{start:{line:60,column:0},end:{line:60,column:36}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:10,column:9},end:{line:10,column:31}},loc:{start:{line:10,column:37},end:{line:10,column:95}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:2},end:{line:14,column:3}},loc:{start:{line:14,column:43},end:{line:19,column:3}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:21,column:2},end:{line:21,column:3}},loc:{start:{line:21,column:45},end:{line:28,column:3}},line:21},"3":{name:"(anonymous_3)",decl:{start:{line:30,column:2},end:{line:30,column:3}},loc:{start:{line:30,column:48},end:{line:52,column:3}},line:30},"4":{name:"(anonymous_4)",decl:{start:{line:54,column:2},end:{line:54,column:3}},loc:{start:{line:54,column:25},end:{line:56,column:3}},line:54}},branchMap:{"0":{loc:{start:{line:10,column:46},end:{line:10,column:92}},type:"cond-expr",locations:[{start:{line:10,column:70},end:{line:10,column:73}},{start:{line:10,column:76},end:{line:10,column:92}}],line:10},"1":{loc:{start:{line:10,column:46},end:{line:10,column:67}},type:"binary-expr",locations:[{start:{line:10,column:46},end:{line:10,column:49}},{start:{line:10,column:53},end:{line:10,column:67}}],line:10},"2":{loc:{start:{line:22,column:4},end:{line:24,column:5}},type:"if",locations:[{start:{line:22,column:4},end:{line:24,column:5}},{start:{line:22,column:4},end:{line:24,column:5}}],line:22},"3":{loc:{start:{line:33,column:4},end:{line:37,column:5}},type:"if",locations:[{start:{line:33,column:4},end:{line:37,column:5}},{start:{line:33,column:4},end:{line:37,column:5}}],line:33},"4":{loc:{start:{line:41,column:4},end:{line:45,column:5}},type:"if",locations:[{start:{line:41,column:4},end:{line:45,column:5}},{start:{line:41,column:4},end:{line:45,column:5}}],line:41},"5":{loc:{start:{line:49,column:4},end:{line:51,column:5}},type:"if",locations:[{start:{line:49,column:4},end:{line:51,column:5}},{start:{line:49,column:4},end:{line:51,column:5}}],line:49}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},inputSourceMap:{version:3,sources:["../../src/LiveQuery/Subscription.js"],names:["Subscription","constructor","className","query","queryHash","hash","clientRequestIds","Map","addClientSubscription","clientId","requestId","has","set","requestIds","get","push","deleteClientSubscription","logger","error","index","indexOf","splice","length","delete","hasSubscribingClient","size"],mappings:";;;;;;;AAAA;;;;AAKA,MAAMA,YAAN,CAAmB;AACjB;AAMAC,EAAAA,WAAW,CAACC,SAAD,EAAoBC,KAApB,EAAsCC,SAAtC,EAAyD;AAClE,SAAKF,SAAL,GAAiBA,SAAjB;AACA,SAAKC,KAAL,GAAaA,KAAb;AACA,SAAKE,IAAL,GAAYD,SAAZ;AACA,SAAKE,gBAAL,GAAwB,IAAIC,GAAJ,EAAxB;AACD;;AAEDC,EAAAA,qBAAqB,CAACC,QAAD,EAAmBC,SAAnB,EAA4C;AAC/D,QAAI,CAAC,KAAKJ,gBAAL,CAAsBK,GAAtB,CAA0BF,QAA1B,CAAL,EAA0C;AACxC,WAAKH,gBAAL,CAAsBM,GAAtB,CAA0BH,QAA1B,EAAoC,EAApC;AACD;;AACD,UAAMI,UAAU,GAAG,KAAKP,gBAAL,CAAsBQ,GAAtB,CAA0BL,QAA1B,CAAnB;AACAI,IAAAA,UAAU,CAACE,IAAX,CAAgBL,SAAhB;AACD;;AAEDM,EAAAA,wBAAwB,CAACP,QAAD,EAAmBC,SAAnB,EAA4C;AAClE,UAAMG,UAAU,GAAG,KAAKP,gBAAL,CAAsBQ,GAAtB,CAA0BL,QAA1B,CAAnB;;AACA,QAAI,OAAOI,UAAP,KAAsB,WAA1B,EAAuC;AACrCI,sBAAOC,KAAP,CAAa,kCAAb,EAAiDT,QAAjD;;AACA;AACD;;AAED,UAAMU,KAAK,GAAGN,UAAU,CAACO,OAAX,CAAmBV,SAAnB,CAAd;;AACA,QAAIS,KAAK,GAAG,CAAZ,EAAe;AACbF,sBAAOC,KAAP,CAAa,kDAAb,EAAiET,QAAjE,EAA2EC,SAA3E;;AACA;AACD;;AACDG,IAAAA,UAAU,CAACQ,MAAX,CAAkBF,KAAlB,EAAyB,CAAzB,EAZkE,CAalE;;AACA,QAAIN,UAAU,CAACS,MAAX,IAAqB,CAAzB,EAA4B;AAC1B,WAAKhB,gBAAL,CAAsBiB,MAAtB,CAA6Bd,QAA7B;AACD;AACF;;AAEDe,EAAAA,oBAAoB,GAAY;AAC9B,WAAO,KAAKlB,gBAAL,CAAsBmB,IAAtB,GAA6B,CAApC;AACD;;AA3CgB",sourcesContent:["import logger from '../logger';\n\nexport type FlattenedObjectData = { [attr: string]: any };\nexport type QueryData = { [attr: string]: any };\n\nclass Subscription {\n  // It is query condition eg query.where\n  query: QueryData;\n  className: string;\n  hash: string;\n  clientRequestIds: Object;\n\n  constructor(className: string, query: QueryData, queryHash: string) {\n    this.className = className;\n    this.query = query;\n    this.hash = queryHash;\n    this.clientRequestIds = new Map();\n  }\n\n  addClientSubscription(clientId: number, requestId: number): void {\n    if (!this.clientRequestIds.has(clientId)) {\n      this.clientRequestIds.set(clientId, []);\n    }\n    const requestIds = this.clientRequestIds.get(clientId);\n    requestIds.push(requestId);\n  }\n\n  deleteClientSubscription(clientId: number, requestId: number): void {\n    const requestIds = this.clientRequestIds.get(clientId);\n    if (typeof requestIds === 'undefined') {\n      logger.error('Can not find client %d to delete', clientId);\n      return;\n    }\n\n    const index = requestIds.indexOf(requestId);\n    if (index < 0) {\n      logger.error('Can not find client %d subscription %d to delete', clientId, requestId);\n      return;\n    }\n    requestIds.splice(index, 1);\n    // Delete client reference if it has no subscription\n    if (requestIds.length == 0) {\n      this.clientRequestIds.delete(clientId);\n    }\n  }\n\n  hasSubscribingClient(): boolean {\n    return this.clientRequestIds.size > 0;\n  }\n}\n\nexport { Subscription };\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"6d6b6e3bbccc7e1038cd0663644b6295af48bbe4"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1xb8gzqef8=function(){return actualCoverage;};}return actualCoverage;}cov_1xb8gzqef8();cov_1xb8gzqef8().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_1xb8gzqef8().s[1]++;exports.Subscription=void 0;var _logger=(cov_1xb8gzqef8().s[2]++,_interopRequireDefault(require("../logger")));function _interopRequireDefault(obj){cov_1xb8gzqef8().f[0]++;cov_1xb8gzqef8().s[3]++;return(cov_1xb8gzqef8().b[1][0]++,obj)&&(cov_1xb8gzqef8().b[1][1]++,obj.__esModule)?(cov_1xb8gzqef8().b[0][0]++,obj):(cov_1xb8gzqef8().b[0][1]++,{default:obj});}class Subscription{// It is query condition eg query.where
constructor(className,query,queryHash){cov_1xb8gzqef8().f[1]++;cov_1xb8gzqef8().s[4]++;this.className=className;cov_1xb8gzqef8().s[5]++;this.query=query;cov_1xb8gzqef8().s[6]++;this.hash=queryHash;cov_1xb8gzqef8().s[7]++;this.clientRequestIds=new Map();}addClientSubscription(clientId,requestId){cov_1xb8gzqef8().f[2]++;cov_1xb8gzqef8().s[8]++;if(!this.clientRequestIds.has(clientId)){cov_1xb8gzqef8().b[2][0]++;cov_1xb8gzqef8().s[9]++;this.clientRequestIds.set(clientId,[]);}else{cov_1xb8gzqef8().b[2][1]++;}const requestIds=(cov_1xb8gzqef8().s[10]++,this.clientRequestIds.get(clientId));cov_1xb8gzqef8().s[11]++;requestIds.push(requestId);}deleteClientSubscription(clientId,requestId){cov_1xb8gzqef8().f[3]++;const requestIds=(cov_1xb8gzqef8().s[12]++,this.clientRequestIds.get(clientId));cov_1xb8gzqef8().s[13]++;if(typeof requestIds==='undefined'){cov_1xb8gzqef8().b[3][0]++;cov_1xb8gzqef8().s[14]++;_logger.default.error('Can not find client %d to delete',clientId);cov_1xb8gzqef8().s[15]++;return;}else{cov_1xb8gzqef8().b[3][1]++;}const index=(cov_1xb8gzqef8().s[16]++,requestIds.indexOf(requestId));cov_1xb8gzqef8().s[17]++;if(index<0){cov_1xb8gzqef8().b[4][0]++;cov_1xb8gzqef8().s[18]++;_logger.default.error('Can not find client %d subscription %d to delete',clientId,requestId);cov_1xb8gzqef8().s[19]++;return;}else{cov_1xb8gzqef8().b[4][1]++;}cov_1xb8gzqef8().s[20]++;requestIds.splice(index,1);// Delete client reference if it has no subscription
cov_1xb8gzqef8().s[21]++;if(requestIds.length==0){cov_1xb8gzqef8().b[5][0]++;cov_1xb8gzqef8().s[22]++;this.clientRequestIds.delete(clientId);}else{cov_1xb8gzqef8().b[5][1]++;}}hasSubscribingClient(){cov_1xb8gzqef8().f[4]++;cov_1xb8gzqef8().s[23]++;return this.clientRequestIds.size>0;}}cov_1xb8gzqef8().s[24]++;exports.Subscription=Subscription;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXZlUXVlcnkvU3Vic2NyaXB0aW9uLmpzIl0sIm5hbWVzIjpbIlN1YnNjcmlwdGlvbiIsImNvbnN0cnVjdG9yIiwiY2xhc3NOYW1lIiwicXVlcnkiLCJxdWVyeUhhc2giLCJoYXNoIiwiY2xpZW50UmVxdWVzdElkcyIsIk1hcCIsImFkZENsaWVudFN1YnNjcmlwdGlvbiIsImNsaWVudElkIiwicmVxdWVzdElkIiwiaGFzIiwic2V0IiwicmVxdWVzdElkcyIsImdldCIsInB1c2giLCJkZWxldGVDbGllbnRTdWJzY3JpcHRpb24iLCJsb2dnZXIiLCJlcnJvciIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsImxlbmd0aCIsImRlbGV0ZSIsImhhc1N1YnNjcmliaW5nQ2xpZW50Iiwic2l6ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7O0FBS0EsTUFBTUEsWUFBTixDQUFtQjtBQUNqQjtBQU1BQyxFQUFBQSxXQUFXLENBQUNDLFNBQUQsRUFBb0JDLEtBQXBCLEVBQXNDQyxTQUF0QyxFQUF5RDtBQUNsRSxTQUFLRixTQUFMLEdBQWlCQSxTQUFqQjtBQUNBLFNBQUtDLEtBQUwsR0FBYUEsS0FBYjtBQUNBLFNBQUtFLElBQUwsR0FBWUQsU0FBWjtBQUNBLFNBQUtFLGdCQUFMLEdBQXdCLElBQUlDLEdBQUosRUFBeEI7QUFDRDs7QUFFREMsRUFBQUEscUJBQXFCLENBQUNDLFFBQUQsRUFBbUJDLFNBQW5CLEVBQTRDO0FBQy9ELFFBQUksQ0FBQyxLQUFLSixnQkFBTCxDQUFzQkssR0FBdEIsQ0FBMEJGLFFBQTFCLENBQUwsRUFBMEM7QUFDeEMsV0FBS0gsZ0JBQUwsQ0FBc0JNLEdBQXRCLENBQTBCSCxRQUExQixFQUFvQyxFQUFwQztBQUNEOztBQUNELFVBQU1JLFVBQVUsR0FBRyxLQUFLUCxnQkFBTCxDQUFzQlEsR0FBdEIsQ0FBMEJMLFFBQTFCLENBQW5CO0FBQ0FJLElBQUFBLFVBQVUsQ0FBQ0UsSUFBWCxDQUFnQkwsU0FBaEI7QUFDRDs7QUFFRE0sRUFBQUEsd0JBQXdCLENBQUNQLFFBQUQsRUFBbUJDLFNBQW5CLEVBQTRDO0FBQ2xFLFVBQU1HLFVBQVUsR0FBRyxLQUFLUCxnQkFBTCxDQUFzQlEsR0FBdEIsQ0FBMEJMLFFBQTFCLENBQW5COztBQUNBLFFBQUksT0FBT0ksVUFBUCxLQUFzQixXQUExQixFQUF1QztBQUNyQ0ksc0JBQU9DLEtBQVAsQ0FBYSxrQ0FBYixFQUFpRFQsUUFBakQ7O0FBQ0E7QUFDRDs7QUFFRCxVQUFNVSxLQUFLLEdBQUdOLFVBQVUsQ0FBQ08sT0FBWCxDQUFtQlYsU0FBbkIsQ0FBZDs7QUFDQSxRQUFJUyxLQUFLLEdBQUcsQ0FBWixFQUFlO0FBQ2JGLHNCQUFPQyxLQUFQLENBQWEsa0RBQWIsRUFBaUVULFFBQWpFLEVBQTJFQyxTQUEzRTs7QUFDQTtBQUNEOztBQUNERyxJQUFBQSxVQUFVLENBQUNRLE1BQVgsQ0FBa0JGLEtBQWxCLEVBQXlCLENBQXpCLEVBWmtFLENBYWxFOztBQUNBLFFBQUlOLFVBQVUsQ0FBQ1MsTUFBWCxJQUFxQixDQUF6QixFQUE0QjtBQUMxQixXQUFLaEIsZ0JBQUwsQ0FBc0JpQixNQUF0QixDQUE2QmQsUUFBN0I7QUFDRDtBQUNGOztBQUVEZSxFQUFBQSxvQkFBb0IsR0FBWTtBQUM5QixXQUFPLEtBQUtsQixnQkFBTCxDQUFzQm1CLElBQXRCLEdBQTZCLENBQXBDO0FBQ0Q7O0FBM0NnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2dnZXIgZnJvbSAnLi4vbG9nZ2VyJztcblxuZXhwb3J0IHR5cGUgRmxhdHRlbmVkT2JqZWN0RGF0YSA9IHsgW2F0dHI6IHN0cmluZ106IGFueSB9O1xuZXhwb3J0IHR5cGUgUXVlcnlEYXRhID0geyBbYXR0cjogc3RyaW5nXTogYW55IH07XG5cbmNsYXNzIFN1YnNjcmlwdGlvbiB7XG4gIC8vIEl0IGlzIHF1ZXJ5IGNvbmRpdGlvbiBlZyBxdWVyeS53aGVyZVxuICBxdWVyeTogUXVlcnlEYXRhO1xuICBjbGFzc05hbWU6IHN0cmluZztcbiAgaGFzaDogc3RyaW5nO1xuICBjbGllbnRSZXF1ZXN0SWRzOiBPYmplY3Q7XG5cbiAgY29uc3RydWN0b3IoY2xhc3NOYW1lOiBzdHJpbmcsIHF1ZXJ5OiBRdWVyeURhdGEsIHF1ZXJ5SGFzaDogc3RyaW5nKSB7XG4gICAgdGhpcy5jbGFzc05hbWUgPSBjbGFzc05hbWU7XG4gICAgdGhpcy5xdWVyeSA9IHF1ZXJ5O1xuICAgIHRoaXMuaGFzaCA9IHF1ZXJ5SGFzaDtcbiAgICB0aGlzLmNsaWVudFJlcXVlc3RJZHMgPSBuZXcgTWFwKCk7XG4gIH1cblxuICBhZGRDbGllbnRTdWJzY3JpcHRpb24oY2xpZW50SWQ6IG51bWJlciwgcmVxdWVzdElkOiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuY2xpZW50UmVxdWVzdElkcy5oYXMoY2xpZW50SWQpKSB7XG4gICAgICB0aGlzLmNsaWVudFJlcXVlc3RJZHMuc2V0KGNsaWVudElkLCBbXSk7XG4gICAgfVxuICAgIGNvbnN0IHJlcXVlc3RJZHMgPSB0aGlzLmNsaWVudFJlcXVlc3RJZHMuZ2V0KGNsaWVudElkKTtcbiAgICByZXF1ZXN0SWRzLnB1c2gocmVxdWVzdElkKTtcbiAgfVxuXG4gIGRlbGV0ZUNsaWVudFN1YnNjcmlwdGlvbihjbGllbnRJZDogbnVtYmVyLCByZXF1ZXN0SWQ6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IHJlcXVlc3RJZHMgPSB0aGlzLmNsaWVudFJlcXVlc3RJZHMuZ2V0KGNsaWVudElkKTtcbiAgICBpZiAodHlwZW9mIHJlcXVlc3RJZHMgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0NhbiBub3QgZmluZCBjbGllbnQgJWQgdG8gZGVsZXRlJywgY2xpZW50SWQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGluZGV4ID0gcmVxdWVzdElkcy5pbmRleE9mKHJlcXVlc3RJZCk7XG4gICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgbG9nZ2VyLmVycm9yKCdDYW4gbm90IGZpbmQgY2xpZW50ICVkIHN1YnNjcmlwdGlvbiAlZCB0byBkZWxldGUnLCBjbGllbnRJZCwgcmVxdWVzdElkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmVxdWVzdElkcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIC8vIERlbGV0ZSBjbGllbnQgcmVmZXJlbmNlIGlmIGl0IGhhcyBubyBzdWJzY3JpcHRpb25cbiAgICBpZiAocmVxdWVzdElkcy5sZW5ndGggPT0gMCkge1xuICAgICAgdGhpcy5jbGllbnRSZXF1ZXN0SWRzLmRlbGV0ZShjbGllbnRJZCk7XG4gICAgfVxuICB9XG5cbiAgaGFzU3Vic2NyaWJpbmdDbGllbnQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY2xpZW50UmVxdWVzdElkcy5zaXplID4gMDtcbiAgfVxufVxuXG5leHBvcnQgeyBTdWJzY3JpcHRpb24gfTtcbiJdfQ==
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9MaXZlUXVlcnkvU3Vic2NyaXB0aW9uLmpzIl0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwicXVlcnkiLCJhZGRDbGllbnRTdWJzY3JpcHRpb24iLCJyZXF1ZXN0SWRzIiwiZGVsZXRlQ2xpZW50U3Vic2NyaXB0aW9uIiwibG9nZ2VyIiwiaW5kZXgiLCJoYXNTdWJzY3JpYmluZ0NsaWVudCJdLCJtYXBwaW5ncyI6ImlrT0FjSTtnT0FkSixHQUFBLENBQUEsT0FBQSwwQkFBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQSxDQUFBLEMsc1BBS0EsS0FBQSxDQUFBLFlBQW1CLENBQ2pCO0FBTUFBLFdBQVcsQ0FBQSxTQUFBLENBQUEsS0FBQSxDQUFBLFNBQUEsQ0FBeUQsaURBQ2xFLEtBQUEsU0FBQSxDQUFBLFNBQUEsQ0FEa0Usd0JBRWxFLEtBQUtDLEtBQUwsQ0FBQSxLQUFBLENBRmtFLHdCQUdsRSxLQUFBLElBQUEsQ0FBQSxTQUFBLENBSGtFLHdCQUlsRSxLQUFBLGdCQUFBLENBQXdCLEdBQXhCLENBQUEsR0FBd0IsRUFBeEIsQ0FDRCxDQUVEQyxxQkFBcUIsQ0FBQSxRQUFBLENBQUEsU0FBQSxDQUE0QyxpREFDL0QsR0FBSSxDQUFDLEtBQUEsZ0JBQUEsQ0FBQSxHQUFBLENBQUwsUUFBSyxDQUFMLENBQTBDLG9EQUN4QyxLQUFBLGdCQUFBLENBQUEsR0FBQSxDQUFBLFFBQUEsQ0FBQSxFQUFBLEVBQ0QsQ0FGRCxpQ0FHQSxLQUFNQyxDQUFBQSxVQUFVLDJCQUFHLEtBQUEsZ0JBQUEsQ0FBQSxHQUFBLENBQW5CLFFBQW1CLENBQUgsQ0FBaEIsQ0FKK0QseUJBSy9EQSxVQUFVLENBQVZBLElBQUFBLENBQUFBLFNBQUFBLEVBQ0QsQ0FFREMsd0JBQXdCLENBQUEsUUFBQSxDQUFBLFNBQUEsQ0FBNEMseUJBQ2xFLEtBQU1ELENBQUFBLFVBQVUsMkJBQUcsS0FBQSxnQkFBQSxDQUFBLEdBQUEsQ0FBbkIsUUFBbUIsQ0FBSCxDQUFoQixDQURrRSx5QkFFbEUsR0FBSSxNQUFBLENBQUEsVUFBQSxHQUFKLFdBQUEsQ0FBdUMscURBQ3JDRSxPQUFBQSxDQUFBQSxPQUFBQSxDQUFBQSxLQUFBQSxDQUFBQSxrQ0FBQUEsQ0FBQUEsUUFBQUEsRUFEcUMseUJBRXJDLE9BQ0QsQ0FIRCxpQ0FLQSxLQUFNQyxDQUFBQSxLQUFLLDJCQUFHSCxVQUFVLENBQVZBLE9BQUFBLENBQWQsU0FBY0EsQ0FBSCxDQUFYLENBUGtFLHlCQVFsRSxHQUFJRyxLQUFLLENBQVQsQ0FBQSxDQUFlLHFEQUNiRCxPQUFBQSxDQUFBQSxPQUFBQSxDQUFBQSxLQUFBQSxDQUFBQSxrREFBQUEsQ0FBQUEsUUFBQUEsQ0FBQUEsU0FBQUEsRUFEYSx5QkFFYixPQUNELENBSEQsaUNBUmtFLHlCQVlsRUYsVUFBVSxDQUFWQSxNQUFBQSxDQUFBQSxLQUFBQSxDQVprRSxDQVlsRUEsRUFDQTtBQWJrRSx5QkFjbEUsR0FBSUEsVUFBVSxDQUFWQSxNQUFBQSxFQUFKLENBQUEsQ0FBNEIscURBQzFCLEtBQUEsZ0JBQUEsQ0FBQSxNQUFBLENBQUEsUUFBQSxFQUNELENBRkQsaUNBR0QsQ0FFREksb0JBQW9CLEVBQVksa0RBQzlCLE1BQU8sTUFBQSxnQkFBQSxDQUFBLElBQUEsQ0FBUCxDQUFBLENBQ0QsQ0EzQ2dCLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nZ2VyIGZyb20gJy4uL2xvZ2dlcic7XG5cbmV4cG9ydCB0eXBlIEZsYXR0ZW5lZE9iamVjdERhdGEgPSB7IFthdHRyOiBzdHJpbmddOiBhbnkgfTtcbmV4cG9ydCB0eXBlIFF1ZXJ5RGF0YSA9IHsgW2F0dHI6IHN0cmluZ106IGFueSB9O1xuXG5jbGFzcyBTdWJzY3JpcHRpb24ge1xuICAvLyBJdCBpcyBxdWVyeSBjb25kaXRpb24gZWcgcXVlcnkud2hlcmVcbiAgcXVlcnk6IFF1ZXJ5RGF0YTtcbiAgY2xhc3NOYW1lOiBzdHJpbmc7XG4gIGhhc2g6IHN0cmluZztcbiAgY2xpZW50UmVxdWVzdElkczogT2JqZWN0O1xuXG4gIGNvbnN0cnVjdG9yKGNsYXNzTmFtZTogc3RyaW5nLCBxdWVyeTogUXVlcnlEYXRhLCBxdWVyeUhhc2g6IHN0cmluZykge1xuICAgIHRoaXMuY2xhc3NOYW1lID0gY2xhc3NOYW1lO1xuICAgIHRoaXMucXVlcnkgPSBxdWVyeTtcbiAgICB0aGlzLmhhc2ggPSBxdWVyeUhhc2g7XG4gICAgdGhpcy5jbGllbnRSZXF1ZXN0SWRzID0gbmV3IE1hcCgpO1xuICB9XG5cbiAgYWRkQ2xpZW50U3Vic2NyaXB0aW9uKGNsaWVudElkOiBudW1iZXIsIHJlcXVlc3RJZDogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNsaWVudFJlcXVlc3RJZHMuaGFzKGNsaWVudElkKSkge1xuICAgICAgdGhpcy5jbGllbnRSZXF1ZXN0SWRzLnNldChjbGllbnRJZCwgW10pO1xuICAgIH1cbiAgICBjb25zdCByZXF1ZXN0SWRzID0gdGhpcy5jbGllbnRSZXF1ZXN0SWRzLmdldChjbGllbnRJZCk7XG4gICAgcmVxdWVzdElkcy5wdXNoKHJlcXVlc3RJZCk7XG4gIH1cblxuICBkZWxldGVDbGllbnRTdWJzY3JpcHRpb24oY2xpZW50SWQ6IG51bWJlciwgcmVxdWVzdElkOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCByZXF1ZXN0SWRzID0gdGhpcy5jbGllbnRSZXF1ZXN0SWRzLmdldChjbGllbnRJZCk7XG4gICAgaWYgKHR5cGVvZiByZXF1ZXN0SWRzID09PSAndW5kZWZpbmVkJykge1xuICAgICAgbG9nZ2VyLmVycm9yKCdDYW4gbm90IGZpbmQgY2xpZW50ICVkIHRvIGRlbGV0ZScsIGNsaWVudElkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpbmRleCA9IHJlcXVlc3RJZHMuaW5kZXhPZihyZXF1ZXN0SWQpO1xuICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQ2FuIG5vdCBmaW5kIGNsaWVudCAlZCBzdWJzY3JpcHRpb24gJWQgdG8gZGVsZXRlJywgY2xpZW50SWQsIHJlcXVlc3RJZCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJlcXVlc3RJZHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAvLyBEZWxldGUgY2xpZW50IHJlZmVyZW5jZSBpZiBpdCBoYXMgbm8gc3Vic2NyaXB0aW9uXG4gICAgaWYgKHJlcXVlc3RJZHMubGVuZ3RoID09IDApIHtcbiAgICAgIHRoaXMuY2xpZW50UmVxdWVzdElkcy5kZWxldGUoY2xpZW50SWQpO1xuICAgIH1cbiAgfVxuXG4gIGhhc1N1YnNjcmliaW5nQ2xpZW50KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNsaWVudFJlcXVlc3RJZHMuc2l6ZSA+IDA7XG4gIH1cbn1cblxuZXhwb3J0IHsgU3Vic2NyaXB0aW9uIH07XG4iXX0=