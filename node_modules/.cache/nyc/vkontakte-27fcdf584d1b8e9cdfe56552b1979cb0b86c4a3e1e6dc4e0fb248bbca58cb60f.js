'use strict';// Helper functions for accessing the vkontakte API.
function cov_13nckut8sd(){var path="/parse-server/lib/Adapters/Auth/vkontakte.js";var hash="800b30deab5021c058981708a69ce427cc60a9b4";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Adapters/Auth/vkontakte.js",statementMap:{"0":{start:{line:3,column:21},end:{line:3,column:46}},"1":{start:{line:5,column:12},end:{line:5,column:39}},"2":{start:{line:9,column:2},end:{line:21,column:5}},"3":{start:{line:10,column:4},end:{line:18,column:5}},"4":{start:{line:11,column:6},end:{line:17,column:9}},"5":{start:{line:12,column:8},end:{line:14,column:9}},"6":{start:{line:13,column:10},end:{line:13,column:17}},"7":{start:{line:16,column:8},end:{line:16,column:97}},"8":{start:{line:20,column:4},end:{line:20,column:96}},"9":{start:{line:25,column:2},end:{line:37,column:5}},"10":{start:{line:26,column:4},end:{line:28,column:5}},"11":{start:{line:27,column:6},end:{line:27,column:117}},"12":{start:{line:30,column:4},end:{line:32,column:5}},"13":{start:{line:31,column:6},end:{line:31,column:34}},"14":{start:{line:34,column:4},end:{line:34,column:14}},"15":{start:{line:36,column:4},end:{line:36,column:180}},"16":{start:{line:42,column:2},end:{line:42,column:27}},"17":{start:{line:47,column:2},end:{line:47,column:58}},"18":{start:{line:50,column:0},end:{line:53,column:2}}},fnMap:{"0":{name:"validateAuthData",decl:{start:{line:8,column:9},end:{line:8,column:25}},loc:{start:{line:8,column:44},end:{line:22,column:1}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:38},end:{line:9,column:39}},loc:{start:{line:9,column:58},end:{line:21,column:3}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:11,column:126},end:{line:11,column:127}},loc:{start:{line:11,column:146},end:{line:17,column:7}},line:11},"3":{name:"vkOAuth2Request",decl:{start:{line:24,column:9},end:{line:24,column:24}},loc:{start:{line:24,column:33},end:{line:38,column:1}},line:24},"4":{name:"(anonymous_4)",decl:{start:{line:25,column:21},end:{line:25,column:22}},loc:{start:{line:25,column:40},end:{line:35,column:3}},line:25},"5":{name:"(anonymous_5)",decl:{start:{line:35,column:10},end:{line:35,column:11}},loc:{start:{line:35,column:22},end:{line:37,column:3}},line:35},"6":{name:"validateAppId",decl:{start:{line:41,column:9},end:{line:41,column:22}},loc:{start:{line:41,column:25},end:{line:43,column:1}},line:41},"7":{name:"request",decl:{start:{line:46,column:9},end:{line:46,column:16}},loc:{start:{line:46,column:29},end:{line:48,column:1}},line:46}},branchMap:{"0":{loc:{start:{line:10,column:4},end:{line:18,column:5}},type:"if",locations:[{start:{line:10,column:4},end:{line:18,column:5}},{start:{line:10,column:4},end:{line:18,column:5}}],line:10},"1":{loc:{start:{line:10,column:8},end:{line:10,column:41}},type:"binary-expr",locations:[{start:{line:10,column:8},end:{line:10,column:16}},{start:{line:10,column:20},end:{line:10,column:41}}],line:10},"2":{loc:{start:{line:12,column:8},end:{line:14,column:9}},type:"if",locations:[{start:{line:12,column:8},end:{line:14,column:9}},{start:{line:12,column:8},end:{line:14,column:9}}],line:12},"3":{loc:{start:{line:12,column:12},end:{line:12,column:111}},type:"binary-expr",locations:[{start:{line:12,column:12},end:{line:12,column:20}},{start:{line:12,column:24},end:{line:12,column:41}},{start:{line:12,column:45},end:{line:12,column:69}},{start:{line:12,column:73},end:{line:12,column:111}}],line:12},"4":{loc:{start:{line:26,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:26,column:4},end:{line:28,column:5}},{start:{line:26,column:4},end:{line:28,column:5}}],line:26},"5":{loc:{start:{line:26,column:8},end:{line:26,column:107}},type:"binary-expr",locations:[{start:{line:26,column:8},end:{line:26,column:15}},{start:{line:26,column:19},end:{line:26,column:33}},{start:{line:26,column:37},end:{line:26,column:58}},{start:{line:26,column:62},end:{line:26,column:79}},{start:{line:26,column:83},end:{line:26,column:107}}],line:26},"6":{loc:{start:{line:30,column:4},end:{line:32,column:5}},type:"if",locations:[{start:{line:30,column:4},end:{line:32,column:5}},{start:{line:30,column:4},end:{line:32,column:5}}],line:30}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0,0,0],"4":[0,0],"5":[0,0,0,0,0],"6":[0,0]},inputSourceMap:{version:3,sources:["../../../src/Adapters/Auth/vkontakte.js"],names:["httpsRequest","require","Parse","validateAuthData","authData","params","vkOAuth2Request","then","response","access_token","request","apiVersion","length","id","Error","OBJECT_NOT_FOUND","Promise","resolve","appIds","appSecret","validateAppId","host","path","get","module","exports"],mappings:"AAAA,a,CAEA;;AAEA,MAAMA,YAAY,GAAGC,OAAO,CAAC,gBAAD,CAA5B;;AACA,IAAIC,KAAK,GAAGD,OAAO,CAAC,YAAD,CAAP,CAAsBC,KAAlC,C,CAEA;;;AACA,SAASC,gBAAT,CAA0BC,QAA1B,EAAoCC,MAApC,EAA4C;AAC1C,SAAOC,eAAe,CAACD,MAAD,CAAf,CAAwBE,IAAxB,CAA6B,UAAUC,QAAV,EAAoB;AACtD,QAAIA,QAAQ,IAAIA,QAAQ,CAACC,YAAzB,EAAuC;AACrC,aAAOC,OAAO,CACZ,YADY,EAEZ,mCAAmCN,QAAQ,CAACK,YAA5C,GAA2D,KAA3D,GAAmEJ,MAAM,CAACM,UAF9D,CAAP,CAGLJ,IAHK,CAGA,UAAUC,QAAV,EAAoB;AACzB,YACEA,QAAQ,IACRA,QAAQ,CAACA,QADT,IAEAA,QAAQ,CAACA,QAAT,CAAkBI,MAFlB,IAGAJ,QAAQ,CAACA,QAAT,CAAkB,CAAlB,EAAqBK,EAArB,IAA2BT,QAAQ,CAACS,EAJtC,EAKE;AACA;AACD;;AACD,cAAM,IAAIX,KAAK,CAACY,KAAV,CAAgBZ,KAAK,CAACY,KAAN,CAAYC,gBAA5B,EAA8C,mCAA9C,CAAN;AACD,OAbM,CAAP;AAcD;;AACD,UAAM,IAAIb,KAAK,CAACY,KAAV,CAAgBZ,KAAK,CAACY,KAAN,CAAYC,gBAA5B,EAA8C,sCAA9C,CAAN;AACD,GAlBM,CAAP;AAmBD;;AAED,SAAST,eAAT,CAAyBD,MAAzB,EAAiC;AAC/B,SAAO,IAAIW,OAAJ,CAAY,UAAUC,OAAV,EAAmB;AACpC,QACE,CAACZ,MAAD,IACA,CAACA,MAAM,CAACa,MADR,IAEA,CAACb,MAAM,CAACa,MAAP,CAAcN,MAFf,IAGA,CAACP,MAAM,CAACc,SAHR,IAIA,CAACd,MAAM,CAACc,SAAP,CAAiBP,MALpB,EAME;AACA,YAAM,IAAIV,KAAK,CAACY,KAAV,CACJZ,KAAK,CAACY,KAAN,CAAYC,gBADR,EAEJ,yDAFI,CAAN;AAID;;AACD,QAAI,CAACV,MAAM,CAACM,UAAZ,EAAwB;AACtBN,MAAAA,MAAM,CAACM,UAAP,GAAoB,OAApB;AACD;;AACDM,IAAAA,OAAO;AACR,GAjBM,EAiBJV,IAjBI,CAiBC,YAAY;AAClB,WAAOG,OAAO,CACZ,cADY,EAEZ,4BACEL,MAAM,CAACa,MADT,GAEE,iBAFF,GAGEb,MAAM,CAACc,SAHT,GAIE,KAJF,GAKEd,MAAM,CAACM,UALT,GAME,gCARU,CAAd;AAUD,GA5BM,CAAP;AA6BD,C,CAED;;;AACA,SAASS,aAAT,GAAyB;AACvB,SAAOJ,OAAO,CAACC,OAAR,EAAP;AACD,C,CAED;;;AACA,SAASP,OAAT,CAAiBW,IAAjB,EAAuBC,IAAvB,EAA6B;AAC3B,SAAOtB,YAAY,CAACuB,GAAb,CAAiB,aAAaF,IAAb,GAAoB,GAApB,GAA0BC,IAA3C,CAAP;AACD;;AAEDE,MAAM,CAACC,OAAP,GAAiB;AACfL,EAAAA,aAAa,EAAEA,aADA;AAEfjB,EAAAA,gBAAgB,EAAEA;AAFH,CAAjB",sourcesContent:["'use strict';\n\n// Helper functions for accessing the vkontakte API.\n\nconst httpsRequest = require('./httpsRequest');\nvar Parse = require('parse/node').Parse;\n\n// Returns a promise that fulfills iff this user id is valid.\nfunction validateAuthData(authData, params) {\n  return vkOAuth2Request(params).then(function (response) {\n    if (response && response.access_token) {\n      return request(\n        'api.vk.com',\n        'method/users.get?access_token=' + authData.access_token + '&v=' + params.apiVersion\n      ).then(function (response) {\n        if (\n          response &&\n          response.response &&\n          response.response.length &&\n          response.response[0].id == authData.id\n        ) {\n          return;\n        }\n        throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, 'Vk auth is invalid for this user.');\n      });\n    }\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, 'Vk appIds or appSecret is incorrect.');\n  });\n}\n\nfunction vkOAuth2Request(params) {\n  return new Promise(function (resolve) {\n    if (\n      !params ||\n      !params.appIds ||\n      !params.appIds.length ||\n      !params.appSecret ||\n      !params.appSecret.length\n    ) {\n      throw new Parse.Error(\n        Parse.Error.OBJECT_NOT_FOUND,\n        'Vk auth is not configured. Missing appIds or appSecret.'\n      );\n    }\n    if (!params.apiVersion) {\n      params.apiVersion = '5.124';\n    }\n    resolve();\n  }).then(function () {\n    return request(\n      'oauth.vk.com',\n      'access_token?client_id=' +\n        params.appIds +\n        '&client_secret=' +\n        params.appSecret +\n        '&v=' +\n        params.apiVersion +\n        '&grant_type=client_credentials'\n    );\n  });\n}\n\n// Returns a promise that fulfills iff this app id is valid.\nfunction validateAppId() {\n  return Promise.resolve();\n}\n\n// A promisey wrapper for api requests\nfunction request(host, path) {\n  return httpsRequest.get('https://' + host + '/' + path);\n}\n\nmodule.exports = {\n  validateAppId: validateAppId,\n  validateAuthData: validateAuthData,\n};\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"800b30deab5021c058981708a69ce427cc60a9b4"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_13nckut8sd=function(){return actualCoverage;};}return actualCoverage;}cov_13nckut8sd();const httpsRequest=(cov_13nckut8sd().s[0]++,require('./httpsRequest'));var Parse=(cov_13nckut8sd().s[1]++,require('parse/node').Parse);// Returns a promise that fulfills iff this user id is valid.
function validateAuthData(authData,params){cov_13nckut8sd().f[0]++;cov_13nckut8sd().s[2]++;return vkOAuth2Request(params).then(function(response){cov_13nckut8sd().f[1]++;cov_13nckut8sd().s[3]++;if((cov_13nckut8sd().b[1][0]++,response)&&(cov_13nckut8sd().b[1][1]++,response.access_token)){cov_13nckut8sd().b[0][0]++;cov_13nckut8sd().s[4]++;return request('api.vk.com','method/users.get?access_token='+authData.access_token+'&v='+params.apiVersion).then(function(response){cov_13nckut8sd().f[2]++;cov_13nckut8sd().s[5]++;if((cov_13nckut8sd().b[3][0]++,response)&&(cov_13nckut8sd().b[3][1]++,response.response)&&(cov_13nckut8sd().b[3][2]++,response.response.length)&&(cov_13nckut8sd().b[3][3]++,response.response[0].id==authData.id)){cov_13nckut8sd().b[2][0]++;cov_13nckut8sd().s[6]++;return;}else{cov_13nckut8sd().b[2][1]++;}cov_13nckut8sd().s[7]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,'Vk auth is invalid for this user.');});}else{cov_13nckut8sd().b[0][1]++;}cov_13nckut8sd().s[8]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,'Vk appIds or appSecret is incorrect.');});}function vkOAuth2Request(params){cov_13nckut8sd().f[3]++;cov_13nckut8sd().s[9]++;return new Promise(function(resolve){cov_13nckut8sd().f[4]++;cov_13nckut8sd().s[10]++;if((cov_13nckut8sd().b[5][0]++,!params)||(cov_13nckut8sd().b[5][1]++,!params.appIds)||(cov_13nckut8sd().b[5][2]++,!params.appIds.length)||(cov_13nckut8sd().b[5][3]++,!params.appSecret)||(cov_13nckut8sd().b[5][4]++,!params.appSecret.length)){cov_13nckut8sd().b[4][0]++;cov_13nckut8sd().s[11]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,'Vk auth is not configured. Missing appIds or appSecret.');}else{cov_13nckut8sd().b[4][1]++;}cov_13nckut8sd().s[12]++;if(!params.apiVersion){cov_13nckut8sd().b[6][0]++;cov_13nckut8sd().s[13]++;params.apiVersion='5.124';}else{cov_13nckut8sd().b[6][1]++;}cov_13nckut8sd().s[14]++;resolve();}).then(function(){cov_13nckut8sd().f[5]++;cov_13nckut8sd().s[15]++;return request('oauth.vk.com','access_token?client_id='+params.appIds+'&client_secret='+params.appSecret+'&v='+params.apiVersion+'&grant_type=client_credentials');});}// Returns a promise that fulfills iff this app id is valid.
function validateAppId(){cov_13nckut8sd().f[6]++;cov_13nckut8sd().s[16]++;return Promise.resolve();}// A promisey wrapper for api requests
function request(host,path){cov_13nckut8sd().f[7]++;cov_13nckut8sd().s[17]++;return httpsRequest.get('https://'+host+'/'+path);}cov_13nckut8sd().s[18]++;module.exports={validateAppId:validateAppId,validateAuthData:validateAuthData};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9BdXRoL3Zrb250YWt0ZS5qcyJdLCJuYW1lcyI6WyJodHRwc1JlcXVlc3QiLCJyZXF1aXJlIiwiUGFyc2UiLCJ2YWxpZGF0ZUF1dGhEYXRhIiwiYXV0aERhdGEiLCJwYXJhbXMiLCJ2a09BdXRoMlJlcXVlc3QiLCJ0aGVuIiwicmVzcG9uc2UiLCJhY2Nlc3NfdG9rZW4iLCJyZXF1ZXN0IiwiYXBpVmVyc2lvbiIsImxlbmd0aCIsImlkIiwiRXJyb3IiLCJPQkpFQ1RfTk9UX0ZPVU5EIiwiUHJvbWlzZSIsInJlc29sdmUiLCJhcHBJZHMiLCJhcHBTZWNyZXQiLCJ2YWxpZGF0ZUFwcElkIiwiaG9zdCIsInBhdGgiLCJnZXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBRUE7O0FBRUEsTUFBTUEsWUFBWSxHQUFHQyxPQUFPLENBQUMsZ0JBQUQsQ0FBNUI7O0FBQ0EsSUFBSUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsWUFBRCxDQUFQLENBQXNCQyxLQUFsQyxDLENBRUE7OztBQUNBLFNBQVNDLGdCQUFULENBQTBCQyxRQUExQixFQUFvQ0MsTUFBcEMsRUFBNEM7QUFDMUMsU0FBT0MsZUFBZSxDQUFDRCxNQUFELENBQWYsQ0FBd0JFLElBQXhCLENBQTZCLFVBQVVDLFFBQVYsRUFBb0I7QUFDdEQsUUFBSUEsUUFBUSxJQUFJQSxRQUFRLENBQUNDLFlBQXpCLEVBQXVDO0FBQ3JDLGFBQU9DLE9BQU8sQ0FDWixZQURZLEVBRVosbUNBQW1DTixRQUFRLENBQUNLLFlBQTVDLEdBQTJELEtBQTNELEdBQW1FSixNQUFNLENBQUNNLFVBRjlELENBQVAsQ0FHTEosSUFISyxDQUdBLFVBQVVDLFFBQVYsRUFBb0I7QUFDekIsWUFDRUEsUUFBUSxJQUNSQSxRQUFRLENBQUNBLFFBRFQsSUFFQUEsUUFBUSxDQUFDQSxRQUFULENBQWtCSSxNQUZsQixJQUdBSixRQUFRLENBQUNBLFFBQVQsQ0FBa0IsQ0FBbEIsRUFBcUJLLEVBQXJCLElBQTJCVCxRQUFRLENBQUNTLEVBSnRDLEVBS0U7QUFDQTtBQUNEOztBQUNELGNBQU0sSUFBSVgsS0FBSyxDQUFDWSxLQUFWLENBQWdCWixLQUFLLENBQUNZLEtBQU4sQ0FBWUMsZ0JBQTVCLEVBQThDLG1DQUE5QyxDQUFOO0FBQ0QsT0FiTSxDQUFQO0FBY0Q7O0FBQ0QsVUFBTSxJQUFJYixLQUFLLENBQUNZLEtBQVYsQ0FBZ0JaLEtBQUssQ0FBQ1ksS0FBTixDQUFZQyxnQkFBNUIsRUFBOEMsc0NBQTlDLENBQU47QUFDRCxHQWxCTSxDQUFQO0FBbUJEOztBQUVELFNBQVNULGVBQVQsQ0FBeUJELE1BQXpCLEVBQWlDO0FBQy9CLFNBQU8sSUFBSVcsT0FBSixDQUFZLFVBQVVDLE9BQVYsRUFBbUI7QUFDcEMsUUFDRSxDQUFDWixNQUFELElBQ0EsQ0FBQ0EsTUFBTSxDQUFDYSxNQURSLElBRUEsQ0FBQ2IsTUFBTSxDQUFDYSxNQUFQLENBQWNOLE1BRmYsSUFHQSxDQUFDUCxNQUFNLENBQUNjLFNBSFIsSUFJQSxDQUFDZCxNQUFNLENBQUNjLFNBQVAsQ0FBaUJQLE1BTHBCLEVBTUU7QUFDQSxZQUFNLElBQUlWLEtBQUssQ0FBQ1ksS0FBVixDQUNKWixLQUFLLENBQUNZLEtBQU4sQ0FBWUMsZ0JBRFIsRUFFSix5REFGSSxDQUFOO0FBSUQ7O0FBQ0QsUUFBSSxDQUFDVixNQUFNLENBQUNNLFVBQVosRUFBd0I7QUFDdEJOLE1BQUFBLE1BQU0sQ0FBQ00sVUFBUCxHQUFvQixPQUFwQjtBQUNEOztBQUNETSxJQUFBQSxPQUFPO0FBQ1IsR0FqQk0sRUFpQkpWLElBakJJLENBaUJDLFlBQVk7QUFDbEIsV0FBT0csT0FBTyxDQUNaLGNBRFksRUFFWiw0QkFDRUwsTUFBTSxDQUFDYSxNQURULEdBRUUsaUJBRkYsR0FHRWIsTUFBTSxDQUFDYyxTQUhULEdBSUUsS0FKRixHQUtFZCxNQUFNLENBQUNNLFVBTFQsR0FNRSxnQ0FSVSxDQUFkO0FBVUQsR0E1Qk0sQ0FBUDtBQTZCRCxDLENBRUQ7OztBQUNBLFNBQVNTLGFBQVQsR0FBeUI7QUFDdkIsU0FBT0osT0FBTyxDQUFDQyxPQUFSLEVBQVA7QUFDRCxDLENBRUQ7OztBQUNBLFNBQVNQLE9BQVQsQ0FBaUJXLElBQWpCLEVBQXVCQyxJQUF2QixFQUE2QjtBQUMzQixTQUFPdEIsWUFBWSxDQUFDdUIsR0FBYixDQUFpQixhQUFhRixJQUFiLEdBQW9CLEdBQXBCLEdBQTBCQyxJQUEzQyxDQUFQO0FBQ0Q7O0FBRURFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQUNmTCxFQUFBQSxhQUFhLEVBQUVBLGFBREE7QUFFZmpCLEVBQUFBLGdCQUFnQixFQUFFQTtBQUZILENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb25zIGZvciBhY2Nlc3NpbmcgdGhlIHZrb250YWt0ZSBBUEkuXG5cbmNvbnN0IGh0dHBzUmVxdWVzdCA9IHJlcXVpcmUoJy4vaHR0cHNSZXF1ZXN0Jyk7XG52YXIgUGFyc2UgPSByZXF1aXJlKCdwYXJzZS9ub2RlJykuUGFyc2U7XG5cbi8vIFJldHVybnMgYSBwcm9taXNlIHRoYXQgZnVsZmlsbHMgaWZmIHRoaXMgdXNlciBpZCBpcyB2YWxpZC5cbmZ1bmN0aW9uIHZhbGlkYXRlQXV0aERhdGEoYXV0aERhdGEsIHBhcmFtcykge1xuICByZXR1cm4gdmtPQXV0aDJSZXF1ZXN0KHBhcmFtcykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuYWNjZXNzX3Rva2VuKSB7XG4gICAgICByZXR1cm4gcmVxdWVzdChcbiAgICAgICAgJ2FwaS52ay5jb20nLFxuICAgICAgICAnbWV0aG9kL3VzZXJzLmdldD9hY2Nlc3NfdG9rZW49JyArIGF1dGhEYXRhLmFjY2Vzc190b2tlbiArICcmdj0nICsgcGFyYW1zLmFwaVZlcnNpb25cbiAgICAgICkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHJlc3BvbnNlICYmXG4gICAgICAgICAgcmVzcG9uc2UucmVzcG9uc2UgJiZcbiAgICAgICAgICByZXNwb25zZS5yZXNwb25zZS5sZW5ndGggJiZcbiAgICAgICAgICByZXNwb25zZS5yZXNwb25zZVswXS5pZCA9PSBhdXRoRGF0YS5pZFxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsICdWayBhdXRoIGlzIGludmFsaWQgZm9yIHRoaXMgdXNlci4nKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgJ1ZrIGFwcElkcyBvciBhcHBTZWNyZXQgaXMgaW5jb3JyZWN0LicpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gdmtPQXV0aDJSZXF1ZXN0KHBhcmFtcykge1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICBpZiAoXG4gICAgICAhcGFyYW1zIHx8XG4gICAgICAhcGFyYW1zLmFwcElkcyB8fFxuICAgICAgIXBhcmFtcy5hcHBJZHMubGVuZ3RoIHx8XG4gICAgICAhcGFyYW1zLmFwcFNlY3JldCB8fFxuICAgICAgIXBhcmFtcy5hcHBTZWNyZXQubGVuZ3RoXG4gICAgKSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgIFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsXG4gICAgICAgICdWayBhdXRoIGlzIG5vdCBjb25maWd1cmVkLiBNaXNzaW5nIGFwcElkcyBvciBhcHBTZWNyZXQuJ1xuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKCFwYXJhbXMuYXBpVmVyc2lvbikge1xuICAgICAgcGFyYW1zLmFwaVZlcnNpb24gPSAnNS4xMjQnO1xuICAgIH1cbiAgICByZXNvbHZlKCk7XG4gIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiByZXF1ZXN0KFxuICAgICAgJ29hdXRoLnZrLmNvbScsXG4gICAgICAnYWNjZXNzX3Rva2VuP2NsaWVudF9pZD0nICtcbiAgICAgICAgcGFyYW1zLmFwcElkcyArXG4gICAgICAgICcmY2xpZW50X3NlY3JldD0nICtcbiAgICAgICAgcGFyYW1zLmFwcFNlY3JldCArXG4gICAgICAgICcmdj0nICtcbiAgICAgICAgcGFyYW1zLmFwaVZlcnNpb24gK1xuICAgICAgICAnJmdyYW50X3R5cGU9Y2xpZW50X2NyZWRlbnRpYWxzJ1xuICAgICk7XG4gIH0pO1xufVxuXG4vLyBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IGZ1bGZpbGxzIGlmZiB0aGlzIGFwcCBpZCBpcyB2YWxpZC5cbmZ1bmN0aW9uIHZhbGlkYXRlQXBwSWQoKSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbn1cblxuLy8gQSBwcm9taXNleSB3cmFwcGVyIGZvciBhcGkgcmVxdWVzdHNcbmZ1bmN0aW9uIHJlcXVlc3QoaG9zdCwgcGF0aCkge1xuICByZXR1cm4gaHR0cHNSZXF1ZXN0LmdldCgnaHR0cHM6Ly8nICsgaG9zdCArICcvJyArIHBhdGgpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgdmFsaWRhdGVBcHBJZDogdmFsaWRhdGVBcHBJZCxcbiAgdmFsaWRhdGVBdXRoRGF0YTogdmFsaWRhdGVBdXRoRGF0YSxcbn07XG4iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9BdXRoL3Zrb250YWt0ZS5qcyJdLCJuYW1lcyI6WyJodHRwc1JlcXVlc3QiLCJyZXF1aXJlIiwiUGFyc2UiLCJyZXNwb25zZSIsImF1dGhEYXRhIiwicGFyYW1zIiwicmVzb2x2ZSIsInJlcXVlc3QiLCJQcm9taXNlIiwibW9kdWxlIiwidmFsaWRhdGVBcHBJZCIsInZhbGlkYXRlQXV0aERhdGEiXSwibWFwcGluZ3MiOiJBQUFBLGFBRUE7NHNSQXFCUTsyRkFuQlIsS0FBTUEsQ0FBQUEsWUFBWSwwQkFBR0MsT0FBTyxDQUE1QixnQkFBNEIsQ0FBVixDQUFsQixDQUNBLEdBQUlDLENBQUFBLEtBQUssMEJBQUdELE9BQU8sQ0FBUEEsWUFBTyxDQUFQQSxDQUFaLEtBQVMsQ0FBVCxDQUVBO0FBQ0EsUUFBQSxDQUFBLGdCQUFBLENBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBNEMsaURBQzFDLE1BQU8sQ0FBQSxlQUFlLENBQWYsTUFBZSxDQUFmLENBQUEsSUFBQSxDQUE2QixTQUFBLFFBQUEsQ0FBb0IsaURBQ3RELEdBQUlFLDRCQUFBQSxRQUFRLCtCQUFJQSxRQUFRLENBQXhCLFlBQVksQ0FBWixDQUF1QyxvREFDckMsTUFBTyxDQUFBLE9BQU8sQ0FBQSxZQUFBLENBRVosaUNBQW1DQyxRQUFRLENBQTNDLFlBQUEsQ0FBQSxLQUFBLENBQW1FQyxNQUFNLENBRnBFLFVBQU8sQ0FBUCxDQUFBLElBQUEsQ0FHQSxTQUFBLFFBQUEsQ0FBb0IsaURBQ3pCLEdBQ0VGLDRCQUFBQSxRQUFRLCtCQUNSQSxRQUFRLENBRFJBLFFBQVEsQ0FBUkEsOEJBRUFBLFFBQVEsQ0FBUkEsUUFBQUEsQ0FGQUEsTUFBQUEsK0JBR0FBLFFBQVEsQ0FBUkEsUUFBQUEsQ0FBQUEsQ0FBQUEsRUFBQUEsRUFBQUEsRUFBMkJDLFFBQVEsQ0FKckMsRUFDRUQsQ0FERixDQUtFLG9EQUNBLE9BQ0QsQ0FQRCxpQ0FEeUIsd0JBU3pCLEtBQU0sSUFBSUQsQ0FBQUEsS0FBSyxDQUFULEtBQUEsQ0FBZ0JBLEtBQUssQ0FBTEEsS0FBQUEsQ0FBaEIsZ0JBQUEsQ0FBTixtQ0FBTSxDQUFOLENBWkYsQ0FBTyxDQUFQLENBY0QsQ0FmRCxpQ0FEc0Qsd0JBaUJ0RCxLQUFNLElBQUlBLENBQUFBLEtBQUssQ0FBVCxLQUFBLENBQWdCQSxLQUFLLENBQUxBLEtBQUFBLENBQWhCLGdCQUFBLENBQU4sc0NBQU0sQ0FBTixDQWpCRixDQUFPLENBQVAsQ0FtQkQsQ0FFRCxRQUFBLENBQUEsZUFBQSxDQUFBLE1BQUEsQ0FBaUMsaURBQy9CLE1BQU8sSUFBQSxDQUFBLE9BQUEsQ0FBWSxTQUFBLE9BQUEsQ0FBbUIsa0RBQ3BDLEdBQ0UsNkJBQUEsTUFBQSwrQkFDQSxDQUFDRyxNQUFNLENBRFAsTUFBQSwrQkFFQSxDQUFDQSxNQUFNLENBQU5BLE1BQUFBLENBRkQsTUFBQSwrQkFHQSxDQUFDQSxNQUFNLENBSFAsU0FBQSwrQkFJQSxDQUFDQSxNQUFNLENBQU5BLFNBQUFBLENBTEgsTUFDRSxDQURGLENBTUUscURBQ0EsS0FBTSxJQUFJSCxDQUFBQSxLQUFLLENBQVQsS0FBQSxDQUNKQSxLQUFLLENBQUxBLEtBQUFBLENBREksZ0JBQUEsQ0FBTix5REFBTSxDQUFOLENBSUQsQ0FYRCxpQ0FEb0MseUJBYXBDLEdBQUksQ0FBQ0csTUFBTSxDQUFYLFVBQUEsQ0FBd0IscURBQ3RCQSxNQUFNLENBQU5BLFVBQUFBLENBQUFBLE9BQUFBLENBQ0QsQ0FGRCxpQ0Fib0MseUJBZ0JwQ0MsT0FBTyxHQWhCRixDQUFBLEVBQUEsSUFBQSxDQWlCQyxVQUFZLGtEQUNsQixNQUFPQyxDQUFBQSxPQUFPLENBQUEsY0FBQSxDQUVaLDBCQUNFRixNQUFNLENBRFIsTUFBQSxDQUFBLGlCQUFBLENBR0VBLE1BQU0sQ0FIUixTQUFBLENBQUEsS0FBQSxDQUtFQSxNQUFNLENBTFIsVUFBQSxDQUZGLGdDQUFjLENBQWQsQ0FsQkYsQ0FBTyxDQUFQLEMsQ0ErQkY7QUFDQSxRQUFBLENBQUEsYUFBQSxFQUF5QixrREFDdkIsTUFBT0csQ0FBQUEsT0FBTyxDQUFkLE9BQU9BLEVBQVAsQyxDQUdGO0FBQ0EsUUFBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsSUFBQSxDQUE2QixrREFDM0IsTUFBT1IsQ0FBQUEsWUFBWSxDQUFaQSxHQUFBQSxDQUFpQixXQUFBLElBQUEsQ0FBQSxHQUFBLENBQXhCLElBQU9BLENBQVAsQ0FDRCxDLHlCQUVEUyxNQUFNLENBQU5BLE9BQUFBLENBQWlCLENBQ2ZDLGFBQWEsQ0FERSxhQUFBLENBRWZDLGdCQUFnQixDQUFFQSxnQkFGSCxDQUFqQkYsQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuLy8gSGVscGVyIGZ1bmN0aW9ucyBmb3IgYWNjZXNzaW5nIHRoZSB2a29udGFrdGUgQVBJLlxuXG5jb25zdCBodHRwc1JlcXVlc3QgPSByZXF1aXJlKCcuL2h0dHBzUmVxdWVzdCcpO1xudmFyIFBhcnNlID0gcmVxdWlyZSgncGFyc2Uvbm9kZScpLlBhcnNlO1xuXG4vLyBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IGZ1bGZpbGxzIGlmZiB0aGlzIHVzZXIgaWQgaXMgdmFsaWQuXG5mdW5jdGlvbiB2YWxpZGF0ZUF1dGhEYXRhKGF1dGhEYXRhLCBwYXJhbXMpIHtcbiAgcmV0dXJuIHZrT0F1dGgyUmVxdWVzdChwYXJhbXMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmFjY2Vzc190b2tlbikge1xuICAgICAgcmV0dXJuIHJlcXVlc3QoXG4gICAgICAgICdhcGkudmsuY29tJyxcbiAgICAgICAgJ21ldGhvZC91c2Vycy5nZXQ/YWNjZXNzX3Rva2VuPScgKyBhdXRoRGF0YS5hY2Nlc3NfdG9rZW4gKyAnJnY9JyArIHBhcmFtcy5hcGlWZXJzaW9uXG4gICAgICApLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICByZXNwb25zZSAmJlxuICAgICAgICAgIHJlc3BvbnNlLnJlc3BvbnNlICYmXG4gICAgICAgICAgcmVzcG9uc2UucmVzcG9uc2UubGVuZ3RoICYmXG4gICAgICAgICAgcmVzcG9uc2UucmVzcG9uc2VbMF0uaWQgPT0gYXV0aERhdGEuaWRcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELCAnVmsgYXV0aCBpcyBpbnZhbGlkIGZvciB0aGlzIHVzZXIuJyk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsICdWayBhcHBJZHMgb3IgYXBwU2VjcmV0IGlzIGluY29ycmVjdC4nKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHZrT0F1dGgyUmVxdWVzdChwYXJhbXMpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgaWYgKFxuICAgICAgIXBhcmFtcyB8fFxuICAgICAgIXBhcmFtcy5hcHBJZHMgfHxcbiAgICAgICFwYXJhbXMuYXBwSWRzLmxlbmd0aCB8fFxuICAgICAgIXBhcmFtcy5hcHBTZWNyZXQgfHxcbiAgICAgICFwYXJhbXMuYXBwU2VjcmV0Lmxlbmd0aFxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgICBQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELFxuICAgICAgICAnVmsgYXV0aCBpcyBub3QgY29uZmlndXJlZC4gTWlzc2luZyBhcHBJZHMgb3IgYXBwU2VjcmV0LidcbiAgICAgICk7XG4gICAgfVxuICAgIGlmICghcGFyYW1zLmFwaVZlcnNpb24pIHtcbiAgICAgIHBhcmFtcy5hcGlWZXJzaW9uID0gJzUuMTI0JztcbiAgICB9XG4gICAgcmVzb2x2ZSgpO1xuICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gcmVxdWVzdChcbiAgICAgICdvYXV0aC52ay5jb20nLFxuICAgICAgJ2FjY2Vzc190b2tlbj9jbGllbnRfaWQ9JyArXG4gICAgICAgIHBhcmFtcy5hcHBJZHMgK1xuICAgICAgICAnJmNsaWVudF9zZWNyZXQ9JyArXG4gICAgICAgIHBhcmFtcy5hcHBTZWNyZXQgK1xuICAgICAgICAnJnY9JyArXG4gICAgICAgIHBhcmFtcy5hcGlWZXJzaW9uICtcbiAgICAgICAgJyZncmFudF90eXBlPWNsaWVudF9jcmVkZW50aWFscydcbiAgICApO1xuICB9KTtcbn1cblxuLy8gUmV0dXJucyBhIHByb21pc2UgdGhhdCBmdWxmaWxscyBpZmYgdGhpcyBhcHAgaWQgaXMgdmFsaWQuXG5mdW5jdGlvbiB2YWxpZGF0ZUFwcElkKCkge1xuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG59XG5cbi8vIEEgcHJvbWlzZXkgd3JhcHBlciBmb3IgYXBpIHJlcXVlc3RzXG5mdW5jdGlvbiByZXF1ZXN0KGhvc3QsIHBhdGgpIHtcbiAgcmV0dXJuIGh0dHBzUmVxdWVzdC5nZXQoJ2h0dHBzOi8vJyArIGhvc3QgKyAnLycgKyBwYXRoKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHZhbGlkYXRlQXBwSWQ6IHZhbGlkYXRlQXBwSWQsXG4gIHZhbGlkYXRlQXV0aERhdGE6IHZhbGlkYXRlQXV0aERhdGEsXG59O1xuIl19