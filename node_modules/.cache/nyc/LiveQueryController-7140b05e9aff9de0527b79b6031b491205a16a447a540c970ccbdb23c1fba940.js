"use strict";function cov_2q8nr4l0cz(){var path="/parse-server/lib/Controllers/LiveQueryController.js";var hash="9ddb6b6d77463b3ae98560a4b0c5327c25a0717c";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Controllers/LiveQueryController.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:55}},"2":{start:{line:8,column:31},end:{line:8,column:78}},"3":{start:{line:10,column:15},end:{line:10,column:36}},"4":{start:{line:12,column:16},end:{line:12,column:40}},"5":{start:{line:17,column:4},end:{line:28,column:5}},"6":{start:{line:18,column:6},end:{line:18,column:34}},"7":{start:{line:19,column:11},end:{line:28,column:5}},"8":{start:{line:20,column:25},end:{line:24,column:8}},"9":{start:{line:21,column:22},end:{line:21,column:55}},"10":{start:{line:23,column:8},end:{line:23,column:40}},"11":{start:{line:25,column:6},end:{line:25,column:44}},"12":{start:{line:27,column:6},end:{line:27,column:61}},"13":{start:{line:30,column:4},end:{line:30,column:91}},"14":{start:{line:34,column:4},end:{line:36,column:5}},"15":{start:{line:35,column:6},end:{line:35,column:13}},"16":{start:{line:38,column:16},end:{line:38,column:96}},"17":{start:{line:40,column:4},end:{line:40,column:54}},"18":{start:{line:44,column:4},end:{line:46,column:5}},"19":{start:{line:45,column:6},end:{line:45,column:13}},"20":{start:{line:48,column:16},end:{line:48,column:96}},"21":{start:{line:50,column:4},end:{line:50,column:56}},"22":{start:{line:54,column:4},end:{line:58,column:5}},"23":{start:{line:55,column:6},end:{line:57,column:7}},"24":{start:{line:56,column:8},end:{line:56,column:20}},"25":{start:{line:60,column:4},end:{line:60,column:17}},"26":{start:{line:64,column:16},end:{line:66,column:5}},"27":{start:{line:68,column:4},end:{line:70,column:5}},"28":{start:{line:69,column:6},end:{line:69,column:36}},"29":{start:{line:72,column:4},end:{line:74,column:5}},"30":{start:{line:73,column:6},end:{line:73,column:56}},"31":{start:{line:76,column:4},end:{line:76,column:15}},"32":{start:{line:81,column:0},end:{line:81,column:50}},"33":{start:{line:82,column:15},end:{line:82,column:34}},"34":{start:{line:83,column:0},end:{line:83,column:27}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:15,column:2},end:{line:15,column:3}},loc:{start:{line:15,column:22},end:{line:31,column:3}},line:15},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:47},end:{line:20,column:48}},loc:{start:{line:20,column:55},end:{line:24,column:7}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:33,column:2},end:{line:33,column:3}},loc:{start:{line:33,column:79},end:{line:41,column:3}},line:33},"3":{name:"(anonymous_3)",decl:{start:{line:43,column:2},end:{line:43,column:3}},loc:{start:{line:43,column:81},end:{line:51,column:3}},line:43},"4":{name:"(anonymous_4)",decl:{start:{line:53,column:2},end:{line:53,column:3}},loc:{start:{line:53,column:26},end:{line:61,column:3}},line:53},"5":{name:"(anonymous_5)",decl:{start:{line:63,column:2},end:{line:63,column:3}},loc:{start:{line:63,column:78},end:{line:77,column:3}},line:63}},branchMap:{"0":{loc:{start:{line:17,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:17,column:4},end:{line:28,column:5}},{start:{line:17,column:4},end:{line:28,column:5}}],line:17},"1":{loc:{start:{line:17,column:8},end:{line:17,column:37}},type:"binary-expr",locations:[{start:{line:17,column:8},end:{line:17,column:15}},{start:{line:17,column:19},end:{line:17,column:37}}],line:17},"2":{loc:{start:{line:19,column:11},end:{line:28,column:5}},type:"if",locations:[{start:{line:19,column:11},end:{line:28,column:5}},{start:{line:19,column:11},end:{line:28,column:5}}],line:19},"3":{loc:{start:{line:34,column:4},end:{line:36,column:5}},type:"if",locations:[{start:{line:34,column:4},end:{line:36,column:5}},{start:{line:34,column:4},end:{line:36,column:5}}],line:34},"4":{loc:{start:{line:44,column:4},end:{line:46,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:46,column:5}},{start:{line:44,column:4},end:{line:46,column:5}}],line:44},"5":{loc:{start:{line:55,column:6},end:{line:57,column:7}},type:"if",locations:[{start:{line:55,column:6},end:{line:57,column:7}},{start:{line:55,column:6},end:{line:57,column:7}}],line:55},"6":{loc:{start:{line:68,column:4},end:{line:70,column:5}},type:"if",locations:[{start:{line:68,column:4},end:{line:70,column:5}},{start:{line:68,column:4},end:{line:70,column:5}}],line:68},"7":{loc:{start:{line:72,column:4},end:{line:74,column:5}},type:"if",locations:[{start:{line:72,column:4},end:{line:74,column:5}},{start:{line:72,column:4},end:{line:74,column:5}}],line:72}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},inputSourceMap:{version:3,sources:["../../src/Controllers/LiveQueryController.js"],names:["LiveQueryController","constructor","config","classNames","Set","Array","map","name","_name","RegExp","liveQueryPublisher","ParseCloudCodePublisher","onAfterSave","className","currentObject","originalObject","classLevelPermissions","hasLiveQuery","req","_makePublisherRequest","onCloudCodeAfterSave","onAfterDelete","onCloudCodeAfterDelete","test","object","original"],mappings:";;;;;;;AAAA;;AACA;;AACA;;AACO,MAAMA,mBAAN,CAA0B;AAI/BC,EAAAA,WAAW,CAACC,MAAD,EAA4B;AACrC;AACA,QAAI,CAACA,MAAD,IAAW,CAACA,MAAM,CAACC,UAAvB,EAAmC;AACjC,WAAKA,UAAL,GAAkB,IAAIC,GAAJ,EAAlB;AACD,KAFD,MAEO,IAAIF,MAAM,CAACC,UAAP,YAA6BE,KAAjC,EAAwC;AAC7C,YAAMF,UAAU,GAAGD,MAAM,CAACC,UAAP,CAAkBG,GAAlB,CAAsBC,IAAI,IAAI;AAC/C,cAAMC,KAAK,GAAG,4BAAaD,IAAb,CAAd;;AACA,eAAO,IAAIE,MAAJ,CAAY,IAAGD,KAAM,GAArB,CAAP;AACD,OAHkB,CAAnB;AAIA,WAAKL,UAAL,GAAkB,IAAIC,GAAJ,CAAQD,UAAR,CAAlB;AACD,KANM,MAMA;AACL,YAAM,gDAAN;AACD;;AACD,SAAKO,kBAAL,GAA0B,IAAIC,gDAAJ,CAA4BT,MAA5B,CAA1B;AACD;;AAEDU,EAAAA,WAAW,CACTC,SADS,EAETC,aAFS,EAGTC,cAHS,EAITC,qBAJS,EAKT;AACA,QAAI,CAAC,KAAKC,YAAL,CAAkBJ,SAAlB,CAAL,EAAmC;AACjC;AACD;;AACD,UAAMK,GAAG,GAAG,KAAKC,qBAAL,CAA2BL,aAA3B,EAA0CC,cAA1C,EAA0DC,qBAA1D,CAAZ;;AACA,SAAKN,kBAAL,CAAwBU,oBAAxB,CAA6CF,GAA7C;AACD;;AAEDG,EAAAA,aAAa,CACXR,SADW,EAEXC,aAFW,EAGXC,cAHW,EAIXC,qBAJW,EAKX;AACA,QAAI,CAAC,KAAKC,YAAL,CAAkBJ,SAAlB,CAAL,EAAmC;AACjC;AACD;;AACD,UAAMK,GAAG,GAAG,KAAKC,qBAAL,CAA2BL,aAA3B,EAA0CC,cAA1C,EAA0DC,qBAA1D,CAAZ;;AACA,SAAKN,kBAAL,CAAwBY,sBAAxB,CAA+CJ,GAA/C;AACD;;AAEDD,EAAAA,YAAY,CAACJ,SAAD,EAA6B;AACvC,SAAK,MAAMN,IAAX,IAAmB,KAAKJ,UAAxB,EAAoC;AAClC,UAAII,IAAI,CAACgB,IAAL,CAAUV,SAAV,CAAJ,EAA0B;AACxB,eAAO,IAAP;AACD;AACF;;AACD,WAAO,KAAP;AACD;;AAEDM,EAAAA,qBAAqB,CAACL,aAAD,EAAqBC,cAArB,EAA0CC,qBAA1C,EAA4E;AAC/F,UAAME,GAAG,GAAG;AACVM,MAAAA,MAAM,EAAEV;AADE,KAAZ;;AAGA,QAAIA,aAAJ,EAAmB;AACjBI,MAAAA,GAAG,CAACO,QAAJ,GAAeV,cAAf;AACD;;AACD,QAAIC,qBAAJ,EAA2B;AACzBE,MAAAA,GAAG,CAACF,qBAAJ,GAA4BA,qBAA5B;AACD;;AACD,WAAOE,GAAP;AACD;;AAlE8B;;;eAqElBlB,mB",sourcesContent:["import { ParseCloudCodePublisher } from '../LiveQuery/ParseCloudCodePublisher';\nimport { LiveQueryOptions } from '../Options';\nimport { getClassName } from './../triggers';\nexport class LiveQueryController {\n  classNames: any;\n  liveQueryPublisher: any;\n\n  constructor(config: ?LiveQueryOptions) {\n    // If config is empty, we just assume no classs needs to be registered as LiveQuery\n    if (!config || !config.classNames) {\n      this.classNames = new Set();\n    } else if (config.classNames instanceof Array) {\n      const classNames = config.classNames.map(name => {\n        const _name = getClassName(name);\n        return new RegExp(`^${_name}$`);\n      });\n      this.classNames = new Set(classNames);\n    } else {\n      throw 'liveQuery.classes should be an array of string';\n    }\n    this.liveQueryPublisher = new ParseCloudCodePublisher(config);\n  }\n\n  onAfterSave(\n    className: string,\n    currentObject: any,\n    originalObject: any,\n    classLevelPermissions: ?any\n  ) {\n    if (!this.hasLiveQuery(className)) {\n      return;\n    }\n    const req = this._makePublisherRequest(currentObject, originalObject, classLevelPermissions);\n    this.liveQueryPublisher.onCloudCodeAfterSave(req);\n  }\n\n  onAfterDelete(\n    className: string,\n    currentObject: any,\n    originalObject: any,\n    classLevelPermissions: any\n  ) {\n    if (!this.hasLiveQuery(className)) {\n      return;\n    }\n    const req = this._makePublisherRequest(currentObject, originalObject, classLevelPermissions);\n    this.liveQueryPublisher.onCloudCodeAfterDelete(req);\n  }\n\n  hasLiveQuery(className: string): boolean {\n    for (const name of this.classNames) {\n      if (name.test(className)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  _makePublisherRequest(currentObject: any, originalObject: any, classLevelPermissions: ?any): any {\n    const req = {\n      object: currentObject,\n    };\n    if (currentObject) {\n      req.original = originalObject;\n    }\n    if (classLevelPermissions) {\n      req.classLevelPermissions = classLevelPermissions;\n    }\n    return req;\n  }\n}\n\nexport default LiveQueryController;\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"9ddb6b6d77463b3ae98560a4b0c5327c25a0717c"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2q8nr4l0cz=function(){return actualCoverage;};}return actualCoverage;}cov_2q8nr4l0cz();cov_2q8nr4l0cz().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_2q8nr4l0cz().s[1]++;exports.default=exports.LiveQueryController=void 0;var _ParseCloudCodePublisher=(cov_2q8nr4l0cz().s[2]++,require("../LiveQuery/ParseCloudCodePublisher"));var _Options=(cov_2q8nr4l0cz().s[3]++,require("../Options"));var _triggers=(cov_2q8nr4l0cz().s[4]++,require("./../triggers"));class LiveQueryController{constructor(config){cov_2q8nr4l0cz().f[0]++;cov_2q8nr4l0cz().s[5]++;// If config is empty, we just assume no classs needs to be registered as LiveQuery
if((cov_2q8nr4l0cz().b[1][0]++,!config)||(cov_2q8nr4l0cz().b[1][1]++,!config.classNames)){cov_2q8nr4l0cz().b[0][0]++;cov_2q8nr4l0cz().s[6]++;this.classNames=new Set();}else{cov_2q8nr4l0cz().b[0][1]++;cov_2q8nr4l0cz().s[7]++;if(config.classNames instanceof Array){cov_2q8nr4l0cz().b[2][0]++;const classNames=(cov_2q8nr4l0cz().s[8]++,config.classNames.map(name=>{cov_2q8nr4l0cz().f[1]++;const _name=(cov_2q8nr4l0cz().s[9]++,(0,_triggers.getClassName)(name));cov_2q8nr4l0cz().s[10]++;return new RegExp(`^${_name}$`);}));cov_2q8nr4l0cz().s[11]++;this.classNames=new Set(classNames);}else{cov_2q8nr4l0cz().b[2][1]++;cov_2q8nr4l0cz().s[12]++;throw'liveQuery.classes should be an array of string';}}cov_2q8nr4l0cz().s[13]++;this.liveQueryPublisher=new _ParseCloudCodePublisher.ParseCloudCodePublisher(config);}onAfterSave(className,currentObject,originalObject,classLevelPermissions){cov_2q8nr4l0cz().f[2]++;cov_2q8nr4l0cz().s[14]++;if(!this.hasLiveQuery(className)){cov_2q8nr4l0cz().b[3][0]++;cov_2q8nr4l0cz().s[15]++;return;}else{cov_2q8nr4l0cz().b[3][1]++;}const req=(cov_2q8nr4l0cz().s[16]++,this._makePublisherRequest(currentObject,originalObject,classLevelPermissions));cov_2q8nr4l0cz().s[17]++;this.liveQueryPublisher.onCloudCodeAfterSave(req);}onAfterDelete(className,currentObject,originalObject,classLevelPermissions){cov_2q8nr4l0cz().f[3]++;cov_2q8nr4l0cz().s[18]++;if(!this.hasLiveQuery(className)){cov_2q8nr4l0cz().b[4][0]++;cov_2q8nr4l0cz().s[19]++;return;}else{cov_2q8nr4l0cz().b[4][1]++;}const req=(cov_2q8nr4l0cz().s[20]++,this._makePublisherRequest(currentObject,originalObject,classLevelPermissions));cov_2q8nr4l0cz().s[21]++;this.liveQueryPublisher.onCloudCodeAfterDelete(req);}hasLiveQuery(className){cov_2q8nr4l0cz().f[4]++;cov_2q8nr4l0cz().s[22]++;for(const name of this.classNames){cov_2q8nr4l0cz().s[23]++;if(name.test(className)){cov_2q8nr4l0cz().b[5][0]++;cov_2q8nr4l0cz().s[24]++;return true;}else{cov_2q8nr4l0cz().b[5][1]++;}}cov_2q8nr4l0cz().s[25]++;return false;}_makePublisherRequest(currentObject,originalObject,classLevelPermissions){cov_2q8nr4l0cz().f[5]++;const req=(cov_2q8nr4l0cz().s[26]++,{object:currentObject});cov_2q8nr4l0cz().s[27]++;if(currentObject){cov_2q8nr4l0cz().b[6][0]++;cov_2q8nr4l0cz().s[28]++;req.original=originalObject;}else{cov_2q8nr4l0cz().b[6][1]++;}cov_2q8nr4l0cz().s[29]++;if(classLevelPermissions){cov_2q8nr4l0cz().b[7][0]++;cov_2q8nr4l0cz().s[30]++;req.classLevelPermissions=classLevelPermissions;}else{cov_2q8nr4l0cz().b[7][1]++;}cov_2q8nr4l0cz().s[31]++;return req;}}cov_2q8nr4l0cz().s[32]++;exports.LiveQueryController=LiveQueryController;var _default=(cov_2q8nr4l0cz().s[33]++,LiveQueryController);cov_2q8nr4l0cz().s[34]++;exports.default=_default;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db250cm9sbGVycy9MaXZlUXVlcnlDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbIkxpdmVRdWVyeUNvbnRyb2xsZXIiLCJjb25zdHJ1Y3RvciIsImNvbmZpZyIsImNsYXNzTmFtZXMiLCJTZXQiLCJBcnJheSIsIm1hcCIsIm5hbWUiLCJfbmFtZSIsIlJlZ0V4cCIsImxpdmVRdWVyeVB1Ymxpc2hlciIsIlBhcnNlQ2xvdWRDb2RlUHVibGlzaGVyIiwib25BZnRlclNhdmUiLCJjbGFzc05hbWUiLCJjdXJyZW50T2JqZWN0Iiwib3JpZ2luYWxPYmplY3QiLCJjbGFzc0xldmVsUGVybWlzc2lvbnMiLCJoYXNMaXZlUXVlcnkiLCJyZXEiLCJfbWFrZVB1Ymxpc2hlclJlcXVlc3QiLCJvbkNsb3VkQ29kZUFmdGVyU2F2ZSIsIm9uQWZ0ZXJEZWxldGUiLCJvbkNsb3VkQ29kZUFmdGVyRGVsZXRlIiwidGVzdCIsIm9iamVjdCIsIm9yaWdpbmFsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ08sTUFBTUEsbUJBQU4sQ0FBMEI7QUFJL0JDLEVBQUFBLFdBQVcsQ0FBQ0MsTUFBRCxFQUE0QjtBQUNyQztBQUNBLFFBQUksQ0FBQ0EsTUFBRCxJQUFXLENBQUNBLE1BQU0sQ0FBQ0MsVUFBdkIsRUFBbUM7QUFDakMsV0FBS0EsVUFBTCxHQUFrQixJQUFJQyxHQUFKLEVBQWxCO0FBQ0QsS0FGRCxNQUVPLElBQUlGLE1BQU0sQ0FBQ0MsVUFBUCxZQUE2QkUsS0FBakMsRUFBd0M7QUFDN0MsWUFBTUYsVUFBVSxHQUFHRCxNQUFNLENBQUNDLFVBQVAsQ0FBa0JHLEdBQWxCLENBQXNCQyxJQUFJLElBQUk7QUFDL0MsY0FBTUMsS0FBSyxHQUFHLDRCQUFhRCxJQUFiLENBQWQ7O0FBQ0EsZUFBTyxJQUFJRSxNQUFKLENBQVksSUFBR0QsS0FBTSxHQUFyQixDQUFQO0FBQ0QsT0FIa0IsQ0FBbkI7QUFJQSxXQUFLTCxVQUFMLEdBQWtCLElBQUlDLEdBQUosQ0FBUUQsVUFBUixDQUFsQjtBQUNELEtBTk0sTUFNQTtBQUNMLFlBQU0sZ0RBQU47QUFDRDs7QUFDRCxTQUFLTyxrQkFBTCxHQUEwQixJQUFJQyxnREFBSixDQUE0QlQsTUFBNUIsQ0FBMUI7QUFDRDs7QUFFRFUsRUFBQUEsV0FBVyxDQUNUQyxTQURTLEVBRVRDLGFBRlMsRUFHVEMsY0FIUyxFQUlUQyxxQkFKUyxFQUtUO0FBQ0EsUUFBSSxDQUFDLEtBQUtDLFlBQUwsQ0FBa0JKLFNBQWxCLENBQUwsRUFBbUM7QUFDakM7QUFDRDs7QUFDRCxVQUFNSyxHQUFHLEdBQUcsS0FBS0MscUJBQUwsQ0FBMkJMLGFBQTNCLEVBQTBDQyxjQUExQyxFQUEwREMscUJBQTFELENBQVo7O0FBQ0EsU0FBS04sa0JBQUwsQ0FBd0JVLG9CQUF4QixDQUE2Q0YsR0FBN0M7QUFDRDs7QUFFREcsRUFBQUEsYUFBYSxDQUNYUixTQURXLEVBRVhDLGFBRlcsRUFHWEMsY0FIVyxFQUlYQyxxQkFKVyxFQUtYO0FBQ0EsUUFBSSxDQUFDLEtBQUtDLFlBQUwsQ0FBa0JKLFNBQWxCLENBQUwsRUFBbUM7QUFDakM7QUFDRDs7QUFDRCxVQUFNSyxHQUFHLEdBQUcsS0FBS0MscUJBQUwsQ0FBMkJMLGFBQTNCLEVBQTBDQyxjQUExQyxFQUEwREMscUJBQTFELENBQVo7O0FBQ0EsU0FBS04sa0JBQUwsQ0FBd0JZLHNCQUF4QixDQUErQ0osR0FBL0M7QUFDRDs7QUFFREQsRUFBQUEsWUFBWSxDQUFDSixTQUFELEVBQTZCO0FBQ3ZDLFNBQUssTUFBTU4sSUFBWCxJQUFtQixLQUFLSixVQUF4QixFQUFvQztBQUNsQyxVQUFJSSxJQUFJLENBQUNnQixJQUFMLENBQVVWLFNBQVYsQ0FBSixFQUEwQjtBQUN4QixlQUFPLElBQVA7QUFDRDtBQUNGOztBQUNELFdBQU8sS0FBUDtBQUNEOztBQUVETSxFQUFBQSxxQkFBcUIsQ0FBQ0wsYUFBRCxFQUFxQkMsY0FBckIsRUFBMENDLHFCQUExQyxFQUE0RTtBQUMvRixVQUFNRSxHQUFHLEdBQUc7QUFDVk0sTUFBQUEsTUFBTSxFQUFFVjtBQURFLEtBQVo7O0FBR0EsUUFBSUEsYUFBSixFQUFtQjtBQUNqQkksTUFBQUEsR0FBRyxDQUFDTyxRQUFKLEdBQWVWLGNBQWY7QUFDRDs7QUFDRCxRQUFJQyxxQkFBSixFQUEyQjtBQUN6QkUsTUFBQUEsR0FBRyxDQUFDRixxQkFBSixHQUE0QkEscUJBQTVCO0FBQ0Q7O0FBQ0QsV0FBT0UsR0FBUDtBQUNEOztBQWxFOEI7OztlQXFFbEJsQixtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhcnNlQ2xvdWRDb2RlUHVibGlzaGVyIH0gZnJvbSAnLi4vTGl2ZVF1ZXJ5L1BhcnNlQ2xvdWRDb2RlUHVibGlzaGVyJztcbmltcG9ydCB7IExpdmVRdWVyeU9wdGlvbnMgfSBmcm9tICcuLi9PcHRpb25zJztcbmltcG9ydCB7IGdldENsYXNzTmFtZSB9IGZyb20gJy4vLi4vdHJpZ2dlcnMnO1xuZXhwb3J0IGNsYXNzIExpdmVRdWVyeUNvbnRyb2xsZXIge1xuICBjbGFzc05hbWVzOiBhbnk7XG4gIGxpdmVRdWVyeVB1Ymxpc2hlcjogYW55O1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogP0xpdmVRdWVyeU9wdGlvbnMpIHtcbiAgICAvLyBJZiBjb25maWcgaXMgZW1wdHksIHdlIGp1c3QgYXNzdW1lIG5vIGNsYXNzcyBuZWVkcyB0byBiZSByZWdpc3RlcmVkIGFzIExpdmVRdWVyeVxuICAgIGlmICghY29uZmlnIHx8ICFjb25maWcuY2xhc3NOYW1lcykge1xuICAgICAgdGhpcy5jbGFzc05hbWVzID0gbmV3IFNldCgpO1xuICAgIH0gZWxzZSBpZiAoY29uZmlnLmNsYXNzTmFtZXMgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgY29uc3QgY2xhc3NOYW1lcyA9IGNvbmZpZy5jbGFzc05hbWVzLm1hcChuYW1lID0+IHtcbiAgICAgICAgY29uc3QgX25hbWUgPSBnZXRDbGFzc05hbWUobmFtZSk7XG4gICAgICAgIHJldHVybiBuZXcgUmVnRXhwKGBeJHtfbmFtZX0kYCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY2xhc3NOYW1lcyA9IG5ldyBTZXQoY2xhc3NOYW1lcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93ICdsaXZlUXVlcnkuY2xhc3NlcyBzaG91bGQgYmUgYW4gYXJyYXkgb2Ygc3RyaW5nJztcbiAgICB9XG4gICAgdGhpcy5saXZlUXVlcnlQdWJsaXNoZXIgPSBuZXcgUGFyc2VDbG91ZENvZGVQdWJsaXNoZXIoY29uZmlnKTtcbiAgfVxuXG4gIG9uQWZ0ZXJTYXZlKFxuICAgIGNsYXNzTmFtZTogc3RyaW5nLFxuICAgIGN1cnJlbnRPYmplY3Q6IGFueSxcbiAgICBvcmlnaW5hbE9iamVjdDogYW55LFxuICAgIGNsYXNzTGV2ZWxQZXJtaXNzaW9uczogP2FueVxuICApIHtcbiAgICBpZiAoIXRoaXMuaGFzTGl2ZVF1ZXJ5KGNsYXNzTmFtZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcmVxID0gdGhpcy5fbWFrZVB1Ymxpc2hlclJlcXVlc3QoY3VycmVudE9iamVjdCwgb3JpZ2luYWxPYmplY3QsIGNsYXNzTGV2ZWxQZXJtaXNzaW9ucyk7XG4gICAgdGhpcy5saXZlUXVlcnlQdWJsaXNoZXIub25DbG91ZENvZGVBZnRlclNhdmUocmVxKTtcbiAgfVxuXG4gIG9uQWZ0ZXJEZWxldGUoXG4gICAgY2xhc3NOYW1lOiBzdHJpbmcsXG4gICAgY3VycmVudE9iamVjdDogYW55LFxuICAgIG9yaWdpbmFsT2JqZWN0OiBhbnksXG4gICAgY2xhc3NMZXZlbFBlcm1pc3Npb25zOiBhbnlcbiAgKSB7XG4gICAgaWYgKCF0aGlzLmhhc0xpdmVRdWVyeShjbGFzc05hbWUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHJlcSA9IHRoaXMuX21ha2VQdWJsaXNoZXJSZXF1ZXN0KGN1cnJlbnRPYmplY3QsIG9yaWdpbmFsT2JqZWN0LCBjbGFzc0xldmVsUGVybWlzc2lvbnMpO1xuICAgIHRoaXMubGl2ZVF1ZXJ5UHVibGlzaGVyLm9uQ2xvdWRDb2RlQWZ0ZXJEZWxldGUocmVxKTtcbiAgfVxuXG4gIGhhc0xpdmVRdWVyeShjbGFzc05hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiB0aGlzLmNsYXNzTmFtZXMpIHtcbiAgICAgIGlmIChuYW1lLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgX21ha2VQdWJsaXNoZXJSZXF1ZXN0KGN1cnJlbnRPYmplY3Q6IGFueSwgb3JpZ2luYWxPYmplY3Q6IGFueSwgY2xhc3NMZXZlbFBlcm1pc3Npb25zOiA/YW55KTogYW55IHtcbiAgICBjb25zdCByZXEgPSB7XG4gICAgICBvYmplY3Q6IGN1cnJlbnRPYmplY3QsXG4gICAgfTtcbiAgICBpZiAoY3VycmVudE9iamVjdCkge1xuICAgICAgcmVxLm9yaWdpbmFsID0gb3JpZ2luYWxPYmplY3Q7XG4gICAgfVxuICAgIGlmIChjbGFzc0xldmVsUGVybWlzc2lvbnMpIHtcbiAgICAgIHJlcS5jbGFzc0xldmVsUGVybWlzc2lvbnMgPSBjbGFzc0xldmVsUGVybWlzc2lvbnM7XG4gICAgfVxuICAgIHJldHVybiByZXE7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTGl2ZVF1ZXJ5Q29udHJvbGxlcjtcbiJdfQ==
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db250cm9sbGVycy9MaXZlUXVlcnlDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiY2xhc3NOYW1lcyIsIm5hbWUiLCJfbmFtZSIsIlBhcnNlQ2xvdWRDb2RlUHVibGlzaGVyIiwib25BZnRlclNhdmUiLCJyZXEiLCJvbkFmdGVyRGVsZXRlIiwiaGFzTGl2ZVF1ZXJ5IiwiX21ha2VQdWJsaXNoZXJSZXF1ZXN0Iiwib2JqZWN0IiwiY3VycmVudE9iamVjdCIsIkxpdmVRdWVyeUNvbnRyb2xsZXIiXSwibWFwcGluZ3MiOiJ1MFNBUUk7dVBBUkosR0FBQSxDQUFBLHdCQUFBLDBCQUFBLE9BQUEsQ0FBQSxzQ0FBQSxDQUFBLENBQUEsQ0FDQSxHQUFBLENBQUEsUUFBQSwwQkFBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUEsQ0FDQSxHQUFBLENBQUEsU0FBQSwwQkFBQSxPQUFBLENBQUEsZUFBQSxDQUFBLENBQUEsQ0FDTyxLQUFBLENBQUEsbUJBQTBCLENBSS9CQSxXQUFXLENBQUEsTUFBQSxDQUE0QixpREFDckM7QUFDQSxHQUFJLDZCQUFBLE1BQUEsK0JBQVcsQ0FBQ0MsTUFBTSxDQUF0QixVQUFJLENBQUosQ0FBbUMsb0RBQ2pDLEtBQUEsVUFBQSxDQUFrQixHQUFsQixDQUFBLEdBQWtCLEVBQWxCLENBREYsQ0FBQSxJQUVPLHVEQUFJQSxNQUFNLENBQU5BLFVBQUFBLFdBQUosQ0FBQSxLQUFBLENBQXdDLDRCQUM3QyxLQUFNQyxDQUFBQSxVQUFVLDBCQUFHLE1BQU0sQ0FBTixVQUFBLENBQUEsR0FBQSxDQUFzQkMsSUFBSSxFQUFJLHlCQUMvQyxLQUFNQyxDQUFBQSxLQUFLLDBCQUFHLENBQUEsRUFBQSxTQUFBLENBQUEsWUFBQSxFQUFkLElBQWMsQ0FBSCxDQUFYLENBRCtDLHlCQUUvQyxNQUFPLElBQUEsQ0FBQSxNQUFBLENBQVksSUFBR0EsS0FBdEIsR0FBTyxDQUFQLENBRkYsQ0FBbUIsQ0FBSCxDQUFoQixDQUQ2Qyx5QkFLN0MsS0FBQSxVQUFBLENBQWtCLEdBQUEsQ0FBQSxHQUFBLENBQWxCLFVBQWtCLENBQWxCLENBTEssQ0FBQSxJQU1BLHFEQUNMLEtBQUEsZ0RBQUEsQ0FDRCxFQVpvQyx5QkFhckMsS0FBQSxrQkFBQSxDQUEwQixHQUFJQyxDQUFBQSx3QkFBQUEsQ0FBSix1QkFBQSxDQUExQixNQUEwQixDQUExQixDQUNELENBRURDLFdBQVcsQ0FBQSxTQUFBLENBQUEsYUFBQSxDQUFBLGNBQUEsQ0FBQSxxQkFBQSxDQUtULGtEQUNBLEdBQUksQ0FBQyxLQUFBLFlBQUEsQ0FBTCxTQUFLLENBQUwsQ0FBbUMscURBQ2pDLE9BQ0QsQ0FGRCxpQ0FHQSxLQUFNQyxDQUFBQSxHQUFHLDJCQUFHLEtBQUEscUJBQUEsQ0FBQSxhQUFBLENBQUEsY0FBQSxDQUFaLHFCQUFZLENBQUgsQ0FBVCxDQUpBLHlCQUtBLEtBQUEsa0JBQUEsQ0FBQSxvQkFBQSxDQUFBLEdBQUEsRUFDRCxDQUVEQyxhQUFhLENBQUEsU0FBQSxDQUFBLGFBQUEsQ0FBQSxjQUFBLENBQUEscUJBQUEsQ0FLWCxrREFDQSxHQUFJLENBQUMsS0FBQSxZQUFBLENBQUwsU0FBSyxDQUFMLENBQW1DLHFEQUNqQyxPQUNELENBRkQsaUNBR0EsS0FBTUQsQ0FBQUEsR0FBRywyQkFBRyxLQUFBLHFCQUFBLENBQUEsYUFBQSxDQUFBLGNBQUEsQ0FBWixxQkFBWSxDQUFILENBQVQsQ0FKQSx5QkFLQSxLQUFBLGtCQUFBLENBQUEsc0JBQUEsQ0FBQSxHQUFBLEVBQ0QsQ0FFREUsWUFBWSxDQUFBLFNBQUEsQ0FBNkIsa0RBQ3ZDLElBQUssS0FBTCxDQUFBLElBQUEsR0FBbUIsTUFBbkIsVUFBQSxDQUFvQywwQkFDbEMsR0FBSU4sSUFBSSxDQUFKQSxJQUFBQSxDQUFKLFNBQUlBLENBQUosQ0FBMEIscURBQ3hCLE1BQUEsS0FBQSxDQUNELENBRkQsaUNBR0QsQ0FMc0MseUJBTXZDLE1BQUEsTUFBQSxDQUNELENBRURPLHFCQUFxQixDQUFBLGFBQUEsQ0FBQSxjQUFBLENBQUEscUJBQUEsQ0FBNEUseUJBQy9GLEtBQU1ILENBQUFBLEdBQUcsMkJBQUcsQ0FDVkksTUFBTSxDQUFFQyxhQURFLENBQUgsQ0FBVCxDQUQrRix5QkFJL0YsR0FBQSxhQUFBLENBQW1CLHFEQUNqQkwsR0FBRyxDQUFIQSxRQUFBQSxDQUFBQSxjQUFBQSxDQUNELENBRkQsaUNBSitGLHlCQU8vRixHQUFBLHFCQUFBLENBQTJCLHFEQUN6QkEsR0FBRyxDQUFIQSxxQkFBQUEsQ0FBQUEscUJBQUFBLENBQ0QsQ0FGRCxpQ0FQK0YseUJBVS9GLE1BQUEsQ0FBQSxHQUFBLENBQ0QsQ0FsRThCLEMsZ0hBcUVsQk0sbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXJzZUNsb3VkQ29kZVB1Ymxpc2hlciB9IGZyb20gJy4uL0xpdmVRdWVyeS9QYXJzZUNsb3VkQ29kZVB1Ymxpc2hlcic7XG5pbXBvcnQgeyBMaXZlUXVlcnlPcHRpb25zIH0gZnJvbSAnLi4vT3B0aW9ucyc7XG5pbXBvcnQgeyBnZXRDbGFzc05hbWUgfSBmcm9tICcuLy4uL3RyaWdnZXJzJztcbmV4cG9ydCBjbGFzcyBMaXZlUXVlcnlDb250cm9sbGVyIHtcbiAgY2xhc3NOYW1lczogYW55O1xuICBsaXZlUXVlcnlQdWJsaXNoZXI6IGFueTtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6ID9MaXZlUXVlcnlPcHRpb25zKSB7XG4gICAgLy8gSWYgY29uZmlnIGlzIGVtcHR5LCB3ZSBqdXN0IGFzc3VtZSBubyBjbGFzc3MgbmVlZHMgdG8gYmUgcmVnaXN0ZXJlZCBhcyBMaXZlUXVlcnlcbiAgICBpZiAoIWNvbmZpZyB8fCAhY29uZmlnLmNsYXNzTmFtZXMpIHtcbiAgICAgIHRoaXMuY2xhc3NOYW1lcyA9IG5ldyBTZXQoKTtcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy5jbGFzc05hbWVzIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBjb25maWcuY2xhc3NOYW1lcy5tYXAobmFtZSA9PiB7XG4gICAgICAgIGNvbnN0IF9uYW1lID0gZ2V0Q2xhc3NOYW1lKG5hbWUpO1xuICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChgXiR7X25hbWV9JGApO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNsYXNzTmFtZXMgPSBuZXcgU2V0KGNsYXNzTmFtZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyAnbGl2ZVF1ZXJ5LmNsYXNzZXMgc2hvdWxkIGJlIGFuIGFycmF5IG9mIHN0cmluZyc7XG4gICAgfVxuICAgIHRoaXMubGl2ZVF1ZXJ5UHVibGlzaGVyID0gbmV3IFBhcnNlQ2xvdWRDb2RlUHVibGlzaGVyKGNvbmZpZyk7XG4gIH1cblxuICBvbkFmdGVyU2F2ZShcbiAgICBjbGFzc05hbWU6IHN0cmluZyxcbiAgICBjdXJyZW50T2JqZWN0OiBhbnksXG4gICAgb3JpZ2luYWxPYmplY3Q6IGFueSxcbiAgICBjbGFzc0xldmVsUGVybWlzc2lvbnM6ID9hbnlcbiAgKSB7XG4gICAgaWYgKCF0aGlzLmhhc0xpdmVRdWVyeShjbGFzc05hbWUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHJlcSA9IHRoaXMuX21ha2VQdWJsaXNoZXJSZXF1ZXN0KGN1cnJlbnRPYmplY3QsIG9yaWdpbmFsT2JqZWN0LCBjbGFzc0xldmVsUGVybWlzc2lvbnMpO1xuICAgIHRoaXMubGl2ZVF1ZXJ5UHVibGlzaGVyLm9uQ2xvdWRDb2RlQWZ0ZXJTYXZlKHJlcSk7XG4gIH1cblxuICBvbkFmdGVyRGVsZXRlKFxuICAgIGNsYXNzTmFtZTogc3RyaW5nLFxuICAgIGN1cnJlbnRPYmplY3Q6IGFueSxcbiAgICBvcmlnaW5hbE9iamVjdDogYW55LFxuICAgIGNsYXNzTGV2ZWxQZXJtaXNzaW9uczogYW55XG4gICkge1xuICAgIGlmICghdGhpcy5oYXNMaXZlUXVlcnkoY2xhc3NOYW1lKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCByZXEgPSB0aGlzLl9tYWtlUHVibGlzaGVyUmVxdWVzdChjdXJyZW50T2JqZWN0LCBvcmlnaW5hbE9iamVjdCwgY2xhc3NMZXZlbFBlcm1pc3Npb25zKTtcbiAgICB0aGlzLmxpdmVRdWVyeVB1Ymxpc2hlci5vbkNsb3VkQ29kZUFmdGVyRGVsZXRlKHJlcSk7XG4gIH1cblxuICBoYXNMaXZlUXVlcnkoY2xhc3NOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgdGhpcy5jbGFzc05hbWVzKSB7XG4gICAgICBpZiAobmFtZS50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIF9tYWtlUHVibGlzaGVyUmVxdWVzdChjdXJyZW50T2JqZWN0OiBhbnksIG9yaWdpbmFsT2JqZWN0OiBhbnksIGNsYXNzTGV2ZWxQZXJtaXNzaW9uczogP2FueSk6IGFueSB7XG4gICAgY29uc3QgcmVxID0ge1xuICAgICAgb2JqZWN0OiBjdXJyZW50T2JqZWN0LFxuICAgIH07XG4gICAgaWYgKGN1cnJlbnRPYmplY3QpIHtcbiAgICAgIHJlcS5vcmlnaW5hbCA9IG9yaWdpbmFsT2JqZWN0O1xuICAgIH1cbiAgICBpZiAoY2xhc3NMZXZlbFBlcm1pc3Npb25zKSB7XG4gICAgICByZXEuY2xhc3NMZXZlbFBlcm1pc3Npb25zID0gY2xhc3NMZXZlbFBlcm1pc3Npb25zO1xuICAgIH1cbiAgICByZXR1cm4gcmVxO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IExpdmVRdWVyeUNvbnRyb2xsZXI7XG4iXX0=