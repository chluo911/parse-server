"use strict";function cov_1ir9drndyn(){var path="/parse-server/lib/AccountLockout.js";var hash="998eb5ddab4ca0f4964b188da4962e39a571cf06";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/AccountLockout.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:50}},"2":{start:{line:8,column:12},end:{line:8,column:57}},"3":{start:{line:10,column:39},end:{line:10,column:93}},"4":{start:{line:15,column:4},end:{line:15,column:22}},"5":{start:{line:16,column:4},end:{line:16,column:26}},"6":{start:{line:24,column:18},end:{line:26,column:5}},"7":{start:{line:27,column:25},end:{line:29,column:5}},"8":{start:{line:30,column:4},end:{line:30,column:70}},"9":{start:{line:38,column:18},end:{line:43,column:5}},"10":{start:{line:44,column:4},end:{line:50,column:7}},"11":{start:{line:45,column:6},end:{line:49,column:7}},"12":{start:{line:46,column:8},end:{line:46,column:20}},"13":{start:{line:48,column:8},end:{line:48,column:21}},"14":{start:{line:59,column:4},end:{line:63,column:7}},"15":{start:{line:60,column:6},end:{line:62,column:7}},"16":{start:{line:61,column:8},end:{line:61,column:44}},"17":{start:{line:71,column:18},end:{line:73,column:5}},"18":{start:{line:74,column:25},end:{line:79,column:5}},"19":{start:{line:80,column:4},end:{line:80,column:70}},"20":{start:{line:90,column:18},end:{line:95,column:5}},"21":{start:{line:96,column:16},end:{line:96,column:26}},"22":{start:{line:97,column:25},end:{line:99,column:5}},"23":{start:{line:100,column:4},end:{line:106,column:7}},"24":{start:{line:101,column:6},end:{line:105,column:7}},"25":{start:{line:102,column:8},end:{line:102,column:15}},"26":{start:{line:104,column:8},end:{line:104,column:18}},"27":{start:{line:117,column:18},end:{line:125,column:5}},"28":{start:{line:126,column:4},end:{line:130,column:7}},"29":{start:{line:127,column:6},end:{line:129,column:7}},"30":{start:{line:128,column:8},end:{line:128,column:219}},"31":{start:{line:142,column:4},end:{line:146,column:7}},"32":{start:{line:143,column:6},end:{line:143,column:47}},"33":{start:{line:145,column:6},end:{line:145,column:42}},"34":{start:{line:154,column:4},end:{line:156,column:5}},"35":{start:{line:155,column:6},end:{line:155,column:31}},"36":{start:{line:158,column:4},end:{line:164,column:7}},"37":{start:{line:159,column:6},end:{line:163,column:7}},"38":{start:{line:160,column:8},end:{line:160,column:44}},"39":{start:{line:162,column:8},end:{line:162,column:48}},"40":{start:{line:172,column:4},end:{line:174,column:5}},"41":{start:{line:173,column:6},end:{line:173,column:31}},"42":{start:{line:176,column:4},end:{line:185,column:7}},"43":{start:{line:190,column:0},end:{line:190,column:40}},"44":{start:{line:191,column:15},end:{line:191,column:29}},"45":{start:{line:192,column:0},end:{line:192,column:27}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:10,column:9},end:{line:10,column:31}},loc:{start:{line:10,column:37},end:{line:10,column:95}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:2},end:{line:14,column:3}},loc:{start:{line:14,column:28},end:{line:17,column:3}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:23,column:2},end:{line:23,column:3}},loc:{start:{line:23,column:30},end:{line:31,column:3}},line:23},"3":{name:"(anonymous_3)",decl:{start:{line:37,column:2},end:{line:37,column:3}},loc:{start:{line:37,column:27},end:{line:51,column:3}},line:37},"4":{name:"(anonymous_4)",decl:{start:{line:44,column:59},end:{line:44,column:60}},loc:{start:{line:44,column:68},end:{line:50,column:5}},line:44},"5":{name:"(anonymous_5)",decl:{start:{line:58,column:2},end:{line:58,column:3}},loc:{start:{line:58,column:26},end:{line:64,column:3}},line:58},"6":{name:"(anonymous_6)",decl:{start:{line:59,column:46},end:{line:59,column:47}},loc:{start:{line:59,column:71},end:{line:63,column:5}},line:59},"7":{name:"(anonymous_7)",decl:{start:{line:70,column:2},end:{line:70,column:3}},loc:{start:{line:70,column:31},end:{line:81,column:3}},line:70},"8":{name:"(anonymous_8)",decl:{start:{line:89,column:2},end:{line:89,column:3}},loc:{start:{line:89,column:26},end:{line:107,column:3}},line:89},"9":{name:"(anonymous_9)",decl:{start:{line:100,column:76},end:{line:100,column:77}},loc:{start:{line:100,column:83},end:{line:106,column:5}},line:100},"10":{name:"(anonymous_10)",decl:{start:{line:116,column:2},end:{line:116,column:3}},loc:{start:{line:116,column:15},end:{line:131,column:3}},line:116},"11":{name:"(anonymous_11)",decl:{start:{line:126,column:59},end:{line:126,column:60}},loc:{start:{line:126,column:68},end:{line:130,column:5}},line:126},"12":{name:"(anonymous_12)",decl:{start:{line:141,column:2},end:{line:141,column:3}},loc:{start:{line:141,column:30},end:{line:147,column:3}},line:141},"13":{name:"(anonymous_13)",decl:{start:{line:142,column:45},end:{line:142,column:46}},loc:{start:{line:142,column:51},end:{line:144,column:5}},line:142},"14":{name:"(anonymous_14)",decl:{start:{line:144,column:12},end:{line:144,column:13}},loc:{start:{line:144,column:18},end:{line:146,column:5}},line:144},"15":{name:"(anonymous_15)",decl:{start:{line:153,column:2},end:{line:153,column:3}},loc:{start:{line:153,column:38},end:{line:165,column:3}},line:153},"16":{name:"(anonymous_16)",decl:{start:{line:158,column:34},end:{line:158,column:35}},loc:{start:{line:158,column:40},end:{line:164,column:5}},line:158},"17":{name:"(anonymous_17)",decl:{start:{line:171,column:2},end:{line:171,column:3}},loc:{start:{line:171,column:18},end:{line:186,column:3}},line:171}},branchMap:{"0":{loc:{start:{line:10,column:46},end:{line:10,column:92}},type:"cond-expr",locations:[{start:{line:10,column:70},end:{line:10,column:73}},{start:{line:10,column:76},end:{line:10,column:92}}],line:10},"1":{loc:{start:{line:10,column:46},end:{line:10,column:67}},type:"binary-expr",locations:[{start:{line:10,column:46},end:{line:10,column:49}},{start:{line:10,column:53},end:{line:10,column:67}}],line:10},"2":{loc:{start:{line:45,column:6},end:{line:49,column:7}},type:"if",locations:[{start:{line:45,column:6},end:{line:49,column:7}},{start:{line:45,column:6},end:{line:49,column:7}}],line:45},"3":{loc:{start:{line:45,column:10},end:{line:45,column:50}},type:"binary-expr",locations:[{start:{line:45,column:10},end:{line:45,column:30}},{start:{line:45,column:34},end:{line:45,column:50}}],line:45},"4":{loc:{start:{line:60,column:6},end:{line:62,column:7}},type:"if",locations:[{start:{line:60,column:6},end:{line:62,column:7}},{start:{line:60,column:6},end:{line:62,column:7}}],line:60},"5":{loc:{start:{line:101,column:6},end:{line:105,column:7}},type:"if",locations:[{start:{line:101,column:6},end:{line:105,column:7}},{start:{line:101,column:6},end:{line:105,column:7}}],line:101},"6":{loc:{start:{line:101,column:10},end:{line:101,column:132}},type:"binary-expr",locations:[{start:{line:101,column:10},end:{line:101,column:13}},{start:{line:101,column:17},end:{line:101,column:25}},{start:{line:101,column:29},end:{line:101,column:40}},{start:{line:101,column:44},end:{line:101,column:93}},{start:{line:101,column:97},end:{line:101,column:132}}],line:101},"7":{loc:{start:{line:127,column:6},end:{line:129,column:7}},type:"if",locations:[{start:{line:127,column:6},end:{line:129,column:7}},{start:{line:127,column:6},end:{line:129,column:7}}],line:127},"8":{loc:{start:{line:127,column:10},end:{line:127,column:50}},type:"binary-expr",locations:[{start:{line:127,column:10},end:{line:127,column:30}},{start:{line:127,column:34},end:{line:127,column:50}}],line:127},"9":{loc:{start:{line:154,column:4},end:{line:156,column:5}},type:"if",locations:[{start:{line:154,column:4},end:{line:156,column:5}},{start:{line:154,column:4},end:{line:156,column:5}}],line:154},"10":{loc:{start:{line:159,column:6},end:{line:163,column:7}},type:"if",locations:[{start:{line:159,column:6},end:{line:163,column:7}},{start:{line:159,column:6},end:{line:163,column:7}}],line:159},"11":{loc:{start:{line:172,column:4},end:{line:174,column:5}},type:"if",locations:[{start:{line:172,column:4},end:{line:174,column:5}},{start:{line:172,column:4},end:{line:174,column:5}}],line:172},"12":{loc:{start:{line:172,column:8},end:{line:172,column:90}},type:"binary-expr",locations:[{start:{line:172,column:8},end:{line:172,column:36}},{start:{line:172,column:40},end:{line:172,column:90}}],line:172}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0,0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0]},inputSourceMap:{version:3,sources:["../src/AccountLockout.js"],names:["AccountLockout","constructor","user","config","_user","_config","_setFailedLoginCount","value","query","username","updateFields","_failed_login_count","database","update","_isFailedLoginCountSet","$exists","find","then","users","Array","isArray","length","_initFailedLoginCount","failedLoginCountIsSet","_incrementFailedLoginCount","__op","amount","_setLockoutExpiration","$gte","accountLockout","threshold","now","Date","_account_lockout_expires_at","Parse","_encode","getTime","duration","catch","err","code","message","Error","OBJECT_NOT_FOUND","_notLocked","$gt","_handleFailedLoginAttempt","handleLoginAttempt","loginSuccessful","Promise","resolve","unlockAccount","unlockOnPasswordReset"],mappings:"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",sourcesContent:["// This class handles the Account Lockout Policy settings.\nimport Parse from 'parse/node';\n\nexport class AccountLockout {\n  constructor(user, config) {\n    this._user = user;\n    this._config = config;\n  }\n\n  /**\n   * set _failed_login_count to value\n   */\n  _setFailedLoginCount(value) {\n    const query = {\n      username: this._user.username,\n    };\n\n    const updateFields = {\n      _failed_login_count: value,\n    };\n\n    return this._config.database.update('_User', query, updateFields);\n  }\n\n  /**\n   * check if the _failed_login_count field has been set\n   */\n  _isFailedLoginCountSet() {\n    const query = {\n      username: this._user.username,\n      _failed_login_count: { $exists: true },\n    };\n\n    return this._config.database.find('_User', query).then(users => {\n      if (Array.isArray(users) && users.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    });\n  }\n\n  /**\n   * if _failed_login_count is NOT set then set it to 0\n   * else do nothing\n   */\n  _initFailedLoginCount() {\n    return this._isFailedLoginCountSet().then(failedLoginCountIsSet => {\n      if (!failedLoginCountIsSet) {\n        return this._setFailedLoginCount(0);\n      }\n    });\n  }\n\n  /**\n   * increment _failed_login_count by 1\n   */\n  _incrementFailedLoginCount() {\n    const query = {\n      username: this._user.username,\n    };\n\n    const updateFields = {\n      _failed_login_count: { __op: 'Increment', amount: 1 },\n    };\n\n    return this._config.database.update('_User', query, updateFields);\n  }\n\n  /**\n   * if the failed login count is greater than the threshold\n   * then sets lockout expiration to 'currenttime + accountPolicy.duration', i.e., account is locked out for the next 'accountPolicy.duration' minutes\n   * else do nothing\n   */\n  _setLockoutExpiration() {\n    const query = {\n      username: this._user.username,\n      _failed_login_count: { $gte: this._config.accountLockout.threshold },\n    };\n\n    const now = new Date();\n\n    const updateFields = {\n      _account_lockout_expires_at: Parse._encode(\n        new Date(now.getTime() + this._config.accountLockout.duration * 60 * 1000)\n      ),\n    };\n\n    return this._config.database.update('_User', query, updateFields).catch(err => {\n      if (\n        err &&\n        err.code &&\n        err.message &&\n        err.code === Parse.Error.OBJECT_NOT_FOUND &&\n        err.message === 'Object not found.'\n      ) {\n        return; // nothing to update so we are good\n      } else {\n        throw err; // unknown error\n      }\n    });\n  }\n\n  /**\n   * if _account_lockout_expires_at > current_time and _failed_login_count > threshold\n   *   reject with account locked error\n   * else\n   *   resolve\n   */\n  _notLocked() {\n    const query = {\n      username: this._user.username,\n      _account_lockout_expires_at: { $gt: Parse._encode(new Date()) },\n      _failed_login_count: { $gte: this._config.accountLockout.threshold },\n    };\n\n    return this._config.database.find('_User', query).then(users => {\n      if (Array.isArray(users) && users.length > 0) {\n        throw new Parse.Error(\n          Parse.Error.OBJECT_NOT_FOUND,\n          'Your account is locked due to multiple failed login attempts. Please try again after ' +\n            this._config.accountLockout.duration +\n            ' minute(s)'\n        );\n      }\n    });\n  }\n\n  /**\n   * set and/or increment _failed_login_count\n   * if _failed_login_count > threshold\n   *   set the _account_lockout_expires_at to current_time + accountPolicy.duration\n   * else\n   *   do nothing\n   */\n  _handleFailedLoginAttempt() {\n    return this._initFailedLoginCount()\n      .then(() => {\n        return this._incrementFailedLoginCount();\n      })\n      .then(() => {\n        return this._setLockoutExpiration();\n      });\n  }\n\n  /**\n   * handle login attempt if the Account Lockout Policy is enabled\n   */\n  handleLoginAttempt(loginSuccessful) {\n    if (!this._config.accountLockout) {\n      return Promise.resolve();\n    }\n    return this._notLocked().then(() => {\n      if (loginSuccessful) {\n        return this._setFailedLoginCount(0);\n      } else {\n        return this._handleFailedLoginAttempt();\n      }\n    });\n  }\n\n  /**\n   * Removes the account lockout.\n   */\n  unlockAccount() {\n    if (!this._config.accountLockout || !this._config.accountLockout.unlockOnPasswordReset) {\n      return Promise.resolve();\n    }\n    return this._config.database.update(\n      '_User',\n      { username: this._user.username },\n      {\n        _failed_login_count: { __op: 'Delete' },\n        _account_lockout_expires_at: { __op: 'Delete' },\n      }\n    );\n  }\n}\n\nexport default AccountLockout;\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"998eb5ddab4ca0f4964b188da4962e39a571cf06"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1ir9drndyn=function(){return actualCoverage;};}return actualCoverage;}cov_1ir9drndyn();cov_1ir9drndyn().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_1ir9drndyn().s[1]++;exports.default=exports.AccountLockout=void 0;var _node=(cov_1ir9drndyn().s[2]++,_interopRequireDefault(require("parse/node")));function _interopRequireDefault(obj){cov_1ir9drndyn().f[0]++;cov_1ir9drndyn().s[3]++;return(cov_1ir9drndyn().b[1][0]++,obj)&&(cov_1ir9drndyn().b[1][1]++,obj.__esModule)?(cov_1ir9drndyn().b[0][0]++,obj):(cov_1ir9drndyn().b[0][1]++,{default:obj});}// This class handles the Account Lockout Policy settings.
class AccountLockout{constructor(user,config){cov_1ir9drndyn().f[1]++;cov_1ir9drndyn().s[4]++;this._user=user;cov_1ir9drndyn().s[5]++;this._config=config;}/**
   * set _failed_login_count to value
   */_setFailedLoginCount(value){cov_1ir9drndyn().f[2]++;const query=(cov_1ir9drndyn().s[6]++,{username:this._user.username});const updateFields=(cov_1ir9drndyn().s[7]++,{_failed_login_count:value});cov_1ir9drndyn().s[8]++;return this._config.database.update('_User',query,updateFields);}/**
   * check if the _failed_login_count field has been set
   */_isFailedLoginCountSet(){cov_1ir9drndyn().f[3]++;const query=(cov_1ir9drndyn().s[9]++,{username:this._user.username,_failed_login_count:{$exists:true}});cov_1ir9drndyn().s[10]++;return this._config.database.find('_User',query).then(users=>{cov_1ir9drndyn().f[4]++;cov_1ir9drndyn().s[11]++;if((cov_1ir9drndyn().b[3][0]++,Array.isArray(users))&&(cov_1ir9drndyn().b[3][1]++,users.length>0)){cov_1ir9drndyn().b[2][0]++;cov_1ir9drndyn().s[12]++;return true;}else{cov_1ir9drndyn().b[2][1]++;cov_1ir9drndyn().s[13]++;return false;}});}/**
   * if _failed_login_count is NOT set then set it to 0
   * else do nothing
   */_initFailedLoginCount(){cov_1ir9drndyn().f[5]++;cov_1ir9drndyn().s[14]++;return this._isFailedLoginCountSet().then(failedLoginCountIsSet=>{cov_1ir9drndyn().f[6]++;cov_1ir9drndyn().s[15]++;if(!failedLoginCountIsSet){cov_1ir9drndyn().b[4][0]++;cov_1ir9drndyn().s[16]++;return this._setFailedLoginCount(0);}else{cov_1ir9drndyn().b[4][1]++;}});}/**
   * increment _failed_login_count by 1
   */_incrementFailedLoginCount(){cov_1ir9drndyn().f[7]++;const query=(cov_1ir9drndyn().s[17]++,{username:this._user.username});const updateFields=(cov_1ir9drndyn().s[18]++,{_failed_login_count:{__op:'Increment',amount:1}});cov_1ir9drndyn().s[19]++;return this._config.database.update('_User',query,updateFields);}/**
   * if the failed login count is greater than the threshold
   * then sets lockout expiration to 'currenttime + accountPolicy.duration', i.e., account is locked out for the next 'accountPolicy.duration' minutes
   * else do nothing
   */_setLockoutExpiration(){cov_1ir9drndyn().f[8]++;const query=(cov_1ir9drndyn().s[20]++,{username:this._user.username,_failed_login_count:{$gte:this._config.accountLockout.threshold}});const now=(cov_1ir9drndyn().s[21]++,new Date());const updateFields=(cov_1ir9drndyn().s[22]++,{_account_lockout_expires_at:_node.default._encode(new Date(now.getTime()+this._config.accountLockout.duration*60*1000))});cov_1ir9drndyn().s[23]++;return this._config.database.update('_User',query,updateFields).catch(err=>{cov_1ir9drndyn().f[9]++;cov_1ir9drndyn().s[24]++;if((cov_1ir9drndyn().b[6][0]++,err)&&(cov_1ir9drndyn().b[6][1]++,err.code)&&(cov_1ir9drndyn().b[6][2]++,err.message)&&(cov_1ir9drndyn().b[6][3]++,err.code===_node.default.Error.OBJECT_NOT_FOUND)&&(cov_1ir9drndyn().b[6][4]++,err.message==='Object not found.')){cov_1ir9drndyn().b[5][0]++;cov_1ir9drndyn().s[25]++;return;// nothing to update so we are good
}else{cov_1ir9drndyn().b[5][1]++;cov_1ir9drndyn().s[26]++;throw err;// unknown error
}});}/**
   * if _account_lockout_expires_at > current_time and _failed_login_count > threshold
   *   reject with account locked error
   * else
   *   resolve
   */_notLocked(){cov_1ir9drndyn().f[10]++;const query=(cov_1ir9drndyn().s[27]++,{username:this._user.username,_account_lockout_expires_at:{$gt:_node.default._encode(new Date())},_failed_login_count:{$gte:this._config.accountLockout.threshold}});cov_1ir9drndyn().s[28]++;return this._config.database.find('_User',query).then(users=>{cov_1ir9drndyn().f[11]++;cov_1ir9drndyn().s[29]++;if((cov_1ir9drndyn().b[8][0]++,Array.isArray(users))&&(cov_1ir9drndyn().b[8][1]++,users.length>0)){cov_1ir9drndyn().b[7][0]++;cov_1ir9drndyn().s[30]++;throw new _node.default.Error(_node.default.Error.OBJECT_NOT_FOUND,'Your account is locked due to multiple failed login attempts. Please try again after '+this._config.accountLockout.duration+' minute(s)');}else{cov_1ir9drndyn().b[7][1]++;}});}/**
   * set and/or increment _failed_login_count
   * if _failed_login_count > threshold
   *   set the _account_lockout_expires_at to current_time + accountPolicy.duration
   * else
   *   do nothing
   */_handleFailedLoginAttempt(){cov_1ir9drndyn().f[12]++;cov_1ir9drndyn().s[31]++;return this._initFailedLoginCount().then(()=>{cov_1ir9drndyn().f[13]++;cov_1ir9drndyn().s[32]++;return this._incrementFailedLoginCount();}).then(()=>{cov_1ir9drndyn().f[14]++;cov_1ir9drndyn().s[33]++;return this._setLockoutExpiration();});}/**
   * handle login attempt if the Account Lockout Policy is enabled
   */handleLoginAttempt(loginSuccessful){cov_1ir9drndyn().f[15]++;cov_1ir9drndyn().s[34]++;if(!this._config.accountLockout){cov_1ir9drndyn().b[9][0]++;cov_1ir9drndyn().s[35]++;return Promise.resolve();}else{cov_1ir9drndyn().b[9][1]++;}cov_1ir9drndyn().s[36]++;return this._notLocked().then(()=>{cov_1ir9drndyn().f[16]++;cov_1ir9drndyn().s[37]++;if(loginSuccessful){cov_1ir9drndyn().b[10][0]++;cov_1ir9drndyn().s[38]++;return this._setFailedLoginCount(0);}else{cov_1ir9drndyn().b[10][1]++;cov_1ir9drndyn().s[39]++;return this._handleFailedLoginAttempt();}});}/**
   * Removes the account lockout.
   */unlockAccount(){cov_1ir9drndyn().f[17]++;cov_1ir9drndyn().s[40]++;if((cov_1ir9drndyn().b[12][0]++,!this._config.accountLockout)||(cov_1ir9drndyn().b[12][1]++,!this._config.accountLockout.unlockOnPasswordReset)){cov_1ir9drndyn().b[11][0]++;cov_1ir9drndyn().s[41]++;return Promise.resolve();}else{cov_1ir9drndyn().b[11][1]++;}cov_1ir9drndyn().s[42]++;return this._config.database.update('_User',{username:this._user.username},{_failed_login_count:{__op:'Delete'},_account_lockout_expires_at:{__op:'Delete'}});}}cov_1ir9drndyn().s[43]++;exports.AccountLockout=AccountLockout;var _default=(cov_1ir9drndyn().s[44]++,AccountLockout);cov_1ir9drndyn().s[45]++;exports.default=_default;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9BY2NvdW50TG9ja291dC5qcyJdLCJuYW1lcyI6WyJBY2NvdW50TG9ja291dCIsImNvbnN0cnVjdG9yIiwidXNlciIsImNvbmZpZyIsIl91c2VyIiwiX2NvbmZpZyIsIl9zZXRGYWlsZWRMb2dpbkNvdW50IiwidmFsdWUiLCJxdWVyeSIsInVzZXJuYW1lIiwidXBkYXRlRmllbGRzIiwiX2ZhaWxlZF9sb2dpbl9jb3VudCIsImRhdGFiYXNlIiwidXBkYXRlIiwiX2lzRmFpbGVkTG9naW5Db3VudFNldCIsIiRleGlzdHMiLCJmaW5kIiwidGhlbiIsInVzZXJzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiX2luaXRGYWlsZWRMb2dpbkNvdW50IiwiZmFpbGVkTG9naW5Db3VudElzU2V0IiwiX2luY3JlbWVudEZhaWxlZExvZ2luQ291bnQiLCJfX29wIiwiYW1vdW50IiwiX3NldExvY2tvdXRFeHBpcmF0aW9uIiwiJGd0ZSIsImFjY291bnRMb2Nrb3V0IiwidGhyZXNob2xkIiwibm93IiwiRGF0ZSIsIl9hY2NvdW50X2xvY2tvdXRfZXhwaXJlc19hdCIsIlBhcnNlIiwiX2VuY29kZSIsImdldFRpbWUiLCJkdXJhdGlvbiIsImNhdGNoIiwiZXJyIiwiY29kZSIsIm1lc3NhZ2UiLCJFcnJvciIsIk9CSkVDVF9OT1RfRk9VTkQiLCJfbm90TG9ja2VkIiwiJGd0IiwiX2hhbmRsZUZhaWxlZExvZ2luQXR0ZW1wdCIsImhhbmRsZUxvZ2luQXR0ZW1wdCIsImxvZ2luU3VjY2Vzc2Z1bCIsIlByb21pc2UiLCJyZXNvbHZlIiwidW5sb2NrQWNjb3VudCIsInVubG9ja09uUGFzc3dvcmRSZXNldCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNBOzs7O0FBREE7QUFHTyxNQUFNQSxjQUFOLENBQXFCO0FBQzFCQyxFQUFBQSxXQUFXLENBQUNDLElBQUQsRUFBT0MsTUFBUCxFQUFlO0FBQ3hCLFNBQUtDLEtBQUwsR0FBYUYsSUFBYjtBQUNBLFNBQUtHLE9BQUws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TGJ6QixjIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhpcyBjbGFzcyBoYW5kbGVzIHRoZSBBY2NvdW50IExvY2tvdXQgUG9saWN5IHNldHRpbmdzLlxuaW1wb3J0IFBhcnNlIGZyb20gJ3BhcnNlL25vZGUnO1xuXG5leHBvcnQgY2xhc3MgQWNjb3VudExvY2tvdXQge1xuICBjb25zdHJ1Y3Rvcih1c2VyLCBjb25maWcpIHtcbiAgICB0aGlzLl91c2VyID0gdXNlcjtcbiAgICB0aGlzLl9jb25maWcgPSBjb25maWc7XG4gIH1cblxuICAvKipcbiAgICogc2V0IF9mYWlsZWRfbG9naW5fY291bnQgdG8gdmFsdWVcbiAgICovXG4gIF9zZXRGYWlsZWRMb2dpbkNvdW50KHZhbHVlKSB7XG4gICAgY29uc3QgcXVlcnkgPSB7XG4gICAgICB1c2VybmFtZTogdGhpcy5fdXNlci51c2VybmFtZSxcbiAgICB9O1xuXG4gICAgY29uc3QgdXBkYXRlRmllbGRzID0ge1xuICAgICAgX2ZhaWxlZF9sb2dpbl9jb3VudDogdmFsdWUsXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLl9jb25maWcuZGF0YWJhc2UudXBkYXRlKCdfVXNlcicsIHF1ZXJ5LCB1cGRhdGVGaWVsZHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIGNoZWNrIGlmIHRoZSBfZmFpbGVkX2xvZ2luX2NvdW50IGZpZWxkIGhhcyBiZWVuIHNldFxuICAgKi9cbiAgX2lzRmFpbGVkTG9naW5Db3VudFNldCgpIHtcbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIHVzZXJuYW1lOiB0aGlzLl91c2VyLnVzZXJuYW1lLFxuICAgICAgX2ZhaWxlZF9sb2dpbl9jb3VudDogeyAkZXhpc3RzOiB0cnVlIH0sXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLl9jb25maWcuZGF0YWJhc2UuZmluZCgnX1VzZXInLCBxdWVyeSkudGhlbih1c2VycyA9PiB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh1c2VycykgJiYgdXNlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBpZiBfZmFpbGVkX2xvZ2luX2NvdW50IGlzIE5PVCBzZXQgdGhlbiBzZXQgaXQgdG8gMFxuICAgKiBlbHNlIGRvIG5vdGhpbmdcbiAgICovXG4gIF9pbml0RmFpbGVkTG9naW5Db3VudCgpIHtcbiAgICByZXR1cm4gdGhpcy5faXNGYWlsZWRMb2dpbkNvdW50U2V0KCkudGhlbihmYWlsZWRMb2dpbkNvdW50SXNTZXQgPT4ge1xuICAgICAgaWYgKCFmYWlsZWRMb2dpbkNvdW50SXNTZXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldEZhaWxlZExvZ2luQ291bnQoMCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogaW5jcmVtZW50IF9mYWlsZWRfbG9naW5fY291bnQgYnkgMVxuICAgKi9cbiAgX2luY3JlbWVudEZhaWxlZExvZ2luQ291bnQoKSB7XG4gICAgY29uc3QgcXVlcnkgPSB7XG4gICAgICB1c2VybmFtZTogdGhpcy5fdXNlci51c2VybmFtZSxcbiAgICB9O1xuXG4gICAgY29uc3QgdXBkYXRlRmllbGRzID0ge1xuICAgICAgX2ZhaWxlZF9sb2dpbl9jb3VudDogeyBfX29wOiAnSW5jcmVtZW50JywgYW1vdW50OiAxIH0sXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLl9jb25maWcuZGF0YWJhc2UudXBkYXRlKCdfVXNlcicsIHF1ZXJ5LCB1cGRhdGVGaWVsZHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIGlmIHRoZSBmYWlsZWQgbG9naW4gY291bnQgaXMgZ3JlYXRlciB0aGFuIHRoZSB0aHJlc2hvbGRcbiAgICogdGhlbiBzZXRzIGxvY2tvdXQgZXhwaXJhdGlvbiB0byAnY3VycmVudHRpbWUgKyBhY2NvdW50UG9saWN5LmR1cmF0aW9uJywgaS5lLiwgYWNjb3VudCBpcyBsb2NrZWQgb3V0IGZvciB0aGUgbmV4dCAnYWNjb3VudFBvbGljeS5kdXJhdGlvbicgbWludXRlc1xuICAgKiBlbHNlIGRvIG5vdGhpbmdcbiAgICovXG4gIF9zZXRMb2Nrb3V0RXhwaXJhdGlvbigpIHtcbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIHVzZXJuYW1lOiB0aGlzLl91c2VyLnVzZXJuYW1lLFxuICAgICAgX2ZhaWxlZF9sb2dpbl9jb3VudDogeyAkZ3RlOiB0aGlzLl9jb25maWcuYWNjb3VudExvY2tvdXQudGhyZXNob2xkIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICBjb25zdCB1cGRhdGVGaWVsZHMgPSB7XG4gICAgICBfYWNjb3VudF9sb2Nrb3V0X2V4cGlyZXNfYXQ6IFBhcnNlLl9lbmNvZGUoXG4gICAgICAgIG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgKyB0aGlzLl9jb25maWcuYWNjb3VudExvY2tvdXQuZHVyYXRpb24gKiA2MCAqIDEwMDApXG4gICAgICApLFxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5fY29uZmlnLmRhdGFiYXNlLnVwZGF0ZSgnX1VzZXInLCBxdWVyeSwgdXBkYXRlRmllbGRzKS5jYXRjaChlcnIgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBlcnIgJiZcbiAgICAgICAgZXJyLmNvZGUgJiZcbiAgICAgICAgZXJyLm1lc3NhZ2UgJiZcbiAgICAgICAgZXJyLmNvZGUgPT09IFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQgJiZcbiAgICAgICAgZXJyLm1lc3NhZ2UgPT09ICdPYmplY3Qgbm90IGZvdW5kLidcbiAgICAgICkge1xuICAgICAgICByZXR1cm47IC8vIG5vdGhpbmcgdG8gdXBkYXRlIHNvIHdlIGFyZSBnb29kXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnI7IC8vIHVua25vd24gZXJyb3JcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBpZiBfYWNjb3VudF9sb2Nrb3V0X2V4cGlyZXNfYXQgPiBjdXJyZW50X3RpbWUgYW5kIF9mYWlsZWRfbG9naW5fY291bnQgPiB0aHJlc2hvbGRcbiAgICogICByZWplY3Qgd2l0aCBhY2NvdW50IGxvY2tlZCBlcnJvclxuICAgKiBlbHNlXG4gICAqICAgcmVzb2x2ZVxuICAgKi9cbiAgX25vdExvY2tlZCgpIHtcbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIHVzZXJuYW1lOiB0aGlzLl91c2VyLnVzZXJuYW1lLFxuICAgICAgX2FjY291bnRfbG9ja291dF9leHBpcmVzX2F0OiB7ICRndDogUGFyc2UuX2VuY29kZShuZXcgRGF0ZSgpKSB9LFxuICAgICAgX2ZhaWxlZF9sb2dpbl9jb3VudDogeyAkZ3RlOiB0aGlzLl9jb25maWcuYWNjb3VudExvY2tvdXQudGhyZXNob2xkIH0sXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLl9jb25maWcuZGF0YWJhc2UuZmluZCgnX1VzZXInLCBxdWVyeSkudGhlbih1c2VycyA9PiB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh1c2VycykgJiYgdXNlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgICAgUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCxcbiAgICAgICAgICAnWW91ciBhY2NvdW50IGlzIGxvY2tlZCBkdWUgdG8gbXVsdGlwbGUgZmFpbGVkIGxvZ2luIGF0dGVtcHRzLiBQbGVhc2UgdHJ5IGFnYWluIGFmdGVyICcgK1xuICAgICAgICAgICAgdGhpcy5fY29uZmlnLmFjY291bnRMb2Nrb3V0LmR1cmF0aW9uICtcbiAgICAgICAgICAgICcgbWludXRlKHMpJ1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIHNldCBhbmQvb3IgaW5jcmVtZW50IF9mYWlsZWRfbG9naW5fY291bnRcbiAgICogaWYgX2ZhaWxlZF9sb2dpbl9jb3VudCA+IHRocmVzaG9sZFxuICAgKiAgIHNldCB0aGUgX2FjY291bnRfbG9ja291dF9leHBpcmVzX2F0IHRvIGN1cnJlbnRfdGltZSArIGFjY291bnRQb2xpY3kuZHVyYXRpb25cbiAgICogZWxzZVxuICAgKiAgIGRvIG5vdGhpbmdcbiAgICovXG4gIF9oYW5kbGVGYWlsZWRMb2dpbkF0dGVtcHQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2luaXRGYWlsZWRMb2dpbkNvdW50KClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luY3JlbWVudEZhaWxlZExvZ2luQ291bnQoKTtcbiAgICAgIH0pXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZXRMb2Nrb3V0RXhwaXJhdGlvbigpO1xuICAgICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogaGFuZGxlIGxvZ2luIGF0dGVtcHQgaWYgdGhlIEFjY291bnQgTG9ja291dCBQb2xpY3kgaXMgZW5hYmxlZFxuICAgKi9cbiAgaGFuZGxlTG9naW5BdHRlbXB0KGxvZ2luU3VjY2Vzc2Z1bCkge1xuICAgIGlmICghdGhpcy5fY29uZmlnLmFjY291bnRMb2Nrb3V0KSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9ub3RMb2NrZWQoKS50aGVuKCgpID0+IHtcbiAgICAgIGlmIChsb2dpblN1Y2Nlc3NmdWwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldEZhaWxlZExvZ2luQ291bnQoMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlRmFpbGVkTG9naW5BdHRlbXB0KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyB0aGUgYWNjb3VudCBsb2Nrb3V0LlxuICAgKi9cbiAgdW5sb2NrQWNjb3VudCgpIHtcbiAgICBpZiAoIXRoaXMuX2NvbmZpZy5hY2NvdW50TG9ja291dCB8fCAhdGhpcy5fY29uZmlnLmFjY291bnRMb2Nrb3V0LnVubG9ja09uUGFzc3dvcmRSZXNldCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fY29uZmlnLmRhdGFiYXNlLnVwZGF0ZShcbiAgICAgICdfVXNlcicsXG4gICAgICB7IHVzZXJuYW1lOiB0aGlzLl91c2VyLnVzZXJuYW1lIH0sXG4gICAgICB7XG4gICAgICAgIF9mYWlsZWRfbG9naW5fY291bnQ6IHsgX19vcDogJ0RlbGV0ZScgfSxcbiAgICAgICAgX2FjY291bnRfbG9ja291dF9leHBpcmVzX2F0OiB7IF9fb3A6ICdEZWxldGUnIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBY2NvdW50TG9ja291dDtcbiJdfQ==
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9BY2NvdW50TG9ja291dC5qcyJdLCJuYW1lcyI6WyJjb25zdHJ1Y3RvciIsIl9jb25maWciLCJfc2V0RmFpbGVkTG9naW5Db3VudCIsInF1ZXJ5IiwidXNlcm5hbWUiLCJ1cGRhdGVGaWVsZHMiLCJfZmFpbGVkX2xvZ2luX2NvdW50IiwidmFsdWUiLCJfaXNGYWlsZWRMb2dpbkNvdW50U2V0IiwiJGV4aXN0cyIsInVzZXJzIiwiQXJyYXkiLCJfaW5pdEZhaWxlZExvZ2luQ291bnQiLCJmYWlsZWRMb2dpbkNvdW50SXNTZXQiLCJfaW5jcmVtZW50RmFpbGVkTG9naW5Db3VudCIsIl9fb3AiLCJhbW91bnQiLCJfc2V0TG9ja291dEV4cGlyYXRpb24iLCIkZ3RlIiwidGhyZXNob2xkIiwibm93IiwiX2FjY291bnRfbG9ja291dF9leHBpcmVzX2F0IiwiUGFyc2UiLCJlcnIiLCJfbm90TG9ja2VkIiwiJGd0IiwiX2hhbmRsZUZhaWxlZExvZ2luQXR0ZW1wdCIsImhhbmRsZUxvZ2luQXR0ZW1wdCIsIlByb21pc2UiLCJ1bmxvY2tBY2NvdW50IiwiQWNjb3VudExvY2tvdXQiXSwibWFwcGluZ3MiOiIybmtCQU1JO2tQQUxKLEdBQUEsQ0FBQSxLQUFBLDBCQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBLENBQUEsQyxzUEFEQTtBQUdPLEtBQUEsQ0FBQSxjQUFxQixDQUMxQkEsV0FBVyxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQWUsaURBQ3hCLEtBQUEsS0FBQSxDQUFBLElBQUEsQ0FEd0Isd0JBRXhCLEtBQUtDLE9BQUwsQ0FBQSxNQUFBLENBQ0QsQ0FFRDtBQUNGO0FBQ0EsS0FDRUMsb0JBQW9CLENBQUEsS0FBQSxDQUFRLHlCQUMxQixLQUFNQyxDQUFBQSxLQUFLLDBCQUFHLENBQ1pDLFFBQVEsQ0FBRSxLQUFBLEtBQUEsQ0FBV0EsUUFEVCxDQUFILENBQVgsQ0FJQSxLQUFNQyxDQUFBQSxZQUFZLDBCQUFHLENBQ25CQyxtQkFB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TyxFQUFQLENBTEosQ0FBTyxDQUFQLENBT0QsQ0FFRDtBQUNGO0FBQ0EsS0FDRUMsa0JBQWtCLENBQUEsZUFBQSxDQUFrQixtREFDbEMsR0FBSSxDQUFDLEtBQUEsT0FBQSxDQUFMLGNBQUEsQ0FBa0MscURBQ2hDLE1BQU9DLENBQUFBLE9BQU8sQ0FBZCxPQUFPQSxFQUFQLENBQ0QsQ0FGRCxpQ0FEa0MseUJBSWxDLE1BQU8sTUFBQSxVQUFBLEdBQUEsSUFBQSxDQUF1QixJQUFNLG1EQUNsQyxHQUFBLGVBQUEsQ0FBcUIsc0RBQ25CLE1BQU8sTUFBQSxvQkFBQSxDQUFQLENBQU8sQ0FBUCxDQURGLENBQUEsSUFFTyxzREFDTCxNQUFPLE1BQVAseUJBQU8sRUFBUCxDQUNELENBTEgsQ0FBTyxDQUFQLENBT0QsQ0FFRDtBQUNGO0FBQ0EsS0FDRUMsYUFBYSxFQUFHLG1EQUNkLEdBQUksOEJBQUMsS0FBQSxPQUFBLENBQUQsY0FBQSxnQ0FBZ0MsQ0FBQyxLQUFBLE9BQUEsQ0FBQSxjQUFBLENBQXJDLHFCQUFJLENBQUosQ0FBd0Ysc0RBQ3RGLE1BQU9ELENBQUFBLE9BQU8sQ0FBZCxPQUFPQSxFQUFQLENBQ0QsQ0FGRCxrQ0FEYyx5QkFJZCxNQUFPLE1BQUEsT0FBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUEsT0FBQSxDQUVMLENBQUV4QixRQUFRLENBQUUsS0FBQSxLQUFBLENBQVdBLFFBQXZCLENBRkssQ0FHTCxDQUNFRSxtQkFBbUIsQ0FBRSxDQUFFUyxJQUFJLENBQUUsUUFBUixDQUR2QixDQUVFTSwyQkFBMkIsQ0FBRSxDQUFFTixJQUFJLENBQUUsUUFBUixDQUYvQixDQUhLLENBQVAsQ0FRRCxDQTdLeUIsQyxzR0FnTGJlLGMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGlzIGNsYXNzIGhhbmRsZXMgdGhlIEFjY291bnQgTG9ja291dCBQb2xpY3kgc2V0dGluZ3MuXG5pbXBvcnQgUGFyc2UgZnJvbSAncGFyc2Uvbm9kZSc7XG5cbmV4cG9ydCBjbGFzcyBBY2NvdW50TG9ja291dCB7XG4gIGNvbnN0cnVjdG9yKHVzZXIsIGNvbmZpZykge1xuICAgIHRoaXMuX3VzZXIgPSB1c2VyO1xuICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcbiAgfVxuXG4gIC8qKlxuICAgKiBzZXQgX2ZhaWxlZF9sb2dpbl9jb3VudCB0byB2YWx1ZVxuICAgKi9cbiAgX3NldEZhaWxlZExvZ2luQ291bnQodmFsdWUpIHtcbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIHVzZXJuYW1lOiB0aGlzLl91c2VyLnVzZXJuYW1lLFxuICAgIH07XG5cbiAgICBjb25zdCB1cGRhdGVGaWVsZHMgPSB7XG4gICAgICBfZmFpbGVkX2xvZ2luX2NvdW50OiB2YWx1ZSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuX2NvbmZpZy5kYXRhYmFzZS51cGRhdGUoJ19Vc2VyJywgcXVlcnksIHVwZGF0ZUZpZWxkcyk7XG4gIH1cblxuICAvKipcbiAgICogY2hlY2sgaWYgdGhlIF9mYWlsZWRfbG9naW5fY291bnQgZmllbGQgaGFzIGJlZW4gc2V0XG4gICAqL1xuICBfaXNGYWlsZWRMb2dpbkNvdW50U2V0KCkge1xuICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgdXNlcm5hbWU6IHRoaXMuX3VzZXIudXNlcm5hbWUsXG4gICAgICBfZmFpbGVkX2xvZ2luX2NvdW50OiB7ICRleGlzdHM6IHRydWUgfSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuX2NvbmZpZy5kYXRhYmFzZS5maW5kKCdfVXNlcicsIHF1ZXJ5KS50aGVuKHVzZXJzID0+IHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHVzZXJzKSAmJiB1c2Vycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIGlmIF9mYWlsZWRfbG9naW5fY291bnQgaXMgTk9UIHNldCB0aGVuIHNldCBpdCB0byAwXG4gICAqIGVsc2UgZG8gbm90aGluZ1xuICAgKi9cbiAgX2luaXRGYWlsZWRMb2dpbkNvdW50KCkge1xuICAgIHJldHVybiB0aGlzLl9pc0ZhaWxlZExvZ2luQ291bnRTZXQoKS50aGVuKGZhaWxlZExvZ2luQ291bnRJc1NldCA9PiB7XG4gICAgICBpZiAoIWZhaWxlZExvZ2luQ291bnRJc1NldCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0RmFpbGVkTG9naW5Db3VudCgwKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBpbmNyZW1lbnQgX2ZhaWxlZF9sb2dpbl9jb3VudCBieSAxXG4gICAqL1xuICBfaW5jcmVtZW50RmFpbGVkTG9naW5Db3VudCgpIHtcbiAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgIHVzZXJuYW1lOiB0aGlzLl91c2VyLnVzZXJuYW1lLFxuICAgIH07XG5cbiAgICBjb25zdCB1cGRhdGVGaWVsZHMgPSB7XG4gICAgICBfZmFpbGVkX2xvZ2luX2NvdW50OiB7IF9fb3A6ICdJbmNyZW1lbnQnLCBhbW91bnQ6IDEgfSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuX2NvbmZpZy5kYXRhYmFzZS51cGRhdGUoJ19Vc2VyJywgcXVlcnksIHVwZGF0ZUZpZWxkcyk7XG4gIH1cblxuICAvKipcbiAgICogaWYgdGhlIGZhaWxlZCBsb2dpbiBjb3VudCBpcyBncmVhdGVyIHRoYW4gdGhlIHRocmVzaG9sZFxuICAgKiB0aGVuIHNldHMgbG9ja291dCBleHBpcmF0aW9uIHRvICdjdXJyZW50dGltZSArIGFjY291bnRQb2xpY3kuZHVyYXRpb24nLCBpLmUuLCBhY2NvdW50IGlzIGxvY2tlZCBvdXQgZm9yIHRoZSBuZXh0ICdhY2NvdW50UG9saWN5LmR1cmF0aW9uJyBtaW51dGVzXG4gICAqIGVsc2UgZG8gbm90aGluZ1xuICAgKi9cbiAgX3NldExvY2tvdXRFeHBpcmF0aW9uKCkge1xuICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgdXNlcm5hbWU6IHRoaXMuX3VzZXIudXNlcm5hbWUsXG4gICAgICBfZmFpbGVkX2xvZ2luX2NvdW50OiB7ICRndGU6IHRoaXMuX2NvbmZpZy5hY2NvdW50TG9ja291dC50aHJlc2hvbGQgfSxcbiAgICB9O1xuXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgIGNvbnN0IHVwZGF0ZUZpZWxkcyA9IHtcbiAgICAgIF9hY2NvdW50X2xvY2tvdXRfZXhwaXJlc19hdDogUGFyc2UuX2VuY29kZShcbiAgICAgICAgbmV3IERhdGUobm93LmdldFRpbWUoKSArIHRoaXMuX2NvbmZpZy5hY2NvdW50TG9ja291dC5kdXJhdGlvbiAqIDYwICogMTAwMClcbiAgICAgICksXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLl9jb25maWcuZGF0YWJhc2UudXBkYXRlKCdfVXNlcicsIHF1ZXJ5LCB1cGRhdGVGaWVsZHMpLmNhdGNoKGVyciA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGVyciAmJlxuICAgICAgICBlcnIuY29kZSAmJlxuICAgICAgICBlcnIubWVzc2FnZSAmJlxuICAgICAgICBlcnIuY29kZSA9PT0gUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCAmJlxuICAgICAgICBlcnIubWVzc2FnZSA9PT0gJ09iamVjdCBub3QgZm91bmQuJ1xuICAgICAgKSB7XG4gICAgICAgIHJldHVybjsgLy8gbm90aGluZyB0byB1cGRhdGUgc28gd2UgYXJlIGdvb2RcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IGVycjsgLy8gdW5rbm93biBlcnJvclxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIGlmIF9hY2NvdW50X2xvY2tvdXRfZXhwaXJlc19hdCA+IGN1cnJlbnRfdGltZSBhbmQgX2ZhaWxlZF9sb2dpbl9jb3VudCA+IHRocmVzaG9sZFxuICAgKiAgIHJlamVjdCB3aXRoIGFjY291bnQgbG9ja2VkIGVycm9yXG4gICAqIGVsc2VcbiAgICogICByZXNvbHZlXG4gICAqL1xuICBfbm90TG9ja2VkKCkge1xuICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgdXNlcm5hbWU6IHRoaXMuX3VzZXIudXNlcm5hbWUsXG4gICAgICBfYWNjb3VudF9sb2Nrb3V0X2V4cGlyZXNfYXQ6IHsgJGd0OiBQYXJzZS5fZW5jb2RlKG5ldyBEYXRlKCkpIH0sXG4gICAgICBfZmFpbGVkX2xvZ2luX2NvdW50OiB7ICRndGU6IHRoaXMuX2NvbmZpZy5hY2NvdW50TG9ja291dC50aHJlc2hvbGQgfSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuX2NvbmZpZy5kYXRhYmFzZS5maW5kKCdfVXNlcicsIHF1ZXJ5KS50aGVuKHVzZXJzID0+IHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHVzZXJzKSAmJiB1c2Vycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgICAgICBQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELFxuICAgICAgICAgICdZb3VyIGFjY291bnQgaXMgbG9ja2VkIGR1ZSB0byBtdWx0aXBsZSBmYWlsZWQgbG9naW4gYXR0ZW1wdHMuIFBsZWFzZSB0cnkgYWdhaW4gYWZ0ZXIgJyArXG4gICAgICAgICAgICB0aGlzLl9jb25maWcuYWNjb3VudExvY2tvdXQuZHVyYXRpb24gK1xuICAgICAgICAgICAgJyBtaW51dGUocyknXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogc2V0IGFuZC9vciBpbmNyZW1lbnQgX2ZhaWxlZF9sb2dpbl9jb3VudFxuICAgKiBpZiBfZmFpbGVkX2xvZ2luX2NvdW50ID4gdGhyZXNob2xkXG4gICAqICAgc2V0IHRoZSBfYWNjb3VudF9sb2Nrb3V0X2V4cGlyZXNfYXQgdG8gY3VycmVudF90aW1lICsgYWNjb3VudFBvbGljeS5kdXJhdGlvblxuICAgKiBlbHNlXG4gICAqICAgZG8gbm90aGluZ1xuICAgKi9cbiAgX2hhbmRsZUZhaWxlZExvZ2luQXR0ZW1wdCgpIHtcbiAgICByZXR1cm4gdGhpcy5faW5pdEZhaWxlZExvZ2luQ291bnQoKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5jcmVtZW50RmFpbGVkTG9naW5Db3VudCgpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldExvY2tvdXRFeHBpcmF0aW9uKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBoYW5kbGUgbG9naW4gYXR0ZW1wdCBpZiB0aGUgQWNjb3VudCBMb2Nrb3V0IFBvbGljeSBpcyBlbmFibGVkXG4gICAqL1xuICBoYW5kbGVMb2dpbkF0dGVtcHQobG9naW5TdWNjZXNzZnVsKSB7XG4gICAgaWYgKCF0aGlzLl9jb25maWcuYWNjb3VudExvY2tvdXQpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX25vdExvY2tlZCgpLnRoZW4oKCkgPT4ge1xuICAgICAgaWYgKGxvZ2luU3VjY2Vzc2Z1bCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0RmFpbGVkTG9naW5Db3VudCgwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVGYWlsZWRMb2dpbkF0dGVtcHQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIHRoZSBhY2NvdW50IGxvY2tvdXQuXG4gICAqL1xuICB1bmxvY2tBY2NvdW50KCkge1xuICAgIGlmICghdGhpcy5fY29uZmlnLmFjY291bnRMb2Nrb3V0IHx8ICF0aGlzLl9jb25maWcuYWNjb3VudExvY2tvdXQudW5sb2NrT25QYXNzd29yZFJlc2V0KSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jb25maWcuZGF0YWJhc2UudXBkYXRlKFxuICAgICAgJ19Vc2VyJyxcbiAgICAgIHsgdXNlcm5hbWU6IHRoaXMuX3VzZXIudXNlcm5hbWUgfSxcbiAgICAgIHtcbiAgICAgICAgX2ZhaWxlZF9sb2dpbl9jb3VudDogeyBfX29wOiAnRGVsZXRlJyB9LFxuICAgICAgICBfYWNjb3VudF9sb2Nrb3V0X2V4cGlyZXNfYXQ6IHsgX19vcDogJ0RlbGV0ZScgfSxcbiAgICAgIH1cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFjY291bnRMb2Nrb3V0O1xuIl19