"use strict";function cov_2bzvxsg282(){var path="/parse-server/lib/Controllers/FilesController.js";var hash="1cd5a70663cde10c6aa8d3de2d7113b86360e7f7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Controllers/FilesController.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:51}},"2":{start:{line:8,column:19},end:{line:8,column:44}},"3":{start:{line:10,column:27},end:{line:10,column:83}},"4":{start:{line:12,column:20},end:{line:12,column:61}},"5":{start:{line:14,column:12},end:{line:14,column:51}},"6":{start:{line:16,column:12},end:{line:16,column:51}},"7":{start:{line:18,column:39},end:{line:18,column:93}},"8":{start:{line:21,column:14},end:{line:21,column:36}},"9":{start:{line:23,column:25},end:{line:23,column:118}},"10":{start:{line:27,column:4},end:{line:27,column:46}},"11":{start:{line:31,column:20},end:{line:31,column:51}},"12":{start:{line:33,column:25},end:{line:33,column:43}},"13":{start:{line:35,column:4},end:{line:39,column:5}},"14":{start:{line:36,column:6},end:{line:36,column:74}},"15":{start:{line:37,column:11},end:{line:39,column:5}},"16":{start:{line:38,column:6},end:{line:38,column:52}},"17":{start:{line:41,column:4},end:{line:43,column:5}},"18":{start:{line:42,column:6},end:{line:42,column:72}},"19":{start:{line:45,column:21},end:{line:45,column:67}},"20":{start:{line:46,column:4},end:{line:51,column:7}},"21":{start:{line:47,column:6},end:{line:50,column:9}},"22":{start:{line:55,column:4},end:{line:55,column:45}},"23":{start:{line:59,column:4},end:{line:61,column:5}},"24":{start:{line:60,column:6},end:{line:60,column:48}},"25":{start:{line:63,column:4},end:{line:63,column:31}},"26":{start:{line:73,column:4},end:{line:76,column:5}},"27":{start:{line:74,column:6},end:{line:74,column:63}},"28":{start:{line:74,column:24},end:{line:74,column:61}},"29":{start:{line:75,column:6},end:{line:75,column:13}},"30":{start:{line:78,column:4},end:{line:80,column:5}},"31":{start:{line:79,column:6},end:{line:79,column:13}},"32":{start:{line:82,column:4},end:{line:106,column:5}},"33":{start:{line:83,column:25},end:{line:83,column:36}},"34":{start:{line:85,column:6},end:{line:105,column:7}},"35":{start:{line:86,column:8},end:{line:88,column:9}},"36":{start:{line:87,column:10},end:{line:87,column:19}},"37":{start:{line:90,column:25},end:{line:90,column:43}},"38":{start:{line:94,column:8},end:{line:104,column:9}},"39":{start:{line:95,column:10},end:{line:95,column:77}},"40":{start:{line:97,column:10},end:{line:103,column:11}},"41":{start:{line:98,column:12},end:{line:98,column:116}},"42":{start:{line:99,column:17},end:{line:103,column:11}},"43":{start:{line:100,column:12},end:{line:100,column:112}},"44":{start:{line:102,column:12},end:{line:102,column:79}},"45":{start:{line:110,column:4},end:{line:110,column:38}},"46":{start:{line:114,column:4},end:{line:114,column:74}},"47":{start:{line:118,column:4},end:{line:126,column:5}},"48":{start:{line:119,column:20},end:{line:119,column:59}},"49":{start:{line:121,column:6},end:{line:123,column:7}},"50":{start:{line:122,column:8},end:{line:122,column:21}},"51":{start:{line:125,column:6},end:{line:125,column:67}},"52":{start:{line:128,column:4},end:{line:128,column:57}},"53":{start:{line:133,column:0},end:{line:133,column:42}},"54":{start:{line:134,column:15},end:{line:134,column:30}},"55":{start:{line:135,column:0},end:{line:135,column:27}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:18,column:9},end:{line:18,column:31}},loc:{start:{line:18,column:37},end:{line:18,column:95}},line:18},"1":{name:"(anonymous_1)",decl:{start:{line:26,column:2},end:{line:26,column:3}},loc:{start:{line:26,column:32},end:{line:28,column:3}},line:26},"2":{name:"(anonymous_2)",decl:{start:{line:30,column:2},end:{line:30,column:3}},loc:{start:{line:30,column:59},end:{line:52,column:3}},line:30},"3":{name:"(anonymous_3)",decl:{start:{line:46,column:78},end:{line:46,column:79}},loc:{start:{line:46,column:84},end:{line:51,column:5}},line:46},"4":{name:"(anonymous_4)",decl:{start:{line:54,column:2},end:{line:54,column:3}},loc:{start:{line:54,column:31},end:{line:56,column:3}},line:54},"5":{name:"(anonymous_5)",decl:{start:{line:58,column:2},end:{line:58,column:3}},loc:{start:{line:58,column:24},end:{line:64,column:3}},line:58},"6":{name:"(anonymous_6)",decl:{start:{line:72,column:2},end:{line:72,column:3}},loc:{start:{line:72,column:38},end:{line:107,column:3}},line:72},"7":{name:"(anonymous_7)",decl:{start:{line:74,column:17},end:{line:74,column:18}},loc:{start:{line:74,column:24},end:{line:74,column:61}},line:74},"8":{name:"(anonymous_8)",decl:{start:{line:109,column:2},end:{line:109,column:3}},loc:{start:{line:109,column:24},end:{line:111,column:3}},line:109},"9":{name:"(anonymous_9)",decl:{start:{line:113,column:2},end:{line:113,column:3}},loc:{start:{line:113,column:60},end:{line:115,column:3}},line:113},"10":{name:"(anonymous_10)",decl:{start:{line:117,column:2},end:{line:117,column:3}},loc:{start:{line:117,column:29},end:{line:129,column:3}},line:117}},branchMap:{"0":{loc:{start:{line:18,column:46},end:{line:18,column:92}},type:"cond-expr",locations:[{start:{line:18,column:70},end:{line:18,column:73}},{start:{line:18,column:76},end:{line:18,column:92}}],line:18},"1":{loc:{start:{line:18,column:46},end:{line:18,column:67}},type:"binary-expr",locations:[{start:{line:18,column:46},end:{line:18,column:49}},{start:{line:18,column:53},end:{line:18,column:67}}],line:18},"2":{loc:{start:{line:35,column:4},end:{line:39,column:5}},type:"if",locations:[{start:{line:35,column:4},end:{line:39,column:5}},{start:{line:35,column:4},end:{line:39,column:5}}],line:35},"3":{loc:{start:{line:35,column:8},end:{line:35,column:79}},type:"binary-expr",locations:[{start:{line:35,column:8},end:{line:35,column:21}},{start:{line:35,column:25},end:{line:35,column:36}},{start:{line:35,column:40},end:{line:35,column:79}}],line:35},"4":{loc:{start:{line:37,column:11},end:{line:39,column:5}},type:"if",locations:[{start:{line:37,column:11},end:{line:39,column:5}},{start:{line:37,column:11},end:{line:39,column:5}}],line:37},"5":{loc:{start:{line:37,column:15},end:{line:37,column:43}},type:"binary-expr",locations:[{start:{line:37,column:15},end:{line:37,column:27}},{start:{line:37,column:31},end:{line:37,column:43}}],line:37},"6":{loc:{start:{line:41,column:4},end:{line:43,column:5}},type:"if",locations:[{start:{line:41,column:4},end:{line:43,column:5}},{start:{line:41,column:4},end:{line:43,column:5}}],line:41},"7":{loc:{start:{line:59,column:4},end:{line:61,column:5}},type:"if",locations:[{start:{line:59,column:4},end:{line:61,column:5}},{start:{line:59,column:4},end:{line:61,column:5}}],line:59},"8":{loc:{start:{line:73,column:4},end:{line:76,column:5}},type:"if",locations:[{start:{line:73,column:4},end:{line:76,column:5}},{start:{line:73,column:4},end:{line:76,column:5}}],line:73},"9":{loc:{start:{line:78,column:4},end:{line:80,column:5}},type:"if",locations:[{start:{line:78,column:4},end:{line:80,column:5}},{start:{line:78,column:4},end:{line:80,column:5}}],line:78},"10":{loc:{start:{line:85,column:6},end:{line:105,column:7}},type:"if",locations:[{start:{line:85,column:6},end:{line:105,column:7}},{start:{line:85,column:6},end:{line:105,column:7}}],line:85},"11":{loc:{start:{line:85,column:10},end:{line:85,column:55}},type:"binary-expr",locations:[{start:{line:85,column:10},end:{line:85,column:20}},{start:{line:85,column:24},end:{line:85,column:55}}],line:85},"12":{loc:{start:{line:86,column:8},end:{line:88,column:9}},type:"if",locations:[{start:{line:86,column:8},end:{line:88,column:9}},{start:{line:86,column:8},end:{line:88,column:9}}],line:86},"13":{loc:{start:{line:94,column:8},end:{line:104,column:9}},type:"if",locations:[{start:{line:94,column:8},end:{line:104,column:9}},{start:{line:94,column:8},end:{line:104,column:9}}],line:94},"14":{loc:{start:{line:97,column:10},end:{line:103,column:11}},type:"if",locations:[{start:{line:97,column:10},end:{line:103,column:11}},{start:{line:97,column:10},end:{line:103,column:11}}],line:97},"15":{loc:{start:{line:99,column:17},end:{line:103,column:11}},type:"if",locations:[{start:{line:99,column:17},end:{line:103,column:11}},{start:{line:99,column:17},end:{line:103,column:11}}],line:99},"16":{loc:{start:{line:118,column:4},end:{line:126,column:5}},type:"if",locations:[{start:{line:118,column:4},end:{line:126,column:5}},{start:{line:118,column:4},end:{line:126,column:5}}],line:118},"17":{loc:{start:{line:121,column:6},end:{line:123,column:7}},type:"if",locations:[{start:{line:121,column:6},end:{line:123,column:7}},{start:{line:121,column:6},end:{line:123,column:7}}],line:121}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0]},inputSourceMap:{version:3,sources:["../../src/Controllers/FilesController.js"],names:["Parse","require","legacyFilesRegex","RegExp","FilesController","AdaptableController","getFileData","config","filename","adapter","createFile","data","contentType","options","extname","path","hasExtension","length","mime","getExtension","getType","preserveFileName","location","getFileLocation","then","Promise","resolve","url","name","deleteFile","getMetadata","expandFilesInObject","object","Array","map","obj","key","fileObject","fileKey","undefined","indexOf","encodeURIComponent","test","expectedAdapterType","FilesAdapter","handleFileStream","req","res","validateFilename","error","Error","INVALID_FILE_NAME"],mappings:"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",sourcesContent:["// FilesController.js\nimport { randomHexString } from '../cryptoUtils';\nimport AdaptableController from './AdaptableController';\nimport { validateFilename, FilesAdapter } from '../Adapters/Files/FilesAdapter';\nimport path from 'path';\nimport mime from 'mime';\nconst Parse = require('parse').Parse;\n\nconst legacyFilesRegex = new RegExp(\n  '^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}-.*'\n);\n\nexport class FilesController extends AdaptableController {\n  getFileData(config, filename) {\n    return this.adapter.getFileData(filename);\n  }\n\n  createFile(config, filename, data, contentType, options) {\n    const extname = path.extname(filename);\n\n    const hasExtension = extname.length > 0;\n\n    if (!hasExtension && contentType && mime.getExtension(contentType)) {\n      filename = filename + '.' + mime.getExtension(contentType);\n    } else if (hasExtension && !contentType) {\n      contentType = mime.getType(filename);\n    }\n\n    if (!this.options.preserveFileName) {\n      filename = randomHexString(32) + '_' + filename;\n    }\n\n    const location = this.adapter.getFileLocation(config, filename);\n    return this.adapter.createFile(filename, data, contentType, options).then(() => {\n      return Promise.resolve({\n        url: location,\n        name: filename,\n      });\n    });\n  }\n\n  deleteFile(config, filename) {\n    return this.adapter.deleteFile(filename);\n  }\n\n  getMetadata(filename) {\n    if (typeof this.adapter.getMetadata === 'function') {\n      return this.adapter.getMetadata(filename);\n    }\n    return Promise.resolve({});\n  }\n\n  /**\n   * Find file references in REST-format object and adds the url key\n   * with the current mount point and app id.\n   * Object may be a single object or list of REST-format objects.\n   */\n  expandFilesInObject(config, object) {\n    if (object instanceof Array) {\n      object.map(obj => this.expandFilesInObject(config, obj));\n      return;\n    }\n    if (typeof object !== 'object') {\n      return;\n    }\n    for (const key in object) {\n      const fileObject = object[key];\n      if (fileObject && fileObject['__type'] === 'File') {\n        if (fileObject['url']) {\n          continue;\n        }\n        const filename = fileObject['name'];\n        // all filenames starting with \"tfss-\" should be from files.parsetfss.com\n        // all filenames starting with a \"-\" seperated UUID should be from files.parse.com\n        // all other filenames have been migrated or created from Parse Server\n        if (config.fileKey === undefined) {\n          fileObject['url'] = this.adapter.getFileLocation(config, filename);\n        } else {\n          if (filename.indexOf('tfss-') === 0) {\n            fileObject['url'] =\n              'http://files.parsetfss.com/' + config.fileKey + '/' + encodeURIComponent(filename);\n          } else if (legacyFilesRegex.test(filename)) {\n            fileObject['url'] =\n              'http://files.parse.com/' + config.fileKey + '/' + encodeURIComponent(filename);\n          } else {\n            fileObject['url'] = this.adapter.getFileLocation(config, filename);\n          }\n        }\n      }\n    }\n  }\n\n  expectedAdapterType() {\n    return FilesAdapter;\n  }\n\n  handleFileStream(config, filename, req, res, contentType) {\n    return this.adapter.handleFileStream(filename, req, res, contentType);\n  }\n\n  validateFilename(filename) {\n    if (typeof this.adapter.validateFilename === 'function') {\n      const error = this.adapter.validateFilename(filename);\n      if (typeof error !== 'string') {\n        return error;\n      }\n      return new Parse.Error(Parse.Error.INVALID_FILE_NAME, error);\n    }\n    return validateFilename(filename);\n  }\n}\n\nexport default FilesController;\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"1cd5a70663cde10c6aa8d3de2d7113b86360e7f7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2bzvxsg282=function(){return actualCoverage;};}return actualCoverage;}cov_2bzvxsg282();cov_2bzvxsg282().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_2bzvxsg282().s[1]++;exports.default=exports.FilesController=void 0;var _cryptoUtils=(cov_2bzvxsg282().s[2]++,require("../cryptoUtils"));var _AdaptableController=(cov_2bzvxsg282().s[3]++,_interopRequireDefault(require("./AdaptableController")));var _FilesAdapter=(cov_2bzvxsg282().s[4]++,require("../Adapters/Files/FilesAdapter"));var _path=(cov_2bzvxsg282().s[5]++,_interopRequireDefault(require("path")));var _mime=(cov_2bzvxsg282().s[6]++,_interopRequireDefault(require("mime")));function _interopRequireDefault(obj){cov_2bzvxsg282().f[0]++;cov_2bzvxsg282().s[7]++;return(cov_2bzvxsg282().b[1][0]++,obj)&&(cov_2bzvxsg282().b[1][1]++,obj.__esModule)?(cov_2bzvxsg282().b[0][0]++,obj):(cov_2bzvxsg282().b[0][1]++,{default:obj});}// FilesController.js
const Parse=(cov_2bzvxsg282().s[8]++,require('parse').Parse);const legacyFilesRegex=(cov_2bzvxsg282().s[9]++,new RegExp('^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}-.*'));class FilesController extends(_AdaptableController.default){getFileData(config,filename){cov_2bzvxsg282().f[1]++;cov_2bzvxsg282().s[10]++;return this.adapter.getFileData(filename);}createFile(config,filename,data,contentType,options){cov_2bzvxsg282().f[2]++;const extname=(cov_2bzvxsg282().s[11]++,_path.default.extname(filename));const hasExtension=(cov_2bzvxsg282().s[12]++,extname.length>0);cov_2bzvxsg282().s[13]++;if((cov_2bzvxsg282().b[3][0]++,!hasExtension)&&(cov_2bzvxsg282().b[3][1]++,contentType)&&(cov_2bzvxsg282().b[3][2]++,_mime.default.getExtension(contentType))){cov_2bzvxsg282().b[2][0]++;cov_2bzvxsg282().s[14]++;filename=filename+'.'+_mime.default.getExtension(contentType);}else{cov_2bzvxsg282().b[2][1]++;cov_2bzvxsg282().s[15]++;if((cov_2bzvxsg282().b[5][0]++,hasExtension)&&(cov_2bzvxsg282().b[5][1]++,!contentType)){cov_2bzvxsg282().b[4][0]++;cov_2bzvxsg282().s[16]++;contentType=_mime.default.getType(filename);}else{cov_2bzvxsg282().b[4][1]++;}}cov_2bzvxsg282().s[17]++;if(!this.options.preserveFileName){cov_2bzvxsg282().b[6][0]++;cov_2bzvxsg282().s[18]++;filename=(0,_cryptoUtils.randomHexString)(32)+'_'+filename;}else{cov_2bzvxsg282().b[6][1]++;}const location=(cov_2bzvxsg282().s[19]++,this.adapter.getFileLocation(config,filename));cov_2bzvxsg282().s[20]++;return this.adapter.createFile(filename,data,contentType,options).then(()=>{cov_2bzvxsg282().f[3]++;cov_2bzvxsg282().s[21]++;return Promise.resolve({url:location,name:filename});});}deleteFile(config,filename){cov_2bzvxsg282().f[4]++;cov_2bzvxsg282().s[22]++;return this.adapter.deleteFile(filename);}getMetadata(filename){cov_2bzvxsg282().f[5]++;cov_2bzvxsg282().s[23]++;if(typeof this.adapter.getMetadata==='function'){cov_2bzvxsg282().b[7][0]++;cov_2bzvxsg282().s[24]++;return this.adapter.getMetadata(filename);}else{cov_2bzvxsg282().b[7][1]++;}cov_2bzvxsg282().s[25]++;return Promise.resolve({});}/**
   * Find file references in REST-format object and adds the url key
   * with the current mount point and app id.
   * Object may be a single object or list of REST-format objects.
   */expandFilesInObject(config,object){cov_2bzvxsg282().f[6]++;cov_2bzvxsg282().s[26]++;if(object instanceof Array){cov_2bzvxsg282().b[8][0]++;cov_2bzvxsg282().s[27]++;object.map(obj=>{cov_2bzvxsg282().f[7]++;cov_2bzvxsg282().s[28]++;return this.expandFilesInObject(config,obj);});cov_2bzvxsg282().s[29]++;return;}else{cov_2bzvxsg282().b[8][1]++;}cov_2bzvxsg282().s[30]++;if(typeof object!=='object'){cov_2bzvxsg282().b[9][0]++;cov_2bzvxsg282().s[31]++;return;}else{cov_2bzvxsg282().b[9][1]++;}cov_2bzvxsg282().s[32]++;for(const key in object){const fileObject=(cov_2bzvxsg282().s[33]++,object[key]);cov_2bzvxsg282().s[34]++;if((cov_2bzvxsg282().b[11][0]++,fileObject)&&(cov_2bzvxsg282().b[11][1]++,fileObject['__type']==='File')){cov_2bzvxsg282().b[10][0]++;cov_2bzvxsg282().s[35]++;if(fileObject['url']){cov_2bzvxsg282().b[12][0]++;cov_2bzvxsg282().s[36]++;continue;}else{cov_2bzvxsg282().b[12][1]++;}const filename=(cov_2bzvxsg282().s[37]++,fileObject['name']);// all filenames starting with "tfss-" should be from files.parsetfss.com
// all filenames starting with a "-" seperated UUID should be from files.parse.com
// all other filenames have been migrated or created from Parse Server
cov_2bzvxsg282().s[38]++;if(config.fileKey===undefined){cov_2bzvxsg282().b[13][0]++;cov_2bzvxsg282().s[39]++;fileObject['url']=this.adapter.getFileLocation(config,filename);}else{cov_2bzvxsg282().b[13][1]++;cov_2bzvxsg282().s[40]++;if(filename.indexOf('tfss-')===0){cov_2bzvxsg282().b[14][0]++;cov_2bzvxsg282().s[41]++;fileObject['url']='http://files.parsetfss.com/'+config.fileKey+'/'+encodeURIComponent(filename);}else{cov_2bzvxsg282().b[14][1]++;cov_2bzvxsg282().s[42]++;if(legacyFilesRegex.test(filename)){cov_2bzvxsg282().b[15][0]++;cov_2bzvxsg282().s[43]++;fileObject['url']='http://files.parse.com/'+config.fileKey+'/'+encodeURIComponent(filename);}else{cov_2bzvxsg282().b[15][1]++;cov_2bzvxsg282().s[44]++;fileObject['url']=this.adapter.getFileLocation(config,filename);}}}}else{cov_2bzvxsg282().b[10][1]++;}}}expectedAdapterType(){cov_2bzvxsg282().f[8]++;cov_2bzvxsg282().s[45]++;return _FilesAdapter.FilesAdapter;}handleFileStream(config,filename,req,res,contentType){cov_2bzvxsg282().f[9]++;cov_2bzvxsg282().s[46]++;return this.adapter.handleFileStream(filename,req,res,contentType);}validateFilename(filename){cov_2bzvxsg282().f[10]++;cov_2bzvxsg282().s[47]++;if(typeof this.adapter.validateFilename==='function'){cov_2bzvxsg282().b[16][0]++;const error=(cov_2bzvxsg282().s[48]++,this.adapter.validateFilename(filename));cov_2bzvxsg282().s[49]++;if(typeof error!=='string'){cov_2bzvxsg282().b[17][0]++;cov_2bzvxsg282().s[50]++;return error;}else{cov_2bzvxsg282().b[17][1]++;}cov_2bzvxsg282().s[51]++;return new Parse.Error(Parse.Error.INVALID_FILE_NAME,error);}else{cov_2bzvxsg282().b[16][1]++;}cov_2bzvxsg282().s[52]++;return(0,_FilesAdapter.validateFilename)(filename);}}cov_2bzvxsg282().s[53]++;exports.FilesController=FilesController;var _default=(cov_2bzvxsg282().s[54]++,FilesController);cov_2bzvxsg282().s[55]++;exports.default=_default;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db250cm9sbGVycy9GaWxlc0NvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiUGFyc2UiLCJyZXF1aXJlIiwibGVnYWN5RmlsZXNSZWdleCIsIlJlZ0V4cCIsIkZpbGVzQ29udHJvbGxlciIsIkFkYXB0YWJsZUNvbnRyb2xsZXIiLCJnZXRGaWxlRGF0YSIsImNvbmZpZyIsImZpbGVuYW1lIiwiYWRhcHRlciIsImNyZWF0ZUZpbGUiLCJkYXRhIiwiY29udGVudFR5cGUiLCJvcHRpb25zIiwiZXh0bmFtZSIsInBhdGgiLCJoYXNFeHRlbnNpb24iLCJsZW5ndGgiLCJtaW1lIiwiZ2V0RXh0ZW5zaW9uIiwiZ2V0VHlwZSIsInByZXNlcnZlRmlsZU5hbWUiLCJsb2NhdGlvbiIsImdldEZpbGVMb2NhdGlvbiIsInRoZW4iLCJQcm9taXNlIiwicmVzb2x2ZSIsInVybCIsIm5hbWUiLCJkZWxldGVGaWxlIiwiZ2V0TWV0YWRhdGEiLCJleHBhbmRGaWxlc0luT2JqZWN0Iiwib2JqZWN0IiwiQXJyYXkiLCJtYXAiLCJvYmoiLCJrZXkiLCJmaWxlT2JqZWN0IiwiZmlsZUtleSIsInVuZGVmaW5lZCIsImluZGV4T2YiLCJlbmNvZGVVUklDb21wb25lbnQiLCJ0ZXN0IiwiZXhwZWN0ZWRBZGFwdGVyVHlwZSIsIkZpbGVzQWRhcHRlciIsImhhbmRsZUZpbGVTdHJlYW0iLCJyZXEiLCJyZXMiLCJ2YWxpZGF0ZUZpbGVuYW1lIiwiZXJyb3IiLCJFcnJvciIsIklOVkFMSURfRklMRV9OQU1FIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFMQTtBQU1BLE1BQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLE9BQUQsQ0FBUCxDQUFpQkQsS0FBL0I7O0FBRUEsTUFBTUUsZ0JBQWdCLEdBQUcsSUFBSUMsTUFBSixDQUN2QixpRkFEdUIsQ0FBekI7O0FBSU8sTUFBTUMsZUFBTixTQUE4QkMsNEJBQTlCLENBQWtEO0FBQ3ZEQyxFQUFBQSxXQUFXLENBQUNDLE1BQUQsRUFBU0MsUUFBVCxFQUFtQjtBQUM1QixXQUFPLEtBQUtDLE9BQUwsQ0FBYUgsV0FBYixDQUF5QkUsUUFBekIsQ0FBUDtBQUNEOztBQUVERSxFQUFBQSxVQUFVLENBQUNILE1BQUQsRUFBU0MsUUFBVCxFQUFtQkcsSUFBbkIsRUFBeUJDLFdBQXpCLEVBQXNDQyxPQUF0QyxFQUErQztBQUN2RCxVQUFNQyxPQUFPLEdBQUdDLGNBQUtELE9BQUwsQ0FBYU4sUUFBYixDQUFoQjs7QUFFQSxVQUFNUSxZQUFZLEdBQUdGLE9BQU8sQ0FBQ0csTUFBUixHQUFpQixDQUF0Qzs7QUFFQSxRQUFJLENBQUNELFlBQUQsSUFBaUJKLFdBQWpCLElBQWdDTSxjQUFLQyxZQUFMLENBQWtCUCxXQUFsQixDQUFwQyxFQUFvRTtBQUNsRUosTUFBQUEsUUFBUSxHQUFHQSxRQUFRLEdBQUcsR0FBWCxHQUFpQlUsY0FBS0MsWUFBTCxDQUFrQlAsV0FBbEIsQ0FBNUI7QUFDRCxLQUZELE1BRU8sSUFBSUksWUFBWSxJQUFJLENBQUNKLFdBQXJCLEVBQWtDO0FBQ3ZDQSxNQUFBQSxXQUFXLEdBQUdNLGNBQUtFLE9BQUwsQ0FBYVosUUFBYixDQUFkO0FBQ0Q7O0FBRUQsUUFBSSxDQUFDLEtBQUtLLE9BQUwsQ0FBYVEsZ0JBQWxCLEVBQW9DO0FBQ2xDYixNQUFBQSxRQUFRLEdBQUcsa0NBQWdCLEVBQWhCLElBQXNCLEdBQXRCLEdBQTRCQSxRQUF2QztBQUNEOztBQUVELFVBQU1jLFFBQVEsR0FBRyxLQUFLYixPQUFMLENBQWFjLGVBQWIsQ0FBNkJoQixNQUE3QixFQUFxQ0MsUUFBckMsQ0FBakI7QUFDQSxXQUFPLEtBQUtDLE9BQUwsQ0FBYUMsVUFBYixDQUF3QkYsUUFBeEIsRUFBa0NHLElBQWxDLEVBQXdDQyxXQUF4QyxFQUFxREMsT0FBckQsRUFBOERXLElBQTlELENBQW1FLE1BQU07QUFDOUUsYUFBT0MsT0FBTyxDQUFDQyxPQUFSLENBQWdCO0FBQ3JCQyxRQUFBQSxHQUFHLEVBQUVMLFFBRGdCO0FBRXJCTSxRQUFBQSxJQUFJLEVBQUVwQjtBQUZlLE9BQWhCLENBQVA7QUFJRCxLQUxNLENBQVA7QUFNRDs7QUFFRHFCLEVBQUFBLFVBQVUsQ0FBQ3RCLE1BQUQsRUFBU0MsUUFBVCxFQUFtQjtBQUMzQixXQUFPLEtBQUtDLE9BQUwsQ0FBYW9CLFVBQWIsQ0FBd0JyQixRQUF4QixDQUFQO0FBQ0Q7O0FBRURzQixFQUFBQSxXQUFXLENBQUN0QixRQUFELEVBQVc7QUFDcEIsUUFBSSxPQUFPLEtBQUtDLE9BQUwsQ0FBYXFCLFdBQXBCLEtBQW9DLFVBQXhDLEVBQW9EO0FBQ2xELGFBQU8sS0FBS3JCLE9BQUwsQ0FBYXFCLFdBQWIsQ0FBeUJ0QixRQUF6QixDQUFQO0FBQ0Q7O0FBQ0QsV0FBT2lCLE9BQU8sQ0FBQ0MsT0FBUixDQUFnQixFQUFoQixDQUFQO0FBQ0Q7QUFFRDtBQUNGO0FBQ0E7QUFDQTtBQUNBOzs7QUFDRUssRUFBQUEsbUJBQW1CLENBQUN4QixNQUFELEVBQVN5QixNQUFULEVBQWlCO0FBQ2xDLFFBQUlBLE1BQU0sWUFBWUMsS0FBdEIsRUFBNkI7QUFDM0JELE1BQUFBLE1BQU0sQ0FBQ0UsR0FBUCxDQUFXQyxHQUFHLElBQUksS0FBS0osbUJBQUwsQ0FBeUJ4QixNQUF6QixFQUFpQzRCLEdBQWpDLENBQWxCO0FBQ0E7QUFDRDs7QUFDRCxRQUFJLE9BQU9ILE1BQVAsS0FBa0IsUUFBdEIsRUFBZ0M7QUFDOUI7QUFDRDs7QUFDRCxTQUFLLE1BQU1JLEdBQVgsSUFBa0JKLE1BQWxCLEVBQTBCO0FBQ3hCLFlBQU1LLFVBQVUsR0FBR0wsTUFBTSxDQUFDSSxHQUFELENBQXpCOztBQUNBLFVBQUlDLFVBQVUsSUFBSUEsVUFBVSxDQUFDLFFBQUQsQ0FBVixLQUF5QixNQUEzQyxFQUFtRDtBQUNqRCxZQUFJQSxVQUFVLENBQUMsS0FBRCxDQUFkLEVBQXVCO0FBQ3JCO0FBQ0Q7O0FBQ0QsY0FBTTdCLFFBQVEsR0FBRzZCLFVBQVUsQ0FBQyxNQUFELENBQTNCLENBSmlELENBS2pEO0FBQ0E7QUFDQTs7QUFDQSxZQUFJOUIsTUFBTSxDQUFDK0IsT0FBUCxLQUFtQkMsU0FBdkIsRUFBa0M7QUFDaENGLFVBQUFBLFVBQVUsQ0FBQyxLQUFELENBQVYsR0FBb0IsS0FBSzVCLE9BQUwsQ0FBYWMsZUFBYixDQUE2QmhCLE1BQTdCLEVBQXFDQyxRQUFyQyxDQUFwQjtBQUNELFNBRkQsTUFFTztBQUNMLGNBQUlBLFFBQVEsQ0FBQ2dDLE9BQVQsQ0FBaUIsT0FBakIsTUFBOEIsQ0FBbEMsRUFBcUM7QUFDbkNILFlBQUFBLFVBQVUsQ0FBQyxLQUFELENBQVYsR0FDRSxnQ0FBZ0M5QixNQUFNLENBQUMrQixPQUF2QyxHQUFpRCxHQUFqRCxHQUF1REcsa0JBQWtCLENBQUNqQyxRQUFELENBRDNFO0FBRUQsV0FIRCxNQUdPLElBQUlOLGdCQUFnQixDQUFDd0MsSUFBakIsQ0FBc0JsQyxRQUF0QixDQUFKLEVBQXFDO0FBQzFDNkIsWUFBQUEsVUFBVSxDQUFDLEtBQUQsQ0FBVixHQUNFLDRCQUE0QjlCLE1BQU0sQ0FBQytCLE9BQW5DLEdBQTZDLEdBQTdDLEdBQW1ERyxrQkFBa0IsQ0FBQ2pDLFFBQUQsQ0FEdkU7QUFFRCxXQUhNLE1BR0E7QUFDTDZCLFlBQUFBLFVBQVUsQ0FBQyxLQUFELENBQVYsR0FBb0IsS0FBSzVCLE9BQUwsQ0FBYWMsZUFBYixDQUE2QmhCLE1BQTdCLEVBQXFDQyxRQUFyQyxDQUFwQjtBQUNEO0FBQ0Y7QUFDRjtBQUNGO0FBQ0Y7O0FBRURtQyxFQUFBQSxtQkFBbUIsR0FBRztBQUNwQixXQUFPQywwQkFBUDtBQUNEOztBQUVEQyxFQUFBQSxnQkFBZ0IsQ0FBQ3RDLE1BQUQsRUFBU0MsUUFBVCxFQUFtQnNDLEdBQW5CLEVBQXdCQyxHQUF4QixFQUE2Qm5DLFdBQTdCLEVBQTBDO0FBQ3hELFdBQU8sS0FBS0gsT0FBTCxDQUFhb0MsZ0JBQWIsQ0FBOEJyQyxRQUE5QixFQUF3Q3NDLEdBQXhDLEVBQTZDQyxHQUE3QyxFQUFrRG5DLFdBQWxELENBQVA7QUFDRDs7QUFFRG9DLEVBQUFBLGdCQUFnQixDQUFDeEMsUUFBRCxFQUFXO0FBQ3pCLFFBQUksT0FBTyxLQUFLQyxPQUFMLENBQWF1QyxnQkFBcEIsS0FBeUMsVUFBN0MsRUFBeUQ7QUFDdkQsWUFBTUMsS0FBSyxHQUFHLEtBQUt4QyxPQUFMLENBQWF1QyxnQkFBYixDQUE4QnhDLFFBQTlCLENBQWQ7O0FBQ0EsVUFBSSxPQUFPeUMsS0FBUCxLQUFpQixRQUFyQixFQUErQjtBQUM3QixlQUFPQSxLQUFQO0FBQ0Q7O0FBQ0QsYUFBTyxJQUFJakQsS0FBSyxDQUFDa0QsS0FBVixDQUFnQmxELEtBQUssQ0FBQ2tELEtBQU4sQ0FBWUMsaUJBQTVCLEVBQStDRixLQUEvQyxDQUFQO0FBQ0Q7O0FBQ0QsV0FBTyxvQ0FBaUJ6QyxRQUFqQixDQUFQO0FBQ0Q7O0FBakdzRDs7O2VBb0cxQ0osZSIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGVzQ29udHJvbGxlci5qc1xuaW1wb3J0IHsgcmFuZG9tSGV4U3RyaW5nIH0gZnJvbSAnLi4vY3J5cHRvVXRpbHMnO1xuaW1wb3J0IEFkYXB0YWJsZUNvbnRyb2xsZXIgZnJvbSAnLi9BZGFwdGFibGVDb250cm9sbGVyJztcbmltcG9ydCB7IHZhbGlkYXRlRmlsZW5hbWUsIEZpbGVzQWRhcHRlciB9IGZyb20gJy4uL0FkYXB0ZXJzL0ZpbGVzL0ZpbGVzQWRhcHRlcic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBtaW1lIGZyb20gJ21pbWUnO1xuY29uc3QgUGFyc2UgPSByZXF1aXJlKCdwYXJzZScpLlBhcnNlO1xuXG5jb25zdCBsZWdhY3lGaWxlc1JlZ2V4ID0gbmV3IFJlZ0V4cChcbiAgJ15bMC05YS1mQS1GXXs4fS1bMC05YS1mQS1GXXs0fS1bMC05YS1mQS1GXXs0fS1bMC05YS1mQS1GXXs0fS1bMC05YS1mQS1GXXsxMn0tLionXG4pO1xuXG5leHBvcnQgY2xhc3MgRmlsZXNDb250cm9sbGVyIGV4dGVuZHMgQWRhcHRhYmxlQ29udHJvbGxlciB7XG4gIGdldEZpbGVEYXRhKGNvbmZpZywgZmlsZW5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5hZGFwdGVyLmdldEZpbGVEYXRhKGZpbGVuYW1lKTtcbiAgfVxuXG4gIGNyZWF0ZUZpbGUoY29uZmlnLCBmaWxlbmFtZSwgZGF0YSwgY29udGVudFR5cGUsIG9wdGlvbnMpIHtcbiAgICBjb25zdCBleHRuYW1lID0gcGF0aC5leHRuYW1lKGZpbGVuYW1lKTtcblxuICAgIGNvbnN0IGhhc0V4dGVuc2lvbiA9IGV4dG5hbWUubGVuZ3RoID4gMDtcblxuICAgIGlmICghaGFzRXh0ZW5zaW9uICYmIGNvbnRlbnRUeXBlICYmIG1pbWUuZ2V0RXh0ZW5zaW9uKGNvbnRlbnRUeXBlKSkge1xuICAgICAgZmlsZW5hbWUgPSBmaWxlbmFtZSArICcuJyArIG1pbWUuZ2V0RXh0ZW5zaW9uKGNvbnRlbnRUeXBlKTtcbiAgICB9IGVsc2UgaWYgKGhhc0V4dGVuc2lvbiAmJiAhY29udGVudFR5cGUpIHtcbiAgICAgIGNvbnRlbnRUeXBlID0gbWltZS5nZXRUeXBlKGZpbGVuYW1lKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMub3B0aW9ucy5wcmVzZXJ2ZUZpbGVOYW1lKSB7XG4gICAgICBmaWxlbmFtZSA9IHJhbmRvbUhleFN0cmluZygzMikgKyAnXycgKyBmaWxlbmFtZTtcbiAgICB9XG5cbiAgICBjb25zdCBsb2NhdGlvbiA9IHRoaXMuYWRhcHRlci5nZXRGaWxlTG9jYXRpb24oY29uZmlnLCBmaWxlbmFtZSk7XG4gICAgcmV0dXJuIHRoaXMuYWRhcHRlci5jcmVhdGVGaWxlKGZpbGVuYW1lLCBkYXRhLCBjb250ZW50VHlwZSwgb3B0aW9ucykudGhlbigoKSA9PiB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgdXJsOiBsb2NhdGlvbixcbiAgICAgICAgbmFtZTogZmlsZW5hbWUsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUZpbGUoY29uZmlnLCBmaWxlbmFtZSkge1xuICAgIHJldHVybiB0aGlzLmFkYXB0ZXIuZGVsZXRlRmlsZShmaWxlbmFtZSk7XG4gIH1cblxuICBnZXRNZXRhZGF0YShmaWxlbmFtZSkge1xuICAgIGlmICh0eXBlb2YgdGhpcy5hZGFwdGVyLmdldE1ldGFkYXRhID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gdGhpcy5hZGFwdGVyLmdldE1ldGFkYXRhKGZpbGVuYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7fSk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBmaWxlIHJlZmVyZW5jZXMgaW4gUkVTVC1mb3JtYXQgb2JqZWN0IGFuZCBhZGRzIHRoZSB1cmwga2V5XG4gICAqIHdpdGggdGhlIGN1cnJlbnQgbW91bnQgcG9pbnQgYW5kIGFwcCBpZC5cbiAgICogT2JqZWN0IG1heSBiZSBhIHNpbmdsZSBvYmplY3Qgb3IgbGlzdCBvZiBSRVNULWZvcm1hdCBvYmplY3RzLlxuICAgKi9cbiAgZXhwYW5kRmlsZXNJbk9iamVjdChjb25maWcsIG9iamVjdCkge1xuICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgb2JqZWN0Lm1hcChvYmogPT4gdGhpcy5leHBhbmRGaWxlc0luT2JqZWN0KGNvbmZpZywgb2JqKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb2JqZWN0ICE9PSAnb2JqZWN0Jykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmplY3QpIHtcbiAgICAgIGNvbnN0IGZpbGVPYmplY3QgPSBvYmplY3Rba2V5XTtcbiAgICAgIGlmIChmaWxlT2JqZWN0ICYmIGZpbGVPYmplY3RbJ19fdHlwZSddID09PSAnRmlsZScpIHtcbiAgICAgICAgaWYgKGZpbGVPYmplY3RbJ3VybCddKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBmaWxlT2JqZWN0WyduYW1lJ107XG4gICAgICAgIC8vIGFsbCBmaWxlbmFtZXMgc3RhcnRpbmcgd2l0aCBcInRmc3MtXCIgc2hvdWxkIGJlIGZyb20gZmlsZXMucGFyc2V0ZnNzLmNvbVxuICAgICAgICAvLyBhbGwgZmlsZW5hbWVzIHN0YXJ0aW5nIHdpdGggYSBcIi1cIiBzZXBlcmF0ZWQgVVVJRCBzaG91bGQgYmUgZnJvbSBmaWxlcy5wYXJzZS5jb21cbiAgICAgICAgLy8gYWxsIG90aGVyIGZpbGVuYW1lcyBoYXZlIGJlZW4gbWlncmF0ZWQgb3IgY3JlYXRlZCBmcm9tIFBhcnNlIFNlcnZlclxuICAgICAgICBpZiAoY29uZmlnLmZpbGVLZXkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGZpbGVPYmplY3RbJ3VybCddID0gdGhpcy5hZGFwdGVyLmdldEZpbGVMb2NhdGlvbihjb25maWcsIGZpbGVuYW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZmlsZW5hbWUuaW5kZXhPZigndGZzcy0nKSA9PT0gMCkge1xuICAgICAgICAgICAgZmlsZU9iamVjdFsndXJsJ10gPVxuICAgICAgICAgICAgICAnaHR0cDovL2ZpbGVzLnBhcnNldGZzcy5jb20vJyArIGNvbmZpZy5maWxlS2V5ICsgJy8nICsgZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGxlZ2FjeUZpbGVzUmVnZXgudGVzdChmaWxlbmFtZSkpIHtcbiAgICAgICAgICAgIGZpbGVPYmplY3RbJ3VybCddID1cbiAgICAgICAgICAgICAgJ2h0dHA6Ly9maWxlcy5wYXJzZS5jb20vJyArIGNvbmZpZy5maWxlS2V5ICsgJy8nICsgZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmlsZU9iamVjdFsndXJsJ10gPSB0aGlzLmFkYXB0ZXIuZ2V0RmlsZUxvY2F0aW9uKGNvbmZpZywgZmlsZW5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGV4cGVjdGVkQWRhcHRlclR5cGUoKSB7XG4gICAgcmV0dXJuIEZpbGVzQWRhcHRlcjtcbiAgfVxuXG4gIGhhbmRsZUZpbGVTdHJlYW0oY29uZmlnLCBmaWxlbmFtZSwgcmVxLCByZXMsIGNvbnRlbnRUeXBlKSB7XG4gICAgcmV0dXJuIHRoaXMuYWRhcHRlci5oYW5kbGVGaWxlU3RyZWFtKGZpbGVuYW1lLCByZXEsIHJlcywgY29udGVudFR5cGUpO1xuICB9XG5cbiAgdmFsaWRhdGVGaWxlbmFtZShmaWxlbmFtZSkge1xuICAgIGlmICh0eXBlb2YgdGhpcy5hZGFwdGVyLnZhbGlkYXRlRmlsZW5hbWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNvbnN0IGVycm9yID0gdGhpcy5hZGFwdGVyLnZhbGlkYXRlRmlsZW5hbWUoZmlsZW5hbWUpO1xuICAgICAgaWYgKHR5cGVvZiBlcnJvciAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIGVycm9yO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5JTlZBTElEX0ZJTEVfTkFNRSwgZXJyb3IpO1xuICAgIH1cbiAgICByZXR1cm4gdmFsaWRhdGVGaWxlbmFtZShmaWxlbmFtZSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRmlsZXNDb250cm9sbGVyO1xuIl19
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db250cm9sbGVycy9GaWxlc0NvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiUGFyc2UiLCJyZXF1aXJlIiwibGVnYWN5RmlsZXNSZWdleCIsIkFkYXB0YWJsZUNvbnRyb2xsZXIiLCJnZXRGaWxlRGF0YSIsImNyZWF0ZUZpbGUiLCJleHRuYW1lIiwicGF0aCIsImhhc0V4dGVuc2lvbiIsIm1pbWUiLCJmaWxlbmFtZSIsImNvbnRlbnRUeXBlIiwibG9jYXRpb24iLCJ1cmwiLCJuYW1lIiwiZGVsZXRlRmlsZSIsImdldE1ldGFkYXRhIiwiUHJvbWlzZSIsImV4cGFuZEZpbGVzSW5PYmplY3QiLCJvYmplY3QiLCJvYmoiLCJmaWxlT2JqZWN0IiwiY29uZmlnIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiZXhwZWN0ZWRBZGFwdGVyVHlwZSIsIkZpbGVzQWRhcHRlciIsImhhbmRsZUZpbGVTdHJlYW0iLCJ2YWxpZGF0ZUZpbGVuYW1lIiwiZXJyb3IiLCJGaWxlc0NvbnRyb2xsZXIiXSwibWFwcGluZ3MiOiIyZ2lCQUtBO21QQUpBLEdBQUEsQ0FBQSxZQUFBLDBCQUFBLE9BQUEsQ0FBQSxnQkFBQSxDQUFBLENBQUEsQ0FDQSxHQUFBLENBQUEsb0JBQUEsMEJBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsdUJBQUEsQ0FBQSxDQUFBLENBQUEsQ0FDQSxHQUFBLENBQUEsYUFBQSwwQkFBQSxPQUFBLENBQUEsZ0NBQUEsQ0FBQSxDQUFBLENBQ0EsR0FBQSxDQUFBLEtBQUEsMEJBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsTUFBQSxDQUFBLENBQUEsQ0FBQSxDQUNBLEdBQUEsQ0FBQSxLQUFBLDBCQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBLENBQUEsQyxzUEFMQTtBQU1BLEtBQU1BLENBQUFBLEtBQUssMEJBQUdDLE9BQU8sQ0FBUEEsT0FBTyxDQUFQQSxDQUFkLEtBQVcsQ0FBWCxDQUVBLEtBQU1DLENBQUFBLGdCQUFnQiwwQkFB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LGtEQUNwQixNQUFPQyxDQUFBQSxhQUFBQSxDQUFQLFlBQUEsQ0FDRCxDQUVEQyxnQkFBZ0IsQ0FBQSxNQUFBLENBQUEsUUFBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsV0FBQSxDQUEwQyxrREFDeEQsTUFBTyxNQUFBLE9BQUEsQ0FBQSxnQkFBQSxDQUFBLFFBQUEsQ0FBQSxHQUFBLENBQUEsR0FBQSxDQUFQLFdBQU8sQ0FBUCxDQUNELENBRURDLGdCQUFnQixDQUFBLFFBQUEsQ0FBVyxtREFDekIsR0FBSSxNQUFPLE1BQUEsT0FBQSxDQUFQLGdCQUFBLEdBQUosVUFBQSxDQUF5RCw2QkFDdkQsS0FBTUMsQ0FBQUEsS0FBSywyQkFBRyxLQUFBLE9BQUEsQ0FBQSxnQkFBQSxDQUFkLFFBQWMsQ0FBSCxDQUFYLENBRHVELHlCQUV2RCxHQUFJLE1BQUEsQ0FBQSxLQUFBLEdBQUosUUFBQSxDQUErQixzREFDN0IsTUFBQSxDQUFBLEtBQUEsQ0FDRCxDQUZELGtDQUZ1RCx5QkFLdkQsTUFBTyxJQUFJNUIsQ0FBQUEsS0FBSyxDQUFULEtBQUEsQ0FBZ0JBLEtBQUssQ0FBTEEsS0FBQUEsQ0FBaEIsaUJBQUEsQ0FBUCxLQUFPLENBQVAsQ0FDRCxDQU5ELGtDQUR5Qix5QkFRekIsTUFBTyxDQUFBLEVBQUEsYUFBQSxDQUFBLGdCQUFBLEVBQVAsUUFBTyxDQUFQLENBQ0QsQ0FqR3NELEMsd0dBb0cxQzZCLGUiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlc0NvbnRyb2xsZXIuanNcbmltcG9ydCB7IHJhbmRvbUhleFN0cmluZyB9IGZyb20gJy4uL2NyeXB0b1V0aWxzJztcbmltcG9ydCBBZGFwdGFibGVDb250cm9sbGVyIGZyb20gJy4vQWRhcHRhYmxlQ29udHJvbGxlcic7XG5pbXBvcnQgeyB2YWxpZGF0ZUZpbGVuYW1lLCBGaWxlc0FkYXB0ZXIgfSBmcm9tICcuLi9BZGFwdGVycy9GaWxlcy9GaWxlc0FkYXB0ZXInO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgbWltZSBmcm9tICdtaW1lJztcbmNvbnN0IFBhcnNlID0gcmVxdWlyZSgncGFyc2UnKS5QYXJzZTtcblxuY29uc3QgbGVnYWN5RmlsZXNSZWdleCA9IG5ldyBSZWdFeHAoXG4gICdeWzAtOWEtZkEtRl17OH0tWzAtOWEtZkEtRl17NH0tWzAtOWEtZkEtRl17NH0tWzAtOWEtZkEtRl17NH0tWzAtOWEtZkEtRl17MTJ9LS4qJ1xuKTtcblxuZXhwb3J0IGNsYXNzIEZpbGVzQ29udHJvbGxlciBleHRlbmRzIEFkYXB0YWJsZUNvbnRyb2xsZXIge1xuICBnZXRGaWxlRGF0YShjb25maWcsIGZpbGVuYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMuYWRhcHRlci5nZXRGaWxlRGF0YShmaWxlbmFtZSk7XG4gIH1cblxuICBjcmVhdGVGaWxlKGNvbmZpZywgZmlsZW5hbWUsIGRhdGEsIGNvbnRlbnRUeXBlLCBvcHRpb25zKSB7XG4gICAgY29uc3QgZXh0bmFtZSA9IHBhdGguZXh0bmFtZShmaWxlbmFtZSk7XG5cbiAgICBjb25zdCBoYXNFeHRlbnNpb24gPSBleHRuYW1lLmxlbmd0aCA+IDA7XG5cbiAgICBpZiAoIWhhc0V4dGVuc2lvbiAmJiBjb250ZW50VHlwZSAmJiBtaW1lLmdldEV4dGVuc2lvbihjb250ZW50VHlwZSkpIHtcbiAgICAgIGZpbGVuYW1lID0gZmlsZW5hbWUgKyAnLicgKyBtaW1lLmdldEV4dGVuc2lvbihjb250ZW50VHlwZSk7XG4gICAgfSBlbHNlIGlmIChoYXNFeHRlbnNpb24gJiYgIWNvbnRlbnRUeXBlKSB7XG4gICAgICBjb250ZW50VHlwZSA9IG1pbWUuZ2V0VHlwZShmaWxlbmFtZSk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLm9wdGlvbnMucHJlc2VydmVGaWxlTmFtZSkge1xuICAgICAgZmlsZW5hbWUgPSByYW5kb21IZXhTdHJpbmcoMzIpICsgJ18nICsgZmlsZW5hbWU7XG4gICAgfVxuXG4gICAgY29uc3QgbG9jYXRpb24gPSB0aGlzLmFkYXB0ZXIuZ2V0RmlsZUxvY2F0aW9uKGNvbmZpZywgZmlsZW5hbWUpO1xuICAgIHJldHVybiB0aGlzLmFkYXB0ZXIuY3JlYXRlRmlsZShmaWxlbmFtZSwgZGF0YSwgY29udGVudFR5cGUsIG9wdGlvbnMpLnRoZW4oKCkgPT4ge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgIHVybDogbG9jYXRpb24sXG4gICAgICAgIG5hbWU6IGZpbGVuYW1lLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBkZWxldGVGaWxlKGNvbmZpZywgZmlsZW5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5hZGFwdGVyLmRlbGV0ZUZpbGUoZmlsZW5hbWUpO1xuICB9XG5cbiAgZ2V0TWV0YWRhdGEoZmlsZW5hbWUpIHtcbiAgICBpZiAodHlwZW9mIHRoaXMuYWRhcHRlci5nZXRNZXRhZGF0YSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIHRoaXMuYWRhcHRlci5nZXRNZXRhZGF0YShmaWxlbmFtZSk7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe30pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgZmlsZSByZWZlcmVuY2VzIGluIFJFU1QtZm9ybWF0IG9iamVjdCBhbmQgYWRkcyB0aGUgdXJsIGtleVxuICAgKiB3aXRoIHRoZSBjdXJyZW50IG1vdW50IHBvaW50IGFuZCBhcHAgaWQuXG4gICAqIE9iamVjdCBtYXkgYmUgYSBzaW5nbGUgb2JqZWN0IG9yIGxpc3Qgb2YgUkVTVC1mb3JtYXQgb2JqZWN0cy5cbiAgICovXG4gIGV4cGFuZEZpbGVzSW5PYmplY3QoY29uZmlnLCBvYmplY3QpIHtcbiAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIG9iamVjdC5tYXAob2JqID0+IHRoaXMuZXhwYW5kRmlsZXNJbk9iamVjdChjb25maWcsIG9iaikpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9iamVjdCAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9yIChjb25zdCBrZXkgaW4gb2JqZWN0KSB7XG4gICAgICBjb25zdCBmaWxlT2JqZWN0ID0gb2JqZWN0W2tleV07XG4gICAgICBpZiAoZmlsZU9iamVjdCAmJiBmaWxlT2JqZWN0WydfX3R5cGUnXSA9PT0gJ0ZpbGUnKSB7XG4gICAgICAgIGlmIChmaWxlT2JqZWN0Wyd1cmwnXSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZpbGVuYW1lID0gZmlsZU9iamVjdFsnbmFtZSddO1xuICAgICAgICAvLyBhbGwgZmlsZW5hbWVzIHN0YXJ0aW5nIHdpdGggXCJ0ZnNzLVwiIHNob3VsZCBiZSBmcm9tIGZpbGVzLnBhcnNldGZzcy5jb21cbiAgICAgICAgLy8gYWxsIGZpbGVuYW1lcyBzdGFydGluZyB3aXRoIGEgXCItXCIgc2VwZXJhdGVkIFVVSUQgc2hvdWxkIGJlIGZyb20gZmlsZXMucGFyc2UuY29tXG4gICAgICAgIC8vIGFsbCBvdGhlciBmaWxlbmFtZXMgaGF2ZSBiZWVuIG1pZ3JhdGVkIG9yIGNyZWF0ZWQgZnJvbSBQYXJzZSBTZXJ2ZXJcbiAgICAgICAgaWYgKGNvbmZpZy5maWxlS2V5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBmaWxlT2JqZWN0Wyd1cmwnXSA9IHRoaXMuYWRhcHRlci5nZXRGaWxlTG9jYXRpb24oY29uZmlnLCBmaWxlbmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGZpbGVuYW1lLmluZGV4T2YoJ3Rmc3MtJykgPT09IDApIHtcbiAgICAgICAgICAgIGZpbGVPYmplY3RbJ3VybCddID1cbiAgICAgICAgICAgICAgJ2h0dHA6Ly9maWxlcy5wYXJzZXRmc3MuY29tLycgKyBjb25maWcuZmlsZUtleSArICcvJyArIGVuY29kZVVSSUNvbXBvbmVudChmaWxlbmFtZSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChsZWdhY3lGaWxlc1JlZ2V4LnRlc3QoZmlsZW5hbWUpKSB7XG4gICAgICAgICAgICBmaWxlT2JqZWN0Wyd1cmwnXSA9XG4gICAgICAgICAgICAgICdodHRwOi8vZmlsZXMucGFyc2UuY29tLycgKyBjb25maWcuZmlsZUtleSArICcvJyArIGVuY29kZVVSSUNvbXBvbmVudChmaWxlbmFtZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpbGVPYmplY3RbJ3VybCddID0gdGhpcy5hZGFwdGVyLmdldEZpbGVMb2NhdGlvbihjb25maWcsIGZpbGVuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBleHBlY3RlZEFkYXB0ZXJUeXBlKCkge1xuICAgIHJldHVybiBGaWxlc0FkYXB0ZXI7XG4gIH1cblxuICBoYW5kbGVGaWxlU3RyZWFtKGNvbmZpZywgZmlsZW5hbWUsIHJlcSwgcmVzLCBjb250ZW50VHlwZSkge1xuICAgIHJldHVybiB0aGlzLmFkYXB0ZXIuaGFuZGxlRmlsZVN0cmVhbShmaWxlbmFtZSwgcmVxLCByZXMsIGNvbnRlbnRUeXBlKTtcbiAgfVxuXG4gIHZhbGlkYXRlRmlsZW5hbWUoZmlsZW5hbWUpIHtcbiAgICBpZiAodHlwZW9mIHRoaXMuYWRhcHRlci52YWxpZGF0ZUZpbGVuYW1lID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjb25zdCBlcnJvciA9IHRoaXMuYWRhcHRlci52YWxpZGF0ZUZpbGVuYW1lKGZpbGVuYW1lKTtcbiAgICAgIGlmICh0eXBlb2YgZXJyb3IgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuSU5WQUxJRF9GSUxFX05BTUUsIGVycm9yKTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbGlkYXRlRmlsZW5hbWUoZmlsZW5hbWUpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEZpbGVzQ29udHJvbGxlcjtcbiJdfQ==