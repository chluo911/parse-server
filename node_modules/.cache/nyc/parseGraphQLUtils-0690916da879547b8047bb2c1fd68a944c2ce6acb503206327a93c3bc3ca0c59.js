"use strict";function cov_1bw5o3wv5k(){var path="/parse-server/lib/GraphQL/parseGraphQLUtils.js";var hash="84d0db401a38da5308603a5ec86118080dceb56c";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/GraphQL/parseGraphQLUtils.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:56}},"2":{start:{line:7,column:0},end:{line:7,column:40}},"3":{start:{line:8,column:0},end:{line:8,column:77}},"4":{start:{line:10,column:12},end:{line:10,column:57}},"5":{start:{line:12,column:24},end:{line:12,column:53}},"6":{start:{line:14,column:39},end:{line:14,column:93}},"7":{start:{line:17,column:2},end:{line:19,column:3}},"8":{start:{line:18,column:4},end:{line:18,column:115}},"9":{start:{line:25,column:2},end:{line:31,column:3}},"10":{start:{line:26,column:4},end:{line:26,column:22}},"11":{start:{line:27,column:4},end:{line:27,column:28}},"12":{start:{line:29,column:4},end:{line:29,column:53}},"13":{start:{line:30,column:4},end:{line:30,column:38}},"14":{start:{line:33,column:2},end:{line:33,column:58}},"15":{start:{line:36,column:30},end:{line:60,column:1}},"16":{start:{line:37,column:2},end:{line:37,column:81}},"17":{start:{line:37,column:50},end:{line:37,column:79}},"18":{start:{line:39,column:2},end:{line:42,column:5}},"19":{start:{line:40,column:4},end:{line:40,column:42}},"20":{start:{line:40,column:24},end:{line:40,column:42}},"21":{start:{line:41,column:4},end:{line:41,column:102}},"22":{start:{line:43,column:13},end:{line:43,column:22}},"23":{start:{line:44,column:16},end:{line:44,column:25}},"24":{start:{line:46,column:2},end:{line:51,column:3}},"25":{start:{line:47,column:4},end:{line:47,column:50}},"26":{start:{line:50,column:4},end:{line:50,column:19}},"27":{start:{line:53,column:2},end:{line:59,column:4}},"28":{start:{line:62,column:0},end:{line:62,column:54}},"29":{start:{line:64,column:36},end:{line:66,column:1}},"30":{start:{line:65,column:2},end:{line:65,column:61}},"31":{start:{line:68,column:0},end:{line:68,column:66}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:14,column:9},end:{line:14,column:31}},loc:{start:{line:14,column:37},end:{line:14,column:95}},line:14},"1":{name:"enforceMasterKeyAccess",decl:{start:{line:16,column:9},end:{line:16,column:31}},loc:{start:{line:16,column:38},end:{line:20,column:1}},line:16},"2":{name:"toGraphQLError",decl:{start:{line:22,column:9},end:{line:22,column:23}},loc:{start:{line:22,column:31},end:{line:34,column:1}},line:22},"3":{name:"(anonymous_3)",decl:{start:{line:36,column:30},end:{line:36,column:31}},loc:{start:{line:36,column:48},end:{line:60,column:1}},line:36},"4":{name:"(anonymous_4)",decl:{start:{line:37,column:41},end:{line:37,column:42}},loc:{start:{line:37,column:50},end:{line:37,column:79}},line:37},"5":{name:"(anonymous_5)",decl:{start:{line:39,column:38},end:{line:39,column:39}},loc:{start:{line:39,column:47},end:{line:42,column:3}},line:39},"6":{name:"(anonymous_6)",decl:{start:{line:64,column:36},end:{line:64,column:37}},loc:{start:{line:64,column:64},end:{line:66,column:1}},line:64}},branchMap:{"0":{loc:{start:{line:14,column:46},end:{line:14,column:92}},type:"cond-expr",locations:[{start:{line:14,column:70},end:{line:14,column:73}},{start:{line:14,column:76},end:{line:14,column:92}}],line:14},"1":{loc:{start:{line:14,column:46},end:{line:14,column:67}},type:"binary-expr",locations:[{start:{line:14,column:46},end:{line:14,column:49}},{start:{line:14,column:53},end:{line:14,column:67}}],line:14},"2":{loc:{start:{line:17,column:2},end:{line:19,column:3}},type:"if",locations:[{start:{line:17,column:2},end:{line:19,column:3}},{start:{line:17,column:2},end:{line:19,column:3}}],line:17},"3":{loc:{start:{line:25,column:2},end:{line:31,column:3}},type:"if",locations:[{start:{line:25,column:2},end:{line:31,column:3}},{start:{line:25,column:2},end:{line:31,column:3}}],line:25},"4":{loc:{start:{line:40,column:4},end:{line:40,column:42}},type:"if",locations:[{start:{line:40,column:4},end:{line:40,column:42}},{start:{line:40,column:4},end:{line:40,column:42}}],line:40},"5":{loc:{start:{line:41,column:11},end:{line:41,column:101}},type:"cond-expr",locations:[{start:{line:41,column:35},end:{line:41,column:93}},{start:{line:41,column:96},end:{line:41,column:101}}],line:41},"6":{loc:{start:{line:46,column:2},end:{line:51,column:3}},type:"if",locations:[{start:{line:46,column:2},end:{line:51,column:3}},{start:{line:46,column:2},end:{line:51,column:3}}],line:46},"7":{loc:{start:{line:57,column:10},end:{line:57,column:68}},type:"cond-expr",locations:[{start:{line:57,column:52},end:{line:57,column:56}},{start:{line:57,column:59},end:{line:57,column:68}}],line:57},"8":{loc:{start:{line:57,column:10},end:{line:57,column:49}},type:"binary-expr",locations:[{start:{line:57,column:10},end:{line:57,column:14}},{start:{line:57,column:18},end:{line:57,column:49}}],line:57},"9":{loc:{start:{line:65,column:9},end:{line:65,column:60}},type:"binary-expr",locations:[{start:{line:65,column:9},end:{line:65,column:25}},{start:{line:65,column:29},end:{line:65,column:54}},{start:{line:65,column:58},end:{line:65,column:60}}],line:65}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0]},inputSourceMap:{version:3,sources:["../../src/GraphQL/parseGraphQLUtils.js"],names:["enforceMasterKeyAccess","auth","isMaster","Parse","Error","OPERATION_FORBIDDEN","toGraphQLError","error","code","message","INTERNAL_SERVER_ERROR","ApolloError","extractKeysAndInclude","selectedFields","filter","field","includes","map","endsWith","substring","lastIndexOf","keys","undefined","include","length","Set","join","indexOf","getParseClassMutationConfig","parseClassConfig","mutation"],mappings:";;;;;;;;;AAAA;;AACA;;;;AAEO,SAASA,sBAAT,CAAgCC,IAAhC,EAAsC;AAC3C,MAAI,CAACA,IAAI,CAACC,QAAV,EAAoB;AAClB,UAAM,IAAIC,cAAMC,KAAV,CAAgBD,cAAMC,KAAN,CAAYC,mBAA5B,EAAiD,sCAAjD,CAAN;AACD;AACF;;AAEM,SAASC,cAAT,CAAwBC,KAAxB,EAA+B;AACpC,MAAIC,IAAJ,EAAUC,OAAV;;AACA,MAAIF,KAAK,YAAYJ,cAAMC,KAA3B,EAAkC;AAChCI,IAAAA,IAAI,GAAGD,KAAK,CAACC,IAAb;AACAC,IAAAA,OAAO,GAAGF,KAAK,CAACE,OAAhB;AACD,GAHD,MAGO;AACLD,IAAAA,IAAI,GAAGL,cAAMC,KAAN,CAAYM,qBAAnB;AACAD,IAAAA,OAAO,GAAG,uBAAV;AACD;;AACD,SAAO,IAAIE,6BAAJ,CAAgBF,OAAhB,EAAyBD,IAAzB,CAAP;AACD;;AAEM,MAAMI,qBAAqB,GAAGC,cAAc,IAAI;AACrDA,EAAAA,cAAc,GAAGA,cAAc,CAACC,MAAf,CAAsBC,KAAK,IAAI,CAACA,KAAK,CAACC,QAAN,CAAe,YAAf,CAAhC,CAAjB,CADqD,CAErD;;AACAH,EAAAA,cAAc,GAAGA,cAAc,CAACI,GAAf,CAAmBF,KAAK,IAAI;AAC3C,QAAIA,KAAK,KAAK,IAAd,EAAoB,OAAO,UAAP;AACpB,WAAOA,KAAK,CAACG,QAAN,CAAe,KAAf,IACF,GAAEH,KAAK,CAACI,SAAN,CAAgB,CAAhB,EAAmBJ,KAAK,CAACK,WAAN,CAAkB,KAAlB,CAAnB,CAA6C,WAD7C,GAEHL,KAFJ;AAGD,GALgB,CAAjB;AAMA,MAAIM,IAAI,GAAGC,SAAX;AACA,MAAIC,OAAO,GAAGD,SAAd;;AAEA,MAAIT,cAAc,CAACW,MAAf,GAAwB,CAA5B,EAA+B;AAC7BH,IAAAA,IAAI,GAAG,CAAC,GAAG,IAAII,GAAJ,CAAQZ,cAAR,CAAJ,EAA6Ba,IAA7B,CAAkC,GAAlC,CAAP,CAD6B,CAE7B;AACA;;AACAH,IAAAA,OAAO,GAAGF,IAAV;AACD;;AAED,SAAO;AACL;AACA;AACA;AACAA,IAAAA,IAAI,EAAEA,IAAI,IAAIA,IAAI,CAACM,OAAL,CAAa,UAAb,MAA6B,CAAC,CAAtC,GAA0CN,IAA1C,GAAiDC,SAJlD;AAKLC,IAAAA;AALK,GAAP;AAOD,CA1BM;;;;AA4BA,MAAMK,2BAA2B,GAAG,UAAUC,gBAAV,EAA4B;AACrE,SAAQA,gBAAgB,IAAIA,gBAAgB,CAACC,QAAtC,IAAmD,EAA1D;AACD,CAFM",sourcesContent:["import Parse from 'parse/node';\nimport { ApolloError } from 'apollo-server-core';\n\nexport function enforceMasterKeyAccess(auth) {\n  if (!auth.isMaster) {\n    throw new Parse.Error(Parse.Error.OPERATION_FORBIDDEN, 'unauthorized: master key is required');\n  }\n}\n\nexport function toGraphQLError(error) {\n  let code, message;\n  if (error instanceof Parse.Error) {\n    code = error.code;\n    message = error.message;\n  } else {\n    code = Parse.Error.INTERNAL_SERVER_ERROR;\n    message = 'Internal server error';\n  }\n  return new ApolloError(message, code);\n}\n\nexport const extractKeysAndInclude = selectedFields => {\n  selectedFields = selectedFields.filter(field => !field.includes('__typename'));\n  // Handles \"id\" field for both current and included objects\n  selectedFields = selectedFields.map(field => {\n    if (field === 'id') return 'objectId';\n    return field.endsWith('.id')\n      ? `${field.substring(0, field.lastIndexOf('.id'))}.objectId`\n      : field;\n  });\n  let keys = undefined;\n  let include = undefined;\n\n  if (selectedFields.length > 0) {\n    keys = [...new Set(selectedFields)].join(',');\n    // We can use this shortcut since optimization is handled\n    // later on RestQuery, avoid overhead here.\n    include = keys;\n  }\n\n  return {\n    // If authData is detected keys will not work properly\n    // since authData has a special storage behavior\n    // so we need to skip keys currently\n    keys: keys && keys.indexOf('authData') === -1 ? keys : undefined,\n    include,\n  };\n};\n\nexport const getParseClassMutationConfig = function (parseClassConfig) {\n  return (parseClassConfig && parseClassConfig.mutation) || {};\n};\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"84d0db401a38da5308603a5ec86118080dceb56c"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1bw5o3wv5k=function(){return actualCoverage;};}return actualCoverage;}cov_1bw5o3wv5k();cov_1bw5o3wv5k().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_1bw5o3wv5k().s[1]++;exports.enforceMasterKeyAccess=enforceMasterKeyAccess;cov_1bw5o3wv5k().s[2]++;exports.toGraphQLError=toGraphQLError;cov_1bw5o3wv5k().s[3]++;exports.getParseClassMutationConfig=exports.extractKeysAndInclude=void 0;var _node=(cov_1bw5o3wv5k().s[4]++,_interopRequireDefault(require("parse/node")));var _apolloServerCore=(cov_1bw5o3wv5k().s[5]++,require("apollo-server-core"));function _interopRequireDefault(obj){cov_1bw5o3wv5k().f[0]++;cov_1bw5o3wv5k().s[6]++;return(cov_1bw5o3wv5k().b[1][0]++,obj)&&(cov_1bw5o3wv5k().b[1][1]++,obj.__esModule)?(cov_1bw5o3wv5k().b[0][0]++,obj):(cov_1bw5o3wv5k().b[0][1]++,{default:obj});}function enforceMasterKeyAccess(auth){cov_1bw5o3wv5k().f[1]++;cov_1bw5o3wv5k().s[7]++;if(!auth.isMaster){cov_1bw5o3wv5k().b[2][0]++;cov_1bw5o3wv5k().s[8]++;throw new _node.default.Error(_node.default.Error.OPERATION_FORBIDDEN,'unauthorized: master key is required');}else{cov_1bw5o3wv5k().b[2][1]++;}}function toGraphQLError(error){cov_1bw5o3wv5k().f[2]++;let code,message;cov_1bw5o3wv5k().s[9]++;if(error instanceof _node.default.Error){cov_1bw5o3wv5k().b[3][0]++;cov_1bw5o3wv5k().s[10]++;code=error.code;cov_1bw5o3wv5k().s[11]++;message=error.message;}else{cov_1bw5o3wv5k().b[3][1]++;cov_1bw5o3wv5k().s[12]++;code=_node.default.Error.INTERNAL_SERVER_ERROR;cov_1bw5o3wv5k().s[13]++;message='Internal server error';}cov_1bw5o3wv5k().s[14]++;return new _apolloServerCore.ApolloError(message,code);}cov_1bw5o3wv5k().s[15]++;const extractKeysAndInclude=selectedFields=>{cov_1bw5o3wv5k().f[3]++;cov_1bw5o3wv5k().s[16]++;selectedFields=selectedFields.filter(field=>{cov_1bw5o3wv5k().f[4]++;cov_1bw5o3wv5k().s[17]++;return!field.includes('__typename');});// Handles "id" field for both current and included objects
cov_1bw5o3wv5k().s[18]++;selectedFields=selectedFields.map(field=>{cov_1bw5o3wv5k().f[5]++;cov_1bw5o3wv5k().s[19]++;if(field==='id'){cov_1bw5o3wv5k().b[4][0]++;cov_1bw5o3wv5k().s[20]++;return'objectId';}else{cov_1bw5o3wv5k().b[4][1]++;}cov_1bw5o3wv5k().s[21]++;return field.endsWith('.id')?(cov_1bw5o3wv5k().b[5][0]++,`${field.substring(0,field.lastIndexOf('.id'))}.objectId`):(cov_1bw5o3wv5k().b[5][1]++,field);});let keys=(cov_1bw5o3wv5k().s[22]++,undefined);let include=(cov_1bw5o3wv5k().s[23]++,undefined);cov_1bw5o3wv5k().s[24]++;if(selectedFields.length>0){cov_1bw5o3wv5k().b[6][0]++;cov_1bw5o3wv5k().s[25]++;keys=[...new Set(selectedFields)].join(',');// We can use this shortcut since optimization is handled
// later on RestQuery, avoid overhead here.
cov_1bw5o3wv5k().s[26]++;include=keys;}else{cov_1bw5o3wv5k().b[6][1]++;}cov_1bw5o3wv5k().s[27]++;return{// If authData is detected keys will not work properly
// since authData has a special storage behavior
// so we need to skip keys currently
keys:(cov_1bw5o3wv5k().b[8][0]++,keys)&&(cov_1bw5o3wv5k().b[8][1]++,keys.indexOf('authData')===-1)?(cov_1bw5o3wv5k().b[7][0]++,keys):(cov_1bw5o3wv5k().b[7][1]++,undefined),include};};cov_1bw5o3wv5k().s[28]++;exports.extractKeysAndInclude=extractKeysAndInclude;cov_1bw5o3wv5k().s[29]++;const getParseClassMutationConfig=function(parseClassConfig){cov_1bw5o3wv5k().f[6]++;cov_1bw5o3wv5k().s[30]++;return(cov_1bw5o3wv5k().b[9][0]++,parseClassConfig)&&(cov_1bw5o3wv5k().b[9][1]++,parseClassConfig.mutation)||(cov_1bw5o3wv5k().b[9][2]++,{});};cov_1bw5o3wv5k().s[31]++;exports.getParseClassMutationConfig=getParseClassMutationConfig;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9HcmFwaFFML3BhcnNlR3JhcGhRTFV0aWxzLmpzIl0sIm5hbWVzIjpbImVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MiLCJhdXRoIiwiaXNNYXN0ZXIiLCJQYXJzZSIsIkVycm9yIiwiT1BFUkFUSU9OX0ZPUkJJRERFTiIsInRvR3JhcGhRTEVycm9yIiwiZXJyb3IiLCJjb2RlIiwibWVzc2FnZSIsIklOVEVSTkFMX1NFUlZFUl9FUlJPUiIsIkFwb2xsb0Vycm9yIiwiZXh0cmFjdEtleXNBbmRJbmNsdWRlIiwic2VsZWN0ZWRGaWVsZHMiLCJmaWx0ZXIiLCJmaWVsZCIsImluY2x1ZGVzIiwibWFwIiwiZW5kc1dpdGgiLCJzdWJzdHJpbmciLCJsYXN0SW5kZXhPZiIsImtleXMiLCJ1bmRlZmluZWQiLCJpbmNsdWRlIiwibGVuZ3RoIiwiU2V0Iiwiam9pbiIsImluZGV4T2YiLCJnZXRQYXJzZUNsYXNzTXV0YXRpb25Db25maWciLCJwYXJzZUNsYXNzQ29uZmlnIiwibXV0YXRpb24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRU8sU0FBU0Esc0JBQVQsQ0FBZ0NDLElBQWhDLEVBQXNDO0FBQzNDLE1BQUksQ0FBQ0EsSUFBSSxDQUFDQyxRQUFWLEVBQW9CO0FBQ2xCLFVBQU0sSUFBSUMsY0FBTUMsS0FBVixDQUFnQkQsY0FBTUMsS0FBTixDQUFZQyxtQkFBNUIsRUFBaUQsc0NBQWpELENBQU47QUFDRDtBQUNGOztBQUVNLFNBQVNDLGNBQVQsQ0FBd0JDLEtBQXhCLEVBQStCO0FBQ3BDLE1BQUlDLElBQUosRUFBVUMsT0FBVjs7QUFDQSxNQUFJRixLQUFLLFlBQVlKLGNBQU1DLEtBQTNCLEVBQWtDO0FBQ2hDSSxJQUFBQSxJQUFJLEdBQUdELEtBQUssQ0FBQ0MsSUFBYjtBQUNBQyxJQUFBQSxPQUFPLEdBQUdGLEtBQUssQ0FBQ0UsT0FBaEI7QUFDRCxHQUhELE1BR087QUFDTEQsSUFBQUEsSUFBSSxHQUFHTCxjQUFNQyxLQUFOLENBQVlNLHFCQUFuQjtBQUNBRCxJQUFBQSxPQUFPLEdBQUcsdUJBQVY7QUFDRDs7QUFDRCxTQUFPLElBQUlFLDZCQUFKLENBQWdCRixPQUFoQixFQUF5QkQsSUFBekIsQ0FBUDtBQUNEOztBQUVNLE1BQU1JLHFCQUFxQixHQUFHQyxjQUFjLElBQUk7QUFDckRBLEVBQUFBLGNBQWMsR0FBR0EsY0FBYyxDQUFDQyxNQUFmLENBQXNCQyxLQUFLLElBQUksQ0FBQ0EsS0FBSyxDQUFDQyxRQUFOLENBQWUsWUFBZixDQUFoQyxDQUFqQixDQURxRCxDQUVyRDs7QUFDQUgsRUFBQUEsY0FBYyxHQUFHQSxjQUFjLENBQUNJLEdBQWYsQ0FBbUJGLEtBQUssSUFBSTtBQUMzQyxRQUFJQSxLQUFLLEtBQUssSUFBZCxFQUFvQixPQUFPLFVBQVA7QUFDcEIsV0FBT0EsS0FBSyxDQUFDRyxRQUFOLENBQWUsS0FBZixJQUNGLEdBQUVILEtBQUssQ0FBQ0ksU0FBTixDQUFnQixDQUFoQixFQUFtQkosS0FBSyxDQUFDSyxXQUFOLENBQWtCLEtBQWxCLENBQW5CLENBQTZDLFdBRDdDLEdBRUhMLEtBRko7QUFHRCxHQUxnQixDQUFqQjtBQU1BLE1BQUlNLElBQUksR0FBR0MsU0FBWDtBQUNBLE1BQUlDLE9BQU8sR0FBR0QsU0FBZDs7QUFFQSxNQUFJVCxjQUFjLENBQUNXLE1BQWYsR0FBd0IsQ0FBNUIsRUFBK0I7QUFDN0JILElBQUFBLElBQUksR0FBRyxDQUFDLEdBQUcsSUFBSUksR0FBSixDQUFRWixjQUFSLENBQUosRUFBNkJhLElBQTdCLENBQWtDLEdBQWxDLENBQVAsQ0FENkIsQ0FFN0I7QUFDQTs7QUFDQUgsSUFBQUEsT0FBTyxHQUFHRixJQUFWO0FBQ0Q7O0FBRUQsU0FBTztBQUNMO0FBQ0E7QUFDQTtBQUNBQSxJQUFBQSxJQUFJLEVBQUVBLElBQUksSUFBSUEsSUFBSSxDQUFDTSxPQUFMLENBQWEsVUFBYixNQUE2QixDQUFDLENBQXRDLEdBQTBDTixJQUExQyxHQUFpREMsU0FKbEQ7QUFLTEMsSUFBQUE7QUFMSyxHQUFQO0FBT0QsQ0ExQk07Ozs7QUE0QkEsTUFBTUssMkJBQTJCLEdBQUcsVUFBVUMsZ0JBQVYsRUFBNEI7QUFDckUsU0FBUUEsZ0JBQWdCLElBQUlBLGdCQUFnQixDQUFDQyxRQUF0QyxJQUFtRCxFQUExRDtBQUNELENBRk0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGFyc2UgZnJvbSAncGFyc2Uvbm9kZSc7XG5pbXBvcnQgeyBBcG9sbG9FcnJvciB9IGZyb20gJ2Fwb2xsby1zZXJ2ZXItY29yZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmZvcmNlTWFzdGVyS2V5QWNjZXNzKGF1dGgpIHtcbiAgaWYgKCFhdXRoLmlzTWFzdGVyKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9QRVJBVElPTl9GT1JCSURERU4sICd1bmF1dGhvcml6ZWQ6IG1hc3RlciBrZXkgaXMgcmVxdWlyZWQnKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9HcmFwaFFMRXJyb3IoZXJyb3IpIHtcbiAgbGV0IGNvZGUsIG1lc3NhZ2U7XG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIFBhcnNlLkVycm9yKSB7XG4gICAgY29kZSA9IGVycm9yLmNvZGU7XG4gICAgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XG4gIH0gZWxzZSB7XG4gICAgY29kZSA9IFBhcnNlLkVycm9yLklOVEVSTkFMX1NFUlZFUl9FUlJPUjtcbiAgICBtZXNzYWdlID0gJ0ludGVybmFsIHNlcnZlciBlcnJvcic7XG4gIH1cbiAgcmV0dXJuIG5ldyBBcG9sbG9FcnJvcihtZXNzYWdlLCBjb2RlKTtcbn1cblxuZXhwb3J0IGNvbnN0IGV4dHJhY3RLZXlzQW5kSW5jbHVkZSA9IHNlbGVjdGVkRmllbGRzID0+IHtcbiAgc2VsZWN0ZWRGaWVsZHMgPSBzZWxlY3RlZEZpZWxkcy5maWx0ZXIoZmllbGQgPT4gIWZpZWxkLmluY2x1ZGVzKCdfX3R5cGVuYW1lJykpO1xuICAvLyBIYW5kbGVzIFwiaWRcIiBmaWVsZCBmb3IgYm90aCBjdXJyZW50IGFuZCBpbmNsdWRlZCBvYmplY3RzXG4gIHNlbGVjdGVkRmllbGRzID0gc2VsZWN0ZWRGaWVsZHMubWFwKGZpZWxkID0+IHtcbiAgICBpZiAoZmllbGQgPT09ICdpZCcpIHJldHVybiAnb2JqZWN0SWQnO1xuICAgIHJldHVybiBmaWVsZC5lbmRzV2l0aCgnLmlkJylcbiAgICAgID8gYCR7ZmllbGQuc3Vic3RyaW5nKDAsIGZpZWxkLmxhc3RJbmRleE9mKCcuaWQnKSl9Lm9iamVjdElkYFxuICAgICAgOiBmaWVsZDtcbiAgfSk7XG4gIGxldCBrZXlzID0gdW5kZWZpbmVkO1xuICBsZXQgaW5jbHVkZSA9IHVuZGVmaW5lZDtcblxuICBpZiAoc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID4gMCkge1xuICAgIGtleXMgPSBbLi4ubmV3IFNldChzZWxlY3RlZEZpZWxkcyldLmpvaW4oJywnKTtcbiAgICAvLyBXZSBjYW4gdXNlIHRoaXMgc2hvcnRjdXQgc2luY2Ugb3B0aW1pemF0aW9uIGlzIGhhbmRsZWRcbiAgICAvLyBsYXRlciBvbiBSZXN0UXVlcnksIGF2b2lkIG92ZXJoZWFkIGhlcmUuXG4gICAgaW5jbHVkZSA9IGtleXM7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIC8vIElmIGF1dGhEYXRhIGlzIGRldGVjdGVkIGtleXMgd2lsbCBub3Qgd29yayBwcm9wZXJseVxuICAgIC8vIHNpbmNlIGF1dGhEYXRhIGhhcyBhIHNwZWNpYWwgc3RvcmFnZSBiZWhhdmlvclxuICAgIC8vIHNvIHdlIG5lZWQgdG8gc2tpcCBrZXlzIGN1cnJlbnRseVxuICAgIGtleXM6IGtleXMgJiYga2V5cy5pbmRleE9mKCdhdXRoRGF0YScpID09PSAtMSA/IGtleXMgOiB1bmRlZmluZWQsXG4gICAgaW5jbHVkZSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRQYXJzZUNsYXNzTXV0YXRpb25Db25maWcgPSBmdW5jdGlvbiAocGFyc2VDbGFzc0NvbmZpZykge1xuICByZXR1cm4gKHBhcnNlQ2xhc3NDb25maWcgJiYgcGFyc2VDbGFzc0NvbmZpZy5tdXRhdGlvbikgfHwge307XG59O1xuIl19
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9HcmFwaFFML3BhcnNlR3JhcGhRTFV0aWxzLmpzIl0sIm5hbWVzIjpbImVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MiLCJhdXRoIiwiUGFyc2UiLCJlcnJvciIsImNvZGUiLCJtZXNzYWdlIiwiQXBvbGxvRXJyb3IiLCJleHRyYWN0S2V5c0FuZEluY2x1ZGUiLCJzZWxlY3RlZEZpZWxkcyIsImZpZWxkIiwia2V5cyIsImluY2x1ZGUiLCJnZXRQYXJzZUNsYXNzTXV0YXRpb25Db25maWciLCJwYXJzZUNsYXNzQ29uZmlnIl0sIm1hcHBpbmdzIjoid3ZTQUdPO3laQUhQLEdBQUEsQ0FBQSxLQUFBLDBCQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBLENBQUEsQ0FDQSxHQUFBLENBQUEsaUJBQUEsMEJBQUEsT0FBQSxDQUFBLG9CQUFBLENBQUEsQ0FBQSxDLHNQQUVPLFFBQVNBLENBQUFBLHNCQUFULENBQUEsSUFBQSxDQUFzQyxpREFDM0MsR0FBSSxDQUFDQyxJQUFJLENBQVQsUUFBQSxDQUFvQixvREFDbEIsS0FBTSxJQUFJQyxDQUFBQSxLQUFBQSxDQUFBQSxPQUFBQSxDQUFKLEtBQUEsQ0FBZ0JBLEtBQUFBLENBQUFBLE9BQUFBLENBQUFBLEtBQUFBLENBQWhCLG1CQUFBLENBQU4sc0NBQU0sQ0FBTixDQUNELENBRkQsaUNBR0QsQ0FFTSxRQUFBLENBQUEsY0FBQSxDQUFBLEtBQUEsQ0FBK0IseUJBQ3BDLEdBQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxDQURvQyx3QkFFcEMsR0FBSUMsS0FBSyxXQUFZRCxDQUFBQSxLQUFBQSxDQUFBQSxPQUFBQSxDQUFyQixLQUFBLENBQWtDLHFEQUNoQ0UsSUFBSSxDQUFHRCxLQUFLLENBQVpDLElBQUFBLENBRGdDLHlCQUVoQ0MsT0FBTyxDQUFHRixLQUFLLENBQWZFLE9BQUFBLENBRkYsQ0FBQSxJQUdPLHFEQUNMRCxJQUFJLENBQUdGLEtBQUFBLENBQUFBLE9BQUFBLENBQUFBLEtBQUFBLENBQVBFLHFCQUFBQSxDQURLLHlCQUVMQyxPQUFPLENBQVBBLHVCQUFBQSxDQUNELENBUm1DLHlCQVNwQyxNQUFPLElBQUlDLENBQUFBLGlCQUFBQSxDQUFKLFdBQUEsQ0FBQSxPQUFBLENBQVAsSUFBTyxDQUFQLENBQ0QsQyx5QkFFTSxLQUFNQyxDQUFBQSxxQkFBcUIsQ0FBR0MsY0FBYyxFQUFJLGtEQUNyREEsY0FBYyxDQUFHQSxjQUFjLENBQWRBLE1BQUFBLENBQXNCQyxLQUFLLEVBQUkseURBQUNBLEtBQUssQ0FBTEEsUUFBQUEsQ0FBQUEsWUFBQUEsQ0FBRCxDQURLLENBQ3BDRCxDQUFqQkEsQ0FDQTtBQUZxRCx5QkFHckRBLGNBQWMsQ0FBRyxjQUFjLENBQWQsR0FBQSxDQUFtQkMsS0FBSyxFQUFJLGtEQUMzQyxHQUFJQSxLQUFLLEdBQVQsSUFBQSxDQUFvQiwyREFBQSxVQUFBLENBQUEsQ0FBcEIsaUNBRDJDLHlCQUUzQyxNQUFPQSxDQUFBQSxLQUFLLENBQUxBLFFBQUFBLENBQUFBLEtBQUFBLDhCQUNGLEdBQUVBLEtBQUssQ0FBTEEsU0FBQUEsQ0FBQUEsQ0FBQUEsQ0FBbUJBLEtBQUssQ0FBTEEsV0FBQUEsQ0FBbkJBLEtBQW1CQSxDQUFuQkEsQ0FEQUEsV0FBQUEsOEJBQVAsS0FBT0EsQ0FBUCxDQUZGRCxDQUFpQixDQUFqQkEsQ0FNQSxHQUFJRSxDQUFBQSxJQUFJLDJCQUFSLFNBQVEsQ0FBUixDQUNBLEdBQUlDLENBQUFBLE9BQU8sMkJBQVgsU0FBVyxDQUFYLENBVnFELHlCQVlyRCxHQUFJSCxjQUFjLENBQWRBLE1BQUFBLENBQUosQ0FBQSxDQUErQixxREFDN0JFLElBQUksQ0FBRyxDQUFDLEdBQUcsR0FBQSxDQUFBLEdBQUEsQ0FBSixjQUFJLENBQUosRUFBQSxJQUFBLENBRHNCLEdBQ3RCLENBQVBBLENBQ0E7QUFDQTtBQUg2Qix5QkFJN0JDLE9BQU8sQ0FBUEEsSUFBQUEsQ0FDRCxDQUxELGlDQVpxRCx5QkFtQnJELE1BQU8sQ0FDTDtBQUNBO0FBQ0E7QUFDQUQsSUFBSSxDQUFFQSw0QkFBQUEsSUFBSSwrQkFBSUEsSUFBSSxDQUFKQSxPQUFBQSxDQUFBQSxVQUFBQSxJQUE2QixDQUFyQ0EsQ0FBSSxDQUFKQSw2QkFBQUEsSUFBQUEsOEJBSkQsU0FJQ0EsQ0FKRCxDQUtMQyxPQUxLLENBQVAsQ0FuQkssQ0FBQSxDLHNHQTRCQSxLQUFNQyxDQUFBQSwyQkFBMkIsQ0FBRyxTQUFBLGdCQUFBLENBQTRCLGtEQUNyRSxNQUFRQyw0QkFBQUEsZ0JBQWdCLCtCQUFJQSxnQkFBZ0IsQ0FBckMsUUFBaUIsQ0FBaEJBLDhCQUFSLEVBQVFBLENBQVIsQ0FESyxDQUFBLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGFyc2UgZnJvbSAncGFyc2Uvbm9kZSc7XG5pbXBvcnQgeyBBcG9sbG9FcnJvciB9IGZyb20gJ2Fwb2xsby1zZXJ2ZXItY29yZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmZvcmNlTWFzdGVyS2V5QWNjZXNzKGF1dGgpIHtcbiAgaWYgKCFhdXRoLmlzTWFzdGVyKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9QRVJBVElPTl9GT1JCSURERU4sICd1bmF1dGhvcml6ZWQ6IG1hc3RlciBrZXkgaXMgcmVxdWlyZWQnKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9HcmFwaFFMRXJyb3IoZXJyb3IpIHtcbiAgbGV0IGNvZGUsIG1lc3NhZ2U7XG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIFBhcnNlLkVycm9yKSB7XG4gICAgY29kZSA9IGVycm9yLmNvZGU7XG4gICAgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XG4gIH0gZWxzZSB7XG4gICAgY29kZSA9IFBhcnNlLkVycm9yLklOVEVSTkFMX1NFUlZFUl9FUlJPUjtcbiAgICBtZXNzYWdlID0gJ0ludGVybmFsIHNlcnZlciBlcnJvcic7XG4gIH1cbiAgcmV0dXJuIG5ldyBBcG9sbG9FcnJvcihtZXNzYWdlLCBjb2RlKTtcbn1cblxuZXhwb3J0IGNvbnN0IGV4dHJhY3RLZXlzQW5kSW5jbHVkZSA9IHNlbGVjdGVkRmllbGRzID0+IHtcbiAgc2VsZWN0ZWRGaWVsZHMgPSBzZWxlY3RlZEZpZWxkcy5maWx0ZXIoZmllbGQgPT4gIWZpZWxkLmluY2x1ZGVzKCdfX3R5cGVuYW1lJykpO1xuICAvLyBIYW5kbGVzIFwiaWRcIiBmaWVsZCBmb3IgYm90aCBjdXJyZW50IGFuZCBpbmNsdWRlZCBvYmplY3RzXG4gIHNlbGVjdGVkRmllbGRzID0gc2VsZWN0ZWRGaWVsZHMubWFwKGZpZWxkID0+IHtcbiAgICBpZiAoZmllbGQgPT09ICdpZCcpIHJldHVybiAnb2JqZWN0SWQnO1xuICAgIHJldHVybiBmaWVsZC5lbmRzV2l0aCgnLmlkJylcbiAgICAgID8gYCR7ZmllbGQuc3Vic3RyaW5nKDAsIGZpZWxkLmxhc3RJbmRleE9mKCcuaWQnKSl9Lm9iamVjdElkYFxuICAgICAgOiBmaWVsZDtcbiAgfSk7XG4gIGxldCBrZXlzID0gdW5kZWZpbmVkO1xuICBsZXQgaW5jbHVkZSA9IHVuZGVmaW5lZDtcblxuICBpZiAoc2VsZWN0ZWRGaWVsZHMubGVuZ3RoID4gMCkge1xuICAgIGtleXMgPSBbLi4ubmV3IFNldChzZWxlY3RlZEZpZWxkcyldLmpvaW4oJywnKTtcbiAgICAvLyBXZSBjYW4gdXNlIHRoaXMgc2hvcnRjdXQgc2luY2Ugb3B0aW1pemF0aW9uIGlzIGhhbmRsZWRcbiAgICAvLyBsYXRlciBvbiBSZXN0UXVlcnksIGF2b2lkIG92ZXJoZWFkIGhlcmUuXG4gICAgaW5jbHVkZSA9IGtleXM7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIC8vIElmIGF1dGhEYXRhIGlzIGRldGVjdGVkIGtleXMgd2lsbCBub3Qgd29yayBwcm9wZXJseVxuICAgIC8vIHNpbmNlIGF1dGhEYXRhIGhhcyBhIHNwZWNpYWwgc3RvcmFnZSBiZWhhdmlvclxuICAgIC8vIHNvIHdlIG5lZWQgdG8gc2tpcCBrZXlzIGN1cnJlbnRseVxuICAgIGtleXM6IGtleXMgJiYga2V5cy5pbmRleE9mKCdhdXRoRGF0YScpID09PSAtMSA/IGtleXMgOiB1bmRlZmluZWQsXG4gICAgaW5jbHVkZSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRQYXJzZUNsYXNzTXV0YXRpb25Db25maWcgPSBmdW5jdGlvbiAocGFyc2VDbGFzc0NvbmZpZykge1xuICByZXR1cm4gKHBhcnNlQ2xhc3NDb25maWcgJiYgcGFyc2VDbGFzc0NvbmZpZy5tdXRhdGlvbikgfHwge307XG59O1xuIl19