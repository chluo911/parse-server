"use strict";/* Apple Game Center Auth
https://developer.apple.com/documentation/gamekit/gklocalplayer/1515407-generateidentityverificationsign#discussion

const authData = {
  publicKeyUrl: 'https://valid.apple.com/public/timeout.cer',
  timestamp: 1460981421303,
  signature: 'PoDwf39DCN464B49jJCU0d9Y0J',
  salt: 'saltST==',
  bundleId: 'com.valid.app'
  id: 'playerId',
};
*/function cov_ae7s81fqk(){var path="/parse-server/lib/Adapters/Auth/gcenter.js";var hash="b77c7cb445d95301b9c3a9a36fee14eb2127777d";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Adapters/Auth/gcenter.js",statementMap:{"0":{start:{line:17,column:4},end:{line:17,column:25}},"1":{start:{line:19,column:15},end:{line:19,column:32}},"2":{start:{line:21,column:14},end:{line:21,column:30}},"3":{start:{line:23,column:12},end:{line:23,column:26}},"4":{start:{line:25,column:14},end:{line:25,column:16}},"5":{start:{line:28,column:20},end:{line:28,column:43}},"6":{start:{line:30,column:2},end:{line:32,column:3}},"7":{start:{line:31,column:4},end:{line:31,column:17}},"8":{start:{line:34,column:24},end:{line:34,column:53}},"9":{start:{line:35,column:17},end:{line:35,column:37}},"10":{start:{line:36,column:22},end:{line:36,column:61}},"11":{start:{line:37,column:17},end:{line:37,column:38}},"12":{start:{line:38,column:2},end:{line:38,column:32}},"13":{start:{line:42,column:20},end:{line:42,column:51}},"14":{start:{line:43,column:21},end:{line:43,column:48}},"15":{start:{line:44,column:17},end:{line:44,column:25}},"16":{start:{line:45,column:19},end:{line:45,column:70}},"17":{start:{line:46,column:2},end:{line:46,column:43}},"18":{start:{line:50,column:2},end:{line:52,column:3}},"19":{start:{line:51,column:4},end:{line:51,column:117}},"20":{start:{line:54,column:2},end:{line:56,column:3}},"21":{start:{line:55,column:4},end:{line:55,column:31}},"22":{start:{line:58,column:2},end:{line:82,column:5}},"23":{start:{line:59,column:4},end:{line:81,column:27}},"24":{start:{line:60,column:17},end:{line:60,column:19}},"25":{start:{line:61,column:6},end:{line:63,column:9}},"26":{start:{line:62,column:8},end:{line:62,column:41}},"27":{start:{line:64,column:6},end:{line:80,column:9}},"28":{start:{line:65,column:21},end:{line:65,column:47}},"29":{start:{line:67,column:8},end:{line:77,column:9}},"30":{start:{line:68,column:23},end:{line:68,column:77}},"31":{start:{line:70,column:10},end:{line:76,column:11}},"32":{start:{line:71,column:12},end:{line:71,column:39}},"33":{start:{line:73,column:12},end:{line:75,column:47}},"34":{start:{line:74,column:14},end:{line:74,column:41}},"35":{start:{line:79,column:8},end:{line:79,column:22}},"36":{start:{line:86,column:17},end:{line:86,column:32}},"37":{start:{line:87,column:15},end:{line:87,column:41}},"38":{start:{line:88,column:14},end:{line:88,column:44}},"39":{start:{line:89,column:2},end:{line:89,column:46}},"40":{start:{line:90,column:2},end:{line:90,column:45}},"41":{start:{line:91,column:2},end:{line:91,column:16}},"42":{start:{line:95,column:19},end:{line:95,column:48}},"43":{start:{line:96,column:2},end:{line:96,column:45}},"44":{start:{line:97,column:2},end:{line:97,column:45}},"45":{start:{line:98,column:2},end:{line:98,column:67}},"46":{start:{line:99,column:2},end:{line:99,column:43}},"47":{start:{line:101,column:2},end:{line:103,column:3}},"48":{start:{line:102,column:4},end:{line:102,column:97}},"49":{start:{line:108,column:2},end:{line:110,column:3}},"50":{start:{line:109,column:4},end:{line:109,column:99}},"51":{start:{line:112,column:2},end:{line:112,column:34}},"52":{start:{line:113,column:20},end:{line:113,column:68}},"53":{start:{line:114,column:2},end:{line:114,column:46}},"54":{start:{line:119,column:2},end:{line:119,column:27}},"55":{start:{line:122,column:0},end:{line:125,column:2}}},fnMap:{"0":{name:"verifyPublicKeyUrl",decl:{start:{line:27,column:9},end:{line:27,column:27}},loc:{start:{line:27,column:42},end:{line:39,column:1}},line:27},"1":{name:"convertX509CertToPEM",decl:{start:{line:41,column:9},end:{line:41,column:29}},loc:{start:{line:41,column:40},end:{line:47,column:1}},line:41},"2":{name:"getAppleCertificate",decl:{start:{line:49,column:9},end:{line:49,column:28}},loc:{start:{line:49,column:43},end:{line:83,column:1}},line:49},"3":{name:"(anonymous_3)",decl:{start:{line:58,column:21},end:{line:58,column:22}},loc:{start:{line:58,column:42},end:{line:82,column:3}},line:58},"4":{name:"(anonymous_4)",decl:{start:{line:59,column:28},end:{line:59,column:29}},loc:{start:{line:59,column:35},end:{line:81,column:5}},line:59},"5":{name:"(anonymous_5)",decl:{start:{line:61,column:21},end:{line:61,column:22}},loc:{start:{line:61,column:30},end:{line:63,column:7}},line:61},"6":{name:"(anonymous_6)",decl:{start:{line:64,column:20},end:{line:64,column:21}},loc:{start:{line:64,column:26},end:{line:80,column:7}},line:64},"7":{name:"(anonymous_7)",decl:{start:{line:73,column:23},end:{line:73,column:24}},loc:{start:{line:73,column:29},end:{line:75,column:13}},line:73},"8":{name:"convertTimestampToBigEndian",decl:{start:{line:85,column:9},end:{line:85,column:36}},loc:{start:{line:85,column:48},end:{line:92,column:1}},line:85},"9":{name:"verifySignature",decl:{start:{line:94,column:9},end:{line:94,column:24}},loc:{start:{line:94,column:46},end:{line:104,column:1}},line:94},"10":{name:"validateAuthData",decl:{start:{line:107,column:15},end:{line:107,column:31}},loc:{start:{line:107,column:42},end:{line:115,column:1}},line:107},"11":{name:"validateAppId",decl:{start:{line:118,column:9},end:{line:118,column:22}},loc:{start:{line:118,column:25},end:{line:120,column:1}},line:118}},branchMap:{"0":{loc:{start:{line:30,column:2},end:{line:32,column:3}},type:"if",locations:[{start:{line:30,column:2},end:{line:32,column:3}},{start:{line:30,column:2},end:{line:32,column:3}}],line:30},"1":{loc:{start:{line:50,column:2},end:{line:52,column:3}},type:"if",locations:[{start:{line:50,column:2},end:{line:52,column:3}},{start:{line:50,column:2},end:{line:52,column:3}}],line:50},"2":{loc:{start:{line:54,column:2},end:{line:56,column:3}},type:"if",locations:[{start:{line:54,column:2},end:{line:56,column:3}},{start:{line:54,column:2},end:{line:56,column:3}}],line:54},"3":{loc:{start:{line:67,column:8},end:{line:77,column:9}},type:"if",locations:[{start:{line:67,column:8},end:{line:77,column:9}},{start:{line:67,column:8},end:{line:77,column:9}}],line:67},"4":{loc:{start:{line:70,column:10},end:{line:76,column:11}},type:"if",locations:[{start:{line:70,column:10},end:{line:76,column:11}},{start:{line:70,column:10},end:{line:76,column:11}}],line:70},"5":{loc:{start:{line:101,column:2},end:{line:103,column:3}},type:"if",locations:[{start:{line:101,column:2},end:{line:103,column:3}},{start:{line:101,column:2},end:{line:103,column:3}}],line:101},"6":{loc:{start:{line:108,column:2},end:{line:110,column:3}},type:"if",locations:[{start:{line:108,column:2},end:{line:110,column:3}},{start:{line:108,column:2},end:{line:110,column:3}}],line:108}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},inputSourceMap:{version:3,sources:["../../../src/Adapters/Auth/gcenter.js"],names:["Parse","require","crypto","https","url","cache","verifyPublicKeyUrl","publicKeyUrl","parsedUrl","parse","protocol","hostnameParts","hostname","split","length","domainParts","slice","domain","join","convertX509CertToPEM","X509Cert","pemPreFix","pemPostFix","base64","certBody","match","RegExp","getAppleCertificate","Error","OBJECT_NOT_FOUND","Promise","resolve","reject","get","res","data","on","chunk","toString","cert","headers","expire","setTimeout","parseInt","convertTimestampToBigEndian","timestamp","buffer","Buffer","alloc","high","low","writeUInt32BE","verifySignature","publicKey","authData","verifier","createVerify","update","playerId","bundleId","salt","verify","signature","validateAuthData","id","validateAppId","module","exports"],mappings:"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",sourcesContent:["/* Apple Game Center Auth\nhttps://developer.apple.com/documentation/gamekit/gklocalplayer/1515407-generateidentityverificationsign#discussion\n\nconst authData = {\n  publicKeyUrl: 'https://valid.apple.com/public/timeout.cer',\n  timestamp: 1460981421303,\n  signature: 'PoDwf39DCN464B49jJCU0d9Y0J',\n  salt: 'saltST==',\n  bundleId: 'com.valid.app'\n  id: 'playerId',\n};\n*/\n\nconst { Parse } = require('parse/node');\nconst crypto = require('crypto');\nconst https = require('https');\nconst url = require('url');\n\nconst cache = {}; // (publicKey -> cert) cache\n\nfunction verifyPublicKeyUrl(publicKeyUrl) {\n  const parsedUrl = url.parse(publicKeyUrl);\n  if (parsedUrl.protocol !== 'https:') {\n    return false;\n  }\n  const hostnameParts = parsedUrl.hostname.split('.');\n  const length = hostnameParts.length;\n  const domainParts = hostnameParts.slice(length - 2, length);\n  const domain = domainParts.join('.');\n  return domain === 'apple.com';\n}\n\nfunction convertX509CertToPEM(X509Cert) {\n  const pemPreFix = '-----BEGIN CERTIFICATE-----\\n';\n  const pemPostFix = '-----END CERTIFICATE-----';\n\n  const base64 = X509Cert;\n  const certBody = base64.match(new RegExp('.{0,64}', 'g')).join('\\n');\n\n  return pemPreFix + certBody + pemPostFix;\n}\n\nfunction getAppleCertificate(publicKeyUrl) {\n  if (!verifyPublicKeyUrl(publicKeyUrl)) {\n    throw new Parse.Error(\n      Parse.Error.OBJECT_NOT_FOUND,\n      `Apple Game Center - invalid publicKeyUrl: ${publicKeyUrl}`\n    );\n  }\n  if (cache[publicKeyUrl]) {\n    return cache[publicKeyUrl];\n  }\n  return new Promise((resolve, reject) => {\n    https\n      .get(publicKeyUrl, res => {\n        let data = '';\n        res.on('data', chunk => {\n          data += chunk.toString('base64');\n        });\n        res.on('end', () => {\n          const cert = convertX509CertToPEM(data);\n          if (res.headers['cache-control']) {\n            var expire = res.headers['cache-control'].match(/max-age=([0-9]+)/);\n            if (expire) {\n              cache[publicKeyUrl] = cert;\n              // we'll expire the cache entry later, as per max-age\n              setTimeout(() => {\n                delete cache[publicKeyUrl];\n              }, parseInt(expire[1], 10) * 1000);\n            }\n          }\n          resolve(cert);\n        });\n      })\n      .on('error', reject);\n  });\n}\n\nfunction convertTimestampToBigEndian(timestamp) {\n  const buffer = Buffer.alloc(8);\n\n  const high = ~~(timestamp / 0xffffffff);\n  const low = timestamp % (0xffffffff + 0x1);\n\n  buffer.writeUInt32BE(parseInt(high, 10), 0);\n  buffer.writeUInt32BE(parseInt(low, 10), 4);\n\n  return buffer;\n}\n\nfunction verifySignature(publicKey, authData) {\n  const verifier = crypto.createVerify('sha256');\n  verifier.update(authData.playerId, 'utf8');\n  verifier.update(authData.bundleId, 'utf8');\n  verifier.update(convertTimestampToBigEndian(authData.timestamp));\n  verifier.update(authData.salt, 'base64');\n\n  if (!verifier.verify(publicKey, authData.signature, 'base64')) {\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, 'Apple Game Center - invalid signature');\n  }\n}\n\n// Returns a promise that fulfills if this user id is valid.\nasync function validateAuthData(authData) {\n  if (!authData.id) {\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, 'Apple Game Center - authData id missing');\n  }\n  authData.playerId = authData.id;\n  const publicKey = await getAppleCertificate(authData.publicKeyUrl);\n  return verifySignature(publicKey, authData);\n}\n\n// Returns a promise that fulfills if this app id is valid.\nfunction validateAppId() {\n  return Promise.resolve();\n}\n\nmodule.exports = {\n  validateAppId,\n  validateAuthData,\n};\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b77c7cb445d95301b9c3a9a36fee14eb2127777d"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_ae7s81fqk=function(){return actualCoverage;};}return actualCoverage;}cov_ae7s81fqk();const{Parse}=(cov_ae7s81fqk().s[0]++,require('parse/node'));const crypto=(cov_ae7s81fqk().s[1]++,require('crypto'));const https=(cov_ae7s81fqk().s[2]++,require('https'));const url=(cov_ae7s81fqk().s[3]++,require('url'));const cache=(cov_ae7s81fqk().s[4]++,{});// (publicKey -> cert) cache
function verifyPublicKeyUrl(publicKeyUrl){cov_ae7s81fqk().f[0]++;const parsedUrl=(cov_ae7s81fqk().s[5]++,url.parse(publicKeyUrl));cov_ae7s81fqk().s[6]++;if(parsedUrl.protocol!=='https:'){cov_ae7s81fqk().b[0][0]++;cov_ae7s81fqk().s[7]++;return false;}else{cov_ae7s81fqk().b[0][1]++;}const hostnameParts=(cov_ae7s81fqk().s[8]++,parsedUrl.hostname.split('.'));const length=(cov_ae7s81fqk().s[9]++,hostnameParts.length);const domainParts=(cov_ae7s81fqk().s[10]++,hostnameParts.slice(length-2,length));const domain=(cov_ae7s81fqk().s[11]++,domainParts.join('.'));cov_ae7s81fqk().s[12]++;return domain==='apple.com';}function convertX509CertToPEM(X509Cert){cov_ae7s81fqk().f[1]++;const pemPreFix=(cov_ae7s81fqk().s[13]++,'-----BEGIN CERTIFICATE-----\n');const pemPostFix=(cov_ae7s81fqk().s[14]++,'-----END CERTIFICATE-----');const base64=(cov_ae7s81fqk().s[15]++,X509Cert);const certBody=(cov_ae7s81fqk().s[16]++,base64.match(new RegExp('.{0,64}','g')).join('\n'));cov_ae7s81fqk().s[17]++;return pemPreFix+certBody+pemPostFix;}function getAppleCertificate(publicKeyUrl){cov_ae7s81fqk().f[2]++;cov_ae7s81fqk().s[18]++;if(!verifyPublicKeyUrl(publicKeyUrl)){cov_ae7s81fqk().b[1][0]++;cov_ae7s81fqk().s[19]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`Apple Game Center - invalid publicKeyUrl: ${publicKeyUrl}`);}else{cov_ae7s81fqk().b[1][1]++;}cov_ae7s81fqk().s[20]++;if(cache[publicKeyUrl]){cov_ae7s81fqk().b[2][0]++;cov_ae7s81fqk().s[21]++;return cache[publicKeyUrl];}else{cov_ae7s81fqk().b[2][1]++;}cov_ae7s81fqk().s[22]++;return new Promise((resolve,reject)=>{cov_ae7s81fqk().f[3]++;cov_ae7s81fqk().s[23]++;https.get(publicKeyUrl,res=>{cov_ae7s81fqk().f[4]++;let data=(cov_ae7s81fqk().s[24]++,'');cov_ae7s81fqk().s[25]++;res.on('data',chunk=>{cov_ae7s81fqk().f[5]++;cov_ae7s81fqk().s[26]++;data+=chunk.toString('base64');});cov_ae7s81fqk().s[27]++;res.on('end',()=>{cov_ae7s81fqk().f[6]++;const cert=(cov_ae7s81fqk().s[28]++,convertX509CertToPEM(data));cov_ae7s81fqk().s[29]++;if(res.headers['cache-control']){cov_ae7s81fqk().b[3][0]++;var expire=(cov_ae7s81fqk().s[30]++,res.headers['cache-control'].match(/max-age=([0-9]+)/));cov_ae7s81fqk().s[31]++;if(expire){cov_ae7s81fqk().b[4][0]++;cov_ae7s81fqk().s[32]++;cache[publicKeyUrl]=cert;// we'll expire the cache entry later, as per max-age
cov_ae7s81fqk().s[33]++;setTimeout(()=>{cov_ae7s81fqk().f[7]++;cov_ae7s81fqk().s[34]++;delete cache[publicKeyUrl];},parseInt(expire[1],10)*1000);}else{cov_ae7s81fqk().b[4][1]++;}}else{cov_ae7s81fqk().b[3][1]++;}cov_ae7s81fqk().s[35]++;resolve(cert);});}).on('error',reject);});}function convertTimestampToBigEndian(timestamp){cov_ae7s81fqk().f[8]++;const buffer=(cov_ae7s81fqk().s[36]++,Buffer.alloc(8));const high=(cov_ae7s81fqk().s[37]++,~~(timestamp/0xffffffff));const low=(cov_ae7s81fqk().s[38]++,timestamp%(0xffffffff+0x1));cov_ae7s81fqk().s[39]++;buffer.writeUInt32BE(parseInt(high,10),0);cov_ae7s81fqk().s[40]++;buffer.writeUInt32BE(parseInt(low,10),4);cov_ae7s81fqk().s[41]++;return buffer;}function verifySignature(publicKey,authData){cov_ae7s81fqk().f[9]++;const verifier=(cov_ae7s81fqk().s[42]++,crypto.createVerify('sha256'));cov_ae7s81fqk().s[43]++;verifier.update(authData.playerId,'utf8');cov_ae7s81fqk().s[44]++;verifier.update(authData.bundleId,'utf8');cov_ae7s81fqk().s[45]++;verifier.update(convertTimestampToBigEndian(authData.timestamp));cov_ae7s81fqk().s[46]++;verifier.update(authData.salt,'base64');cov_ae7s81fqk().s[47]++;if(!verifier.verify(publicKey,authData.signature,'base64')){cov_ae7s81fqk().b[5][0]++;cov_ae7s81fqk().s[48]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,'Apple Game Center - invalid signature');}else{cov_ae7s81fqk().b[5][1]++;}}// Returns a promise that fulfills if this user id is valid.
async function validateAuthData(authData){cov_ae7s81fqk().f[10]++;cov_ae7s81fqk().s[49]++;if(!authData.id){cov_ae7s81fqk().b[6][0]++;cov_ae7s81fqk().s[50]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,'Apple Game Center - authData id missing');}else{cov_ae7s81fqk().b[6][1]++;}cov_ae7s81fqk().s[51]++;authData.playerId=authData.id;const publicKey=(cov_ae7s81fqk().s[52]++,await getAppleCertificate(authData.publicKeyUrl));cov_ae7s81fqk().s[53]++;return verifySignature(publicKey,authData);}// Returns a promise that fulfills if this app id is valid.
function validateAppId(){cov_ae7s81fqk().f[11]++;cov_ae7s81fqk().s[54]++;return Promise.resolve();}cov_ae7s81fqk().s[55]++;module.exports={validateAppId,validateAuthData};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9BdXRoL2djZW50ZXIuanMiXSwibmFtZXMiOlsiUGFyc2UiLCJyZXF1aXJlIiwiY3J5cHRvIiwiaHR0cHMiLCJ1cmwiLCJjYWNoZSIsInZlcmlmeVB1YmxpY0tleVVybCIsInB1YmxpY0tleVVybCIsInBhcnNlZFVybCIsInBhcnNlIiwicHJvdG9jb2wiLCJob3N0bmFtZVBhcnRzIiwiaG9zdG5hbWUiLCJzcGxpdCIsImxlbmd0aCIsImRvbWFpblBhcnRzIiwic2xpY2UiLCJkb21haW4iLCJqb2luIiwiY29udmVydFg1MDlDZXJ0VG9QRU0iLCJYNTA5Q2VydCIsInBlbVByZUZpeCIsInBlbVBvc3RGaXgiLCJiYXNlNjQiLCJjZXJ0Qm9keSIsIm1hdGNoIiwiUmVnRXhwIiwiZ2V0QXBwbGVDZXJ0aWZpY2F0ZSIsIkVycm9yIiwiT0JKRUNUX05PVF9GT1VORCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZ2V0IiwicmVzIiwiZGF0YSIsIm9uIiwiY2h1bmsiLCJ0b1N0cmluZyIsImNlcnQiLCJoZWFkZXJzIiwiZXhwaXJlIiwic2V0VGltZW91dCIsInBhcnNlSW50IiwiY29udmVydFRpbWVzdGFtcFRvQmlnRW5kaWFuIiwidGltZXN0YW1wIiwiYnVmZmVyIiwiQnVmZmVyIiwiYWxsb2MiLCJoaWdoIiwibG93Iiwid3JpdGVVSW50MzJCRSIsInZlcmlmeVNpZ25hdHVyZSIsInB1YmxpY0tleSIsImF1dGhEYXRhIiwidmVyaWZpZXIiLCJjcmVhdGVWZXJpZnkiLCJ1cGRhdGUiLCJwbGF5ZXJJZCIsImJ1bmRsZUlkIiwic2FsdCIsInZlcmlmeSIsInNpZ25hdHVyZSIsInZhbGlkYXRlQXV0aERhdGEiLCJpZCIsInZhbGlkYXRlQXBwSWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVB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Q1QsU0FBVixDQUEzQztBQUNBVSxFQUFBQSxRQUFRLENBQUNFLE1BQVQsQ0FBZ0JILFFBQVEsQ0FBQ00sSUFBekIsRUFBK0IsUUFBL0I7O0FBRUEsTUFBSSxDQUFDTCxRQUFRLENBQUNNLE1BQVQsQ0FBZ0JSLFNBQWhCLEVBQTJCQyxRQUFRLENBQUNRLFNBQXBDLEVBQStDLFFBQS9DLENBQUwsRUFBK0Q7QUFDN0QsVUFBTSxJQUFJOUQsS0FBSyxDQUFDNEIsS0FBVixDQUFnQjVCLEtBQUssQ0FBQzRCLEtBQU4sQ0FBWUMsZ0JBQTVCLEVBQThDLHVDQUE5QyxDQUFOO0FBQ0Q7QUFDRixDLENBRUQ7OztBQUNBLGVBQWVrQyxnQkFBZixDQUFnQ1QsUUFBaEMsRUFBMEM7QUFDeEMsTUFBSSxDQUFDQSxRQUFRLENBQUNVLEVBQWQsRUFBa0I7QUFDaEIsVUFBTSxJQUFJaEUsS0FBSyxDQUFDNEIsS0FBVixDQUFnQjVCLEtBQUssQ0FBQzRCLEtBQU4sQ0FBWUMsZ0JBQTVCLEVBQThDLHlDQUE5QyxDQUFOO0FBQ0Q7O0FBQ0R5QixFQUFBQSxRQUFRLENBQUNJLFFBQVQsR0FBb0JKLFFBQVEsQ0FBQ1UsRUFBN0I7QUFDQSxRQUFNWCxTQUFTLEdBQUcsTUFBTTFCLG1CQUFtQixDQUFDMkIsUUFBUSxDQUFDL0MsWUFBVixDQUEzQztBQUNBLFNBQU82QyxlQUFlLENBQUNDLFNBQUQsRUFBWUMsUUFBWixDQUF0QjtBQUNELEMsQ0FFRDs7O0FBQ0EsU0FBU1csYUFBVCxHQUF5QjtBQUN2QixTQUFPbkMsT0FBTyxDQUFDQyxPQUFSLEVBQVA7QUFDRDs7QUFFRG1DLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQUNmRixFQUFBQSxhQURlO0FBRWZGLEVBQUFBO0FBRmUsQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBBcHBsZSBHYW1lIENlbnRlciBBdXRoXG5odHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vZG9jdW1lbnRhdGlvbi9nYW1la2l0L2drbG9jYWxwbGF5ZXIvMTUxNTQwNy1nZW5lcmF0ZWlkZW50aXR5dmVyaWZpY2F0aW9uc2lnbiNkaXNjdXNzaW9uXG5cbmNvbnN0IGF1dGhEYXRhID0ge1xuICBwdWJsaWNLZXlVcmw6ICdodHRwczovL3ZhbGlkLmFwcGxlLmNvbS9wdWJsaWMvdGltZW91dC5jZXInLFxuICB0aW1lc3RhbXA6IDE0NjA5ODE0MjEzMDMsXG4gIHNpZ25hdHVyZTogJ1BvRHdmMzlEQ040NjRCNDlqSkNVMGQ5WTBKJyxcbiAgc2FsdDogJ3NhbHRTVD09JyxcbiAgYnVuZGxlSWQ6ICdjb20udmFsaWQuYXBwJ1xuICBpZDogJ3BsYXllcklkJyxcbn07XG4qL1xuXG5jb25zdCB7IFBhcnNlIH0gPSByZXF1aXJlKCdwYXJzZS9ub2RlJyk7XG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcbmNvbnN0IGh0dHBzID0gcmVxdWlyZSgnaHR0cHMnKTtcbmNvbnN0IHVybCA9IHJlcXVpcmUoJ3VybCcpO1xuXG5jb25zdCBjYWNoZSA9IHt9OyAvLyAocHVibGljS2V5IC0+IGNlcnQpIGNhY2hlXG5cbmZ1bmN0aW9uIHZlcmlmeVB1YmxpY0tleVVybChwdWJsaWNLZXlVcmwpIHtcbiAgY29uc3QgcGFyc2VkVXJsID0gdXJsLnBhcnNlKHB1YmxpY0tleVVybCk7XG4gIGlmIChwYXJzZWRVcmwucHJvdG9jb2wgIT09ICdodHRwczonKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IGhvc3RuYW1lUGFydHMgPSBwYXJzZWRVcmwuaG9zdG5hbWUuc3BsaXQoJy4nKTtcbiAgY29uc3QgbGVuZ3RoID0gaG9zdG5hbWVQYXJ0cy5sZW5ndGg7XG4gIGNvbnN0IGRvbWFpblBhcnRzID0gaG9zdG5hbWVQYXJ0cy5zbGljZShsZW5ndGggLSAyLCBsZW5ndGgpO1xuICBjb25zdCBkb21haW4gPSBkb21haW5QYXJ0cy5qb2luKCcuJyk7XG4gIHJldHVybiBkb21haW4gPT09ICdhcHBsZS5jb20nO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0WDUwOUNlcnRUb1BFTShYNTA5Q2VydCkge1xuICBjb25zdCBwZW1QcmVGaXggPSAnLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tXFxuJztcbiAgY29uc3QgcGVtUG9zdEZpeCA9ICctLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tJztcblxuICBjb25zdCBiYXNlNjQgPSBYNTA5Q2VydDtcbiAgY29uc3QgY2VydEJvZHkgPSBiYXNlNjQubWF0Y2gobmV3IFJlZ0V4cCgnLnswLDY0fScsICdnJykpLmpvaW4oJ1xcbicpO1xuXG4gIHJldHVybiBwZW1QcmVGaXggKyBjZXJ0Qm9keSArIHBlbVBvc3RGaXg7XG59XG5cbmZ1bmN0aW9uIGdldEFwcGxlQ2VydGlmaWNhdGUocHVibGljS2V5VXJsKSB7XG4gIGlmICghdmVyaWZ5UHVibGljS2V5VXJsKHB1YmxpY0tleVVybCkpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICBQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELFxuICAgICAgYEFwcGxlIEdhbWUgQ2VudGVyIC0gaW52YWxpZCBwdWJsaWNLZXlVcmw6ICR7cHVibGljS2V5VXJsfWBcbiAgICApO1xuICB9XG4gIGlmIChjYWNoZVtwdWJsaWNLZXlVcmxdKSB7XG4gICAgcmV0dXJuIGNhY2hlW3B1YmxpY0tleVVybF07XG4gIH1cbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBodHRwc1xuICAgICAgLmdldChwdWJsaWNLZXlVcmwsIHJlcyA9PiB7XG4gICAgICAgIGxldCBkYXRhID0gJyc7XG4gICAgICAgIHJlcy5vbignZGF0YScsIGNodW5rID0+IHtcbiAgICAgICAgICBkYXRhICs9IGNodW5rLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlcy5vbignZW5kJywgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNlcnQgPSBjb252ZXJ0WDUwOUNlcnRUb1BFTShkYXRhKTtcbiAgICAgICAgICBpZiAocmVzLmhlYWRlcnNbJ2NhY2hlLWNvbnRyb2wnXSkge1xuICAgICAgICAgICAgdmFyIGV4cGlyZSA9IHJlcy5oZWFkZXJzWydjYWNoZS1jb250cm9sJ10ubWF0Y2goL21heC1hZ2U9KFswLTldKykvKTtcbiAgICAgICAgICAgIGlmIChleHBpcmUpIHtcbiAgICAgICAgICAgICAgY2FjaGVbcHVibGljS2V5VXJsXSA9IGNlcnQ7XG4gICAgICAgICAgICAgIC8vIHdlJ2xsIGV4cGlyZSB0aGUgY2FjaGUgZW50cnkgbGF0ZXIsIGFzIHBlciBtYXgtYWdlXG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBjYWNoZVtwdWJsaWNLZXlVcmxdO1xuICAgICAgICAgICAgICB9LCBwYXJzZUludChleHBpcmVbMV0sIDEwKSAqIDEwMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXNvbHZlKGNlcnQpO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAub24oJ2Vycm9yJywgcmVqZWN0KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRUaW1lc3RhbXBUb0JpZ0VuZGlhbih0aW1lc3RhbXApIHtcbiAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmFsbG9jKDgpO1xuXG4gIGNvbnN0IGhpZ2ggPSB+fih0aW1lc3RhbXAgLyAweGZmZmZmZmZmKTtcbiAgY29uc3QgbG93ID0gdGltZXN0YW1wICUgKDB4ZmZmZmZmZmYgKyAweDEpO1xuXG4gIGJ1ZmZlci53cml0ZVVJbnQzMkJFKHBhcnNlSW50KGhpZ2gsIDEwKSwgMCk7XG4gIGJ1ZmZlci53cml0ZVVJbnQzMkJFKHBhcnNlSW50KGxvdywgMTApLCA0KTtcblxuICByZXR1cm4gYnVmZmVyO1xufVxuXG5mdW5jdGlvbiB2ZXJpZnlTaWduYXR1cmUocHVibGljS2V5LCBhdXRoRGF0YSkge1xuICBjb25zdCB2ZXJpZmllciA9IGNyeXB0by5jcmVhdGVWZXJpZnkoJ3NoYTI1NicpO1xuICB2ZXJpZmllci51cGRhdGUoYXV0aERhdGEucGxheWVySWQsICd1dGY4Jyk7XG4gIHZlcmlmaWVyLnVwZGF0ZShhdXRoRGF0YS5idW5kbGVJZCwgJ3V0ZjgnKTtcbiAgdmVyaWZpZXIudXBkYXRlKGNvbnZlcnRUaW1lc3RhbXBUb0JpZ0VuZGlhbihhdXRoRGF0YS50aW1lc3RhbXApKTtcbiAgdmVyaWZpZXIudXBkYXRlKGF1dGhEYXRhLnNhbHQsICdiYXNlNjQnKTtcblxuICBpZiAoIXZlcmlmaWVyLnZlcmlmeShwdWJsaWNLZXksIGF1dGhEYXRhLnNpZ25hdHVyZSwgJ2Jhc2U2NCcpKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsICdBcHBsZSBHYW1lIENlbnRlciAtIGludmFsaWQgc2lnbmF0dXJlJyk7XG4gIH1cbn1cblxuLy8gUmV0dXJucyBhIHByb21pc2UgdGhhdCBmdWxmaWxscyBpZiB0aGlzIHVzZXIgaWQgaXMgdmFsaWQuXG5hc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUF1dGhEYXRhKGF1dGhEYXRhKSB7XG4gIGlmICghYXV0aERhdGEuaWQpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgJ0FwcGxlIEdhbWUgQ2VudGVyIC0gYXV0aERhdGEgaWQgbWlzc2luZycpO1xuICB9XG4gIGF1dGhEYXRhLnBsYXllcklkID0gYXV0aERhdGEuaWQ7XG4gIGNvbnN0IHB1YmxpY0tleSA9IGF3YWl0IGdldEFwcGxlQ2VydGlmaWNhdGUoYXV0aERhdGEucHVibGljS2V5VXJsKTtcbiAgcmV0dXJuIHZlcmlmeVNpZ25hdHVyZShwdWJsaWNLZXksIGF1dGhEYXRhKTtcbn1cblxuLy8gUmV0dXJucyBhIHByb21pc2UgdGhhdCBmdWxmaWxscyBpZiB0aGlzIGFwcCBpZCBpcyB2YWxpZC5cbmZ1bmN0aW9uIHZhbGlkYXRlQXBwSWQoKSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHZhbGlkYXRlQXBwSWQsXG4gIHZhbGlkYXRlQXV0aERhdGEsXG59O1xuIl19
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9BdXRoL2djZW50ZXIuanMiXSwibmFtZXMiOlsiUGFyc2UiLCJyZXF1aXJlIiwiY3J5cHRvIiwiaHR0cHMiLCJ1cmwiLCJjYWNoZSIsInBhcnNlZFVybCIsImhvc3RuYW1lUGFydHMiLCJsZW5ndGgiLCJkb21haW5QYXJ0cyIsImRvbWFpbiIsInBlbVByZUZpeCIsInBlbVBvc3RGaXgiLCJiYXNlNjQiLCJjZXJ0Qm9keSIsInZlcmlmeVB1YmxpY0tleVVybCIsInB1YmxpY0tleVVybCIsInJlcyIsImRhdGEiLCJjaHVuayIsImNlcnQiLCJjb252ZXJ0WDUwOUNlcnRUb1BFTSIsImV4cGlyZSIsInNldFRpbWVvdXQiLCJwYXJzZUludCIsInJlc29sdmUiLCJidWZmZXIiLCJCdWZmZXIiLCJoaWdoIiwidGltZXN0YW1wIiwibG93IiwidmVyaWZpZXIiLCJhdXRoRGF0YSIsImNvbnZlcnRUaW1lc3RhbXBUb0JpZ0VuZGlhbiIsInB1YmxpY0tleSIsImdldEFwcGxlQ2VydGlmaWNhdGUiLCJ2ZXJpZnlTaWduYXR1cmUiLCJQcm9taXNlIiwibW9kdWxlIiwidmFsaWRhdGVBdXRoRGF0YSJdLCJtYXBwaW5ncyI6ImFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEUsMnNlQUVRQTt5RkFBUixLQUFNLENBQUVBLEtBQUYsMEJBQVlDLE9BQU8sQ0FBekIsWUFBeUIsQ0FBbkIsQ0FBTixDQUNBLEtBQU1DLENBQUFBLE1BQU0seUJBQUdELE9BQU8sQ0FBdEIsUUFBc0IsQ0FBVixDQUFaLENBQ0EsS0FBTUUsQ0FBQUEsS0FBSyx5QkFBR0YsT0FBTyxDQUFyQixPQUFxQixDQUFWLENBQVgsQ0FDQSxLQUFNRyxDQUFBQSxHQUFHLHlCQUFHSCxPQUFPLENBQW5CLEtBQW1CLENBQVYsQ0FBVCxDQUVBLEtBQU1JLENBQUFBLEtBQUsseUJBQVgsRUFBVyxDQUFYLENBQWtCO0FBRWxC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QixDQUFBLGFBQUEsQ0FFZkMsZ0JBRmUsQ0FBakJELEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBBcHBsZSBHYW1lIENlbnRlciBBdXRoXG5odHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vZG9jdW1lbnRhdGlvbi9nYW1la2l0L2drbG9jYWxwbGF5ZXIvMTUxNTQwNy1nZW5lcmF0ZWlkZW50aXR5dmVyaWZpY2F0aW9uc2lnbiNkaXNjdXNzaW9uXG5cbmNvbnN0IGF1dGhEYXRhID0ge1xuICBwdWJsaWNLZXlVcmw6ICdodHRwczovL3ZhbGlkLmFwcGxlLmNvbS9wdWJsaWMvdGltZW91dC5jZXInLFxuICB0aW1lc3RhbXA6IDE0NjA5ODE0MjEzMDMsXG4gIHNpZ25hdHVyZTogJ1BvRHdmMzlEQ040NjRCNDlqSkNVMGQ5WTBKJyxcbiAgc2FsdDogJ3NhbHRTVD09JyxcbiAgYnVuZGxlSWQ6ICdjb20udmFsaWQuYXBwJ1xuICBpZDogJ3BsYXllcklkJyxcbn07XG4qL1xuXG5jb25zdCB7IFBhcnNlIH0gPSByZXF1aXJlKCdwYXJzZS9ub2RlJyk7XG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcbmNvbnN0IGh0dHBzID0gcmVxdWlyZSgnaHR0cHMnKTtcbmNvbnN0IHVybCA9IHJlcXVpcmUoJ3VybCcpO1xuXG5jb25zdCBjYWNoZSA9IHt9OyAvLyAocHVibGljS2V5IC0+IGNlcnQpIGNhY2hlXG5cbmZ1bmN0aW9uIHZlcmlmeVB1YmxpY0tleVVybChwdWJsaWNLZXlVcmwpIHtcbiAgY29uc3QgcGFyc2VkVXJsID0gdXJsLnBhcnNlKHB1YmxpY0tleVVybCk7XG4gIGlmIChwYXJzZWRVcmwucHJvdG9jb2wgIT09ICdodHRwczonKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IGhvc3RuYW1lUGFydHMgPSBwYXJzZWRVcmwuaG9zdG5hbWUuc3BsaXQoJy4nKTtcbiAgY29uc3QgbGVuZ3RoID0gaG9zdG5hbWVQYXJ0cy5sZW5ndGg7XG4gIGNvbnN0IGRvbWFpblBhcnRzID0gaG9zdG5hbWVQYXJ0cy5zbGljZShsZW5ndGggLSAyLCBsZW5ndGgpO1xuICBjb25zdCBkb21haW4gPSBkb21haW5QYXJ0cy5qb2luKCcuJyk7XG4gIHJldHVybiBkb21haW4gPT09ICdhcHBsZS5jb20nO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0WDUwOUNlcnRUb1BFTShYNTA5Q2VydCkge1xuICBjb25zdCBwZW1QcmVGaXggPSAnLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tXFxuJztcbiAgY29uc3QgcGVtUG9zdEZpeCA9ICctLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tJztcblxuICBjb25zdCBiYXNlNjQgPSBYNTA5Q2VydDtcbiAgY29uc3QgY2VydEJvZHkgPSBiYXNlNjQubWF0Y2gobmV3IFJlZ0V4cCgnLnswLDY0fScsICdnJykpLmpvaW4oJ1xcbicpO1xuXG4gIHJldHVybiBwZW1QcmVGaXggKyBjZXJ0Qm9keSArIHBlbVBvc3RGaXg7XG59XG5cbmZ1bmN0aW9uIGdldEFwcGxlQ2VydGlmaWNhdGUocHVibGljS2V5VXJsKSB7XG4gIGlmICghdmVyaWZ5UHVibGljS2V5VXJsKHB1YmxpY0tleVVybCkpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICBQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELFxuICAgICAgYEFwcGxlIEdhbWUgQ2VudGVyIC0gaW52YWxpZCBwdWJsaWNLZXlVcmw6ICR7cHVibGljS2V5VXJsfWBcbiAgICApO1xuICB9XG4gIGlmIChjYWNoZVtwdWJsaWNLZXlVcmxdKSB7XG4gICAgcmV0dXJuIGNhY2hlW3B1YmxpY0tleVVybF07XG4gIH1cbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBodHRwc1xuICAgICAgLmdldChwdWJsaWNLZXlVcmwsIHJlcyA9PiB7XG4gICAgICAgIGxldCBkYXRhID0gJyc7XG4gICAgICAgIHJlcy5vbignZGF0YScsIGNodW5rID0+IHtcbiAgICAgICAgICBkYXRhICs9IGNodW5rLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlcy5vbignZW5kJywgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNlcnQgPSBjb252ZXJ0WDUwOUNlcnRUb1BFTShkYXRhKTtcbiAgICAgICAgICBpZiAocmVzLmhlYWRlcnNbJ2NhY2hlLWNvbnRyb2wnXSkge1xuICAgICAgICAgICAgdmFyIGV4cGlyZSA9IHJlcy5oZWFkZXJzWydjYWNoZS1jb250cm9sJ10ubWF0Y2goL21heC1hZ2U9KFswLTldKykvKTtcbiAgICAgICAgICAgIGlmIChleHBpcmUpIHtcbiAgICAgICAgICAgICAgY2FjaGVbcHVibGljS2V5VXJsXSA9IGNlcnQ7XG4gICAgICAgICAgICAgIC8vIHdlJ2xsIGV4cGlyZSB0aGUgY2FjaGUgZW50cnkgbGF0ZXIsIGFzIHBlciBtYXgtYWdlXG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBjYWNoZVtwdWJsaWNLZXlVcmxdO1xuICAgICAgICAgICAgICB9LCBwYXJzZUludChleHBpcmVbMV0sIDEwKSAqIDEwMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXNvbHZlKGNlcnQpO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAub24oJ2Vycm9yJywgcmVqZWN0KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRUaW1lc3RhbXBUb0JpZ0VuZGlhbih0aW1lc3RhbXApIHtcbiAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmFsbG9jKDgpO1xuXG4gIGNvbnN0IGhpZ2ggPSB+fih0aW1lc3RhbXAgLyAweGZmZmZmZmZmKTtcbiAgY29uc3QgbG93ID0gdGltZXN0YW1wICUgKDB4ZmZmZmZmZmYgKyAweDEpO1xuXG4gIGJ1ZmZlci53cml0ZVVJbnQzMkJFKHBhcnNlSW50KGhpZ2gsIDEwKSwgMCk7XG4gIGJ1ZmZlci53cml0ZVVJbnQzMkJFKHBhcnNlSW50KGxvdywgMTApLCA0KTtcblxuICByZXR1cm4gYnVmZmVyO1xufVxuXG5mdW5jdGlvbiB2ZXJpZnlTaWduYXR1cmUocHVibGljS2V5LCBhdXRoRGF0YSkge1xuICBjb25zdCB2ZXJpZmllciA9IGNyeXB0by5jcmVhdGVWZXJpZnkoJ3NoYTI1NicpO1xuICB2ZXJpZmllci51cGRhdGUoYXV0aERhdGEucGxheWVySWQsICd1dGY4Jyk7XG4gIHZlcmlmaWVyLnVwZGF0ZShhdXRoRGF0YS5idW5kbGVJZCwgJ3V0ZjgnKTtcbiAgdmVyaWZpZXIudXBkYXRlKGNvbnZlcnRUaW1lc3RhbXBUb0JpZ0VuZGlhbihhdXRoRGF0YS50aW1lc3RhbXApKTtcbiAgdmVyaWZpZXIudXBkYXRlKGF1dGhEYXRhLnNhbHQsICdiYXNlNjQnKTtcblxuICBpZiAoIXZlcmlmaWVyLnZlcmlmeShwdWJsaWNLZXksIGF1dGhEYXRhLnNpZ25hdHVyZSwgJ2Jhc2U2NCcpKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsICdBcHBsZSBHYW1lIENlbnRlciAtIGludmFsaWQgc2lnbmF0dXJlJyk7XG4gIH1cbn1cblxuLy8gUmV0dXJucyBhIHByb21pc2UgdGhhdCBmdWxmaWxscyBpZiB0aGlzIHVzZXIgaWQgaXMgdmFsaWQuXG5hc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUF1dGhEYXRhKGF1dGhEYXRhKSB7XG4gIGlmICghYXV0aERhdGEuaWQpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgJ0FwcGxlIEdhbWUgQ2VudGVyIC0gYXV0aERhdGEgaWQgbWlzc2luZycpO1xuICB9XG4gIGF1dGhEYXRhLnBsYXllcklkID0gYXV0aERhdGEuaWQ7XG4gIGNvbnN0IHB1YmxpY0tleSA9IGF3YWl0IGdldEFwcGxlQ2VydGlmaWNhdGUoYXV0aERhdGEucHVibGljS2V5VXJsKTtcbiAgcmV0dXJuIHZlcmlmeVNpZ25hdHVyZShwdWJsaWNLZXksIGF1dGhEYXRhKTtcbn1cblxuLy8gUmV0dXJucyBhIHByb21pc2UgdGhhdCBmdWxmaWxscyBpZiB0aGlzIGFwcCBpZCBpcyB2YWxpZC5cbmZ1bmN0aW9uIHZhbGlkYXRlQXBwSWQoKSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHZhbGlkYXRlQXBwSWQsXG4gIHZhbGlkYXRlQXV0aERhdGEsXG59O1xuIl19