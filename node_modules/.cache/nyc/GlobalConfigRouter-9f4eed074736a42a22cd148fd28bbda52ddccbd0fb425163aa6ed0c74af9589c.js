"use strict";function cov_xgm2o4uje(){var path="/parse-server/lib/Routers/GlobalConfigRouter.js";var hash="56ca0824eff21d0fa4c3f7bc389f614dd1e0219b";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Routers/GlobalConfigRouter.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:54}},"2":{start:{line:8,column:12},end:{line:8,column:57}},"3":{start:{line:10,column:21},end:{line:10,column:72}},"4":{start:{line:12,column:17},end:{line:12,column:67}},"5":{start:{line:14,column:49},end:{line:14,column:96}},"6":{start:{line:14,column:84},end:{line:14,column:96}},"7":{start:{line:14,column:121},end:{line:14,column:134}},"8":{start:{line:14,column:159},end:{line:14,column:172}},"9":{start:{line:14,column:174},end:{line:14,column:309}},"10":{start:{line:14,column:234},end:{line:14,column:292}},"11":{start:{line:16,column:53},end:{line:16,column:111}},"12":{start:{line:16,column:98},end:{line:16,column:109}},"13":{start:{line:16,column:112},end:{line:16,column:214}},"14":{start:{line:16,column:188},end:{line:16,column:212}},"15":{start:{line:16,column:227},end:{line:16,column:264}},"16":{start:{line:16,column:266},end:{line:16,column:321}},"17":{start:{line:16,column:297},end:{line:16,column:319}},"18":{start:{line:16,column:335},end:{line:16,column:337}},"19":{start:{line:16,column:367},end:{line:16,column:423}},"20":{start:{line:16,column:425},end:{line:16,column:726}},"21":{start:{line:16,column:448},end:{line:16,column:724}},"22":{start:{line:16,column:534},end:{line:16,column:606}},"23":{start:{line:16,column:608},end:{line:16,column:722}},"24":{start:{line:16,column:646},end:{line:16,column:687}},"25":{start:{line:16,column:697},end:{line:16,column:720}},"26":{start:{line:16,column:727},end:{line:16,column:748}},"27":{start:{line:16,column:749},end:{line:16,column:787}},"28":{start:{line:16,column:762},end:{line:16,column:785}},"29":{start:{line:16,column:788},end:{line:16,column:802}},"30":{start:{line:18,column:39},end:{line:18,column:93}},"31":{start:{line:23,column:4},end:{line:54,column:7}},"32":{start:{line:28,column:6},end:{line:35,column:7}},"33":{start:{line:30,column:8},end:{line:34,column:10}},"34":{start:{line:37,column:27},end:{line:37,column:37}},"35":{start:{line:39,column:6},end:{line:46,column:7}},"36":{start:{line:40,column:8},end:{line:45,column:9}},"37":{start:{line:41,column:10},end:{line:44,column:11}},"38":{start:{line:42,column:12},end:{line:42,column:46}},"39":{start:{line:43,column:12},end:{line:43,column:53}},"40":{start:{line:48,column:6},end:{line:53,column:8}},"41":{start:{line:58,column:4},end:{line:60,column:5}},"42":{start:{line:59,column:6},end:{line:59,column:136}},"43":{start:{line:62,column:19},end:{line:62,column:34}},"44":{start:{line:63,column:26},end:{line:63,column:54}},"45":{start:{line:65,column:19},end:{line:69,column:10}},"46":{start:{line:66,column:6},end:{line:66,column:41}},"47":{start:{line:67,column:6},end:{line:67,column:64}},"48":{start:{line:68,column:6},end:{line:68,column:17}},"49":{start:{line:70,column:4},end:{line:78,column:8}},"50":{start:{line:74,column:19},end:{line:78,column:5}},"51":{start:{line:82,column:4},end:{line:84,column:7}},"52":{start:{line:83,column:6},end:{line:83,column:39}},"53":{start:{line:85,column:4},end:{line:87,column:7}},"54":{start:{line:86,column:6},end:{line:86,column:42}},"55":{start:{line:92,column:0},end:{line:92,column:48}},"56":{start:{line:93,column:15},end:{line:93,column:33}},"57":{start:{line:94,column:0},end:{line:94,column:27}}},fnMap:{"0":{name:"_getRequireWildcardCache",decl:{start:{line:14,column:9},end:{line:14,column:33}},loc:{start:{line:14,column:47},end:{line:14,column:311}},line:14},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:209},end:{line:14,column:210}},loc:{start:{line:14,column:232},end:{line:14,column:294}},line:14},"2":{name:"_interopRequireWildcard",decl:{start:{line:16,column:9},end:{line:16,column:32}},loc:{start:{line:16,column:51},end:{line:16,column:804}},line:16},"3":{name:"_interopRequireDefault",decl:{start:{line:18,column:9},end:{line:18,column:31}},loc:{start:{line:18,column:37},end:{line:18,column:95}},line:18},"4":{name:"(anonymous_4)",decl:{start:{line:22,column:2},end:{line:22,column:3}},loc:{start:{line:22,column:23},end:{line:55,column:3}},line:22},"5":{name:"(anonymous_5)",decl:{start:{line:27,column:12},end:{line:27,column:13}},loc:{start:{line:27,column:23},end:{line:54,column:5}},line:27},"6":{name:"(anonymous_6)",decl:{start:{line:57,column:2},end:{line:57,column:3}},loc:{start:{line:57,column:26},end:{line:79,column:3}},line:57},"7":{name:"(anonymous_7)",decl:{start:{line:65,column:46},end:{line:65,column:47}},loc:{start:{line:65,column:60},end:{line:69,column:5}},line:65},"8":{name:"(anonymous_8)",decl:{start:{line:74,column:12},end:{line:74,column:13}},loc:{start:{line:74,column:19},end:{line:78,column:5}},line:74},"9":{name:"(anonymous_9)",decl:{start:{line:81,column:2},end:{line:81,column:3}},loc:{start:{line:81,column:16},end:{line:88,column:3}},line:81},"10":{name:"(anonymous_10)",decl:{start:{line:82,column:33},end:{line:82,column:34}},loc:{start:{line:82,column:40},end:{line:84,column:5}},line:82},"11":{name:"(anonymous_11)",decl:{start:{line:85,column:75},end:{line:85,column:76}},loc:{start:{line:85,column:82},end:{line:87,column:5}},line:85}},branchMap:{"0":{loc:{start:{line:14,column:49},end:{line:14,column:96}},type:"if",locations:[{start:{line:14,column:49},end:{line:14,column:96}},{start:{line:14,column:49},end:{line:14,column:96}}],line:14},"1":{loc:{start:{line:14,column:241},end:{line:14,column:291}},type:"cond-expr",locations:[{start:{line:14,column:255},end:{line:14,column:271}},{start:{line:14,column:274},end:{line:14,column:291}}],line:14},"2":{loc:{start:{line:16,column:53},end:{line:16,column:111}},type:"if",locations:[{start:{line:16,column:53},end:{line:16,column:111}},{start:{line:16,column:53},end:{line:16,column:111}}],line:16},"3":{loc:{start:{line:16,column:57},end:{line:16,column:94}},type:"binary-expr",locations:[{start:{line:16,column:57},end:{line:16,column:69}},{start:{line:16,column:73},end:{line:16,column:76}},{start:{line:16,column:80},end:{line:16,column:94}}],line:16},"4":{loc:{start:{line:16,column:112},end:{line:16,column:214}},type:"if",locations:[{start:{line:16,column:112},end:{line:16,column:214}},{start:{line:16,column:112},end:{line:16,column:214}}],line:16},"5":{loc:{start:{line:16,column:116},end:{line:16,column:184}},type:"binary-expr",locations:[{start:{line:16,column:116},end:{line:16,column:128}},{start:{line:16,column:132},end:{line:16,column:155}},{start:{line:16,column:159},end:{line:16,column:184}}],line:16},"6":{loc:{start:{line:16,column:266},end:{line:16,column:321}},type:"if",locations:[{start:{line:16,column:266},end:{line:16,column:321}},{start:{line:16,column:266},end:{line:16,column:321}}],line:16},"7":{loc:{start:{line:16,column:270},end:{line:16,column:293}},type:"binary-expr",locations:[{start:{line:16,column:270},end:{line:16,column:275}},{start:{line:16,column:279},end:{line:16,column:293}}],line:16},"8":{loc:{start:{line:16,column:367},end:{line:16,column:423}},type:"binary-expr",locations:[{start:{line:16,column:367},end:{line:16,column:388}},{start:{line:16,column:392},end:{line:16,column:423}}],line:16},"9":{loc:{start:{line:16,column:448},end:{line:16,column:724}},type:"if",locations:[{start:{line:16,column:448},end:{line:16,column:724}},{start:{line:16,column:448},end:{line:16,column:724}}],line:16},"10":{loc:{start:{line:16,column:452},end:{line:16,column:519}},type:"binary-expr",locations:[{start:{line:16,column:452},end:{line:16,column:469}},{start:{line:16,column:473},end:{line:16,column:519}}],line:16},"11":{loc:{start:{line:16,column:534},end:{line:16,column:606}},type:"cond-expr",locations:[{start:{line:16,column:558},end:{line:16,column:599}},{start:{line:16,column:602},end:{line:16,column:606}}],line:16},"12":{loc:{start:{line:16,column:608},end:{line:16,column:722}},type:"if",locations:[{start:{line:16,column:608},end:{line:16,column:722}},{start:{line:16,column:608},end:{line:16,column:722}}],line:16},"13":{loc:{start:{line:16,column:612},end:{line:16,column:642}},type:"binary-expr",locations:[{start:{line:16,column:612},end:{line:16,column:616}},{start:{line:16,column:621},end:{line:16,column:629}},{start:{line:16,column:633},end:{line:16,column:641}}],line:16},"14":{loc:{start:{line:16,column:749},end:{line:16,column:787}},type:"if",locations:[{start:{line:16,column:749},end:{line:16,column:787}},{start:{line:16,column:749},end:{line:16,column:787}}],line:16},"15":{loc:{start:{line:18,column:46},end:{line:18,column:92}},type:"cond-expr",locations:[{start:{line:18,column:70},end:{line:18,column:73}},{start:{line:18,column:76},end:{line:18,column:92}}],line:18},"16":{loc:{start:{line:18,column:46},end:{line:18,column:67}},type:"binary-expr",locations:[{start:{line:18,column:46},end:{line:18,column:49}},{start:{line:18,column:53},end:{line:18,column:67}}],line:18},"17":{loc:{start:{line:28,column:6},end:{line:35,column:7}},type:"if",locations:[{start:{line:28,column:6},end:{line:35,column:7}},{start:{line:28,column:6},end:{line:35,column:7}}],line:28},"18":{loc:{start:{line:39,column:6},end:{line:46,column:7}},type:"if",locations:[{start:{line:39,column:6},end:{line:46,column:7}},{start:{line:39,column:6},end:{line:46,column:7}}],line:39},"19":{loc:{start:{line:39,column:10},end:{line:39,column:72}},type:"binary-expr",locations:[{start:{line:39,column:10},end:{line:39,column:28}},{start:{line:39,column:32},end:{line:39,column:72}}],line:39},"20":{loc:{start:{line:41,column:10},end:{line:44,column:11}},type:"if",locations:[{start:{line:41,column:10},end:{line:44,column:11}},{start:{line:41,column:10},end:{line:44,column:11}}],line:41},"21":{loc:{start:{line:58,column:4},end:{line:60,column:5}},type:"if",locations:[{start:{line:58,column:4},end:{line:60,column:5}},{start:{line:58,column:4},end:{line:60,column:5}}],line:58},"22":{loc:{start:{line:63,column:26},end:{line:63,column:54}},type:"binary-expr",locations:[{start:{line:63,column:26},end:{line:63,column:48}},{start:{line:63,column:52},end:{line:63,column:54}}],line:63},"23":{loc:{start:{line:67,column:36},end:{line:67,column:63}},type:"binary-expr",locations:[{start:{line:67,column:36},end:{line:67,column:54}},{start:{line:67,column:58},end:{line:67,column:63}}],line:67}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0,0],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0]},inputSourceMap:{version:3,sources:["../../src/Routers/GlobalConfigRouter.js"],names:["GlobalConfigRouter","PromiseRouter","getGlobalConfig","req","config","database","find","objectId","limit","then","results","length","response","params","globalConfig","auth","isMaster","masterKeyOnly","undefined","param","updateGlobalConfig","isReadOnly","Parse","Error","OPERATION_FORBIDDEN","body","update","Object","keys","reduce","acc","key","upsert","result","mountRoutes","route","middleware","promiseEnforceMasterKeyAccess"],mappings:"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",sourcesContent:["// global_config.js\nimport Parse from 'parse/node';\nimport PromiseRouter from '../PromiseRouter';\nimport * as middleware from '../middlewares';\n\nexport class GlobalConfigRouter extends PromiseRouter {\n  getGlobalConfig(req) {\n    return req.config.database\n      .find('_GlobalConfig', { objectId: '1' }, { limit: 1 })\n      .then(results => {\n        if (results.length != 1) {\n          // If there is no config in the database - return empty config.\n          return { response: { params: {} } };\n        }\n        const globalConfig = results[0];\n        if (!req.auth.isMaster && globalConfig.masterKeyOnly !== undefined) {\n          for (const param in globalConfig.params) {\n            if (globalConfig.masterKeyOnly[param]) {\n              delete globalConfig.params[param];\n              delete globalConfig.masterKeyOnly[param];\n            }\n          }\n        }\n        return {\n          response: {\n            params: globalConfig.params,\n            masterKeyOnly: globalConfig.masterKeyOnly,\n          },\n        };\n      });\n  }\n\n  updateGlobalConfig(req) {\n    if (req.auth.isReadOnly) {\n      throw new Parse.Error(\n        Parse.Error.OPERATION_FORBIDDEN,\n        \"read-only masterKey isn't allowed to update the config.\"\n      );\n    }\n    const params = req.body.params;\n    const masterKeyOnly = req.body.masterKeyOnly || {};\n    // Transform in dot notation to make sure it works\n    const update = Object.keys(params).reduce((acc, key) => {\n      acc[`params.${key}`] = params[key];\n      acc[`masterKeyOnly.${key}`] = masterKeyOnly[key] || false;\n      return acc;\n    }, {});\n    return req.config.database\n      .update('_GlobalConfig', { objectId: '1' }, update, { upsert: true })\n      .then(() => ({ response: { result: true } }));\n  }\n\n  mountRoutes() {\n    this.route('GET', '/config', req => {\n      return this.getGlobalConfig(req);\n    });\n    this.route('PUT', '/config', middleware.promiseEnforceMasterKeyAccess, req => {\n      return this.updateGlobalConfig(req);\n    });\n  }\n}\n\nexport default GlobalConfigRouter;\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"56ca0824eff21d0fa4c3f7bc389f614dd1e0219b"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_xgm2o4uje=function(){return actualCoverage;};}return actualCoverage;}cov_xgm2o4uje();cov_xgm2o4uje().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_xgm2o4uje().s[1]++;exports.default=exports.GlobalConfigRouter=void 0;var _node=(cov_xgm2o4uje().s[2]++,_interopRequireDefault(require("parse/node")));var _PromiseRouter=(cov_xgm2o4uje().s[3]++,_interopRequireDefault(require("../PromiseRouter")));var middleware=(cov_xgm2o4uje().s[4]++,_interopRequireWildcard(require("../middlewares")));function _getRequireWildcardCache(nodeInterop){cov_xgm2o4uje().f[0]++;cov_xgm2o4uje().s[5]++;if(typeof WeakMap!=="function"){cov_xgm2o4uje().b[0][0]++;cov_xgm2o4uje().s[6]++;return null;}else{cov_xgm2o4uje().b[0][1]++;}var cacheBabelInterop=(cov_xgm2o4uje().s[7]++,new WeakMap());var cacheNodeInterop=(cov_xgm2o4uje().s[8]++,new WeakMap());cov_xgm2o4uje().s[9]++;return(_getRequireWildcardCache=function(nodeInterop){cov_xgm2o4uje().f[1]++;cov_xgm2o4uje().s[10]++;return nodeInterop?(cov_xgm2o4uje().b[1][0]++,cacheNodeInterop):(cov_xgm2o4uje().b[1][1]++,cacheBabelInterop);})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){cov_xgm2o4uje().f[2]++;cov_xgm2o4uje().s[11]++;if((cov_xgm2o4uje().b[3][0]++,!nodeInterop)&&(cov_xgm2o4uje().b[3][1]++,obj)&&(cov_xgm2o4uje().b[3][2]++,obj.__esModule)){cov_xgm2o4uje().b[2][0]++;cov_xgm2o4uje().s[12]++;return obj;}else{cov_xgm2o4uje().b[2][1]++;}cov_xgm2o4uje().s[13]++;if((cov_xgm2o4uje().b[5][0]++,obj===null)||(cov_xgm2o4uje().b[5][1]++,typeof obj!=="object")&&(cov_xgm2o4uje().b[5][2]++,typeof obj!=="function")){cov_xgm2o4uje().b[4][0]++;cov_xgm2o4uje().s[14]++;return{default:obj};}else{cov_xgm2o4uje().b[4][1]++;}var cache=(cov_xgm2o4uje().s[15]++,_getRequireWildcardCache(nodeInterop));cov_xgm2o4uje().s[16]++;if((cov_xgm2o4uje().b[7][0]++,cache)&&(cov_xgm2o4uje().b[7][1]++,cache.has(obj))){cov_xgm2o4uje().b[6][0]++;cov_xgm2o4uje().s[17]++;return cache.get(obj);}else{cov_xgm2o4uje().b[6][1]++;}var newObj=(cov_xgm2o4uje().s[18]++,{});var hasPropertyDescriptor=(cov_xgm2o4uje().s[19]++,(cov_xgm2o4uje().b[8][0]++,Object.defineProperty)&&(cov_xgm2o4uje().b[8][1]++,Object.getOwnPropertyDescriptor));cov_xgm2o4uje().s[20]++;for(var key in obj){cov_xgm2o4uje().s[21]++;if((cov_xgm2o4uje().b[10][0]++,key!=="default")&&(cov_xgm2o4uje().b[10][1]++,Object.prototype.hasOwnProperty.call(obj,key))){cov_xgm2o4uje().b[9][0]++;var desc=(cov_xgm2o4uje().s[22]++,hasPropertyDescriptor?(cov_xgm2o4uje().b[11][0]++,Object.getOwnPropertyDescriptor(obj,key)):(cov_xgm2o4uje().b[11][1]++,null));cov_xgm2o4uje().s[23]++;if((cov_xgm2o4uje().b[13][0]++,desc)&&((cov_xgm2o4uje().b[13][1]++,desc.get)||(cov_xgm2o4uje().b[13][2]++,desc.set))){cov_xgm2o4uje().b[12][0]++;cov_xgm2o4uje().s[24]++;Object.defineProperty(newObj,key,desc);}else{cov_xgm2o4uje().b[12][1]++;cov_xgm2o4uje().s[25]++;newObj[key]=obj[key];}}else{cov_xgm2o4uje().b[9][1]++;}}cov_xgm2o4uje().s[26]++;newObj.default=obj;cov_xgm2o4uje().s[27]++;if(cache){cov_xgm2o4uje().b[14][0]++;cov_xgm2o4uje().s[28]++;cache.set(obj,newObj);}else{cov_xgm2o4uje().b[14][1]++;}cov_xgm2o4uje().s[29]++;return newObj;}function _interopRequireDefault(obj){cov_xgm2o4uje().f[3]++;cov_xgm2o4uje().s[30]++;return(cov_xgm2o4uje().b[16][0]++,obj)&&(cov_xgm2o4uje().b[16][1]++,obj.__esModule)?(cov_xgm2o4uje().b[15][0]++,obj):(cov_xgm2o4uje().b[15][1]++,{default:obj});}// global_config.js
class GlobalConfigRouter extends(_PromiseRouter.default){getGlobalConfig(req){cov_xgm2o4uje().f[4]++;cov_xgm2o4uje().s[31]++;return req.config.database.find('_GlobalConfig',{objectId:'1'},{limit:1}).then(results=>{cov_xgm2o4uje().f[5]++;cov_xgm2o4uje().s[32]++;if(results.length!=1){cov_xgm2o4uje().b[17][0]++;cov_xgm2o4uje().s[33]++;// If there is no config in the database - return empty config.
return{response:{params:{}}};}else{cov_xgm2o4uje().b[17][1]++;}const globalConfig=(cov_xgm2o4uje().s[34]++,results[0]);cov_xgm2o4uje().s[35]++;if((cov_xgm2o4uje().b[19][0]++,!req.auth.isMaster)&&(cov_xgm2o4uje().b[19][1]++,globalConfig.masterKeyOnly!==undefined)){cov_xgm2o4uje().b[18][0]++;cov_xgm2o4uje().s[36]++;for(const param in globalConfig.params){cov_xgm2o4uje().s[37]++;if(globalConfig.masterKeyOnly[param]){cov_xgm2o4uje().b[20][0]++;cov_xgm2o4uje().s[38]++;delete globalConfig.params[param];cov_xgm2o4uje().s[39]++;delete globalConfig.masterKeyOnly[param];}else{cov_xgm2o4uje().b[20][1]++;}}}else{cov_xgm2o4uje().b[18][1]++;}cov_xgm2o4uje().s[40]++;return{response:{params:globalConfig.params,masterKeyOnly:globalConfig.masterKeyOnly}};});}updateGlobalConfig(req){cov_xgm2o4uje().f[6]++;cov_xgm2o4uje().s[41]++;if(req.auth.isReadOnly){cov_xgm2o4uje().b[21][0]++;cov_xgm2o4uje().s[42]++;throw new _node.default.Error(_node.default.Error.OPERATION_FORBIDDEN,"read-only masterKey isn't allowed to update the config.");}else{cov_xgm2o4uje().b[21][1]++;}const params=(cov_xgm2o4uje().s[43]++,req.body.params);const masterKeyOnly=(cov_xgm2o4uje().s[44]++,(cov_xgm2o4uje().b[22][0]++,req.body.masterKeyOnly)||(cov_xgm2o4uje().b[22][1]++,{}));// Transform in dot notation to make sure it works
const update=(cov_xgm2o4uje().s[45]++,Object.keys(params).reduce((acc,key)=>{cov_xgm2o4uje().f[7]++;cov_xgm2o4uje().s[46]++;acc[`params.${key}`]=params[key];cov_xgm2o4uje().s[47]++;acc[`masterKeyOnly.${key}`]=(cov_xgm2o4uje().b[23][0]++,masterKeyOnly[key])||(cov_xgm2o4uje().b[23][1]++,false);cov_xgm2o4uje().s[48]++;return acc;},{}));cov_xgm2o4uje().s[49]++;return req.config.database.update('_GlobalConfig',{objectId:'1'},update,{upsert:true}).then(()=>{cov_xgm2o4uje().f[8]++;cov_xgm2o4uje().s[50]++;return{response:{result:true}};});}mountRoutes(){cov_xgm2o4uje().f[9]++;cov_xgm2o4uje().s[51]++;this.route('GET','/config',req=>{cov_xgm2o4uje().f[10]++;cov_xgm2o4uje().s[52]++;return this.getGlobalConfig(req);});cov_xgm2o4uje().s[53]++;this.route('PUT','/config',middleware.promiseEnforceMasterKeyAccess,req=>{cov_xgm2o4uje().f[11]++;cov_xgm2o4uje().s[54]++;return this.updateGlobalConfig(req);});}}cov_xgm2o4uje().s[55]++;exports.GlobalConfigRouter=GlobalConfigRouter;var _default=(cov_xgm2o4uje().s[56]++,GlobalConfigRouter);cov_xgm2o4uje().s[57]++;exports.default=_default;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Sb3V0ZXJzL0dsb2JhbENvbmZpZ1JvdXRlci5qcyJdLCJuYW1lcyI6WyJHbG9iYWxDb25maWdSb3V0ZXIiLCJQcm9taXNlUm91dGVyIiwiZ2V0R2xvYmFsQ29uZmlnIiwicmVxIiwiY29uZmlnIiwiZGF0YWJhc2UiLCJmaW5kIiwib2JqZWN0SWQiLCJsaW1pdCIsInRoZW4iLCJyZXN1bHRzIiwibGVuZ3RoIiwicmVzcG9uc2UiLCJwYXJhbXMiLCJnbG9iYWxDb25maWciLCJhdXRoIiwiaXNNYXN0ZXIiLCJtYXN0ZXJLZXlPbmx5IiwidW5kZWZpbmVkIiwicGFyYW0iLCJ1cGRhdGVHbG9iYWxDb25maWciLCJpc1JlYWRPbmx5IiwiUGFyc2UiLCJFcnJvciIsIk9QRVJBVElPTl9GT1JCSURERU4iLCJib2R5IiwidXBkYXRlIiwiT2JqZWN0Iiwia2V5cyIsInJlZHVjZSIsImFjYyIsImtleSIsInVwc2VydCIsInJlc3VsdCIsIm1vdW50Um91dGVzIiwicm91dGUiLCJtaWRkbGV3YXJlIiwicHJvbWlzZUVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFIQTtBQUtPLE1BQU1BLGtCQUFOLFNBQWlDQyxzQkFBakMsQ0FBK0M7QUFDcERDLEVBQUFBLGVBQWUsQ0FBQ0MsR0FBRCxFQUFNO0FBQ25CLFdBQU9BLEdBQUcsQ0FBQ0MsTUFBSixDQUFXQyxRQUFYLENBQ0pDLElBREksQ0FDQyxlQURELEVBQ2tCO0FBQUVDLE1BQUFBLFFBQVEsRUFBRTtBQUFaLEtBRGxCLEVBQ3FDO0FBQUVDLE1BQUFBLEtBQUssRUFBRTtBQUFULEtBRHJDLEVBRUpDLElBRkksQ0FFQ0MsT0FBTyxJQUFJO0FBQ2YsVUFBSUEsT0FBTyxDQUFDQyxNQUFSLElBQWtCLENBQXRCLEVBQXlCO0FBQ3ZCO0FBQ0EsZUFBTztBQUFFQyxVQUFBQSxRQUFRLEVBQUU7QUFBRUMsWUFBQUEsTUFBTSxFQUFFO0FBQVY7QUFBWixTQUFQO0FBQ0Q7O0FBQ0QsWUFBTUMsWUFBWSxHQUFHSixPQUFPLENBQUMsQ0FBRCxDQUE1Qjs7QUFDQSxVQUFJLENBQUNQLEdBQUcsQ0FBQ1ksSUFBSixDQUFTQyxRQUFWLElBQXNCRixZQUFZLENBQUNHLGFBQWIsS0FBK0JDLFNBQXpELEVBQW9FO0FBQ2xFLGFBQUssTUFBTUMsS0FBWCxJQUFvQkwsWUFBWSxDQUFDRCxNQUFqQyxFQUF5QztBQUN2QyxjQUFJQyxZQUFZLENBQUNHLGFBQWIsQ0FBMkJFLEtBQTNCLENBQUosRUFBdUM7QUFDckMsbUJBQU9MLFlBQVksQ0FBQ0QsTUFBYixDQUFvQk0sS0FBcEIsQ0FBUDtBQUNBLG1CQUFPTCxZQUFZLENBQUNHLGFBQWIsQ0FBMkJFLEtBQTNCLENBQVA7QUFDRDtBQUNGO0FBQ0Y7O0FBQ0QsYUFBTztBQUNMUCxRQUFBQSxRQUFRLEVBQUU7QUFDUkMsVUFBQUEsTUFBTSxFQUFFQyxZQUFZLENBQUNELE1BRGI7QUFFUkksVUFBQUEsYUFBYSxFQUFFSCxZQUFZLENBQUNHO0FBRnBCO0FBREwsT0FBUDtBQU1ELEtBdEJJLENBQVA7QUF1QkQ7O0FBRURHLEVBQUFBLGtCQUFrQixDQUFDakIsR0FBRCxFQUFNO0FBQ3RCLFFBQUlBLEdBQUcsQ0FBQ1ksSUFBSixDQUFTTSxVQUFiLEVBQXlCO0FBQ3ZCLFlBQU0sSUFBSUMsY0FBTUMsS0FBVixDQUNKRCxjQUFNQyxLQUFOLENBQVlDLG1CQURSLEVBRUoseURBRkksQ0FBTjtBQUlEOztBQUNELFVBQU1YLE1BQU0sR0FBR1YsR0FBRyxDQUFDc0IsSUFBSixDQUFTWixNQUF4QjtBQUNBLFVBQU1JLGFBQWEsR0FBR2QsR0FBRyxDQUFDc0IsSUFBSixDQUFTUixhQUFULElBQTBCLEVBQWhELENBUnNCLENBU3RCOztBQUNBLFVBQU1TLE1BQU0sR0FBR0MsTUFBTSxDQUFDQyxJQUFQLENBQVlmLE1BQVosRUFBb0JnQixNQUFwQixDQUEyQixDQUFDQyxHQUFELEVBQU1DLEdBQU4sS0FBYztBQUN0REQsTUFBQUEsR0FBRyxDQUFFLFVBQVNDLEdBQUksRUFBZixDQUFILEdBQXVCbEIsTUFBTSxDQUFDa0IsR0FBRCxDQUE3QjtBQUNBRCxNQUFBQSxHQUFHLENBQUUsaUJBQWdCQyxHQUFJLEVBQXRCLENBQUgsR0FBOEJkLGFBQWEsQ0FBQ2MsR0FBRCxDQUFiLElBQXNCLEtBQXBEO0FBQ0EsYUFBT0QsR0FBUDtBQUNELEtBSmMsRUFJWixFQUpZLENBQWY7QUFLQSxXQUFPM0IsR0FBRyxDQUFDQyxNQUFKLENBQVdDLFFBQVgsQ0FDSnFCLE1BREksQ0FDRyxlQURILEVBQ29CO0FBQUVuQixNQUFBQSxRQUFRLEVBQUU7QUFBWixLQURwQixFQUN1Q21CLE1BRHZDLEVBQytDO0FBQUVNLE1BQUFBLE1BQU0sRUFBRTtBQUFWLEtBRC9DLEVBRUp2QixJQUZJLENBRUMsT0FBTztBQUFFRyxNQUFBQSxRQUFRLEVBQUU7QUFBRXFCLFFBQUFBLE1BQU0sRUFBRTtBQUFWO0FBQVosS0FBUCxDQUZELENBQVA7QUFHRDs7QUFFREMsRUFBQUEsV0FBVyxHQUFHO0FBQ1osU0FBS0MsS0FBTCxDQUFXLEtBQVgsRUFBa0IsU0FBbEIsRUFBNkJoQyxHQUFHLElBQUk7QUFDbEMsYUFBTyxLQUFLRCxlQUFMLENBQXFCQyxHQUFyQixDQUFQO0FBQ0QsS0FGRDtBQUdBLFNBQUtnQyxLQUFMLENBQVcsS0FBWCxFQUFrQixTQUFsQixFQUE2QkMsVUFBVSxDQUFDQyw2QkFBeEMsRUFBdUVsQyxHQUFHLElBQUk7QUFDNUUsYUFBTyxLQUFLaUIsa0JBQUwsQ0FBd0JqQixHQUF4QixDQUFQO0FBQ0QsS0FGRDtBQUdEOztBQXREbUQ7OztlQXlEdkNILGtCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gZ2xvYmFsX2NvbmZpZy5qc1xuaW1wb3J0IFBhcnNlIGZyb20gJ3BhcnNlL25vZGUnO1xuaW1wb3J0IFByb21pc2VSb3V0ZXIgZnJvbSAnLi4vUHJvbWlzZVJvdXRlcic7XG5pbXBvcnQgKiBhcyBtaWRkbGV3YXJlIGZyb20gJy4uL21pZGRsZXdhcmVzJztcblxuZXhwb3J0IGNsYXNzIEdsb2JhbENvbmZpZ1JvdXRlciBleHRlbmRzIFByb21pc2VSb3V0ZXIge1xuICBnZXRHbG9iYWxDb25maWcocmVxKSB7XG4gICAgcmV0dXJuIHJlcS5jb25maWcuZGF0YWJhc2VcbiAgICAgIC5maW5kKCdfR2xvYmFsQ29uZmlnJywgeyBvYmplY3RJZDogJzEnIH0sIHsgbGltaXQ6IDEgfSlcbiAgICAgIC50aGVuKHJlc3VsdHMgPT4ge1xuICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggIT0gMSkge1xuICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIGNvbmZpZyBpbiB0aGUgZGF0YWJhc2UgLSByZXR1cm4gZW1wdHkgY29uZmlnLlxuICAgICAgICAgIHJldHVybiB7IHJlc3BvbnNlOiB7IHBhcmFtczoge30gfSB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGdsb2JhbENvbmZpZyA9IHJlc3VsdHNbMF07XG4gICAgICAgIGlmICghcmVxLmF1dGguaXNNYXN0ZXIgJiYgZ2xvYmFsQ29uZmlnLm1hc3RlcktleU9ubHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGZvciAoY29uc3QgcGFyYW0gaW4gZ2xvYmFsQ29uZmlnLnBhcmFtcykge1xuICAgICAgICAgICAgaWYgKGdsb2JhbENvbmZpZy5tYXN0ZXJLZXlPbmx5W3BhcmFtXSkge1xuICAgICAgICAgICAgICBkZWxldGUgZ2xvYmFsQ29uZmlnLnBhcmFtc1twYXJhbV07XG4gICAgICAgICAgICAgIGRlbGV0ZSBnbG9iYWxDb25maWcubWFzdGVyS2V5T25seVtwYXJhbV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcmVzcG9uc2U6IHtcbiAgICAgICAgICAgIHBhcmFtczogZ2xvYmFsQ29uZmlnLnBhcmFtcyxcbiAgICAgICAgICAgIG1hc3RlcktleU9ubHk6IGdsb2JhbENvbmZpZy5tYXN0ZXJLZXlPbmx5LFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZUdsb2JhbENvbmZpZyhyZXEpIHtcbiAgICBpZiAocmVxLmF1dGguaXNSZWFkT25seSkge1xuICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgICBQYXJzZS5FcnJvci5PUEVSQVRJT05fRk9SQklEREVOLFxuICAgICAgICBcInJlYWQtb25seSBtYXN0ZXJLZXkgaXNuJ3QgYWxsb3dlZCB0byB1cGRhdGUgdGhlIGNvbmZpZy5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgcGFyYW1zID0gcmVxLmJvZHkucGFyYW1zO1xuICAgIGNvbnN0IG1hc3RlcktleU9ubHkgPSByZXEuYm9keS5tYXN0ZXJLZXlPbmx5IHx8IHt9O1xuICAgIC8vIFRyYW5zZm9ybSBpbiBkb3Qgbm90YXRpb24gdG8gbWFrZSBzdXJlIGl0IHdvcmtzXG4gICAgY29uc3QgdXBkYXRlID0gT2JqZWN0LmtleXMocGFyYW1zKS5yZWR1Y2UoKGFjYywga2V5KSA9PiB7XG4gICAgICBhY2NbYHBhcmFtcy4ke2tleX1gXSA9IHBhcmFtc1trZXldO1xuICAgICAgYWNjW2BtYXN0ZXJLZXlPbmx5LiR7a2V5fWBdID0gbWFzdGVyS2V5T25seVtrZXldIHx8IGZhbHNlO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSk7XG4gICAgcmV0dXJuIHJlcS5jb25maWcuZGF0YWJhc2VcbiAgICAgIC51cGRhdGUoJ19HbG9iYWxDb25maWcnLCB7IG9iamVjdElkOiAnMScgfSwgdXBkYXRlLCB7IHVwc2VydDogdHJ1ZSB9KVxuICAgICAgLnRoZW4oKCkgPT4gKHsgcmVzcG9uc2U6IHsgcmVzdWx0OiB0cnVlIH0gfSkpO1xuICB9XG5cbiAgbW91bnRSb3V0ZXMoKSB7XG4gICAgdGhpcy5yb3V0ZSgnR0VUJywgJy9jb25maWcnLCByZXEgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0R2xvYmFsQ29uZmlnKHJlcSk7XG4gICAgfSk7XG4gICAgdGhpcy5yb3V0ZSgnUFVUJywgJy9jb25maWcnLCBtaWRkbGV3YXJlLnByb21pc2VFbmZvcmNlTWFzdGVyS2V5QWNjZXNzLCByZXEgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMudXBkYXRlR2xvYmFsQ29uZmlnKHJlcSk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgR2xvYmFsQ29uZmlnUm91dGVyO1xuIl19
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Sb3V0ZXJzL0dsb2JhbENvbmZpZ1JvdXRlci5qcyJdLCJuYW1lcyI6WyJQcm9taXNlUm91dGVyIiwiZ2V0R2xvYmFsQ29uZmlnIiwib2JqZWN0SWQiLCJsaW1pdCIsInJlc3VsdHMiLCJyZXNwb25zZSIsInBhcmFtcyIsImdsb2JhbENvbmZpZyIsInJlcSIsIm1hc3RlcktleU9ubHkiLCJ1cGRhdGVHbG9iYWxDb25maWciLCJQYXJzZSIsInVwZGF0ZSIsImFjYyIsImtleSIsInVwc2VydCIsInJlc3VsdCIsIm1vdW50Um91dGVzIiwibWlkZGxld2FyZSIsIkdsb2JhbENvbmZpZ1JvdXRlciJdLCJtYXBwaW5ncyI6IjtrUEFDQSxHQUFBLENBQUEsS0FBQSx5QkFBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxZQUFBLENBQUEsQ0FBQSxDQUFBLENBQ0EsR0FBQSxDQUFBLGNBQUEseUJBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsa0JBQUEsQ0FBQSxDQUFBLENBQUEsQ0FDQSxHQUFBLENBQUEsVUFBQSx5QkFBQSx1QkFBQSxDQUFBLE9BQUEsQ0FBQSxnQkFBQSxDQUFBLENBQUEsQ0FBQSxDLDJ5RkFIQTtBQUtPLEtBQUEsQ0FBQSxrQkFBQSxTQUFpQ0EsY0FBQUEsQ0FBakMsT0FBQSxDQUErQyxDQUNwREMsZUFBZSxDQUFBLEdBQUEsQ0FBTSxnREFDbkIsTUFBTyxDQUFBLEdBQUcsQ0FBSCxNQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxlQUFBLENBQ2tCLENBQUVDLFFBQVEsQ0FBRSxHQUFaLENBRGxCLENBQ3FDLENBQUVDLEtBQUssQ0FBRSxDQUFULENBRHJDLEVBQUEsSUFBQSxDQUVDQyxPQUFPLEVBQUksZ0RBQ2YsR0FBSUEsT0FBTyxDQUFQQSxNQUFBQSxFQUFKLENBQUEsQ0FBeUIsb0RBQ3ZCO0FBQ0EsTUFBTyxDQUFFQyxRQUFRLENBQUUsQ0FBRUMsTUFBTSxDQUFFLEVBQVYsQ0FBWixDQUFQLENBQ0QsQ0FIRCxpQ0FJQSxLQUFNQyxDQUFBQSxZQUFZLDBCQUFHSCxPQUFPLENBQTVCLENBQTRCLENBQVYsQ0FBbEIsQ0FMZSx3QkFNZixHQUFJLDZCQUFDSSxHQUFHLENBQUhBLElBQUFBLENBQUQsUUFBQSwrQkFBc0JELFlBQVksQ0FBWkEsYUFBQUEsR0FBMUIsU0FBSSxDQUFKLENBQW9FLG9EQUNsRSxJQUFLLEtBQUwsQ0FBQSxLQUFBLEdBQW9CQSxDQUFBQSxZQUFZLENBQWhDLE1BQUEsQ0FBeUMseUJBQ3ZDLEdBQUlBLFlBQVksQ0FBWkEsYUFBQUEsQ0FBSixLQUFJQSxDQUFKLENBQXVDLG9EQUNyQyxNQUFPQSxDQUFBQSxZQUFZLENBQVpBLE1BQUFBLENBQVAsS0FBT0EsQ0FBUCxDQURxQyx3QkFFckMsTUFBT0EsQ0FBQUEsWUFBWSxDQUFaQSxhQUFBQSxDQUFQLEtBQU9BLENBQVAsQ0FDRCxDQUhELGlDQUlELENBQ0YsQ0FQRCxpQ0FOZSx3QkFjZixNQUFPLENBQ0xGLFFBQVEsQ0FBRSxDQUNSQyxNQUFNLENBQUVDLFlBQVksQ0FEWixNQUFBLENBRVJFLGFBQWEsQ0FBRUYsWUFBWSxDQUFDRSxhQUZwQixDQURMLENBQVAsQ0FoQkosQ0FBTyxDQUFQLENBdUJELENBRURDLGtCQUFrQixDQUFBLEdBQUEsQ0FBTSxnREFDdEIsR0FBSUYsR0FBRyxDQUFIQSxJQUFBQSxDQUFKLFVBQUEsQ0FBeUIsb0RBQ3ZCLEtBQU0sSUFBSUcsQ0FBQUEsS0FBQUEsQ0FBQUEsT0FBQUEsQ0FBSixLQUFBLENBQ0pBLEtBQUFBLENBQUFBLE9BQUFBLENBQUFBLEtBQUFBLENBREksbUJBQUEsQ0FBTix5REFBTSxDQUFOLENBSUQsQ0FMRCxpQ0FNQSxLQUFNTCxDQUFBQSxNQUFNLDBCQUFHRSxHQUFHLENBQUhBLElBQUFBLENBQWYsTUFBWSxDQUFaLENBQ0EsS0FBTUMsQ0FBQUEsYUFBYSwwQkFBR0QsNEJBQUFBLEdBQUcsQ0FBSEEsSUFBQUEsQ0FBQUEsYUFBQUEsK0JBUkEsRUFRQUEsQ0FBSCxDQUFuQixDQUNBO0FBQ0EsS0FBTUksQ0FBQUEsTUFBTSwwQkFBRyxNQUFNLENBQU4sSUFBQSxDQUFBLE1BQUEsRUFBQSxNQUFBLENBQTJCLENBQUEsR0FBQSxDQUFBLEdBQUEsR0FBYyxnREFDdERDLEdBQUcsQ0FBRSxVQUFTQyxHQUFkRCxFQUFHLENBQUhBLENBQXVCUCxNQUFNLENBQTdCTyxHQUE2QixDQUE3QkEsQ0FEc0Qsd0JBRXREQSxHQUFHLENBQUUsaUJBQWdCQyxHQUFyQkQsRUFBRyxDQUFIQSxDQUE4QkosNEJBQUFBLGFBQWEsQ0FBYkEsR0FBYSxDQUFiQSwrQkFBOUJJLEtBQThCSixDQUE5QkksQ0FGc0Qsd0JBR3RELE1BQUEsQ0FBQSxHQUFBLENBSGEsQ0FBQSxDQUFmLEVBQWUsQ0FBSCxDQUFaLENBVnNCLHdCQWV0QixNQUFPLENBQUEsR0FBRyxDQUFILE1BQUEsQ0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLGVBQUEsQ0FDb0IsQ0FBRVgsUUFBUSxDQUFFLEdBQVosQ0FEcEIsQ0FBQSxNQUFBLENBQytDLENBQUVhLE1BQU0sQ0FBRSxJQUFWLENBRC9DLEVBQUEsSUFBQSxDQUVDLElBQU8sdURBQUVWLFFBQVEsQ0FBRSxDQUFFVyxNQUFNLENBQUUsSUFBVixDQUFaLEVBRmYsQ0FBTyxDQUFQLENBR0QsQ0FFREMsV0FBVyxFQUFHLGdEQUNaLEtBQUEsS0FBQSxDQUFBLEtBQUEsQ0FBQSxTQUFBLENBQTZCVCxHQUFHLEVBQUksaURBQ2xDLE1BQU8sTUFBQSxlQUFBLENBQVAsR0FBTyxDQUFQLENBREYsQ0FBQSxFQURZLHdCQUlaLEtBQUEsS0FBQSxDQUFBLEtBQUEsQ0FBQSxTQUFBLENBQTZCVSxVQUFVLENBQXZDLDZCQUFBLENBQXVFVixHQUFHLEVBQUksaURBQzVFLE1BQU8sTUFBQSxrQkFBQSxDQUFQLEdBQU8sQ0FBUCxDQURGLENBQUEsRUFHRCxDQXREbUQsQyw0R0F5RHZDVyxrQiIsInNvdXJjZXNDb250ZW50IjpbIi8vIGdsb2JhbF9jb25maWcuanNcbmltcG9ydCBQYXJzZSBmcm9tICdwYXJzZS9ub2RlJztcbmltcG9ydCBQcm9taXNlUm91dGVyIGZyb20gJy4uL1Byb21pc2VSb3V0ZXInO1xuaW1wb3J0ICogYXMgbWlkZGxld2FyZSBmcm9tICcuLi9taWRkbGV3YXJlcyc7XG5cbmV4cG9ydCBjbGFzcyBHbG9iYWxDb25maWdSb3V0ZXIgZXh0ZW5kcyBQcm9taXNlUm91dGVyIHtcbiAgZ2V0R2xvYmFsQ29uZmlnKHJlcSkge1xuICAgIHJldHVybiByZXEuY29uZmlnLmRhdGFiYXNlXG4gICAgICAuZmluZCgnX0dsb2JhbENvbmZpZycsIHsgb2JqZWN0SWQ6ICcxJyB9LCB7IGxpbWl0OiAxIH0pXG4gICAgICAudGhlbihyZXN1bHRzID0+IHtcbiAgICAgICAgaWYgKHJlc3VsdHMubGVuZ3RoICE9IDEpIHtcbiAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBjb25maWcgaW4gdGhlIGRhdGFiYXNlIC0gcmV0dXJuIGVtcHR5IGNvbmZpZy5cbiAgICAgICAgICByZXR1cm4geyByZXNwb25zZTogeyBwYXJhbXM6IHt9IH0gfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBnbG9iYWxDb25maWcgPSByZXN1bHRzWzBdO1xuICAgICAgICBpZiAoIXJlcS5hdXRoLmlzTWFzdGVyICYmIGdsb2JhbENvbmZpZy5tYXN0ZXJLZXlPbmx5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IHBhcmFtIGluIGdsb2JhbENvbmZpZy5wYXJhbXMpIHtcbiAgICAgICAgICAgIGlmIChnbG9iYWxDb25maWcubWFzdGVyS2V5T25seVtwYXJhbV0pIHtcbiAgICAgICAgICAgICAgZGVsZXRlIGdsb2JhbENvbmZpZy5wYXJhbXNbcGFyYW1dO1xuICAgICAgICAgICAgICBkZWxldGUgZ2xvYmFsQ29uZmlnLm1hc3RlcktleU9ubHlbcGFyYW1dO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHJlc3BvbnNlOiB7XG4gICAgICAgICAgICBwYXJhbXM6IGdsb2JhbENvbmZpZy5wYXJhbXMsXG4gICAgICAgICAgICBtYXN0ZXJLZXlPbmx5OiBnbG9iYWxDb25maWcubWFzdGVyS2V5T25seSxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gIH1cblxuICB1cGRhdGVHbG9iYWxDb25maWcocmVxKSB7XG4gICAgaWYgKHJlcS5hdXRoLmlzUmVhZE9ubHkpIHtcbiAgICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgICAgUGFyc2UuRXJyb3IuT1BFUkFUSU9OX0ZPUkJJRERFTixcbiAgICAgICAgXCJyZWFkLW9ubHkgbWFzdGVyS2V5IGlzbid0IGFsbG93ZWQgdG8gdXBkYXRlIHRoZSBjb25maWcuXCJcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtcyA9IHJlcS5ib2R5LnBhcmFtcztcbiAgICBjb25zdCBtYXN0ZXJLZXlPbmx5ID0gcmVxLmJvZHkubWFzdGVyS2V5T25seSB8fCB7fTtcbiAgICAvLyBUcmFuc2Zvcm0gaW4gZG90IG5vdGF0aW9uIHRvIG1ha2Ugc3VyZSBpdCB3b3Jrc1xuICAgIGNvbnN0IHVwZGF0ZSA9IE9iamVjdC5rZXlzKHBhcmFtcykucmVkdWNlKChhY2MsIGtleSkgPT4ge1xuICAgICAgYWNjW2BwYXJhbXMuJHtrZXl9YF0gPSBwYXJhbXNba2V5XTtcbiAgICAgIGFjY1tgbWFzdGVyS2V5T25seS4ke2tleX1gXSA9IG1hc3RlcktleU9ubHlba2V5XSB8fCBmYWxzZTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuICAgIHJldHVybiByZXEuY29uZmlnLmRhdGFiYXNlXG4gICAgICAudXBkYXRlKCdfR2xvYmFsQ29uZmlnJywgeyBvYmplY3RJZDogJzEnIH0sIHVwZGF0ZSwgeyB1cHNlcnQ6IHRydWUgfSlcbiAgICAgIC50aGVuKCgpID0+ICh7IHJlc3BvbnNlOiB7IHJlc3VsdDogdHJ1ZSB9IH0pKTtcbiAgfVxuXG4gIG1vdW50Um91dGVzKCkge1xuICAgIHRoaXMucm91dGUoJ0dFVCcsICcvY29uZmlnJywgcmVxID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmdldEdsb2JhbENvbmZpZyhyZXEpO1xuICAgIH0pO1xuICAgIHRoaXMucm91dGUoJ1BVVCcsICcvY29uZmlnJywgbWlkZGxld2FyZS5wcm9taXNlRW5mb3JjZU1hc3RlcktleUFjY2VzcywgcmVxID0+IHtcbiAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUdsb2JhbENvbmZpZyhyZXEpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdsb2JhbENvbmZpZ1JvdXRlcjtcbiJdfQ==