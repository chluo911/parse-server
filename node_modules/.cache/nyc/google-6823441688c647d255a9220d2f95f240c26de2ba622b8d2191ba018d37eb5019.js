'use strict';// Helper functions for accessing the google API.
function cov_1s0qj2s22n(){var path="/parse-server/lib/Adapters/Auth/google.js";var hash="d7ec3a58442ca46bab4e13b741982ae89bee3347";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Adapters/Auth/google.js",statementMap:{"0":{start:{line:3,column:12},end:{line:3,column:39}},"1":{start:{line:5,column:14},end:{line:5,column:30}},"2":{start:{line:7,column:12},end:{line:7,column:35}},"3":{start:{line:9,column:21},end:{line:9,column:42}},"4":{start:{line:10,column:27},end:{line:10,column:56}},"5":{start:{line:11,column:12},end:{line:11,column:14}},"6":{start:{line:14,column:2},end:{line:16,column:3}},"7":{start:{line:15,column:4},end:{line:15,column:24}},"8":{start:{line:18,column:2},end:{line:49,column:5}},"9":{start:{line:19,column:4},end:{line:48,column:27}},"10":{start:{line:20,column:17},end:{line:20,column:19}},"11":{start:{line:21,column:6},end:{line:23,column:9}},"12":{start:{line:22,column:8},end:{line:22,column:39}},"13":{start:{line:24,column:6},end:{line:47,column:9}},"14":{start:{line:27,column:12},end:{line:27,column:28}},"15":{start:{line:28,column:21},end:{line:34,column:15}},"16":{start:{line:32,column:14},end:{line:34,column:10}},"17":{start:{line:36,column:8},end:{line:44,column:9}},"18":{start:{line:37,column:23},end:{line:37,column:77}},"19":{start:{line:39,column:10},end:{line:43,column:11}},"20":{start:{line:40,column:12},end:{line:42,column:15}},"21":{start:{line:46,column:8},end:{line:46,column:29}},"22":{start:{line:53,column:23},end:{line:55,column:4}},"23":{start:{line:57,column:2},end:{line:59,column:3}},"24":{start:{line:58,column:4},end:{line:58,column:97}},"25":{start:{line:61,column:2},end:{line:61,column:29}},"26":{start:{line:70,column:2},end:{line:72,column:3}},"27":{start:{line:71,column:4},end:{line:71,column:94}},"28":{start:{line:77,column:6},end:{line:77,column:31}},"29":{start:{line:79,column:20},end:{line:79,column:52}},"30":{start:{line:81,column:2},end:{line:89,column:3}},"31":{start:{line:82,column:4},end:{line:85,column:7}},"32":{start:{line:87,column:20},end:{line:87,column:37}},"33":{start:{line:88,column:4},end:{line:88,column:70}},"34":{start:{line:91,column:2},end:{line:93,column:3}},"35":{start:{line:92,column:4},end:{line:92,column:177}},"36":{start:{line:95,column:2},end:{line:97,column:3}},"37":{start:{line:96,column:4},end:{line:96,column:95}},"38":{start:{line:99,column:2},end:{line:101,column:3}},"39":{start:{line:100,column:4},end:{line:100,column:102}},"40":{start:{line:103,column:2},end:{line:103,column:19}},"41":{start:{line:108,column:2},end:{line:108,column:42}},"42":{start:{line:113,column:2},end:{line:113,column:27}},"43":{start:{line:116,column:0},end:{line:119,column:2}},"44":{start:{line:122,column:18},end:{line:122,column:50}},"45":{start:{line:123,column:19},end:{line:123,column:52}},"46":{start:{line:124,column:21},end:{line:124,column:58}},"47":{start:{line:125,column:22},end:{line:125,column:60}},"48":{start:{line:126,column:17},end:{line:126,column:38}},"49":{start:{line:127,column:17},end:{line:127,column:39}},"50":{start:{line:128,column:24},end:{line:128,column:47}},"51":{start:{line:129,column:24},end:{line:129,column:47}},"52":{start:{line:130,column:24},end:{line:130,column:194}},"53":{start:{line:131,column:14},end:{line:131,column:65}},"54":{start:{line:132,column:12},end:{line:132,column:46}},"55":{start:{line:133,column:2},end:{line:133,column:47}},"56":{start:{line:134,column:2},end:{line:134,column:44}},"57":{start:{line:135,column:2},end:{line:135,column:13}},"58":{start:{line:139,column:14},end:{line:139,column:23}},"59":{start:{line:141,column:2},end:{line:143,column:3}},"60":{start:{line:142,column:4},end:{line:142,column:25}},"61":{start:{line:145,column:2},end:{line:145,column:16}},"62":{start:{line:149,column:15},end:{line:149,column:34}},"63":{start:{line:151,column:2},end:{line:153,column:3}},"64":{start:{line:152,column:4},end:{line:152,column:22}},"65":{start:{line:155,column:2},end:{line:155,column:14}},"66":{start:{line:159,column:2},end:{line:161,column:3}},"67":{start:{line:160,column:4},end:{line:160,column:20}},"68":{start:{line:163,column:15},end:{line:163,column:23}},"69":{start:{line:164,column:29},end:{line:164,column:50}},"70":{start:{line:165,column:2},end:{line:165,column:42}}},fnMap:{"0":{name:"getGoogleKeyByKeyId",decl:{start:{line:13,column:9},end:{line:13,column:28}},loc:{start:{line:13,column:36},end:{line:50,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:21},end:{line:18,column:22}},loc:{start:{line:18,column:42},end:{line:49,column:3}},line:18},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:60},end:{line:19,column:61}},loc:{start:{line:19,column:67},end:{line:48,column:5}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:21,column:21},end:{line:21,column:22}},loc:{start:{line:21,column:30},end:{line:23,column:7}},line:21},"4":{name:"(anonymous_4)",decl:{start:{line:24,column:20},end:{line:24,column:21}},loc:{start:{line:24,column:26},end:{line:47,column:7}},line:24},"5":{name:"(anonymous_5)",decl:{start:{line:28,column:33},end:{line:28,column:34}},loc:{start:{line:32,column:14},end:{line:34,column:10}},line:32},"6":{name:"getHeaderFromToken",decl:{start:{line:52,column:9},end:{line:52,column:27}},loc:{start:{line:52,column:35},end:{line:62,column:1}},line:52},"7":{name:"verifyIdToken",decl:{start:{line:64,column:15},end:{line:64,column:28}},loc:{start:{line:69,column:3},end:{line:104,column:1}},line:69},"8":{name:"validateAuthData",decl:{start:{line:107,column:9},end:{line:107,column:25}},loc:{start:{line:107,column:50},end:{line:109,column:1}},line:107},"9":{name:"validateAppId",decl:{start:{line:112,column:9},end:{line:112,column:22}},loc:{start:{line:112,column:25},end:{line:114,column:1}},line:112},"10":{name:"rsaPublicKeyToPEM",decl:{start:{line:121,column:9},end:{line:121,column:26}},loc:{start:{line:121,column:52},end:{line:136,column:1}},line:121},"11":{name:"prepadSigned",decl:{start:{line:138,column:9},end:{line:138,column:21}},loc:{start:{line:138,column:30},end:{line:146,column:1}},line:138},"12":{name:"toHex",decl:{start:{line:148,column:9},end:{line:148,column:14}},loc:{start:{line:148,column:23},end:{line:156,column:1}},line:148},"13":{name:"encodeLengthHex",decl:{start:{line:158,column:9},end:{line:158,column:24}},loc:{start:{line:158,column:28},end:{line:166,column:1}},line:158}},branchMap:{"0":{loc:{start:{line:14,column:2},end:{line:16,column:3}},type:"if",locations:[{start:{line:14,column:2},end:{line:16,column:3}},{start:{line:14,column:2},end:{line:16,column:3}}],line:14},"1":{loc:{start:{line:14,column:6},end:{line:14,column:50}},type:"binary-expr",locations:[{start:{line:14,column:6},end:{line:14,column:18}},{start:{line:14,column:22},end:{line:14,column:50}}],line:14},"2":{loc:{start:{line:36,column:8},end:{line:44,column:9}},type:"if",locations:[{start:{line:36,column:8},end:{line:44,column:9}},{start:{line:36,column:8},end:{line:44,column:9}}],line:36},"3":{loc:{start:{line:39,column:10},end:{line:43,column:11}},type:"if",locations:[{start:{line:39,column:10},end:{line:43,column:11}},{start:{line:39,column:10},end:{line:43,column:11}}],line:39},"4":{loc:{start:{line:57,column:2},end:{line:59,column:3}},type:"if",locations:[{start:{line:57,column:2},end:{line:59,column:3}},{start:{line:57,column:2},end:{line:59,column:3}}],line:57},"5":{loc:{start:{line:70,column:2},end:{line:72,column:3}},type:"if",locations:[{start:{line:70,column:2},end:{line:72,column:3}},{start:{line:70,column:2},end:{line:72,column:3}}],line:70},"6":{loc:{start:{line:91,column:2},end:{line:93,column:3}},type:"if",locations:[{start:{line:91,column:2},end:{line:93,column:3}},{start:{line:91,column:2},end:{line:93,column:3}}],line:91},"7":{loc:{start:{line:91,column:6},end:{line:91,column:76}},type:"binary-expr",locations:[{start:{line:91,column:6},end:{line:91,column:36}},{start:{line:91,column:40},end:{line:91,column:76}}],line:91},"8":{loc:{start:{line:95,column:2},end:{line:97,column:3}},type:"if",locations:[{start:{line:95,column:2},end:{line:97,column:3}},{start:{line:95,column:2},end:{line:97,column:3}}],line:95},"9":{loc:{start:{line:99,column:2},end:{line:101,column:3}},type:"if",locations:[{start:{line:99,column:2},end:{line:101,column:3}},{start:{line:99,column:2},end:{line:101,column:3}}],line:99},"10":{loc:{start:{line:99,column:6},end:{line:99,column:44}},type:"binary-expr",locations:[{start:{line:99,column:6},end:{line:99,column:14}},{start:{line:99,column:18},end:{line:99,column:44}}],line:99},"11":{loc:{start:{line:107,column:36},end:{line:107,column:48}},type:"default-arg",locations:[{start:{line:107,column:46},end:{line:107,column:48}}],line:107},"12":{loc:{start:{line:141,column:2},end:{line:143,column:3}},type:"if",locations:[{start:{line:141,column:2},end:{line:143,column:3}},{start:{line:141,column:2},end:{line:143,column:3}}],line:141},"13":{loc:{start:{line:141,column:6},end:{line:141,column:28}},type:"binary-expr",locations:[{start:{line:141,column:6},end:{line:141,column:15}},{start:{line:141,column:19},end:{line:141,column:28}}],line:141},"14":{loc:{start:{line:151,column:2},end:{line:153,column:3}},type:"if",locations:[{start:{line:151,column:2},end:{line:153,column:3}},{start:{line:151,column:2},end:{line:153,column:3}}],line:151},"15":{loc:{start:{line:159,column:2},end:{line:161,column:3}},type:"if",locations:[{start:{line:159,column:2},end:{line:161,column:3}},{start:{line:159,column:2},end:{line:161,column:3}}],line:159}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},inputSourceMap:{version:3,sources:["../../../src/Adapters/Auth/google.js"],names:["Parse","require","https","jwt","TOKEN_ISSUER","HTTPS_TOKEN_ISSUER","cache","getGoogleKeyByKeyId","keyId","expiresAt","Date","Promise","resolve","reject","get","res","data","on","chunk","toString","keys","JSON","parse","pems","reduce","n","modulus","e","exposant","kid","Object","assign","rsaPublicKeyToPEM","headers","expire","match","getTime","Number","getHeaderFromToken","token","decodedToken","decode","complete","Error","OBJECT_NOT_FOUND","header","verifyIdToken","id_token","id","clientId","alg","algorithm","jwtClaims","googleKey","verify","algorithms","audience","exception","message","iss","sub","aud","validateAuthData","authData","options","validateAppId","module","exports","modulusB64","exponentB64","Buffer","exponent","modulusHex","prepadSigned","exponentHex","modlen","length","explen","encodedModlen","encodeLengthHex","encodedExplen","encodedPubkey","der","pem","join","hexStr","msb","toHex","number","nstr","nHex","lengthOfLengthByte"],mappings:"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",sourcesContent:["'use strict';\n\n// Helper functions for accessing the google API.\nvar Parse = require('parse/node').Parse;\n\nconst https = require('https');\nconst jwt = require('jsonwebtoken');\n\nconst TOKEN_ISSUER = 'accounts.google.com';\nconst HTTPS_TOKEN_ISSUER = 'https://accounts.google.com';\n\nlet cache = {};\n\n// Retrieve Google Signin Keys (with cache control)\nfunction getGoogleKeyByKeyId(keyId) {\n  if (cache[keyId] && cache.expiresAt > new Date()) {\n    return cache[keyId];\n  }\n\n  return new Promise((resolve, reject) => {\n    https\n      .get(`https://www.googleapis.com/oauth2/v3/certs`, res => {\n        let data = '';\n        res.on('data', chunk => {\n          data += chunk.toString('utf8');\n        });\n        res.on('end', () => {\n          const { keys } = JSON.parse(data);\n          const pems = keys.reduce(\n            (pems, { n: modulus, e: exposant, kid }) =>\n              Object.assign(pems, {\n                [kid]: rsaPublicKeyToPEM(modulus, exposant),\n              }),\n            {}\n          );\n\n          if (res.headers['cache-control']) {\n            var expire = res.headers['cache-control'].match(/max-age=([0-9]+)/);\n\n            if (expire) {\n              cache = Object.assign({}, pems, {\n                expiresAt: new Date(new Date().getTime() + Number(expire[1]) * 1000),\n              });\n            }\n          }\n\n          resolve(pems[keyId]);\n        });\n      })\n      .on('error', reject);\n  });\n}\n\nfunction getHeaderFromToken(token) {\n  const decodedToken = jwt.decode(token, { complete: true });\n\n  if (!decodedToken) {\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `provided token does not decode as JWT`);\n  }\n\n  return decodedToken.header;\n}\n\nasync function verifyIdToken({ id_token: token, id }, { clientId }) {\n  if (!token) {\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `id token is invalid for this user.`);\n  }\n\n  const { kid: keyId, alg: algorithm } = getHeaderFromToken(token);\n  let jwtClaims;\n  const googleKey = await getGoogleKeyByKeyId(keyId);\n\n  try {\n    jwtClaims = jwt.verify(token, googleKey, {\n      algorithms: algorithm,\n      audience: clientId,\n    });\n  } catch (exception) {\n    const message = exception.message;\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `${message}`);\n  }\n\n  if (jwtClaims.iss !== TOKEN_ISSUER && jwtClaims.iss !== HTTPS_TOKEN_ISSUER) {\n    throw new Parse.Error(\n      Parse.Error.OBJECT_NOT_FOUND,\n      `id token not issued by correct provider - expected: ${TOKEN_ISSUER} or ${HTTPS_TOKEN_ISSUER} | from: ${jwtClaims.iss}`\n    );\n  }\n\n  if (jwtClaims.sub !== id) {\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `auth data is invalid for this user.`);\n  }\n\n  if (clientId && jwtClaims.aud !== clientId) {\n    throw new Parse.Error(\n      Parse.Error.OBJECT_NOT_FOUND,\n      `id token not authorized for this clientId.`\n    );\n  }\n\n  return jwtClaims;\n}\n\n// Returns a promise that fulfills if this user id is valid.\nfunction validateAuthData(authData, options = {}) {\n  return verifyIdToken(authData, options);\n}\n\n// Returns a promise that fulfills if this app id is valid.\nfunction validateAppId() {\n  return Promise.resolve();\n}\n\nmodule.exports = {\n  validateAppId: validateAppId,\n  validateAuthData: validateAuthData,\n};\n\n// Helpers functions to convert the RSA certs to PEM (from jwks-rsa)\nfunction rsaPublicKeyToPEM(modulusB64, exponentB64) {\n  const modulus = new Buffer(modulusB64, 'base64');\n  const exponent = new Buffer(exponentB64, 'base64');\n  const modulusHex = prepadSigned(modulus.toString('hex'));\n  const exponentHex = prepadSigned(exponent.toString('hex'));\n  const modlen = modulusHex.length / 2;\n  const explen = exponentHex.length / 2;\n\n  const encodedModlen = encodeLengthHex(modlen);\n  const encodedExplen = encodeLengthHex(explen);\n  const encodedPubkey =\n    '30' +\n    encodeLengthHex(modlen + explen + encodedModlen.length / 2 + encodedExplen.length / 2 + 2) +\n    '02' +\n    encodedModlen +\n    modulusHex +\n    '02' +\n    encodedExplen +\n    exponentHex;\n\n  const der = new Buffer(encodedPubkey, 'hex').toString('base64');\n\n  let pem = '-----BEGIN RSA PUBLIC KEY-----\\n';\n  pem += `${der.match(/.{1,64}/g).join('\\n')}`;\n  pem += '\\n-----END RSA PUBLIC KEY-----\\n';\n  return pem;\n}\n\nfunction prepadSigned(hexStr) {\n  const msb = hexStr[0];\n  if (msb < '0' || msb > '7') {\n    return `00${hexStr}`;\n  }\n  return hexStr;\n}\n\nfunction toHex(number) {\n  const nstr = number.toString(16);\n  if (nstr.length % 2) {\n    return `0${nstr}`;\n  }\n  return nstr;\n}\n\nfunction encodeLengthHex(n) {\n  if (n <= 127) {\n    return toHex(n);\n  }\n  const nHex = toHex(n);\n  const lengthOfLengthByte = 128 + nHex.length / 2;\n  return toHex(lengthOfLengthByte) + nHex;\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"d7ec3a58442ca46bab4e13b741982ae89bee3347"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1s0qj2s22n=function(){return actualCoverage;};}return actualCoverage;}cov_1s0qj2s22n();var Parse=(cov_1s0qj2s22n().s[0]++,require('parse/node').Parse);const https=(cov_1s0qj2s22n().s[1]++,require('https'));const jwt=(cov_1s0qj2s22n().s[2]++,require('jsonwebtoken'));const TOKEN_ISSUER=(cov_1s0qj2s22n().s[3]++,'accounts.google.com');const HTTPS_TOKEN_ISSUER=(cov_1s0qj2s22n().s[4]++,'https://accounts.google.com');let cache=(cov_1s0qj2s22n().s[5]++,{});// Retrieve Google Signin Keys (with cache control)
function getGoogleKeyByKeyId(keyId){cov_1s0qj2s22n().f[0]++;cov_1s0qj2s22n().s[6]++;if((cov_1s0qj2s22n().b[1][0]++,cache[keyId])&&(cov_1s0qj2s22n().b[1][1]++,cache.expiresAt>new Date())){cov_1s0qj2s22n().b[0][0]++;cov_1s0qj2s22n().s[7]++;return cache[keyId];}else{cov_1s0qj2s22n().b[0][1]++;}cov_1s0qj2s22n().s[8]++;return new Promise((resolve,reject)=>{cov_1s0qj2s22n().f[1]++;cov_1s0qj2s22n().s[9]++;https.get(`https://www.googleapis.com/oauth2/v3/certs`,res=>{cov_1s0qj2s22n().f[2]++;let data=(cov_1s0qj2s22n().s[10]++,'');cov_1s0qj2s22n().s[11]++;res.on('data',chunk=>{cov_1s0qj2s22n().f[3]++;cov_1s0qj2s22n().s[12]++;data+=chunk.toString('utf8');});cov_1s0qj2s22n().s[13]++;res.on('end',()=>{cov_1s0qj2s22n().f[4]++;const{keys}=(cov_1s0qj2s22n().s[14]++,JSON.parse(data));const pems=(cov_1s0qj2s22n().s[15]++,keys.reduce((pems,{n:modulus,e:exposant,kid})=>{cov_1s0qj2s22n().f[5]++;cov_1s0qj2s22n().s[16]++;return Object.assign(pems,{[kid]:rsaPublicKeyToPEM(modulus,exposant)});},{}));cov_1s0qj2s22n().s[17]++;if(res.headers['cache-control']){cov_1s0qj2s22n().b[2][0]++;var expire=(cov_1s0qj2s22n().s[18]++,res.headers['cache-control'].match(/max-age=([0-9]+)/));cov_1s0qj2s22n().s[19]++;if(expire){cov_1s0qj2s22n().b[3][0]++;cov_1s0qj2s22n().s[20]++;cache=Object.assign({},pems,{expiresAt:new Date(new Date().getTime()+Number(expire[1])*1000)});}else{cov_1s0qj2s22n().b[3][1]++;}}else{cov_1s0qj2s22n().b[2][1]++;}cov_1s0qj2s22n().s[21]++;resolve(pems[keyId]);});}).on('error',reject);});}function getHeaderFromToken(token){cov_1s0qj2s22n().f[6]++;const decodedToken=(cov_1s0qj2s22n().s[22]++,jwt.decode(token,{complete:true}));cov_1s0qj2s22n().s[23]++;if(!decodedToken){cov_1s0qj2s22n().b[4][0]++;cov_1s0qj2s22n().s[24]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`provided token does not decode as JWT`);}else{cov_1s0qj2s22n().b[4][1]++;}cov_1s0qj2s22n().s[25]++;return decodedToken.header;}async function verifyIdToken({id_token:token,id},{clientId}){cov_1s0qj2s22n().f[7]++;cov_1s0qj2s22n().s[26]++;if(!token){cov_1s0qj2s22n().b[5][0]++;cov_1s0qj2s22n().s[27]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`id token is invalid for this user.`);}else{cov_1s0qj2s22n().b[5][1]++;}const{kid:keyId,alg:algorithm}=(cov_1s0qj2s22n().s[28]++,getHeaderFromToken(token));let jwtClaims;const googleKey=(cov_1s0qj2s22n().s[29]++,await getGoogleKeyByKeyId(keyId));cov_1s0qj2s22n().s[30]++;try{cov_1s0qj2s22n().s[31]++;jwtClaims=jwt.verify(token,googleKey,{algorithms:algorithm,audience:clientId});}catch(exception){const message=(cov_1s0qj2s22n().s[32]++,exception.message);cov_1s0qj2s22n().s[33]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`${message}`);}cov_1s0qj2s22n().s[34]++;if((cov_1s0qj2s22n().b[7][0]++,jwtClaims.iss!==TOKEN_ISSUER)&&(cov_1s0qj2s22n().b[7][1]++,jwtClaims.iss!==HTTPS_TOKEN_ISSUER)){cov_1s0qj2s22n().b[6][0]++;cov_1s0qj2s22n().s[35]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`id token not issued by correct provider - expected: ${TOKEN_ISSUER} or ${HTTPS_TOKEN_ISSUER} | from: ${jwtClaims.iss}`);}else{cov_1s0qj2s22n().b[6][1]++;}cov_1s0qj2s22n().s[36]++;if(jwtClaims.sub!==id){cov_1s0qj2s22n().b[8][0]++;cov_1s0qj2s22n().s[37]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`auth data is invalid for this user.`);}else{cov_1s0qj2s22n().b[8][1]++;}cov_1s0qj2s22n().s[38]++;if((cov_1s0qj2s22n().b[10][0]++,clientId)&&(cov_1s0qj2s22n().b[10][1]++,jwtClaims.aud!==clientId)){cov_1s0qj2s22n().b[9][0]++;cov_1s0qj2s22n().s[39]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`id token not authorized for this clientId.`);}else{cov_1s0qj2s22n().b[9][1]++;}cov_1s0qj2s22n().s[40]++;return jwtClaims;}// Returns a promise that fulfills if this user id is valid.
function validateAuthData(authData,options=(cov_1s0qj2s22n().b[11][0]++,{})){cov_1s0qj2s22n().f[8]++;cov_1s0qj2s22n().s[41]++;return verifyIdToken(authData,options);}// Returns a promise that fulfills if this app id is valid.
function validateAppId(){cov_1s0qj2s22n().f[9]++;cov_1s0qj2s22n().s[42]++;return Promise.resolve();}cov_1s0qj2s22n().s[43]++;module.exports={validateAppId:validateAppId,validateAuthData:validateAuthData};// Helpers functions to convert the RSA certs to PEM (from jwks-rsa)
function rsaPublicKeyToPEM(modulusB64,exponentB64){cov_1s0qj2s22n().f[10]++;const modulus=(cov_1s0qj2s22n().s[44]++,new Buffer(modulusB64,'base64'));const exponent=(cov_1s0qj2s22n().s[45]++,new Buffer(exponentB64,'base64'));const modulusHex=(cov_1s0qj2s22n().s[46]++,prepadSigned(modulus.toString('hex')));const exponentHex=(cov_1s0qj2s22n().s[47]++,prepadSigned(exponent.toString('hex')));const modlen=(cov_1s0qj2s22n().s[48]++,modulusHex.length/2);const explen=(cov_1s0qj2s22n().s[49]++,exponentHex.length/2);const encodedModlen=(cov_1s0qj2s22n().s[50]++,encodeLengthHex(modlen));const encodedExplen=(cov_1s0qj2s22n().s[51]++,encodeLengthHex(explen));const encodedPubkey=(cov_1s0qj2s22n().s[52]++,'30'+encodeLengthHex(modlen+explen+encodedModlen.length/2+encodedExplen.length/2+2)+'02'+encodedModlen+modulusHex+'02'+encodedExplen+exponentHex);const der=(cov_1s0qj2s22n().s[53]++,new Buffer(encodedPubkey,'hex').toString('base64'));let pem=(cov_1s0qj2s22n().s[54]++,'-----BEGIN RSA PUBLIC KEY-----\n');cov_1s0qj2s22n().s[55]++;pem+=`${der.match(/.{1,64}/g).join('\n')}`;cov_1s0qj2s22n().s[56]++;pem+='\n-----END RSA PUBLIC KEY-----\n';cov_1s0qj2s22n().s[57]++;return pem;}function prepadSigned(hexStr){cov_1s0qj2s22n().f[11]++;const msb=(cov_1s0qj2s22n().s[58]++,hexStr[0]);cov_1s0qj2s22n().s[59]++;if((cov_1s0qj2s22n().b[13][0]++,msb<'0')||(cov_1s0qj2s22n().b[13][1]++,msb>'7')){cov_1s0qj2s22n().b[12][0]++;cov_1s0qj2s22n().s[60]++;return`00${hexStr}`;}else{cov_1s0qj2s22n().b[12][1]++;}cov_1s0qj2s22n().s[61]++;return hexStr;}function toHex(number){cov_1s0qj2s22n().f[12]++;const nstr=(cov_1s0qj2s22n().s[62]++,number.toString(16));cov_1s0qj2s22n().s[63]++;if(nstr.length%2){cov_1s0qj2s22n().b[14][0]++;cov_1s0qj2s22n().s[64]++;return`0${nstr}`;}else{cov_1s0qj2s22n().b[14][1]++;}cov_1s0qj2s22n().s[65]++;return nstr;}function encodeLengthHex(n){cov_1s0qj2s22n().f[13]++;cov_1s0qj2s22n().s[66]++;if(n<=127){cov_1s0qj2s22n().b[15][0]++;cov_1s0qj2s22n().s[67]++;return toHex(n);}else{cov_1s0qj2s22n().b[15][1]++;}const nHex=(cov_1s0qj2s22n().s[68]++,toHex(n));const lengthOfLengthByte=(cov_1s0qj2s22n().s[69]++,128+nHex.length/2);cov_1s0qj2s22n().s[70]++;return toHex(lengthOfLengthByte)+nHex;}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9BdXRoL2dvb2dsZS5qcyJdLCJuYW1lcyI6WyJQYXJzZSIsInJlcXVpcmUiLCJodHRwcyIsImp3dCIsIlRPS0VOX0lTU1VFUiIsIkhUVFBTX1RPS0VOX0lTU1VFUiIsImNhY2hlIiwiZ2V0R29vZ2xlS2V5QnlLZXlJZCIsImtleUlkIiwiZXhwaXJlc0F0IiwiRGF0ZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZ2V0IiwicmVzIiwiZGF0YSIsIm9uIiwiY2h1bmsiLCJ0b1N0cmluZyIsImtleXMiLCJKU09OIiwicGFyc2UiLCJwZW1zIiwicmVkdWNlIiwibiIsIm1vZHVsdXMiLCJlIiwiZXhwb3NhbnQiLCJraWQiLCJPYmplY3QiLCJhc3NpZ24iLCJyc2FQdWJsaWNLZXlUb1BFTSIsImhlYWRlcnMiLCJleHBpcmUiLCJtYXRjaCIsImdldFRpbWUiLCJOdW1iZXIiLCJnZXRIZWFkZXJGcm9tVG9rZW4iLCJ0b2tlbiIsImRlY29kZWRUb2tlbiIsImRlY29kZSIsImNvbXBsZXRlIiwiRXJyb3IiLCJPQkpFQ1RfTk9UX0ZPVU5EIiwiaGVhZGVyIiwidmVyaWZ5SWRUb2tlbiIsImlkX3Rva2VuIiwiaWQiLCJjbGllbnRJZCIsImFsZyIsImFsZ29yaXRobSIsImp3dENsYWltcyIsImdvb2dsZUtleSIsInZlcmlmeSIsImFsZ29yaXRobXMiLCJhdWRpZW5jZSIsImV4Y2VwdGlvbiIsIm1lc3NhZ2UiLCJpc3MiLCJzdWIiLCJhdWQiLCJ2YWxpZGF0ZUF1dGhEYXRhIiwiYXV0aERhdGEiLCJvcHRpb25zIiwidmFsaWRhdGVBcHBJZCIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bHVzQjY0IiwiZXhwb25lbnRCNjQiLCJCdWZmZXIiLCJleHBvbmVudCIsIm1vZHVsdXNIZXgiLCJwcmVwYWRTaWduZWQiLCJleHBvbmVudEhleCIsIm1vZGxlbiIsImxlbmd0aCIsImV4cGxlbiIsImVuY29kZWRNb2RsZW4iLCJlbmNvZGVMZW5ndGhIZXgiLCJlbmNvZGVkRXhwbGVuIiwiZW5jb2RlZFB1YmtleSIsImRlciIsInBlbSIsImpvaW4iLCJoZXhTdHIiLCJtc2IiLCJ0b0hleCIsIm51bWJlciIsIm5zdHIiLCJuSGV4IiwibGVuZ3RoT2ZMZW5ndGhCeXRlIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBRUE7O0FBQ0EsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsWUFBRCxDQUFQLENBQXNCRCxLQUFsQzs7QUFFQSxNQUFNRSxLQUFLLEdBQUdELE9BQU8sQ0FBQyxPQUFELENBQXJCOztBQUNBLE1BQU1FLEdBQUcsR0FBR0YsT0FBTyxDQUFDLGNBQUQsQ0FBbkI7O0FBRUEsTUFBTUcsWUFBWSxHQUFHLHFCQUFyQjtBQUNBLE1BQU1DLGtCQUFrQixHQUFHLDZCQUEzQjtBQUVBLElBQUlDLEtBQUssR0FBRyxFQUFaLEMsQ0FFQTs7QUFDQSxTQUFTQyxtQkFBVCxDQUE2QkMsS0FBN0IsRUFBb0M7QUFDbEMsTUFBSUYsS0FBSyxDQUFDRSxLQUFELENBQUwsSUFBZ0JGLEtBQUssQ0FBQ0csU0FBTixHQUFrQixJQUFJQyxJQUFKLEVBQXRDLEVBQWtEO0FBQ2hELFdBQU9KLEtBQUssQ0FBQ0UsS0FBRCxDQUFaO0FBQ0Q7O0FBRUQsU0FBTyxJQUFJRyxPQUFKLENBQVksQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3RDWCxJQUFBQSxLQUFLLENBQ0ZZLEdBREgsQ0FDUSw0Q0FEUixFQUNxREMsR0FBRyxJQUFJO0FBQ3hELFVBQUlDLElBQUksR0FBRyxFQUFYO0FBQ0FELE1BQUFBLEdBQUcsQ0FBQ0UsRUFBSixDQUFPLE1BQVAsRUFBZUMsS0FBSyxJQUFJO0FBQ3RCRixRQUFBQSxJQUFJLElBQUlFLEtBQUssQ0FBQ0MsUUFBTixDQUFlLE1BQWYsQ0FBUjtBQUNELE9BRkQ7QUFHQUosTUFBQUEsR0FBRyxDQUFDRSxFQUFKLENBQU8sS0FBUCxFQUFjLE1BQU07QUFDbEIsY0FBTTtBQUFFRyxVQUFBQTtBQUFGLFlBQVdDLElBQUksQ0FBQ0Ms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O0FBQ0EsU0FBT0EsR0FBUDtBQUNEOztBQUVELFNBQVNWLFlBQVQsQ0FBc0JZLE1BQXRCLEVBQThCO0FBQzVCLFFBQU1DLEdBQUcsR0FBR0QsTUFBTSxDQUFDLENBQUQsQ0FBbEI7O0FBQ0EsTUFBSUMsR0FBRyxHQUFHLEdBQU4sSUFBYUEsR0FBRyxHQUFHLEdBQXZCLEVBQTRCO0FBQzFCLFdBQVEsS0FBSUQsTUFBTyxFQUFuQjtBQUNEOztBQUNELFNBQU9BLE1BQVA7QUFDRDs7QUFFRCxTQUFTRSxLQUFULENBQWVDLE1BQWYsRUFBdUI7QUFDckIsUUFBTUMsSUFBSSxHQUFHRCxNQUFNLENBQUNyRSxRQUFQLENBQWdCLEVBQWhCLENBQWI7O0FBQ0EsTUFBSXNFLElBQUksQ0FBQ2IsTUFBTCxHQUFjLENBQWxCLEVBQXFCO0FBQ25CLFdBQVEsSUFBR2EsSUFBSyxFQUFoQjtBQUNEOztBQUNELFNBQU9BLElBQVA7QUFDRDs7QUFFRCxTQUFTVixlQUFULENBQXlCdEQsQ0FBekIsRUFBNEI7QUFDMUIsTUFBSUEsQ0FBQyxJQUFJLEdBQVQsRUFBYztBQUNaLFdBQU84RCxLQUFLLENBQUM5RCxDQUFELENBQVo7QUFDRDs7QUFDRCxRQUFNaUUsSUFBSSxHQUFHSCxLQUFLLENBQUM5RCxDQUFELENBQWxCO0FBQ0EsUUFBTWtFLGtCQUFrQixHQUFHLE1BQU1ELElBQUksQ0FBQ2QsTUFBTCxHQUFjLENBQS9DO0FBQ0EsU0FBT1csS0FBSyxDQUFDSSxrQkFBRCxDQUFMLEdBQTRCRCxJQUFuQztBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb25zIGZvciBhY2Nlc3NpbmcgdGhlIGdvb2dsZSBBUEkuXG52YXIgUGFyc2UgPSByZXF1aXJlKCdwYXJzZS9ub2RlJykuUGFyc2U7XG5cbmNvbnN0IGh0dHBzID0gcmVxdWlyZSgnaHR0cHMnKTtcbmNvbnN0IGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpO1xuXG5jb25zdCBUT0tFTl9JU1NVRVIgPSAnYWNjb3VudHMuZ29vZ2xlLmNvbSc7XG5jb25zdCBIVFRQU19UT0tFTl9JU1NVRVIgPSAnaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tJztcblxubGV0IGNhY2hlID0ge307XG5cbi8vIFJldHJpZXZlIEdvb2dsZSBTaWduaW4gS2V5cyAod2l0aCBjYWNoZSBjb250cm9sKVxuZnVuY3Rpb24gZ2V0R29vZ2xlS2V5QnlLZXlJZChrZXlJZCkge1xuICBpZiAoY2FjaGVba2V5SWRdICYmIGNhY2hlLmV4cGlyZXNBdCA+IG5ldyBEYXRlKCkpIHtcbiAgICByZXR1cm4gY2FjaGVba2V5SWRdO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBodHRwc1xuICAgICAgLmdldChgaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YzL2NlcnRzYCwgcmVzID0+IHtcbiAgICAgICAgbGV0IGRhdGEgPSAnJztcbiAgICAgICAgcmVzLm9uKCdkYXRhJywgY2h1bmsgPT4ge1xuICAgICAgICAgIGRhdGEgKz0gY2h1bmsudG9TdHJpbmcoJ3V0ZjgnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlcy5vbignZW5kJywgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsga2V5cyB9ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgICBjb25zdCBwZW1zID0ga2V5cy5yZWR1Y2UoXG4gICAgICAgICAgICAocGVtcywgeyBuOiBtb2R1bHVzLCBlOiBleHBvc2FudCwga2lkIH0pID0+XG4gICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGVtcywge1xuICAgICAgICAgICAgICAgIFtraWRdOiByc2FQdWJsaWNLZXlUb1BFTShtb2R1bHVzLCBleHBvc2FudCksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAge31cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKHJlcy5oZWFkZXJzWydjYWNoZS1jb250cm9sJ10pIHtcbiAgICAgICAgICAgIHZhciBleHBpcmUgPSByZXMuaGVhZGVyc1snY2FjaGUtY29udHJvbCddLm1hdGNoKC9tYXgtYWdlPShbMC05XSspLyk7XG5cbiAgICAgICAgICAgIGlmIChleHBpcmUpIHtcbiAgICAgICAgICAgICAgY2FjaGUgPSBPYmplY3QuYXNzaWduKHt9LCBwZW1zLCB7XG4gICAgICAgICAgICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSArIE51bWJlcihleHBpcmVbMV0pICogMTAwMCksXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlc29sdmUocGVtc1trZXlJZF0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAub24oJ2Vycm9yJywgcmVqZWN0KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldEhlYWRlckZyb21Ub2tlbih0b2tlbikge1xuICBjb25zdCBkZWNvZGVkVG9rZW4gPSBqd3QuZGVjb2RlKHRva2VuLCB7IGNvbXBsZXRlOiB0cnVlIH0pO1xuXG4gIGlmICghZGVjb2RlZFRva2VuKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsIGBwcm92aWRlZCB0b2tlbiBkb2VzIG5vdCBkZWNvZGUgYXMgSldUYCk7XG4gIH1cblxuICByZXR1cm4gZGVjb2RlZFRva2VuLmhlYWRlcjtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5SWRUb2tlbih7IGlkX3Rva2VuOiB0b2tlbiwgaWQgfSwgeyBjbGllbnRJZCB9KSB7XG4gIGlmICghdG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgYGlkIHRva2VuIGlzIGludmFsaWQgZm9yIHRoaXMgdXNlci5gKTtcbiAgfVxuXG4gIGNvbnN0IHsga2lkOiBrZXlJZCwgYWxnOiBhbGdvcml0aG0gfSA9IGdldEhlYWRlckZyb21Ub2tlbih0b2tlbik7XG4gIGxldCBqd3RDbGFpbXM7XG4gIGNvbnN0IGdvb2dsZUtleSA9IGF3YWl0IGdldEdvb2dsZUtleUJ5S2V5SWQoa2V5SWQpO1xuXG4gIHRyeSB7XG4gICAgand0Q2xhaW1zID0gand0LnZlcmlmeSh0b2tlbiwgZ29vZ2xlS2V5LCB7XG4gICAgICBhbGdvcml0aG1zOiBhbGdvcml0aG0sXG4gICAgICBhdWRpZW5jZTogY2xpZW50SWQsXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGV4Y2VwdGlvbikge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBleGNlcHRpb24ubWVzc2FnZTtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgYCR7bWVzc2FnZX1gKTtcbiAgfVxuXG4gIGlmIChqd3RDbGFpbXMuaXNzICE9PSBUT0tFTl9JU1NVRVIgJiYgand0Q2xhaW1zLmlzcyAhPT0gSFRUUFNfVE9LRU5fSVNTVUVSKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCxcbiAgICAgIGBpZCB0b2tlbiBub3QgaXNzdWVkIGJ5IGNvcnJlY3QgcHJvdmlkZXIgLSBleHBlY3RlZDogJHtUT0tFTl9JU1NVRVJ9IG9yICR7SFRUUFNfVE9LRU5fSVNTVUVSfSB8IGZyb206ICR7and0Q2xhaW1zLmlzc31gXG4gICAgKTtcbiAgfVxuXG4gIGlmIChqd3RDbGFpbXMuc3ViICE9PSBpZCkge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELCBgYXV0aCBkYXRhIGlzIGludmFsaWQgZm9yIHRoaXMgdXNlci5gKTtcbiAgfVxuXG4gIGlmIChjbGllbnRJZCAmJiBqd3RDbGFpbXMuYXVkICE9PSBjbGllbnRJZCkge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgIFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsXG4gICAgICBgaWQgdG9rZW4gbm90IGF1dGhvcml6ZWQgZm9yIHRoaXMgY2xpZW50SWQuYFxuICAgICk7XG4gIH1cblxuICByZXR1cm4gand0Q2xhaW1zO1xufVxuXG4vLyBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IGZ1bGZpbGxzIGlmIHRoaXMgdXNlciBpZCBpcyB2YWxpZC5cbmZ1bmN0aW9uIHZhbGlkYXRlQXV0aERhdGEoYXV0aERhdGEsIG9wdGlvbnMgPSB7fSkge1xuICByZXR1cm4gdmVyaWZ5SWRUb2tlbihhdXRoRGF0YSwgb3B0aW9ucyk7XG59XG5cbi8vIFJldHVybnMgYSBwcm9taXNlIHRoYXQgZnVsZmlsbHMgaWYgdGhpcyBhcHAgaWQgaXMgdmFsaWQuXG5mdW5jdGlvbiB2YWxpZGF0ZUFwcElkKCkge1xuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICB2YWxpZGF0ZUFwcElkOiB2YWxpZGF0ZUFwcElkLFxuICB2YWxpZGF0ZUF1dGhEYXRhOiB2YWxpZGF0ZUF1dGhEYXRhLFxufTtcblxuLy8gSGVscGVycyBmdW5jdGlvbnMgdG8gY29udmVydCB0aGUgUlNBIGNlcnRzIHRvIFBFTSAoZnJvbSBqd2tzLXJzYSlcbmZ1bmN0aW9uIHJzYVB1YmxpY0tleVRvUEVNKG1vZHVsdXNCNjQsIGV4cG9uZW50QjY0KSB7XG4gIGNvbnN0IG1vZHVsdXMgPSBuZXcgQnVmZmVyKG1vZHVsdXNCNjQsICdiYXNlNjQnKTtcbiAgY29uc3QgZXhwb25lbnQgPSBuZXcgQnVmZmVyKGV4cG9uZW50QjY0LCAnYmFzZTY0Jyk7XG4gIGNvbnN0IG1vZHVsdXNIZXggPSBwcmVwYWRTaWduZWQobW9kdWx1cy50b1N0cmluZygnaGV4JykpO1xuICBjb25zdCBleHBvbmVudEhleCA9IHByZXBhZFNpZ25lZChleHBvbmVudC50b1N0cmluZygnaGV4JykpO1xuICBjb25zdCBtb2RsZW4gPSBtb2R1bHVzSGV4Lmxlbmd0aCAvIDI7XG4gIGNvbnN0IGV4cGxlbiA9IGV4cG9uZW50SGV4Lmxlbmd0aCAvIDI7XG5cbiAgY29uc3QgZW5jb2RlZE1vZGxlbiA9IGVuY29kZUxlbmd0aEhleChtb2RsZW4pO1xuICBjb25zdCBlbmNvZGVkRXhwbGVuID0gZW5jb2RlTGVuZ3RoSGV4KGV4cGxlbik7XG4gIGNvbnN0IGVuY29kZWRQdWJrZXkgPVxuICAgICczMCcgK1xuICAgIGVuY29kZUxlbmd0aEhleChtb2RsZW4gKyBleHBsZW4gKyBlbmNvZGVkTW9kbGVuLmxlbmd0aCAvIDIgKyBlbmNvZGVkRXhwbGVuLmxlbmd0aCAvIDIgKyAyKSArXG4gICAgJzAyJyArXG4gICAgZW5jb2RlZE1vZGxlbiArXG4gICAgbW9kdWx1c0hleCArXG4gICAgJzAyJyArXG4gICAgZW5jb2RlZEV4cGxlbiArXG4gICAgZXhwb25lbnRIZXg7XG5cbiAgY29uc3QgZGVyID0gbmV3IEJ1ZmZlcihlbmNvZGVkUHVia2V5LCAnaGV4JykudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuXG4gIGxldCBwZW0gPSAnLS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tXFxuJztcbiAgcGVtICs9IGAke2Rlci5tYXRjaCgvLnsxLDY0fS9nKS5qb2luKCdcXG4nKX1gO1xuICBwZW0gKz0gJ1xcbi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS1cXG4nO1xuICByZXR1cm4gcGVtO1xufVxuXG5mdW5jdGlvbiBwcmVwYWRTaWduZWQoaGV4U3RyKSB7XG4gIGNvbnN0IG1zYiA9IGhleFN0clswXTtcbiAgaWYgKG1zYiA8ICcwJyB8fCBtc2IgPiAnNycpIHtcbiAgICByZXR1cm4gYDAwJHtoZXhTdHJ9YDtcbiAgfVxuICByZXR1cm4gaGV4U3RyO1xufVxuXG5mdW5jdGlvbiB0b0hleChudW1iZXIpIHtcbiAgY29uc3QgbnN0ciA9IG51bWJlci50b1N0cmluZygxNik7XG4gIGlmIChuc3RyLmxlbmd0aCAlIDIpIHtcbiAgICByZXR1cm4gYDAke25zdHJ9YDtcbiAgfVxuICByZXR1cm4gbnN0cjtcbn1cblxuZnVuY3Rpb24gZW5jb2RlTGVuZ3RoSGV4KG4pIHtcbiAgaWYgKG4gPD0gMTI3KSB7XG4gICAgcmV0dXJuIHRvSGV4KG4pO1xuICB9XG4gIGNvbnN0IG5IZXggPSB0b0hleChuKTtcbiAgY29uc3QgbGVuZ3RoT2ZMZW5ndGhCeXRlID0gMTI4ICsgbkhleC5sZW5ndGggLyAyO1xuICByZXR1cm4gdG9IZXgobGVuZ3RoT2ZMZW5ndGhCeXRlKSArIG5IZXg7XG59XG4iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9BdXRoL2dvb2dsZS5qcyJdLCJuYW1lcyI6WyJQYXJzZSIsInJlcXVpcmUiLCJodHRwcyIsImp3dCIsIlRPS0VOX0lTU1VFUiIsIkhUVFBTX1RPS0VOX0lTU1VFUiIsImNhY2hlIiwicmVzIiwiZGF0YSIsImNodW5rIiwia2V5cyIsIkpTT04iLCJwZW1zIiwibiIsImUiLCJraWQiLCJyc2FQdWJsaWNLZXlUb1BFTSIsImV4cGlyZSIsImV4cGlyZXNBdCIsIk51bWJlciIsInJlc29sdmUiLCJkZWNvZGVkVG9rZW4iLCJjb21wbGV0ZSIsImlkX3Rva2VuIiwiaWQiLCJjbGllbnRJZCIsImFsZyIsImFsZ29yaXRobSIsImdldEhlYWRlckZyb21Ub2tlbiIsImdvb2dsZUtleSIsImdldEdvb2dsZUtleUJ5S2V5SWQiLCJqd3RDbGFpbXMiLCJhbGdvcml0aG1zIiwiYXVkaWVuY2UiLCJtZXNzYWdlIiwiZXhjZXB0aW9uIiwiaXNzIiwib3B0aW9ucyIsInZlcmlmeUlkVG9rZW4iLCJQcm9taXNlIiwibW9kdWxlIiwidmFsaWRhdGVBcHBJZCIsInZhbGlkYXRlQXV0aERhdGEiLCJtb2R1bHVzIiwiZXhwb25lbnQiLCJtb2R1bHVzSGV4IiwicHJlcGFkU2lnbmVkIiwiZXhwb25lbnRIZXgiLCJtb2RsZW4iLCJleHBsZW4iLCJlbmNvZGVkTW9kbGVuIiwiZW5jb2RlTGVuZ3RoSGV4IiwiZW5jb2RlZEV4cGxlbiIsImVuY29kZWRQdWJrZXkiLCJkZXIiLCJwZW0iLCJtc2IiLCJoZXhTdHIiLCJuc3RyIiwibnVtYmVyIiwidG9IZXgiLCJuSGV4IiwibGVuZ3RoT2ZMZW5ndGhCeXRlIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBO3locUJBZUc7MkZBZEgsR0FBSUEsQ0FBQUEsS0FBSywwQkFBR0MsT0FBTyxDQUFQQSxZQUFPLENBQVBBLENBQVosS0FBUyxDQUFULENBRUEsS0FBTUMsQ0FBQUEsS0FBSywwQkFBR0QsT0FBTyxDQUFyQixP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akMsQ0FBd0IsQ0FBeEIsQ0FMMEIseUJBTTFCLE1BQU9ELENBQUFBLEtBQUssQ0FBTEEsa0JBQUssQ0FBTEEsQ0FBUCxJQUFBLENBQ0QsQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuLy8gSGVscGVyIGZ1bmN0aW9ucyBmb3IgYWNjZXNzaW5nIHRoZSBnb29nbGUgQVBJLlxudmFyIFBhcnNlID0gcmVxdWlyZSgncGFyc2Uvbm9kZScpLlBhcnNlO1xuXG5jb25zdCBodHRwcyA9IHJlcXVpcmUoJ2h0dHBzJyk7XG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTtcblxuY29uc3QgVE9LRU5fSVNTVUVSID0gJ2FjY291bnRzLmdvb2dsZS5jb20nO1xuY29uc3QgSFRUUFNfVE9LRU5fSVNTVUVSID0gJ2h0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbSc7XG5cbmxldCBjYWNoZSA9IHt9O1xuXG4vLyBSZXRyaWV2ZSBHb29nbGUgU2lnbmluIEtleXMgKHdpdGggY2FjaGUgY29udHJvbClcbmZ1bmN0aW9uIGdldEdvb2dsZUtleUJ5S2V5SWQoa2V5SWQpIHtcbiAgaWYgKGNhY2hlW2tleUlkXSAmJiBjYWNoZS5leHBpcmVzQXQgPiBuZXcgRGF0ZSgpKSB7XG4gICAgcmV0dXJuIGNhY2hlW2tleUlkXTtcbiAgfVxuXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgaHR0cHNcbiAgICAgIC5nZXQoYGh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92My9jZXJ0c2AsIHJlcyA9PiB7XG4gICAgICAgIGxldCBkYXRhID0gJyc7XG4gICAgICAgIHJlcy5vbignZGF0YScsIGNodW5rID0+IHtcbiAgICAgICAgICBkYXRhICs9IGNodW5rLnRvU3RyaW5nKCd1dGY4Jyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXMub24oJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IGtleXMgfSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgY29uc3QgcGVtcyA9IGtleXMucmVkdWNlKFxuICAgICAgICAgICAgKHBlbXMsIHsgbjogbW9kdWx1cywgZTogZXhwb3NhbnQsIGtpZCB9KSA9PlxuICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHBlbXMsIHtcbiAgICAgICAgICAgICAgICBba2lkXTogcnNhUHVibGljS2V5VG9QRU0obW9kdWx1cywgZXhwb3NhbnQpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHt9XG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmIChyZXMuaGVhZGVyc1snY2FjaGUtY29udHJvbCddKSB7XG4gICAgICAgICAgICB2YXIgZXhwaXJlID0gcmVzLmhlYWRlcnNbJ2NhY2hlLWNvbnRyb2wnXS5tYXRjaCgvbWF4LWFnZT0oWzAtOV0rKS8pO1xuXG4gICAgICAgICAgICBpZiAoZXhwaXJlKSB7XG4gICAgICAgICAgICAgIGNhY2hlID0gT2JqZWN0LmFzc2lnbih7fSwgcGVtcywge1xuICAgICAgICAgICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgKyBOdW1iZXIoZXhwaXJlWzFdKSAqIDEwMDApLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXNvbHZlKHBlbXNba2V5SWRdKTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgICAgLm9uKCdlcnJvcicsIHJlamVjdCk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRIZWFkZXJGcm9tVG9rZW4odG9rZW4pIHtcbiAgY29uc3QgZGVjb2RlZFRva2VuID0gand0LmRlY29kZSh0b2tlbiwgeyBjb21wbGV0ZTogdHJ1ZSB9KTtcblxuICBpZiAoIWRlY29kZWRUb2tlbikge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELCBgcHJvdmlkZWQgdG9rZW4gZG9lcyBub3QgZGVjb2RlIGFzIEpXVGApO1xuICB9XG5cbiAgcmV0dXJuIGRlY29kZWRUb2tlbi5oZWFkZXI7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHZlcmlmeUlkVG9rZW4oeyBpZF90b2tlbjogdG9rZW4sIGlkIH0sIHsgY2xpZW50SWQgfSkge1xuICBpZiAoIXRva2VuKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsIGBpZCB0b2tlbiBpcyBpbnZhbGlkIGZvciB0aGlzIHVzZXIuYCk7XG4gIH1cblxuICBjb25zdCB7IGtpZDoga2V5SWQsIGFsZzogYWxnb3JpdGhtIH0gPSBnZXRIZWFkZXJGcm9tVG9rZW4odG9rZW4pO1xuICBsZXQgand0Q2xhaW1zO1xuICBjb25zdCBnb29nbGVLZXkgPSBhd2FpdCBnZXRHb29nbGVLZXlCeUtleUlkKGtleUlkKTtcblxuICB0cnkge1xuICAgIGp3dENsYWltcyA9IGp3dC52ZXJpZnkodG9rZW4sIGdvb2dsZUtleSwge1xuICAgICAgYWxnb3JpdGhtczogYWxnb3JpdGhtLFxuICAgICAgYXVkaWVuY2U6IGNsaWVudElkLFxuICAgIH0pO1xuICB9IGNhdGNoIChleGNlcHRpb24pIHtcbiAgICBjb25zdCBtZXNzYWdlID0gZXhjZXB0aW9uLm1lc3NhZ2U7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsIGAke21lc3NhZ2V9YCk7XG4gIH1cblxuICBpZiAoand0Q2xhaW1zLmlzcyAhPT0gVE9LRU5fSVNTVUVSICYmIGp3dENsYWltcy5pc3MgIT09IEhUVFBTX1RPS0VOX0lTU1VFUikge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgIFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsXG4gICAgICBgaWQgdG9rZW4gbm90IGlzc3VlZCBieSBjb3JyZWN0IHByb3ZpZGVyIC0gZXhwZWN0ZWQ6ICR7VE9LRU5fSVNTVUVSfSBvciAke0hUVFBTX1RPS0VOX0lTU1VFUn0gfCBmcm9tOiAke2p3dENsYWltcy5pc3N9YFxuICAgICk7XG4gIH1cblxuICBpZiAoand0Q2xhaW1zLnN1YiAhPT0gaWQpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgYGF1dGggZGF0YSBpcyBpbnZhbGlkIGZvciB0aGlzIHVzZXIuYCk7XG4gIH1cblxuICBpZiAoY2xpZW50SWQgJiYgand0Q2xhaW1zLmF1ZCAhPT0gY2xpZW50SWQpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICBQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELFxuICAgICAgYGlkIHRva2VuIG5vdCBhdXRob3JpemVkIGZvciB0aGlzIGNsaWVudElkLmBcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIGp3dENsYWltcztcbn1cblxuLy8gUmV0dXJucyBhIHByb21pc2UgdGhhdCBmdWxmaWxscyBpZiB0aGlzIHVzZXIgaWQgaXMgdmFsaWQuXG5mdW5jdGlvbiB2YWxpZGF0ZUF1dGhEYXRhKGF1dGhEYXRhLCBvcHRpb25zID0ge30pIHtcbiAgcmV0dXJuIHZlcmlmeUlkVG9rZW4oYXV0aERhdGEsIG9wdGlvbnMpO1xufVxuXG4vLyBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IGZ1bGZpbGxzIGlmIHRoaXMgYXBwIGlkIGlzIHZhbGlkLlxuZnVuY3Rpb24gdmFsaWRhdGVBcHBJZCgpIHtcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgdmFsaWRhdGVBcHBJZDogdmFsaWRhdGVBcHBJZCxcbiAgdmFsaWRhdGVBdXRoRGF0YTogdmFsaWRhdGVBdXRoRGF0YSxcbn07XG5cbi8vIEhlbHBlcnMgZnVuY3Rpb25zIHRvIGNvbnZlcnQgdGhlIFJTQSBjZXJ0cyB0byBQRU0gKGZyb20gandrcy1yc2EpXG5mdW5jdGlvbiByc2FQdWJsaWNLZXlUb1BFTShtb2R1bHVzQjY0LCBleHBvbmVudEI2NCkge1xuICBjb25zdCBtb2R1bHVzID0gbmV3IEJ1ZmZlcihtb2R1bHVzQjY0LCAnYmFzZTY0Jyk7XG4gIGNvbnN0IGV4cG9uZW50ID0gbmV3IEJ1ZmZlcihleHBvbmVudEI2NCwgJ2Jhc2U2NCcpO1xuICBjb25zdCBtb2R1bHVzSGV4ID0gcHJlcGFkU2lnbmVkKG1vZHVsdXMudG9TdHJpbmcoJ2hleCcpKTtcbiAgY29uc3QgZXhwb25lbnRIZXggPSBwcmVwYWRTaWduZWQoZXhwb25lbnQudG9TdHJpbmcoJ2hleCcpKTtcbiAgY29uc3QgbW9kbGVuID0gbW9kdWx1c0hleC5sZW5ndGggLyAyO1xuICBjb25zdCBleHBsZW4gPSBleHBvbmVudEhleC5sZW5ndGggLyAyO1xuXG4gIGNvbnN0IGVuY29kZWRNb2RsZW4gPSBlbmNvZGVMZW5ndGhIZXgobW9kbGVuKTtcbiAgY29uc3QgZW5jb2RlZEV4cGxlbiA9IGVuY29kZUxlbmd0aEhleChleHBsZW4pO1xuICBjb25zdCBlbmNvZGVkUHVia2V5ID1cbiAgICAnMzAnICtcbiAgICBlbmNvZGVMZW5ndGhIZXgobW9kbGVuICsgZXhwbGVuICsgZW5jb2RlZE1vZGxlbi5sZW5ndGggLyAyICsgZW5jb2RlZEV4cGxlbi5sZW5ndGggLyAyICsgMikgK1xuICAgICcwMicgK1xuICAgIGVuY29kZWRNb2RsZW4gK1xuICAgIG1vZHVsdXNIZXggK1xuICAgICcwMicgK1xuICAgIGVuY29kZWRFeHBsZW4gK1xuICAgIGV4cG9uZW50SGV4O1xuXG4gIGNvbnN0IGRlciA9IG5ldyBCdWZmZXIoZW5jb2RlZFB1YmtleSwgJ2hleCcpLnRvU3RyaW5nKCdiYXNlNjQnKTtcblxuICBsZXQgcGVtID0gJy0tLS0tQkVHSU4gUlNBIFBVQkxJQyBLRVktLS0tLVxcbic7XG4gIHBlbSArPSBgJHtkZXIubWF0Y2goLy57MSw2NH0vZykuam9pbignXFxuJyl9YDtcbiAgcGVtICs9ICdcXG4tLS0tLUVORCBSU0EgUFVCTElDIEtFWS0tLS0tXFxuJztcbiAgcmV0dXJuIHBlbTtcbn1cblxuZnVuY3Rpb24gcHJlcGFkU2lnbmVkKGhleFN0cikge1xuICBjb25zdCBtc2IgPSBoZXhTdHJbMF07XG4gIGlmIChtc2IgPCAnMCcgfHwgbXNiID4gJzcnKSB7XG4gICAgcmV0dXJuIGAwMCR7aGV4U3RyfWA7XG4gIH1cbiAgcmV0dXJuIGhleFN0cjtcbn1cblxuZnVuY3Rpb24gdG9IZXgobnVtYmVyKSB7XG4gIGNvbnN0IG5zdHIgPSBudW1iZXIudG9TdHJpbmcoMTYpO1xuICBpZiAobnN0ci5sZW5ndGggJSAyKSB7XG4gICAgcmV0dXJuIGAwJHtuc3RyfWA7XG4gIH1cbiAgcmV0dXJuIG5zdHI7XG59XG5cbmZ1bmN0aW9uIGVuY29kZUxlbmd0aEhleChuKSB7XG4gIGlmIChuIDw9IDEyNykge1xuICAgIHJldHVybiB0b0hleChuKTtcbiAgfVxuICBjb25zdCBuSGV4ID0gdG9IZXgobik7XG4gIGNvbnN0IGxlbmd0aE9mTGVuZ3RoQnl0ZSA9IDEyOCArIG5IZXgubGVuZ3RoIC8gMjtcbiAgcmV0dXJuIHRvSGV4KGxlbmd0aE9mTGVuZ3RoQnl0ZSkgKyBuSGV4O1xufVxuIl19