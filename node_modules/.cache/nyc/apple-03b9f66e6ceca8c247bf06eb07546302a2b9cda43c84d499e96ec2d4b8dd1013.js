"use strict";// Apple SignIn Auth
// https://developer.apple.com/documentation/signinwithapplerestapi
function cov_2r4avrgpn4(){var path="/parse-server/lib/Adapters/Auth/apple.js";var hash="dd608da5b40692daff5849f76c7e1f02a22ed664";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Adapters/Auth/apple.js",statementMap:{"0":{start:{line:5,column:14},end:{line:5,column:41}},"1":{start:{line:7,column:19},end:{line:7,column:38}},"2":{start:{line:9,column:13},end:{line:9,column:28}},"3":{start:{line:11,column:12},end:{line:11,column:35}},"4":{start:{line:13,column:21},end:{line:13,column:48}},"5":{start:{line:15,column:27},end:{line:32,column:1}},"6":{start:{line:16,column:17},end:{line:21,column:4}},"7":{start:{line:22,column:37},end:{line:22,column:73}},"8":{start:{line:25,column:2},end:{line:29,column:3}},"9":{start:{line:26,column:4},end:{line:26,column:50}},"10":{start:{line:28,column:4},end:{line:28,column:108}},"11":{start:{line:31,column:2},end:{line:31,column:13}},"12":{start:{line:34,column:27},end:{line:44,column:1}},"13":{start:{line:35,column:23},end:{line:37,column:4}},"14":{start:{line:39,column:2},end:{line:41,column:3}},"15":{start:{line:40,column:4},end:{line:40,column:97}},"16":{start:{line:43,column:2},end:{line:43,column:29}},"17":{start:{line:46,column:22},end:{line:89,column:1}},"18":{start:{line:54,column:2},end:{line:56,column:3}},"19":{start:{line:55,column:4},end:{line:55,column:94}},"20":{start:{line:61,column:6},end:{line:61,column:31}},"21":{start:{line:62,column:25},end:{line:62,column:32}},"22":{start:{line:64,column:2},end:{line:64,column:46}},"23":{start:{line:65,column:2},end:{line:65,column:41}},"24":{start:{line:66,column:19},end:{line:66,column:80}},"25":{start:{line:67,column:21},end:{line:67,column:64}},"26":{start:{line:69,column:2},end:{line:78,column:3}},"27":{start:{line:70,column:4},end:{line:74,column:7}},"28":{start:{line:76,column:20},end:{line:76,column:37}},"29":{start:{line:77,column:4},end:{line:77,column:70}},"30":{start:{line:80,column:2},end:{line:82,column:3}},"31":{start:{line:81,column:4},end:{line:81,column:159}},"32":{start:{line:84,column:2},end:{line:86,column:3}},"33":{start:{line:85,column:4},end:{line:85,column:95}},"34":{start:{line:88,column:2},end:{line:88,column:19}},"35":{start:{line:93,column:2},end:{line:93,column:42}},"36":{start:{line:98,column:2},end:{line:98,column:27}},"37":{start:{line:101,column:0},end:{line:104,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:15,column:27},end:{line:15,column:28}},loc:{start:{line:15,column:74},end:{line:32,column:1}},line:15},"1":{name:"(anonymous_1)",decl:{start:{line:34,column:27},end:{line:34,column:28}},loc:{start:{line:34,column:36},end:{line:44,column:1}},line:34},"2":{name:"(anonymous_2)",decl:{start:{line:46,column:22},end:{line:46,column:23}},loc:{start:{line:53,column:6},end:{line:89,column:1}},line:53},"3":{name:"validateAuthData",decl:{start:{line:92,column:9},end:{line:92,column:25}},loc:{start:{line:92,column:50},end:{line:94,column:1}},line:92},"4":{name:"validateAppId",decl:{start:{line:97,column:9},end:{line:97,column:22}},loc:{start:{line:97,column:25},end:{line:99,column:1}},line:97}},branchMap:{"0":{loc:{start:{line:39,column:2},end:{line:41,column:3}},type:"if",locations:[{start:{line:39,column:2},end:{line:41,column:3}},{start:{line:39,column:2},end:{line:41,column:3}}],line:39},"1":{loc:{start:{line:54,column:2},end:{line:56,column:3}},type:"if",locations:[{start:{line:54,column:2},end:{line:56,column:3}},{start:{line:54,column:2},end:{line:56,column:3}}],line:54},"2":{loc:{start:{line:64,column:16},end:{line:64,column:45}},type:"binary-expr",locations:[{start:{line:64,column:16},end:{line:64,column:27}},{start:{line:64,column:31},end:{line:64,column:45}}],line:64},"3":{loc:{start:{line:65,column:20},end:{line:65,column:40}},type:"binary-expr",locations:[{start:{line:65,column:20},end:{line:65,column:35}},{start:{line:65,column:39},end:{line:65,column:40}}],line:65},"4":{loc:{start:{line:67,column:21},end:{line:67,column:64}},type:"binary-expr",locations:[{start:{line:67,column:21},end:{line:67,column:39}},{start:{line:67,column:43},end:{line:67,column:64}}],line:67},"5":{loc:{start:{line:80,column:2},end:{line:82,column:3}},type:"if",locations:[{start:{line:80,column:2},end:{line:82,column:3}},{start:{line:80,column:2},end:{line:82,column:3}}],line:80},"6":{loc:{start:{line:84,column:2},end:{line:86,column:3}},type:"if",locations:[{start:{line:84,column:2},end:{line:86,column:3}},{start:{line:84,column:2},end:{line:86,column:3}}],line:84},"7":{loc:{start:{line:92,column:36},end:{line:92,column:48}},type:"default-arg",locations:[{start:{line:92,column:46},end:{line:92,column:48}}],line:92}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0]},inputSourceMap:{version:3,sources:["../../../src/Adapters/Auth/apple.js"],names:["Parse","require","jwksClient","util","jwt","TOKEN_ISSUER","getAppleKeyByKeyId","keyId","cacheMaxEntries","cacheMaxAge","client","jwksUri","cache","asyncGetSigningKeyFunction","promisify","getSigningKey","key","error","Error","OBJECT_NOT_FOUND","getHeaderFromToken","token","decodedToken","decode","complete","header","verifyIdToken","id","clientId","kid","alg","algorithm","ONE_HOUR_IN_MS","jwtClaims","appleKey","signingKey","publicKey","rsaPublicKey","verify","algorithms","audience","exception","message","iss","sub","validateAuthData","authData","options","validateAppId","Promise","resolve","module","exports"],mappings:"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",sourcesContent:["// Apple SignIn Auth\n// https://developer.apple.com/documentation/signinwithapplerestapi\n\nconst Parse = require('parse/node').Parse;\nconst jwksClient = require('jwks-rsa');\nconst util = require('util');\nconst jwt = require('jsonwebtoken');\n\nconst TOKEN_ISSUER = 'https://appleid.apple.com';\n\nconst getAppleKeyByKeyId = async (keyId, cacheMaxEntries, cacheMaxAge) => {\n  const client = jwksClient({\n    jwksUri: `${TOKEN_ISSUER}/auth/keys`,\n    cache: true,\n    cacheMaxEntries,\n    cacheMaxAge,\n  });\n\n  const asyncGetSigningKeyFunction = util.promisify(client.getSigningKey);\n\n  let key;\n  try {\n    key = await asyncGetSigningKeyFunction(keyId);\n  } catch (error) {\n    throw new Parse.Error(\n      Parse.Error.OBJECT_NOT_FOUND,\n      `Unable to find matching key for Key ID: ${keyId}`\n    );\n  }\n  return key;\n};\n\nconst getHeaderFromToken = token => {\n  const decodedToken = jwt.decode(token, { complete: true });\n  if (!decodedToken) {\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `provided token does not decode as JWT`);\n  }\n\n  return decodedToken.header;\n};\n\nconst verifyIdToken = async ({ token, id }, { clientId, cacheMaxEntries, cacheMaxAge }) => {\n  if (!token) {\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `id token is invalid for this user.`);\n  }\n\n  const { kid: keyId, alg: algorithm } = getHeaderFromToken(token);\n  const ONE_HOUR_IN_MS = 3600000;\n  let jwtClaims;\n\n  cacheMaxAge = cacheMaxAge || ONE_HOUR_IN_MS;\n  cacheMaxEntries = cacheMaxEntries || 5;\n\n  const appleKey = await getAppleKeyByKeyId(keyId, cacheMaxEntries, cacheMaxAge);\n  const signingKey = appleKey.publicKey || appleKey.rsaPublicKey;\n\n  try {\n    jwtClaims = jwt.verify(token, signingKey, {\n      algorithms: algorithm,\n      // the audience can be checked against a string, a regular expression or a list of strings and/or regular expressions.\n      audience: clientId,\n    });\n  } catch (exception) {\n    const message = exception.message;\n\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `${message}`);\n  }\n\n  if (jwtClaims.iss !== TOKEN_ISSUER) {\n    throw new Parse.Error(\n      Parse.Error.OBJECT_NOT_FOUND,\n      `id token not issued by correct OpenID provider - expected: ${TOKEN_ISSUER} | from: ${jwtClaims.iss}`\n    );\n  }\n\n  if (jwtClaims.sub !== id) {\n    throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND, `auth data is invalid for this user.`);\n  }\n  return jwtClaims;\n};\n\n// Returns a promise that fulfills if this id token is valid\nfunction validateAuthData(authData, options = {}) {\n  return verifyIdToken(authData, options);\n}\n\n// Returns a promise that fulfills if this app id is valid.\nfunction validateAppId() {\n  return Promise.resolve();\n}\n\nmodule.exports = {\n  validateAppId,\n  validateAuthData,\n};\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"dd608da5b40692daff5849f76c7e1f02a22ed664"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2r4avrgpn4=function(){return actualCoverage;};}return actualCoverage;}cov_2r4avrgpn4();const Parse=(cov_2r4avrgpn4().s[0]++,require('parse/node').Parse);const jwksClient=(cov_2r4avrgpn4().s[1]++,require('jwks-rsa'));const util=(cov_2r4avrgpn4().s[2]++,require('util'));const jwt=(cov_2r4avrgpn4().s[3]++,require('jsonwebtoken'));const TOKEN_ISSUER=(cov_2r4avrgpn4().s[4]++,'https://appleid.apple.com');cov_2r4avrgpn4().s[5]++;const getAppleKeyByKeyId=async(keyId,cacheMaxEntries,cacheMaxAge)=>{cov_2r4avrgpn4().f[0]++;const client=(cov_2r4avrgpn4().s[6]++,jwksClient({jwksUri:`${TOKEN_ISSUER}/auth/keys`,cache:true,cacheMaxEntries,cacheMaxAge}));const asyncGetSigningKeyFunction=(cov_2r4avrgpn4().s[7]++,util.promisify(client.getSigningKey));let key;cov_2r4avrgpn4().s[8]++;try{cov_2r4avrgpn4().s[9]++;key=await asyncGetSigningKeyFunction(keyId);}catch(error){cov_2r4avrgpn4().s[10]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`Unable to find matching key for Key ID: ${keyId}`);}cov_2r4avrgpn4().s[11]++;return key;};cov_2r4avrgpn4().s[12]++;const getHeaderFromToken=token=>{cov_2r4avrgpn4().f[1]++;const decodedToken=(cov_2r4avrgpn4().s[13]++,jwt.decode(token,{complete:true}));cov_2r4avrgpn4().s[14]++;if(!decodedToken){cov_2r4avrgpn4().b[0][0]++;cov_2r4avrgpn4().s[15]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`provided token does not decode as JWT`);}else{cov_2r4avrgpn4().b[0][1]++;}cov_2r4avrgpn4().s[16]++;return decodedToken.header;};cov_2r4avrgpn4().s[17]++;const verifyIdToken=async({token,id},{clientId,cacheMaxEntries,cacheMaxAge})=>{cov_2r4avrgpn4().f[2]++;cov_2r4avrgpn4().s[18]++;if(!token){cov_2r4avrgpn4().b[1][0]++;cov_2r4avrgpn4().s[19]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`id token is invalid for this user.`);}else{cov_2r4avrgpn4().b[1][1]++;}const{kid:keyId,alg:algorithm}=(cov_2r4avrgpn4().s[20]++,getHeaderFromToken(token));const ONE_HOUR_IN_MS=(cov_2r4avrgpn4().s[21]++,3600000);let jwtClaims;cov_2r4avrgpn4().s[22]++;cacheMaxAge=(cov_2r4avrgpn4().b[2][0]++,cacheMaxAge)||(cov_2r4avrgpn4().b[2][1]++,ONE_HOUR_IN_MS);cov_2r4avrgpn4().s[23]++;cacheMaxEntries=(cov_2r4avrgpn4().b[3][0]++,cacheMaxEntries)||(cov_2r4avrgpn4().b[3][1]++,5);const appleKey=(cov_2r4avrgpn4().s[24]++,await getAppleKeyByKeyId(keyId,cacheMaxEntries,cacheMaxAge));const signingKey=(cov_2r4avrgpn4().s[25]++,(cov_2r4avrgpn4().b[4][0]++,appleKey.publicKey)||(cov_2r4avrgpn4().b[4][1]++,appleKey.rsaPublicKey));cov_2r4avrgpn4().s[26]++;try{cov_2r4avrgpn4().s[27]++;jwtClaims=jwt.verify(token,signingKey,{algorithms:algorithm,// the audience can be checked against a string, a regular expression or a list of strings and/or regular expressions.
audience:clientId});}catch(exception){const message=(cov_2r4avrgpn4().s[28]++,exception.message);cov_2r4avrgpn4().s[29]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`${message}`);}cov_2r4avrgpn4().s[30]++;if(jwtClaims.iss!==TOKEN_ISSUER){cov_2r4avrgpn4().b[5][0]++;cov_2r4avrgpn4().s[31]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`id token not issued by correct OpenID provider - expected: ${TOKEN_ISSUER} | from: ${jwtClaims.iss}`);}else{cov_2r4avrgpn4().b[5][1]++;}cov_2r4avrgpn4().s[32]++;if(jwtClaims.sub!==id){cov_2r4avrgpn4().b[6][0]++;cov_2r4avrgpn4().s[33]++;throw new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,`auth data is invalid for this user.`);}else{cov_2r4avrgpn4().b[6][1]++;}cov_2r4avrgpn4().s[34]++;return jwtClaims;};// Returns a promise that fulfills if this id token is valid
function validateAuthData(authData,options=(cov_2r4avrgpn4().b[7][0]++,{})){cov_2r4avrgpn4().f[3]++;cov_2r4avrgpn4().s[35]++;return verifyIdToken(authData,options);}// Returns a promise that fulfills if this app id is valid.
function validateAppId(){cov_2r4avrgpn4().f[4]++;cov_2r4avrgpn4().s[36]++;return Promise.resolve();}cov_2r4avrgpn4().s[37]++;module.exports={validateAppId,validateAuthData};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9BdXRoL2FwcGxlLmpzIl0sIm5hbWVzIjpbIlBhcnNlIiwicmVxdWlyZSIsImp3a3NDbGllbnQiLCJ1dGlsIiwiand0IiwiVE9LRU5fSVNTVUVSIiwiZ2V0QXBwbGVLZXlCeUtleUlkIiwia2V5SWQiLCJjYWNoZU1heEVudHJpZXMiLCJjYWNoZU1heEFnZSIsImNsaWVudCIsImp3a3NVcmkiLCJjYWNoZSIsImFzeW5jR2V0U2lnbmluZ0tleUZ1bmN0aW9uIiwicHJvbWlzaWZ5IiwiZ2V0U2lnbmluZ0tleSIsImtleSIsImVycm9yIiwiRXJyb3IiLCJPQkpFQ1RfTk9UX0ZPVU5EIiwiZ2V0SGVhZGVyRnJvbVRva2VuIiwidG9rZW4iLCJkZWNvZGVkVG9rZW4iLCJkZWNvZGUiLCJjb21wbGV0ZSIsImhlYWRlciIsInZlcmlmeUlkVG9rZW4iLCJpZCIsImNsaWVudElkIiwia2lkIiwiYWxnIiwiYWxnb3JpdGhtIiwiT05FX0hPVVJfSU5fTVMiLCJqd3RDbGFpbXMiLCJhcHBsZUtleSIsInNpZ25pbmdLZXkiLCJwdWJsaWNLZXkiLCJyc2FQdWJsaWNLZXkiLCJ2ZXJpZnkiLCJhbGdvcml0aG1zIiwiYXVkaWVuY2UiLCJleGNlcHRpb24iLCJtZXNzYWdlIiwiaXNzIiwic3ViIiwidmFsaWRhdGVBdXRoRGF0YSIsImF1dGhEYXRhIiwib3B0aW9ucyIsInZhbGlkYXRlQXBwSWQiLCJQcm9taXNlIiwicmVzb2x2ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUVBLE1BQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLFlBQUQsQ0FBUCxDQUFzQkQsS0FBcEM7O0FBQ0EsTUFBTUUsVUFBVSxHQUFHRCxPQUFPLENBQUMsVUFBRCxDQUExQjs7QUFDQSxNQUFNRSxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1HLEdBQUcsR0FBR0gsT0FBTyxDQUFDLGNBQUQsQ0FBbkI7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QXpELENBQU47QUFDRDs7QUFFRCxNQUFJVCxTQUFTLENBQUNVLEdBQVYsS0FBa0J0QyxZQUF0QixFQUFvQztBQUNsQyxVQUFNLElBQUlMLEtBQUssQ0FBQ2tCLEtBQVYsQ0FDSmxCLEtBQUssQ0FBQ2tCLEtBQU4sQ0FBWUMsZ0JBRFIsRUFFSCw4REFBNkRkLFlBQWEsWUFBVzRCLFNBQVMsQ0FBQ1UsR0FBSSxFQUZoRyxDQUFOO0FBSUQ7O0FBRUQsTUFBSVYsU0FBUyxDQUFDVyxHQUFWLEtBQWtCakIsRUFBdEIsRUFBMEI7QUFDeEIsVUFBTSxJQUFJM0IsS0FBSyxDQUFDa0IsS0FBVixDQUFnQmxCLEtBQUssQ0FBQ2tCLEtBQU4sQ0FBWUMsZ0JBQTVCLEVBQStDLHFDQUEvQyxDQUFOO0FBQ0Q7O0FBQ0QsU0FBT2MsU0FBUDtBQUNELENBdENELEMsQ0F3Q0E7OztBQUNBLFNBQVNZLGdCQUFULENBQTBCQyxRQUExQixFQUFvQ0MsT0FBTyxHQUFHLEVBQTlDLEVBQWtEO0FBQ2hELFNBQU9yQixhQUFhLENBQUNvQixRQUFELEVBQVdDLE9BQVgsQ0FBcEI7QUFDRCxDLENBRUQ7OztBQUNBLFNBQVNDLGFBQVQsR0FBeUI7QUFDdkIsU0FBT0MsT0FBTyxDQUFDQyxPQUFSLEVBQVA7QUFDRDs7QUFFREMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQ2ZKLEVBQUFBLGFBRGU7QUFFZkgsRUFBQUE7QUFGZSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8vIEFwcGxlIFNpZ25JbiBBdXRoXG4vLyBodHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vZG9jdW1lbnRhdGlvbi9zaWduaW53aXRoYXBwbGVyZXN0YXBpXG5cbmNvbnN0IFBhcnNlID0gcmVxdWlyZSgncGFyc2Uvbm9kZScpLlBhcnNlO1xuY29uc3Qgandrc0NsaWVudCA9IHJlcXVpcmUoJ2p3a3MtcnNhJyk7XG5jb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpO1xuY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XG5cbmNvbnN0IFRPS0VOX0lTU1VFUiA9ICdodHRwczovL2FwcGxlaWQuYXBwbGUuY29tJztcblxuY29uc3QgZ2V0QXBwbGVLZXlCeUtleUlkID0gYXN5bmMgKGtleUlkLCBjYWNoZU1heEVudHJpZXMsIGNhY2hlTWF4QWdlKSA9PiB7XG4gIGNvbnN0IGNsaWVudCA9IGp3a3NDbGllbnQoe1xuICAgIGp3a3NVcmk6IGAke1RPS0VOX0lTU1VFUn0vYXV0aC9rZXlzYCxcbiAgICBjYWNoZTogdHJ1ZSxcbiAgICBjYWNoZU1heEVudHJpZXMsXG4gICAgY2FjaGVNYXhBZ2UsXG4gIH0pO1xuXG4gIGNvbnN0IGFzeW5jR2V0U2lnbmluZ0tleUZ1bmN0aW9uID0gdXRpbC5wcm9taXNpZnkoY2xpZW50LmdldFNpZ25pbmdLZXkpO1xuXG4gIGxldCBrZXk7XG4gIHRyeSB7XG4gICAga2V5ID0gYXdhaXQgYXN5bmNHZXRTaWduaW5nS2V5RnVuY3Rpb24oa2V5SWQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgIFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsXG4gICAgICBgVW5hYmxlIHRvIGZpbmQgbWF0Y2hpbmcga2V5IGZvciBLZXkgSUQ6ICR7a2V5SWR9YFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGtleTtcbn07XG5cbmNvbnN0IGdldEhlYWRlckZyb21Ub2tlbiA9IHRva2VuID0+IHtcbiAgY29uc3QgZGVjb2RlZFRva2VuID0gand0LmRlY29kZSh0b2tlbiwgeyBjb21wbGV0ZTogdHJ1ZSB9KTtcbiAgaWYgKCFkZWNvZGVkVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgYHByb3ZpZGVkIHRva2VuIGRvZXMgbm90IGRlY29kZSBhcyBKV1RgKTtcbiAgfVxuXG4gIHJldHVybiBkZWNvZGVkVG9rZW4uaGVhZGVyO1xufTtcblxuY29uc3QgdmVyaWZ5SWRUb2tlbiA9IGFzeW5jICh7IHRva2VuLCBpZCB9LCB7IGNsaWVudElkLCBjYWNoZU1heEVudHJpZXMsIGNhY2hlTWF4QWdlIH0pID0+IHtcbiAgaWYgKCF0b2tlbikge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELCBgaWQgdG9rZW4gaXMgaW52YWxpZCBmb3IgdGhpcyB1c2VyLmApO1xuICB9XG5cbiAgY29uc3QgeyBraWQ6IGtleUlkLCBhbGc6IGFsZ29yaXRobSB9ID0gZ2V0SGVhZGVyRnJvbVRva2VuKHRva2VuKTtcbiAgY29uc3QgT05FX0hPVVJfSU5fTVMgPSAzNjAwMDAwO1xuICBsZXQgand0Q2xhaW1zO1xuXG4gIGNhY2hlTWF4QWdlID0gY2FjaGVNYXhBZ2UgfHwgT05FX0hPVVJfSU5fTVM7XG4gIGNhY2hlTWF4RW50cmllcyA9IGNhY2hlTWF4RW50cmllcyB8fCA1O1xuXG4gIGNvbnN0IGFwcGxlS2V5ID0gYXdhaXQgZ2V0QXBwbGVLZXlCeUtleUlkKGtleUlkLCBjYWNoZU1heEVudHJpZXMsIGNhY2hlTWF4QWdlKTtcbiAgY29uc3Qgc2lnbmluZ0tleSA9IGFwcGxlS2V5LnB1YmxpY0tleSB8fCBhcHBsZUtleS5yc2FQdWJsaWNLZXk7XG5cbiAgdHJ5IHtcbiAgICBqd3RDbGFpbXMgPSBqd3QudmVyaWZ5KHRva2VuLCBzaWduaW5nS2V5LCB7XG4gICAgICBhbGdvcml0aG1zOiBhbGdvcml0aG0sXG4gICAgICAvLyB0aGUgYXVkaWVuY2UgY2FuIGJlIGNoZWNrZWQgYWdhaW5zdCBhIHN0cmluZywgYSByZWd1bGFyIGV4cHJlc3Npb24gb3IgYSBsaXN0IG9mIHN0cmluZ3MgYW5kL29yIHJlZ3VsYXIgZXhwcmVzc2lvbnMuXG4gICAgICBhdWRpZW5jZTogY2xpZW50SWQsXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGV4Y2VwdGlvbikge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBleGNlcHRpb24ubWVzc2FnZTtcblxuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELCBgJHttZXNzYWdlfWApO1xuICB9XG5cbiAgaWYgKGp3dENsYWltcy5pc3MgIT09IFRPS0VOX0lTU1VFUikge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgIFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsXG4gICAgICBgaWQgdG9rZW4gbm90IGlzc3VlZCBieSBjb3JyZWN0IE9wZW5JRCBwcm92aWRlciAtIGV4cGVjdGVkOiAke1RPS0VOX0lTU1VFUn0gfCBmcm9tOiAke2p3dENsYWltcy5pc3N9YFxuICAgICk7XG4gIH1cblxuICBpZiAoand0Q2xhaW1zLnN1YiAhPT0gaWQpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgYGF1dGggZGF0YSBpcyBpbnZhbGlkIGZvciB0aGlzIHVzZXIuYCk7XG4gIH1cbiAgcmV0dXJuIGp3dENsYWltcztcbn07XG5cbi8vIFJldHVybnMgYSBwcm9taXNlIHRoYXQgZnVsZmlsbHMgaWYgdGhpcyBpZCB0b2tlbiBpcyB2YWxpZFxuZnVuY3Rpb24gdmFsaWRhdGVBdXRoRGF0YShhdXRoRGF0YSwgb3B0aW9ucyA9IHt9KSB7XG4gIHJldHVybiB2ZXJpZnlJZFRva2VuKGF1dGhEYXRhLCBvcHRpb25zKTtcbn1cblxuLy8gUmV0dXJucyBhIHByb21pc2UgdGhhdCBmdWxmaWxscyBpZiB0aGlzIGFwcCBpZCBpcyB2YWxpZC5cbmZ1bmN0aW9uIHZhbGlkYXRlQXBwSWQoKSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHZhbGlkYXRlQXBwSWQsXG4gIHZhbGlkYXRlQXV0aERhdGEsXG59O1xuIl19
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9BdXRoL2FwcGxlLmpzIl0sIm5hbWVzIjpbIlBhcnNlIiwicmVxdWlyZSIsImp3a3NDbGllbnQiLCJ1dGlsIiwiand0IiwiVE9LRU5fSVNTVUVSIiwiZ2V0QXBwbGVLZXlCeUtleUlkIiwiY2xpZW50Iiwiandrc1VyaSIsImNhY2hlIiwiY2FjaGVNYXhBZ2UiLCJhc3luY0dldFNpZ25pbmdLZXlGdW5jdGlvbiIsImtleSIsImtleUlkIiwiZ2V0SGVhZGVyRnJvbVRva2VuIiwidG9rZW4iLCJkZWNvZGVkVG9rZW4iLCJjb21wbGV0ZSIsInZlcmlmeUlkVG9rZW4iLCJpZCIsImtpZCIsImFsZyIsImFsZ29yaXRobSIsIk9ORV9IT1VSX0lOX01TIiwiY2FjaGVNYXhFbnRyaWVzIiwiYXBwbGVLZXkiLCJzaWduaW5nS2V5Iiwiand0Q2xhaW1zIiwiYWxnb3JpdGhtcyIsImF1ZGllbmNlIiwiY2xpZW50SWQiLCJtZXNzYWdlIiwiZXhjZXB0aW9uIiwiaXNzIiwib3B0aW9ucyIsIlByb21pc2UiLCJtb2R1bGUiLCJ2YWxpZGF0ZUF1dGhEYXRhIl0sIm1hcHBpbmdzIjoiYUFBQTtBQUNBOzZ1V0FVUU87MkZBUlIsS0FBTVAsQ0FBQUEsS0FBSywwQkFBR0MsT0FBTyxDQUFQQSxZQUFPLENBQVBBLENBQWQsS0FBVyxDQUFYLENBQ0EsS0FBTUMsQ0FBQUEsVUFBVSwwQkFBR0QsT0FBTyxDQUExQixVQUEwQixDQUFWLENBQWhCLENBQ0EsS0FBTUUsQ0FBQUEsSUFBSSwwQkFBR0YsT0FBTyxDQUFwQixNQUFvQixDQUFWLENBQVYsQ0FDQSxLQUFNRyxDQUFBQSxHQUFHLDBCQUFHSCxPQUFPLENBQW5CLGNBQW1CLENBQVYsQ0FBVCxDQUVBLEtBQU1JLENBQUFBLFlBQVksMEJBQWxCLDJCQUFrQixDQUFsQixDLHdCQUVBLEtBQU1DLENBQUFBLGtCQUFrQixDQUFHLE1BQUEsS0FBQSxDQUFBLGVBQUEsQ0FBQSxXQUFBLEdBQStDLHlCQUN4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QSxDQUErQyxHQUFFK0IsT0FBdkQsRUFBTSxDQUFOLENBQ0QsQ0F6QndGLHlCQTJCekYsR0FBSUosU0FBUyxDQUFUQSxHQUFBQSxHQUFKLFlBQUEsQ0FBb0MscURBQ2xDLEtBQU0sSUFBSTNCLENBQUFBLEtBQUssQ0FBVCxLQUFBLENBQ0pBLEtBQUssQ0FBTEEsS0FBQUEsQ0FESSxnQkFBQSxDQUVILDhEQUE2REssWUFBYSxZQUFXc0IsU0FBUyxDQUFDTSxHQUZsRyxFQUFNLENBQU4sQ0FJRCxDQUxELGlDQTNCeUYseUJBa0N6RixHQUFJTixTQUFTLENBQVRBLEdBQUFBLEdBQUosRUFBQSxDQUEwQixxREFDeEIsS0FBTSxJQUFJM0IsQ0FBQUEsS0FBSyxDQUFULEtBQUEsQ0FBZ0JBLEtBQUssQ0FBTEEsS0FBQUEsQ0FBaEIsZ0JBQUEsQ0FBTixxQ0FBTSxDQUFOLENBQ0QsQ0FGRCxpQ0FsQ3lGLHlCQXFDekYsTUFBQSxDQUFBLFNBQUEsQ0FyQ0YsQ0FBQSxDQXdDQTtBQUNBLFFBQUEsQ0FBQSxnQkFBQSxDQUFBLFFBQUEsQ0FBb0NrQyxPQUFPLDZCQUEzQyxFQUEyQyxDQUEzQyxDQUFrRCxrREFDaEQsTUFBT2hCLENBQUFBLGFBQWEsQ0FBQSxRQUFBLENBQXBCLE9BQW9CLENBQXBCLEMsQ0FHRjtBQUNBLFFBQUEsQ0FBQSxhQUFBLEVBQXlCLGtEQUN2QixNQUFPaUIsQ0FBQUEsT0FBTyxDQUFkLE9BQU9BLEVBQVAsQ0FDRCxDLHlCQUVEQyxNQUFNLENBQU5BLE9BQUFBLENBQWlCLENBQUEsYUFBQSxDQUVmQyxnQkFGZSxDQUFqQkQsQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEFwcGxlIFNpZ25JbiBBdXRoXG4vLyBodHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vZG9jdW1lbnRhdGlvbi9zaWduaW53aXRoYXBwbGVyZXN0YXBpXG5cbmNvbnN0IFBhcnNlID0gcmVxdWlyZSgncGFyc2Uvbm9kZScpLlBhcnNlO1xuY29uc3Qgandrc0NsaWVudCA9IHJlcXVpcmUoJ2p3a3MtcnNhJyk7XG5jb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpO1xuY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XG5cbmNvbnN0IFRPS0VOX0lTU1VFUiA9ICdodHRwczovL2FwcGxlaWQuYXBwbGUuY29tJztcblxuY29uc3QgZ2V0QXBwbGVLZXlCeUtleUlkID0gYXN5bmMgKGtleUlkLCBjYWNoZU1heEVudHJpZXMsIGNhY2hlTWF4QWdlKSA9PiB7XG4gIGNvbnN0IGNsaWVudCA9IGp3a3NDbGllbnQoe1xuICAgIGp3a3NVcmk6IGAke1RPS0VOX0lTU1VFUn0vYXV0aC9rZXlzYCxcbiAgICBjYWNoZTogdHJ1ZSxcbiAgICBjYWNoZU1heEVudHJpZXMsXG4gICAgY2FjaGVNYXhBZ2UsXG4gIH0pO1xuXG4gIGNvbnN0IGFzeW5jR2V0U2lnbmluZ0tleUZ1bmN0aW9uID0gdXRpbC5wcm9taXNpZnkoY2xpZW50LmdldFNpZ25pbmdLZXkpO1xuXG4gIGxldCBrZXk7XG4gIHRyeSB7XG4gICAga2V5ID0gYXdhaXQgYXN5bmNHZXRTaWduaW5nS2V5RnVuY3Rpb24oa2V5SWQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgIFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsXG4gICAgICBgVW5hYmxlIHRvIGZpbmQgbWF0Y2hpbmcga2V5IGZvciBLZXkgSUQ6ICR7a2V5SWR9YFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGtleTtcbn07XG5cbmNvbnN0IGdldEhlYWRlckZyb21Ub2tlbiA9IHRva2VuID0+IHtcbiAgY29uc3QgZGVjb2RlZFRva2VuID0gand0LmRlY29kZSh0b2tlbiwgeyBjb21wbGV0ZTogdHJ1ZSB9KTtcbiAgaWYgKCFkZWNvZGVkVG9rZW4pIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgYHByb3ZpZGVkIHRva2VuIGRvZXMgbm90IGRlY29kZSBhcyBKV1RgKTtcbiAgfVxuXG4gIHJldHVybiBkZWNvZGVkVG9rZW4uaGVhZGVyO1xufTtcblxuY29uc3QgdmVyaWZ5SWRUb2tlbiA9IGFzeW5jICh7IHRva2VuLCBpZCB9LCB7IGNsaWVudElkLCBjYWNoZU1heEVudHJpZXMsIGNhY2hlTWF4QWdlIH0pID0+IHtcbiAgaWYgKCF0b2tlbikge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELCBgaWQgdG9rZW4gaXMgaW52YWxpZCBmb3IgdGhpcyB1c2VyLmApO1xuICB9XG5cbiAgY29uc3QgeyBraWQ6IGtleUlkLCBhbGc6IGFsZ29yaXRobSB9ID0gZ2V0SGVhZGVyRnJvbVRva2VuKHRva2VuKTtcbiAgY29uc3QgT05FX0hPVVJfSU5fTVMgPSAzNjAwMDAwO1xuICBsZXQgand0Q2xhaW1zO1xuXG4gIGNhY2hlTWF4QWdlID0gY2FjaGVNYXhBZ2UgfHwgT05FX0hPVVJfSU5fTVM7XG4gIGNhY2hlTWF4RW50cmllcyA9IGNhY2hlTWF4RW50cmllcyB8fCA1O1xuXG4gIGNvbnN0IGFwcGxlS2V5ID0gYXdhaXQgZ2V0QXBwbGVLZXlCeUtleUlkKGtleUlkLCBjYWNoZU1heEVudHJpZXMsIGNhY2hlTWF4QWdlKTtcbiAgY29uc3Qgc2lnbmluZ0tleSA9IGFwcGxlS2V5LnB1YmxpY0tleSB8fCBhcHBsZUtleS5yc2FQdWJsaWNLZXk7XG5cbiAgdHJ5IHtcbiAgICBqd3RDbGFpbXMgPSBqd3QudmVyaWZ5KHRva2VuLCBzaWduaW5nS2V5LCB7XG4gICAgICBhbGdvcml0aG1zOiBhbGdvcml0aG0sXG4gICAgICAvLyB0aGUgYXVkaWVuY2UgY2FuIGJlIGNoZWNrZWQgYWdhaW5zdCBhIHN0cmluZywgYSByZWd1bGFyIGV4cHJlc3Npb24gb3IgYSBsaXN0IG9mIHN0cmluZ3MgYW5kL29yIHJlZ3VsYXIgZXhwcmVzc2lvbnMuXG4gICAgICBhdWRpZW5jZTogY2xpZW50SWQsXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGV4Y2VwdGlvbikge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBleGNlcHRpb24ubWVzc2FnZTtcblxuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELCBgJHttZXNzYWdlfWApO1xuICB9XG5cbiAgaWYgKGp3dENsYWltcy5pc3MgIT09IFRPS0VOX0lTU1VFUikge1xuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgIFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsXG4gICAgICBgaWQgdG9rZW4gbm90IGlzc3VlZCBieSBjb3JyZWN0IE9wZW5JRCBwcm92aWRlciAtIGV4cGVjdGVkOiAke1RPS0VOX0lTU1VFUn0gfCBmcm9tOiAke2p3dENsYWltcy5pc3N9YFxuICAgICk7XG4gIH1cblxuICBpZiAoand0Q2xhaW1zLnN1YiAhPT0gaWQpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgYGF1dGggZGF0YSBpcyBpbnZhbGlkIGZvciB0aGlzIHVzZXIuYCk7XG4gIH1cbiAgcmV0dXJuIGp3dENsYWltcztcbn07XG5cbi8vIFJldHVybnMgYSBwcm9taXNlIHRoYXQgZnVsZmlsbHMgaWYgdGhpcyBpZCB0b2tlbiBpcyB2YWxpZFxuZnVuY3Rpb24gdmFsaWRhdGVBdXRoRGF0YShhdXRoRGF0YSwgb3B0aW9ucyA9IHt9KSB7XG4gIHJldHVybiB2ZXJpZnlJZFRva2VuKGF1dGhEYXRhLCBvcHRpb25zKTtcbn1cblxuLy8gUmV0dXJucyBhIHByb21pc2UgdGhhdCBmdWxmaWxscyBpZiB0aGlzIGFwcCBpZCBpcyB2YWxpZC5cbmZ1bmN0aW9uIHZhbGlkYXRlQXBwSWQoKSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHZhbGlkYXRlQXBwSWQsXG4gIHZhbGlkYXRlQXV0aERhdGEsXG59O1xuIl19