"use strict";function cov_22ifv5wh8i(){var path="/parse-server/lib/Controllers/PushController.js";var hash="4ae7648d7e0f492a62a5eabf2d7320e970ac6403";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Controllers/PushController.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:50}},"2":{start:{line:8,column:12},end:{line:8,column:33}},"3":{start:{line:10,column:17},end:{line:10,column:64}},"4":{start:{line:12,column:17},end:{line:12,column:64}},"5":{start:{line:14,column:12},end:{line:14,column:30}},"6":{start:{line:16,column:21},end:{line:16,column:48}},"7":{start:{line:18,column:13},end:{line:18,column:37}},"8":{start:{line:20,column:39},end:{line:20,column:93}},"9":{start:{line:24,column:4},end:{line:26,column:5}},"10":{start:{line:25,column:6},end:{line:25,column:102}},"11":{start:{line:29,column:4},end:{line:29,column:66}},"12":{start:{line:30,column:4},end:{line:30,column:74}},"13":{start:{line:32,column:4},end:{line:34,column:5}},"14":{start:{line:33,column:6},end:{line:33,column:134}},"15":{start:{line:37,column:4},end:{line:40,column:5}},"16":{start:{line:38,column:20},end:{line:38,column:51}},"17":{start:{line:39,column:6},end:{line:39,column:71}},"18":{start:{line:42,column:21},end:{line:42,column:53}},"19":{start:{line:44,column:4},end:{line:46,column:5}},"20":{start:{line:45,column:6},end:{line:45,column:66}},"21":{start:{line:50,column:22},end:{line:52,column:5}},"22":{start:{line:51,column:6},end:{line:51,column:31}},"23":{start:{line:54,column:4},end:{line:92,column:5}},"24":{start:{line:55,column:20},end:{line:55,column:35}},"25":{start:{line:56,column:23},end:{line:56,column:25}},"26":{start:{line:58,column:6},end:{line:78,column:7}},"27":{start:{line:59,column:8},end:{line:64,column:10}},"28":{start:{line:65,column:13},end:{line:78,column:7}},"29":{start:{line:66,column:8},end:{line:71,column:10}},"30":{start:{line:72,column:13},end:{line:78,column:7}},"31":{start:{line:73,column:8},end:{line:75,column:10}},"32":{start:{line:77,column:8},end:{line:77,column:95}},"33":{start:{line:81,column:26},end:{line:81,column:67}},"34":{start:{line:83,column:6},end:{line:91,column:8}},"35":{start:{line:85,column:26},end:{line:85,column:113}},"36":{start:{line:86,column:8},end:{line:90,column:11}},"37":{start:{line:87,column:24},end:{line:87,column:131}},"38":{start:{line:88,column:10},end:{line:88,column:39}},"39":{start:{line:89,column:10},end:{line:89,column:33}},"40":{start:{line:94,column:23},end:{line:94,column:68}},"41":{start:{line:95,column:4},end:{line:132,column:7}},"42":{start:{line:96,column:6},end:{line:96,column:48}},"43":{start:{line:98,column:6},end:{line:98,column:45}},"44":{start:{line:99,column:6},end:{line:99,column:27}},"45":{start:{line:102,column:6},end:{line:118,column:7}},"46":{start:{line:103,column:27},end:{line:103,column:43}},"47":{start:{line:104,column:29},end:{line:113,column:9}},"48":{start:{line:114,column:22},end:{line:116,column:26}},"49":{start:{line:117,column:8},end:{line:117,column:24}},"50":{start:{line:121,column:6},end:{line:121,column:31}},"51":{start:{line:123,column:6},end:{line:125,column:7}},"52":{start:{line:124,column:8},end:{line:124,column:33}},"53":{start:{line:127,column:6},end:{line:127,column:87}},"54":{start:{line:129,column:6},end:{line:131,column:9}},"55":{start:{line:130,column:8},end:{line:130,column:18}},"56":{start:{line:142,column:28},end:{line:142,column:89}},"57":{start:{line:144,column:4},end:{line:146,column:5}},"58":{start:{line:145,column:6},end:{line:145,column:13}},"59":{start:{line:148,column:30},end:{line:148,column:53}},"60":{start:{line:151,column:4},end:{line:157,column:5}},"61":{start:{line:152,column:6},end:{line:152,column:60}},"62":{start:{line:153,column:11},end:{line:157,column:5}},"63":{start:{line:154,column:6},end:{line:154,column:53}},"64":{start:{line:156,column:6},end:{line:156,column:121}},"65":{start:{line:160,column:4},end:{line:162,column:5}},"66":{start:{line:161,column:6},end:{line:161,column:121}},"67":{start:{line:164,column:4},end:{line:164,column:36}},"68":{start:{line:168,column:34},end:{line:168,column:99}},"69":{start:{line:170,column:4},end:{line:172,column:5}},"70":{start:{line:171,column:6},end:{line:171,column:13}},"71":{start:{line:174,column:34},end:{line:174,column:61}},"72":{start:{line:176,column:4},end:{line:178,column:5}},"73":{start:{line:177,column:6},end:{line:177,column:127}},"74":{start:{line:180,column:4},end:{line:180,column:35}},"75":{start:{line:190,column:22},end:{line:190,column:77}},"76":{start:{line:192,column:4},end:{line:194,column:5}},"77":{start:{line:193,column:6},end:{line:193,column:13}},"78":{start:{line:196,column:24},end:{line:196,column:41}},"79":{start:{line:198,column:22},end:{line:198,column:26}},"80":{start:{line:200,column:4},end:{line:207,column:5}},"81":{start:{line:201,column:6},end:{line:201,column:44}},"82":{start:{line:202,column:11},end:{line:207,column:5}},"83":{start:{line:203,column:6},end:{line:203,column:80}},"84":{start:{line:204,column:6},end:{line:204,column:37}},"85":{start:{line:206,column:6},end:{line:206,column:115}},"86":{start:{line:210,column:4},end:{line:212,column:5}},"87":{start:{line:211,column:6},end:{line:211,column:115}},"88":{start:{line:214,column:4},end:{line:217,column:6}},"89":{start:{line:227,column:26},end:{line:227,column:48}},"90":{start:{line:228,column:4},end:{line:229,column:5}},"91":{start:{line:243,column:4},end:{line:247,column:5}},"92":{start:{line:245,column:24},end:{line:245,column:42}},"93":{start:{line:246,column:6},end:{line:246,column:60}},"94":{start:{line:249,column:4},end:{line:249,column:30}},"95":{start:{line:254,column:0},end:{line:254,column:40}},"96":{start:{line:255,column:15},end:{line:255,column:29}},"97":{start:{line:256,column:0},end:{line:256,column:27}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:20,column:9},end:{line:20,column:31}},loc:{start:{line:20,column:37},end:{line:20,column:95}},line:20},"1":{name:"(anonymous_1)",decl:{start:{line:23,column:2},end:{line:23,column:3}},loc:{start:{line:23,column:96},end:{line:133,column:3}},line:23},"2":{name:"(anonymous_2)",decl:{start:{line:23,column:68},end:{line:23,column:69}},loc:{start:{line:23,column:74},end:{line:23,column:76}},line:23},"3":{name:"(anonymous_3)",decl:{start:{line:50,column:22},end:{line:50,column:23}},loc:{start:{line:50,column:28},end:{line:52,column:5}},line:50},"4":{name:"(anonymous_4)",decl:{start:{line:83,column:20},end:{line:83,column:21}},loc:{start:{line:83,column:26},end:{line:91,column:7}},line:83},"5":{name:"(anonymous_5)",decl:{start:{line:86,column:47},end:{line:86,column:48}},loc:{start:{line:86,column:53},end:{line:90,column:9}},line:86},"6":{name:"(anonymous_6)",decl:{start:{line:95,column:34},end:{line:95,column:35}},loc:{start:{line:95,column:40},end:{line:97,column:5}},line:95},"7":{name:"(anonymous_7)",decl:{start:{line:97,column:12},end:{line:97,column:13}},loc:{start:{line:97,column:18},end:{line:100,column:5}},line:97},"8":{name:"(anonymous_8)",decl:{start:{line:100,column:12},end:{line:100,column:13}},loc:{start:{line:100,column:18},end:{line:122,column:5}},line:100},"9":{name:"(anonymous_9)",decl:{start:{line:122,column:12},end:{line:122,column:13}},loc:{start:{line:122,column:18},end:{line:128,column:5}},line:122},"10":{name:"(anonymous_10)",decl:{start:{line:128,column:13},end:{line:128,column:14}},loc:{start:{line:128,column:20},end:{line:132,column:5}},line:128},"11":{name:"(anonymous_11)",decl:{start:{line:129,column:39},end:{line:129,column:40}},loc:{start:{line:129,column:45},end:{line:131,column:7}},line:129},"12":{name:"(anonymous_12)",decl:{start:{line:141,column:2},end:{line:141,column:3}},loc:{start:{line:141,column:38},end:{line:165,column:3}},line:141},"13":{name:"(anonymous_13)",decl:{start:{line:167,column:2},end:{line:167,column:3}},loc:{start:{line:167,column:42},end:{line:181,column:3}},line:167},"14":{name:"(anonymous_14)",decl:{start:{line:189,column:2},end:{line:189,column:3}},loc:{start:{line:189,column:32},end:{line:218,column:3}},line:189},"15":{name:"(anonymous_15)",decl:{start:{line:226,column:2},end:{line:226,column:3}},loc:{start:{line:226,column:53},end:{line:230,column:3}},line:226},"16":{name:"(anonymous_16)",decl:{start:{line:239,column:2},end:{line:239,column:3}},loc:{start:{line:242,column:5},end:{line:250,column:3}},line:242}},branchMap:{"0":{loc:{start:{line:20,column:46},end:{line:20,column:92}},type:"cond-expr",locations:[{start:{line:20,column:70},end:{line:20,column:73}},{start:{line:20,column:76},end:{line:20,column:92}}],line:20},"1":{loc:{start:{line:20,column:46},end:{line:20,column:67}},type:"binary-expr",locations:[{start:{line:20,column:46},end:{line:20,column:49}},{start:{line:20,column:53},end:{line:20,column:67}}],line:20},"2":{loc:{start:{line:23,column:11},end:{line:23,column:20}},type:"default-arg",locations:[{start:{line:23,column:18},end:{line:23,column:20}}],line:23},"3":{loc:{start:{line:23,column:22},end:{line:23,column:32}},type:"default-arg",locations:[{start:{line:23,column:30},end:{line:23,column:32}}],line:23},"4":{loc:{start:{line:23,column:48},end:{line:23,column:76}},type:"default-arg",locations:[{start:{line:23,column:68},end:{line:23,column:76}}],line:23},"5":{loc:{start:{line:23,column:78},end:{line:23,column:94}},type:"default-arg",locations:[{start:{line:23,column:84},end:{line:23,column:94}}],line:23},"6":{loc:{start:{line:24,column:4},end:{line:26,column:5}},type:"if",locations:[{start:{line:24,column:4},end:{line:26,column:5}},{start:{line:24,column:4},end:{line:26,column:5}}],line:24},"7":{loc:{start:{line:32,column:4},end:{line:34,column:5}},type:"if",locations:[{start:{line:32,column:4},end:{line:34,column:5}},{start:{line:32,column:4},end:{line:34,column:5}}],line:32},"8":{loc:{start:{line:32,column:8},end:{line:32,column:56}},type:"binary-expr",locations:[{start:{line:32,column:8},end:{line:32,column:28}},{start:{line:32,column:32},end:{line:32,column:56}}],line:32},"9":{loc:{start:{line:37,column:4},end:{line:40,column:5}},type:"if",locations:[{start:{line:37,column:4},end:{line:40,column:5}},{start:{line:37,column:4},end:{line:40,column:5}}],line:37},"10":{loc:{start:{line:37,column:8},end:{line:37,column:92}},type:"binary-expr",locations:[{start:{line:37,column:8},end:{line:37,column:32}},{start:{line:37,column:36},end:{line:37,column:92}}],line:37},"11":{loc:{start:{line:44,column:4},end:{line:46,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:46,column:5}},{start:{line:44,column:4},end:{line:46,column:5}}],line:44},"12":{loc:{start:{line:44,column:8},end:{line:44,column:49}},type:"binary-expr",locations:[{start:{line:44,column:8},end:{line:44,column:16}},{start:{line:44,column:20},end:{line:44,column:49}}],line:44},"13":{loc:{start:{line:54,column:4},end:{line:92,column:5}},type:"if",locations:[{start:{line:54,column:4},end:{line:92,column:5}},{start:{line:54,column:4},end:{line:92,column:5}}],line:54},"14":{loc:{start:{line:54,column:8},end:{line:54,column:36}},type:"binary-expr",locations:[{start:{line:54,column:8},end:{line:54,column:17}},{start:{line:54,column:21},end:{line:54,column:36}}],line:54},"15":{loc:{start:{line:58,column:6},end:{line:78,column:7}},type:"if",locations:[{start:{line:58,column:6},end:{line:78,column:7}},{start:{line:58,column:6},end:{line:78,column:7}}],line:58},"16":{loc:{start:{line:58,column:10},end:{line:58,column:73}},type:"binary-expr",locations:[{start:{line:58,column:10},end:{line:58,column:34}},{start:{line:58,column:38},end:{line:58,column:73}}],line:58},"17":{loc:{start:{line:65,column:13},end:{line:78,column:7}},type:"if",locations:[{start:{line:65,column:13},end:{line:78,column:7}},{start:{line:65,column:13},end:{line:78,column:7}}],line:65},"18":{loc:{start:{line:65,column:17},end:{line:65,column:141}},type:"binary-expr",locations:[{start:{line:65,column:17},end:{line:65,column:41}},{start:{line:65,column:45},end:{line:65,column:74}},{start:{line:65,column:78},end:{line:65,column:117}},{start:{line:65,column:121},end:{line:65,column:141}}],line:65},"19":{loc:{start:{line:72,column:13},end:{line:78,column:7}},type:"if",locations:[{start:{line:72,column:13},end:{line:78,column:7}},{start:{line:72,column:13},end:{line:78,column:7}}],line:72},"20":{loc:{start:{line:102,column:6},end:{line:118,column:7}},type:"if",locations:[{start:{line:102,column:6},end:{line:118,column:7}},{start:{line:102,column:6},end:{line:118,column:7}}],line:102},"21":{loc:{start:{line:123,column:6},end:{line:125,column:7}},type:"if",locations:[{start:{line:123,column:6},end:{line:125,column:7}},{start:{line:123,column:6},end:{line:125,column:7}}],line:123},"22":{loc:{start:{line:123,column:10},end:{line:123,column:99}},type:"binary-expr",locations:[{start:{line:123,column:10},end:{line:123,column:65}},{start:{line:123,column:69},end:{line:123,column:99}}],line:123},"23":{loc:{start:{line:141,column:27},end:{line:141,column:36}},type:"default-arg",locations:[{start:{line:141,column:34},end:{line:141,column:36}}],line:141},"24":{loc:{start:{line:144,column:4},end:{line:146,column:5}},type:"if",locations:[{start:{line:144,column:4},end:{line:146,column:5}},{start:{line:144,column:4},end:{line:146,column:5}}],line:144},"25":{loc:{start:{line:151,column:4},end:{line:157,column:5}},type:"if",locations:[{start:{line:151,column:4},end:{line:157,column:5}},{start:{line:151,column:4},end:{line:157,column:5}}],line:151},"26":{loc:{start:{line:153,column:11},end:{line:157,column:5}},type:"if",locations:[{start:{line:153,column:11},end:{line:157,column:5}},{start:{line:153,column:11},end:{line:157,column:5}}],line:153},"27":{loc:{start:{line:160,column:4},end:{line:162,column:5}},type:"if",locations:[{start:{line:160,column:4},end:{line:162,column:5}},{start:{line:160,column:4},end:{line:162,column:5}}],line:160},"28":{loc:{start:{line:167,column:31},end:{line:167,column:40}},type:"default-arg",locations:[{start:{line:167,column:38},end:{line:167,column:40}}],line:167},"29":{loc:{start:{line:170,column:4},end:{line:172,column:5}},type:"if",locations:[{start:{line:170,column:4},end:{line:172,column:5}},{start:{line:170,column:4},end:{line:172,column:5}}],line:170},"30":{loc:{start:{line:176,column:4},end:{line:178,column:5}},type:"if",locations:[{start:{line:176,column:4},end:{line:178,column:5}},{start:{line:176,column:4},end:{line:178,column:5}}],line:176},"31":{loc:{start:{line:176,column:8},end:{line:176,column:83}},type:"binary-expr",locations:[{start:{line:176,column:8},end:{line:176,column:51}},{start:{line:176,column:55},end:{line:176,column:83}}],line:176},"32":{loc:{start:{line:189,column:21},end:{line:189,column:30}},type:"default-arg",locations:[{start:{line:189,column:28},end:{line:189,column:30}}],line:189},"33":{loc:{start:{line:192,column:4},end:{line:194,column:5}},type:"if",locations:[{start:{line:192,column:4},end:{line:194,column:5}},{start:{line:192,column:4},end:{line:194,column:5}}],line:192},"34":{loc:{start:{line:200,column:4},end:{line:207,column:5}},type:"if",locations:[{start:{line:200,column:4},end:{line:207,column:5}},{start:{line:200,column:4},end:{line:207,column:5}}],line:200},"35":{loc:{start:{line:202,column:11},end:{line:207,column:5}},type:"if",locations:[{start:{line:202,column:11},end:{line:207,column:5}},{start:{line:202,column:11},end:{line:207,column:5}}],line:202},"36":{loc:{start:{line:210,column:4},end:{line:212,column:5}},type:"if",locations:[{start:{line:210,column:4},end:{line:212,column:5}},{start:{line:210,column:4},end:{line:212,column:5}}],line:210},"37":{loc:{start:{line:228,column:11},end:{line:228,column:103}},type:"binary-expr",locations:[{start:{line:228,column:11},end:{line:228,column:66}},{start:{line:228,column:70},end:{line:228,column:103}}],line:228},"38":{loc:{start:{line:243,column:4},end:{line:247,column:5}},type:"if",locations:[{start:{line:243,column:4},end:{line:247,column:5}},{start:{line:243,column:4},end:{line:247,column:5}}],line:243}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0],"1":[0,0],"2":[0],"3":[0],"4":[0],"5":[0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0,0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0]},inputSourceMap:{version:3,sources:["../../src/Controllers/PushController.js"],names:["PushController","sendPush","body","where","config","auth","onPushStatusSaved","now","Date","hasPushSupport","Parse","Error","PUSH_MISCONFIGURED","expiration_time","getExpirationTime","expiration_interval","getExpirationInterval","Object","prototype","hasOwnProperty","call","ttlMs","valueOf","pushTime","getPushTime","date","formatPushTime","badgeUpdate","Promise","resolve","data","badge","restUpdate","toLowerCase","__op","amount","Number","updateWhere","restQuery","RestQuery","buildRestWhere","then","write","RestWrite","restWhere","runOptions","many","execute","pushStatus","setInitial","objectId","audience_id","audienceId","updateAudience","lastUsed","__type","iso","toISOString","timesUsed","hasPushScheduledSupport","pushControllerQueue","enqueue","catch","err","fail","hasExpirationTime","expirationTimeParam","expirationTime","isFinite","hasExpirationInterval","expirationIntervalParam","hasPushTime","pushTimeParam","isLocalTime","pushTimeHasTimezoneComponent","offsetPattern","indexOf","length","test","isoString","substring"],mappings:"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",sourcesContent:["import { Parse } from 'parse/node';\nimport RestQuery from '../RestQuery';\nimport RestWrite from '../RestWrite';\nimport { master } from '../Auth';\nimport { pushStatusHandler } from '../StatusHandler';\nimport { applyDeviceTokenExists } from '../Push/utils';\n\nexport class PushController {\n  sendPush(body = {}, where = {}, config, auth, onPushStatusSaved = () => {}, now = new Date()) {\n    if (!config.hasPushSupport) {\n      throw new Parse.Error(Parse.Error.PUSH_MISCONFIGURED, 'Missing push configuration');\n    }\n\n    // Replace the expiration_time and push_time with a valid Unix epoch milliseconds time\n    body.expiration_time = PushController.getExpirationTime(body);\n    body.expiration_interval = PushController.getExpirationInterval(body);\n    if (body.expiration_time && body.expiration_interval) {\n      throw new Parse.Error(\n        Parse.Error.PUSH_MISCONFIGURED,\n        'Both expiration_time and expiration_interval cannot be set'\n      );\n    }\n\n    // Immediate push\n    if (body.expiration_interval && !Object.prototype.hasOwnProperty.call(body, 'push_time')) {\n      const ttlMs = body.expiration_interval * 1000;\n      body.expiration_time = new Date(now.valueOf() + ttlMs).valueOf();\n    }\n\n    const pushTime = PushController.getPushTime(body);\n    if (pushTime && pushTime.date !== 'undefined') {\n      body['push_time'] = PushController.formatPushTime(pushTime);\n    }\n\n    // TODO: If the req can pass the checking, we return immediately instead of waiting\n    // pushes to be sent. We probably change this behaviour in the future.\n    let badgeUpdate = () => {\n      return Promise.resolve();\n    };\n\n    if (body.data && body.data.badge) {\n      const badge = body.data.badge;\n      let restUpdate = {};\n      if (typeof badge == 'string' && badge.toLowerCase() === 'increment') {\n        restUpdate = { badge: { __op: 'Increment', amount: 1 } };\n      } else if (\n        typeof badge == 'object' &&\n        typeof badge.__op == 'string' &&\n        badge.__op.toLowerCase() == 'increment' &&\n        Number(badge.amount)\n      ) {\n        restUpdate = { badge: { __op: 'Increment', amount: badge.amount } };\n      } else if (Number(badge)) {\n        restUpdate = { badge: badge };\n      } else {\n        throw \"Invalid value for badge, expected number or 'Increment' or {increment: number}\";\n      }\n\n      // Force filtering on only valid device tokens\n      const updateWhere = applyDeviceTokenExists(where);\n      badgeUpdate = () => {\n        // Build a real RestQuery so we can use it in RestWrite\n        const restQuery = new RestQuery(config, master(config), '_Installation', updateWhere);\n        return restQuery.buildRestWhere().then(() => {\n          const write = new RestWrite(\n            config,\n            master(config),\n            '_Installation',\n            restQuery.restWhere,\n            restUpdate\n          );\n          write.runOptions.many = true;\n          return write.execute();\n        });\n      };\n    }\n    const pushStatus = pushStatusHandler(config);\n    return Promise.resolve()\n      .then(() => {\n        return pushStatus.setInitial(body, where);\n      })\n      .then(() => {\n        onPushStatusSaved(pushStatus.objectId);\n        return badgeUpdate();\n      })\n      .then(() => {\n        // Update audience lastUsed and timesUsed\n        if (body.audience_id) {\n          const audienceId = body.audience_id;\n\n          var updateAudience = {\n            lastUsed: { __type: 'Date', iso: new Date().toISOString() },\n            timesUsed: { __op: 'Increment', amount: 1 },\n          };\n          const write = new RestWrite(\n            config,\n            master(config),\n            '_Audience',\n            { objectId: audienceId },\n            updateAudience\n          );\n          write.execute();\n        }\n        // Don't wait for the audience update promise to resolve.\n        return Promise.resolve();\n      })\n      .then(() => {\n        if (\n          Object.prototype.hasOwnProperty.call(body, 'push_time') &&\n          config.hasPushScheduledSupport\n        ) {\n          return Promise.resolve();\n        }\n        return config.pushControllerQueue.enqueue(body, where, config, auth, pushStatus);\n      })\n      .catch(err => {\n        return pushStatus.fail(err).then(() => {\n          throw err;\n        });\n      });\n  }\n\n  /**\n   * Get expiration time from the request body.\n   * @param {Object} request A request object\n   * @returns {Number|undefined} The expiration time if it exists in the request\n   */\n  static getExpirationTime(body = {}) {\n    var hasExpirationTime = Object.prototype.hasOwnProperty.call(body, 'expiration_time');\n    if (!hasExpirationTime) {\n      return;\n    }\n    var expirationTimeParam = body['expiration_time'];\n    var expirationTime;\n    if (typeof expirationTimeParam === 'number') {\n      expirationTime = new Date(expirationTimeParam * 1000);\n    } else if (typeof expirationTimeParam === 'string') {\n      expirationTime = new Date(expirationTimeParam);\n    } else {\n      throw new Parse.Error(\n        Parse.Error.PUSH_MISCONFIGURED,\n        body['expiration_time'] + ' is not valid time.'\n      );\n    }\n    // Check expirationTime is valid or not, if it is not valid, expirationTime is NaN\n    if (!isFinite(expirationTime)) {\n      throw new Parse.Error(\n        Parse.Error.PUSH_MISCONFIGURED,\n        body['expiration_time'] + ' is not valid time.'\n      );\n    }\n    return expirationTime.valueOf();\n  }\n\n  static getExpirationInterval(body = {}) {\n    const hasExpirationInterval = Object.prototype.hasOwnProperty.call(body, 'expiration_interval');\n    if (!hasExpirationInterval) {\n      return;\n    }\n\n    var expirationIntervalParam = body['expiration_interval'];\n    if (typeof expirationIntervalParam !== 'number' || expirationIntervalParam <= 0) {\n      throw new Parse.Error(\n        Parse.Error.PUSH_MISCONFIGURED,\n        `expiration_interval must be a number greater than 0`\n      );\n    }\n    return expirationIntervalParam;\n  }\n\n  /**\n   * Get push time from the request body.\n   * @param {Object} request A request object\n   * @returns {Number|undefined} The push time if it exists in the request\n   */\n  static getPushTime(body = {}) {\n    var hasPushTime = Object.prototype.hasOwnProperty.call(body, 'push_time');\n    if (!hasPushTime) {\n      return;\n    }\n    var pushTimeParam = body['push_time'];\n    var date;\n    var isLocalTime = true;\n\n    if (typeof pushTimeParam === 'number') {\n      date = new Date(pushTimeParam * 1000);\n    } else if (typeof pushTimeParam === 'string') {\n      isLocalTime = !PushController.pushTimeHasTimezoneComponent(pushTimeParam);\n      date = new Date(pushTimeParam);\n    } else {\n      throw new Parse.Error(\n        Parse.Error.PUSH_MISCONFIGURED,\n        body['push_time'] + ' is not valid time.'\n      );\n    }\n    // Check pushTime is valid or not, if it is not valid, pushTime is NaN\n    if (!isFinite(date)) {\n      throw new Parse.Error(\n        Parse.Error.PUSH_MISCONFIGURED,\n        body['push_time'] + ' is not valid time.'\n      );\n    }\n\n    return {\n      date,\n      isLocalTime,\n    };\n  }\n\n  /**\n   * Checks if a ISO8601 formatted date contains a timezone component\n   * @param pushTimeParam {string}\n   * @returns {boolean}\n   */\n  static pushTimeHasTimezoneComponent(pushTimeParam: string): boolean {\n    const offsetPattern = /(.+)([+-])\\d\\d:\\d\\d$/;\n    return (\n      pushTimeParam.indexOf('Z') === pushTimeParam.length - 1 || offsetPattern.test(pushTimeParam) // 2007-04-05T12:30Z\n    ); // 2007-04-05T12:30.000+02:00, 2007-04-05T12:30.000-02:00\n  }\n\n  /**\n   * Converts a date to ISO format in UTC time and strips the timezone if `isLocalTime` is true\n   * @param date {Date}\n   * @param isLocalTime {boolean}\n   * @returns {string}\n   */\n  static formatPushTime({ date, isLocalTime }: { date: Date, isLocalTime: boolean }) {\n    if (isLocalTime) {\n      // Strip 'Z'\n      const isoString = date.toISOString();\n      return isoString.substring(0, isoString.indexOf('Z'));\n    }\n    return date.toISOString();\n  }\n}\n\nexport default PushController;\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"4ae7648d7e0f492a62a5eabf2d7320e970ac6403"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_22ifv5wh8i=function(){return actualCoverage;};}return actualCoverage;}cov_22ifv5wh8i();cov_22ifv5wh8i().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_22ifv5wh8i().s[1]++;exports.default=exports.PushController=void 0;var _node=(cov_22ifv5wh8i().s[2]++,require("parse/node"));var _RestQuery=(cov_22ifv5wh8i().s[3]++,_interopRequireDefault(require("../RestQuery")));var _RestWrite=(cov_22ifv5wh8i().s[4]++,_interopRequireDefault(require("../RestWrite")));var _Auth=(cov_22ifv5wh8i().s[5]++,require("../Auth"));var _StatusHandler=(cov_22ifv5wh8i().s[6]++,require("../StatusHandler"));var _utils=(cov_22ifv5wh8i().s[7]++,require("../Push/utils"));function _interopRequireDefault(obj){cov_22ifv5wh8i().f[0]++;cov_22ifv5wh8i().s[8]++;return(cov_22ifv5wh8i().b[1][0]++,obj)&&(cov_22ifv5wh8i().b[1][1]++,obj.__esModule)?(cov_22ifv5wh8i().b[0][0]++,obj):(cov_22ifv5wh8i().b[0][1]++,{default:obj});}class PushController{sendPush(body=(cov_22ifv5wh8i().b[2][0]++,{}),where=(cov_22ifv5wh8i().b[3][0]++,{}),config,auth,onPushStatusSaved=(cov_22ifv5wh8i().b[4][0]++,()=>{cov_22ifv5wh8i().f[2]++;}),now=(cov_22ifv5wh8i().b[5][0]++,new Date())){cov_22ifv5wh8i().f[1]++;cov_22ifv5wh8i().s[9]++;if(!config.hasPushSupport){cov_22ifv5wh8i().b[6][0]++;cov_22ifv5wh8i().s[10]++;throw new _node.Parse.Error(_node.Parse.Error.PUSH_MISCONFIGURED,'Missing push configuration');}else{cov_22ifv5wh8i().b[6][1]++;}// Replace the expiration_time and push_time with a valid Unix epoch milliseconds time
cov_22ifv5wh8i().s[11]++;body.expiration_time=PushController.getExpirationTime(body);cov_22ifv5wh8i().s[12]++;body.expiration_interval=PushController.getExpirationInterval(body);cov_22ifv5wh8i().s[13]++;if((cov_22ifv5wh8i().b[8][0]++,body.expiration_time)&&(cov_22ifv5wh8i().b[8][1]++,body.expiration_interval)){cov_22ifv5wh8i().b[7][0]++;cov_22ifv5wh8i().s[14]++;throw new _node.Parse.Error(_node.Parse.Error.PUSH_MISCONFIGURED,'Both expiration_time and expiration_interval cannot be set');}else{cov_22ifv5wh8i().b[7][1]++;}// Immediate push
cov_22ifv5wh8i().s[15]++;if((cov_22ifv5wh8i().b[10][0]++,body.expiration_interval)&&(cov_22ifv5wh8i().b[10][1]++,!Object.prototype.hasOwnProperty.call(body,'push_time'))){cov_22ifv5wh8i().b[9][0]++;const ttlMs=(cov_22ifv5wh8i().s[16]++,body.expiration_interval*1000);cov_22ifv5wh8i().s[17]++;body.expiration_time=new Date(now.valueOf()+ttlMs).valueOf();}else{cov_22ifv5wh8i().b[9][1]++;}const pushTime=(cov_22ifv5wh8i().s[18]++,PushController.getPushTime(body));cov_22ifv5wh8i().s[19]++;if((cov_22ifv5wh8i().b[12][0]++,pushTime)&&(cov_22ifv5wh8i().b[12][1]++,pushTime.date!=='undefined')){cov_22ifv5wh8i().b[11][0]++;cov_22ifv5wh8i().s[20]++;body['push_time']=PushController.formatPushTime(pushTime);}else{cov_22ifv5wh8i().b[11][1]++;}// TODO: If the req can pass the checking, we return immediately instead of waiting
// pushes to be sent. We probably change this behaviour in the future.
cov_22ifv5wh8i().s[21]++;let badgeUpdate=()=>{cov_22ifv5wh8i().f[3]++;cov_22ifv5wh8i().s[22]++;return Promise.resolve();};cov_22ifv5wh8i().s[23]++;if((cov_22ifv5wh8i().b[14][0]++,body.data)&&(cov_22ifv5wh8i().b[14][1]++,body.data.badge)){cov_22ifv5wh8i().b[13][0]++;const badge=(cov_22ifv5wh8i().s[24]++,body.data.badge);let restUpdate=(cov_22ifv5wh8i().s[25]++,{});cov_22ifv5wh8i().s[26]++;if((cov_22ifv5wh8i().b[16][0]++,typeof badge=='string')&&(cov_22ifv5wh8i().b[16][1]++,badge.toLowerCase()==='increment')){cov_22ifv5wh8i().b[15][0]++;cov_22ifv5wh8i().s[27]++;restUpdate={badge:{__op:'Increment',amount:1}};}else{cov_22ifv5wh8i().b[15][1]++;cov_22ifv5wh8i().s[28]++;if((cov_22ifv5wh8i().b[18][0]++,typeof badge=='object')&&(cov_22ifv5wh8i().b[18][1]++,typeof badge.__op=='string')&&(cov_22ifv5wh8i().b[18][2]++,badge.__op.toLowerCase()=='increment')&&(cov_22ifv5wh8i().b[18][3]++,Number(badge.amount))){cov_22ifv5wh8i().b[17][0]++;cov_22ifv5wh8i().s[29]++;restUpdate={badge:{__op:'Increment',amount:badge.amount}};}else{cov_22ifv5wh8i().b[17][1]++;cov_22ifv5wh8i().s[30]++;if(Number(badge)){cov_22ifv5wh8i().b[19][0]++;cov_22ifv5wh8i().s[31]++;restUpdate={badge:badge};}else{cov_22ifv5wh8i().b[19][1]++;cov_22ifv5wh8i().s[32]++;throw"Invalid value for badge, expected number or 'Increment' or {increment: number}";}}}// Force filtering on only valid device tokens
const updateWhere=(cov_22ifv5wh8i().s[33]++,(0,_utils.applyDeviceTokenExists)(where));cov_22ifv5wh8i().s[34]++;badgeUpdate=()=>{cov_22ifv5wh8i().f[4]++;// Build a real RestQuery so we can use it in RestWrite
const restQuery=(cov_22ifv5wh8i().s[35]++,new _RestQuery.default(config,(0,_Auth.master)(config),'_Installation',updateWhere));cov_22ifv5wh8i().s[36]++;return restQuery.buildRestWhere().then(()=>{cov_22ifv5wh8i().f[5]++;const write=(cov_22ifv5wh8i().s[37]++,new _RestWrite.default(config,(0,_Auth.master)(config),'_Installation',restQuery.restWhere,restUpdate));cov_22ifv5wh8i().s[38]++;write.runOptions.many=true;cov_22ifv5wh8i().s[39]++;return write.execute();});};}else{cov_22ifv5wh8i().b[13][1]++;}const pushStatus=(cov_22ifv5wh8i().s[40]++,(0,_StatusHandler.pushStatusHandler)(config));cov_22ifv5wh8i().s[41]++;return Promise.resolve().then(()=>{cov_22ifv5wh8i().f[6]++;cov_22ifv5wh8i().s[42]++;return pushStatus.setInitial(body,where);}).then(()=>{cov_22ifv5wh8i().f[7]++;cov_22ifv5wh8i().s[43]++;onPushStatusSaved(pushStatus.objectId);cov_22ifv5wh8i().s[44]++;return badgeUpdate();}).then(()=>{cov_22ifv5wh8i().f[8]++;cov_22ifv5wh8i().s[45]++;// Update audience lastUsed and timesUsed
if(body.audience_id){cov_22ifv5wh8i().b[20][0]++;const audienceId=(cov_22ifv5wh8i().s[46]++,body.audience_id);var updateAudience=(cov_22ifv5wh8i().s[47]++,{lastUsed:{__type:'Date',iso:new Date().toISOString()},timesUsed:{__op:'Increment',amount:1}});const write=(cov_22ifv5wh8i().s[48]++,new _RestWrite.default(config,(0,_Auth.master)(config),'_Audience',{objectId:audienceId},updateAudience));cov_22ifv5wh8i().s[49]++;write.execute();}else{cov_22ifv5wh8i().b[20][1]++;}// Don't wait for the audience update promise to resolve.
cov_22ifv5wh8i().s[50]++;return Promise.resolve();}).then(()=>{cov_22ifv5wh8i().f[9]++;cov_22ifv5wh8i().s[51]++;if((cov_22ifv5wh8i().b[22][0]++,Object.prototype.hasOwnProperty.call(body,'push_time'))&&(cov_22ifv5wh8i().b[22][1]++,config.hasPushScheduledSupport)){cov_22ifv5wh8i().b[21][0]++;cov_22ifv5wh8i().s[52]++;return Promise.resolve();}else{cov_22ifv5wh8i().b[21][1]++;}cov_22ifv5wh8i().s[53]++;return config.pushControllerQueue.enqueue(body,where,config,auth,pushStatus);}).catch(err=>{cov_22ifv5wh8i().f[10]++;cov_22ifv5wh8i().s[54]++;return pushStatus.fail(err).then(()=>{cov_22ifv5wh8i().f[11]++;cov_22ifv5wh8i().s[55]++;throw err;});});}/**
   * Get expiration time from the request body.
   * @param {Object} request A request object
   * @returns {Number|undefined} The expiration time if it exists in the request
   */static getExpirationTime(body=(cov_22ifv5wh8i().b[23][0]++,{})){cov_22ifv5wh8i().f[12]++;var hasExpirationTime=(cov_22ifv5wh8i().s[56]++,Object.prototype.hasOwnProperty.call(body,'expiration_time'));cov_22ifv5wh8i().s[57]++;if(!hasExpirationTime){cov_22ifv5wh8i().b[24][0]++;cov_22ifv5wh8i().s[58]++;return;}else{cov_22ifv5wh8i().b[24][1]++;}var expirationTimeParam=(cov_22ifv5wh8i().s[59]++,body['expiration_time']);var expirationTime;cov_22ifv5wh8i().s[60]++;if(typeof expirationTimeParam==='number'){cov_22ifv5wh8i().b[25][0]++;cov_22ifv5wh8i().s[61]++;expirationTime=new Date(expirationTimeParam*1000);}else{cov_22ifv5wh8i().b[25][1]++;cov_22ifv5wh8i().s[62]++;if(typeof expirationTimeParam==='string'){cov_22ifv5wh8i().b[26][0]++;cov_22ifv5wh8i().s[63]++;expirationTime=new Date(expirationTimeParam);}else{cov_22ifv5wh8i().b[26][1]++;cov_22ifv5wh8i().s[64]++;throw new _node.Parse.Error(_node.Parse.Error.PUSH_MISCONFIGURED,body['expiration_time']+' is not valid time.');}}// Check expirationTime is valid or not, if it is not valid, expirationTime is NaN
cov_22ifv5wh8i().s[65]++;if(!isFinite(expirationTime)){cov_22ifv5wh8i().b[27][0]++;cov_22ifv5wh8i().s[66]++;throw new _node.Parse.Error(_node.Parse.Error.PUSH_MISCONFIGURED,body['expiration_time']+' is not valid time.');}else{cov_22ifv5wh8i().b[27][1]++;}cov_22ifv5wh8i().s[67]++;return expirationTime.valueOf();}static getExpirationInterval(body=(cov_22ifv5wh8i().b[28][0]++,{})){cov_22ifv5wh8i().f[13]++;const hasExpirationInterval=(cov_22ifv5wh8i().s[68]++,Object.prototype.hasOwnProperty.call(body,'expiration_interval'));cov_22ifv5wh8i().s[69]++;if(!hasExpirationInterval){cov_22ifv5wh8i().b[29][0]++;cov_22ifv5wh8i().s[70]++;return;}else{cov_22ifv5wh8i().b[29][1]++;}var expirationIntervalParam=(cov_22ifv5wh8i().s[71]++,body['expiration_interval']);cov_22ifv5wh8i().s[72]++;if((cov_22ifv5wh8i().b[31][0]++,typeof expirationIntervalParam!=='number')||(cov_22ifv5wh8i().b[31][1]++,expirationIntervalParam<=0)){cov_22ifv5wh8i().b[30][0]++;cov_22ifv5wh8i().s[73]++;throw new _node.Parse.Error(_node.Parse.Error.PUSH_MISCONFIGURED,`expiration_interval must be a number greater than 0`);}else{cov_22ifv5wh8i().b[30][1]++;}cov_22ifv5wh8i().s[74]++;return expirationIntervalParam;}/**
   * Get push time from the request body.
   * @param {Object} request A request object
   * @returns {Number|undefined} The push time if it exists in the request
   */static getPushTime(body=(cov_22ifv5wh8i().b[32][0]++,{})){cov_22ifv5wh8i().f[14]++;var hasPushTime=(cov_22ifv5wh8i().s[75]++,Object.prototype.hasOwnProperty.call(body,'push_time'));cov_22ifv5wh8i().s[76]++;if(!hasPushTime){cov_22ifv5wh8i().b[33][0]++;cov_22ifv5wh8i().s[77]++;return;}else{cov_22ifv5wh8i().b[33][1]++;}var pushTimeParam=(cov_22ifv5wh8i().s[78]++,body['push_time']);var date;var isLocalTime=(cov_22ifv5wh8i().s[79]++,true);cov_22ifv5wh8i().s[80]++;if(typeof pushTimeParam==='number'){cov_22ifv5wh8i().b[34][0]++;cov_22ifv5wh8i().s[81]++;date=new Date(pushTimeParam*1000);}else{cov_22ifv5wh8i().b[34][1]++;cov_22ifv5wh8i().s[82]++;if(typeof pushTimeParam==='string'){cov_22ifv5wh8i().b[35][0]++;cov_22ifv5wh8i().s[83]++;isLocalTime=!PushController.pushTimeHasTimezoneComponent(pushTimeParam);cov_22ifv5wh8i().s[84]++;date=new Date(pushTimeParam);}else{cov_22ifv5wh8i().b[35][1]++;cov_22ifv5wh8i().s[85]++;throw new _node.Parse.Error(_node.Parse.Error.PUSH_MISCONFIGURED,body['push_time']+' is not valid time.');}}// Check pushTime is valid or not, if it is not valid, pushTime is NaN
cov_22ifv5wh8i().s[86]++;if(!isFinite(date)){cov_22ifv5wh8i().b[36][0]++;cov_22ifv5wh8i().s[87]++;throw new _node.Parse.Error(_node.Parse.Error.PUSH_MISCONFIGURED,body['push_time']+' is not valid time.');}else{cov_22ifv5wh8i().b[36][1]++;}cov_22ifv5wh8i().s[88]++;return{date,isLocalTime};}/**
   * Checks if a ISO8601 formatted date contains a timezone component
   * @param pushTimeParam {string}
   * @returns {boolean}
   */static pushTimeHasTimezoneComponent(pushTimeParam){cov_22ifv5wh8i().f[15]++;const offsetPattern=(cov_22ifv5wh8i().s[89]++,/(.+)([+-])\d\d:\d\d$/);cov_22ifv5wh8i().s[90]++;return(cov_22ifv5wh8i().b[37][0]++,pushTimeParam.indexOf('Z')===pushTimeParam.length-1)||(cov_22ifv5wh8i().b[37][1]++,offsetPattern.test(pushTimeParam))// 2007-04-05T12:30Z
;// 2007-04-05T12:30.000+02:00, 2007-04-05T12:30.000-02:00
}/**
   * Converts a date to ISO format in UTC time and strips the timezone if `isLocalTime` is true
   * @param date {Date}
   * @param isLocalTime {boolean}
   * @returns {string}
   */static formatPushTime({date,isLocalTime}){cov_22ifv5wh8i().f[16]++;cov_22ifv5wh8i().s[91]++;if(isLocalTime){cov_22ifv5wh8i().b[38][0]++;// Strip 'Z'
const isoString=(cov_22ifv5wh8i().s[92]++,date.toISOString());cov_22ifv5wh8i().s[93]++;return isoString.substring(0,isoString.indexOf('Z'));}else{cov_22ifv5wh8i().b[38][1]++;}cov_22ifv5wh8i().s[94]++;return date.toISOString();}}cov_22ifv5wh8i().s[95]++;exports.PushController=PushController;var _default=(cov_22ifv5wh8i().s[96]++,PushController);cov_22ifv5wh8i().s[97]++;exports.default=_default;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db250cm9sbGVycy9QdXNoQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJQdXNoQ29udHJvbGxlciIsInNlbmRQdXNoIiwiYm9keSIsIndoZXJlIiwiY29uZmlnIiwiYXV0aCIsIm9uUHVzaFN0YXR1c1NhdmVkIiwibm93IiwiRGF0ZSIsImhhc1B1c2hTdXBwb3J0IiwiUGFyc2UiLCJFcnJvciIsIlBVU0hfTUlTQ09ORklHVVJFRCIsImV4cGlyYXRpb25fdGltZSIsImdldEV4cGlyYXRpb25UaW1lIiwiZXhwaXJhdGlvbl9pbnRlcnZhbCIsImdldEV4cGlyYXRpb25JbnRlcnZhbCIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInR0bE1zIiwidmFsdWVPZiIsInB1c2hUaW1lIiwiZ2V0UHVzaFRpbWUiLCJkYXRlIiwiZm9ybWF0UHVzaFRpbWUiLCJiYWRnZVVwZGF0ZSIsIlByb21pc2UiLCJyZXNvbHZlIiwiZGF0YSIsImJhZGdlIiwicmVzdFVwZGF0ZSIsInRvTG93ZXJDYXNlIiwiX19vcCIsImFtb3VudCIsIk51bWJlciIsInVwZGF0ZVdoZXJlIiwicmVzdFF1ZXJ5IiwiUmVzdFF1ZXJ5IiwiYnVpbGRSZXN0V2hlcmUiLCJ0aGVuIiwid3JpdGUiLCJSZXN0V3JpdGUiLCJyZXN0V2hlcmUiLCJydW5PcHRpb25zIiwibWFueSIsImV4ZWN1dGUiLCJwdXNoU3RhdHVzIiwic2V0SW5pdGlhbCIsIm9iamVjdElkIiwiYXVkaWVuY2VfaWQiLCJhdWRpZW5jZUlkIiwidXBkYXRlQXVkaWVuY2UiLCJsYXN0VXNlZCIsIl9fdHlwZSIsImlzbyIsInRvSVNPU3RyaW5nIiwidGltZXNVc2VkIiwiaGFzUHVzaFNjaGVkdWxlZFN1cHBvcnQiLCJwdXNoQ29udHJvbGxlclF1ZXVlIiwiZW5xdWV1ZSIsImNhdGNoIiwiZXJyIiwiZmFpbCIsImhhc0V4cGlyYXRpb25UaW1lIiwiZXhwaXJhdGlvblRpbWVQYXJhbSIsImV4cGlyYXRpb25UaW1lIiwiaXNGaW5pdGUiLCJoYXNFeHBpcmF0aW9uSW50ZXJ2YWwiLCJleHBpcmF0aW9uSW50ZXJ2YWxQYXJhbSIsImhhc1B1c2hUaW1lIiwicHVzaFRpbWVQYXJhbSIsImlzTG9jYWxUaW1lIiwicHVzaFRpbWVIYXNUaW1lem9uZUNvbXBvbmVudCIsIm9mZnNldFBhdHRlcm4iLCJpbmRleE9mIiwibGVuZ3RoIiwidGVzdCIsImlzb1N0cmluZyIsInN1YnN0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRU8sTUFBTUEsY0FBTixDQUFxQjtBQUMxQkMsRUFBQUEsUUFBUSxDQUFDQyxJQUFJLEdBQUcsRUFBUixFQUFZQyxLQUFLLEdBQUcsRUFBcEIsRUFBd0JDLE1BQXhCLEVBQWdDQyxJQUFoQyxFQUFzQ0MsaUJBQWlCLEdBQUcsTUFBTSxDQUFFLENBQWxFLEVBQW9FQyxHQUFHLEdBQUcsSUFBSUMsSUFBSixFQUExRSxFQUFzRjtBQUM1RixRQUFJLENBQUNKLE1BQU0sQ0FBQ0ssY0FBWixFQUE0QjtBQUMxQixZQUFNLElBQUlDLFlBQU1DLEtBQVYsQ0FBZ0JELFlBQU1DLEtBQU4sQ0FBWUMsa0JBQTVCLEVBQWdELDRCQUFoRCxDQUFOO0FBQ0QsS0FIMkYsQ0FLNUY7OztBQUNBVixJQUFBQSxJQUFJLENBQUNXLGVBQUwsR0FBdUJiLGNBQWMsQ0FBQ2MsaUJBQWYsQ0FBaUNaLElBQWpDLENBQXZCO0FBQ0FBLElBQUFBLElBQUksQ0FBQ2EsbUJBQUwsR0FBMkJmLGNBQWMsQ0FBQ2dCLHFCQUFmLENBQXFDZCxJQUFyQyxDQUEzQjs7QUFDQSxRQUFJQSxJQUFJLENBQUNXLGVBQUwsSUFBd0JYLElBQUksQ0FBQ2EsbUJBQWpDLEVBQXNEO0FBQ3BELFlBQU0sSUFBSUwsWUFBTUMsS0FBVixDQUNKRCxZQUFNQyxLQUFOLENBQVlDLGtCQURSLEVBRUosNERBRkksQ0FBTjtBQUlELEtBYjJGLENBZTVGOzs7QUFDQSxRQUFJVixJQUFJLENBQUNhLG1CQUFMLElBQTRCLENBQUNFLE1BQU0sQ0FBQ0MsU0FBUCxDQUFpQkMsY0FBakIsQ0FBZ0NDLElBQWhDLENBQXFDbEIsSUFBckMsRUFBMkMsV0FBM0MsQ0FBakMsRUFBMEY7QUFDeEYsWUFBTW1CLEtBQUssR0FBR25CLElBQUksQ0FBQ2EsbUJBQUwsR0FBMkIsSUFBekM7QUFDQWIsTUFBQUEsSUFBSSxDQUFDVyxlQUFMLEdBQXVCLElBQUlMLElBQUosQ0FBU0QsR0FBRyxDQUFDZSxPQUFKLEtBQWdCRCxLQUF6QixFQUFnQ0MsT0FBaEMsRUFBdkI7QUFDRDs7QUFFRCxVQUFNQyxRQUFRLEdBQUd2QixjQUFjLENBQUN3QixXQUFmLENBQTJCdEIsSUFBM0IsQ0FBakI7O0FBQ0EsUUFBSXFCLFFBQVEsSUFBSUEsUUFBUSxDQUFDRSxJQUFULEtBQWtCLFdBQWxDLEVBQStDO0FBQzdDdkIsTUFBQUEsSUFBSSxDQUFDLFdBQUQsQ0FBSixHQUFvQkYsY0FBYyxDQUFDMEIsY0FBZixDQUE4QkgsUUFBOUIsQ0FBcEI7QUFDRCxLQXhCMkYsQ0EwQjVGO0FBQ0E7OztBQUNBLFFBQUlJLFdBQVcsR0FBRyxNQUFNO0FBQ3RCLGFBQU9DLE9BQU8sQ0FBQ0MsT0FBUixFQUFQO0FBQ0QsS0FGRDs7QUFJQSxRQUFJM0IsSUFBSSxDQUFDNEIsSUFBTCxJQUFhNUIsSUFBSSxDQUFDNEIsSUFBTCxDQUFVQyxLQUEzQixFQUFrQztBQUNoQyxZQUFNQSxLQUFLLEdBQUc3QixJQUFJLENBQUM0QixJQUFMLENBQVVDLEtBQXhCO0FBQ0EsVUFBSUMsVUFBVSxHQUFHLEVBQWpCOztBQUNBLFVBQUksT0FBT0QsS0FBUCxJQUFnQixRQUFoQixJQUE0QkEsS0FBSyxDQUFDRSxXQUFOLE9BQXdCLFdBQXhELEVBQXFFO0FBQ25FRCxRQUFBQSxVQUFVLEdBQUc7QUFBRUQsVUFBQUEsS0FBSyxFQUFFO0FBQUVHLFlBQUFBLElBQUksRUFBRSxXQUFSO0FBQXFCQyxZQUFBQSxNQUFNLEVBQUU7QUFBN0I7QUFBVCxTQUFiO0FBQ0QsT0FGRCxNQUVPLElBQ0wsT0FBT0osS0FBUCxJQUFnQixRQUFoQixJQUNBLE9BQU9BLEtBQUssQ0FBQ0csSUFBYixJQUFxQixRQURyQixJQUVBSCxLQUFLLENBQUNHLElBQU4sQ0FBV0QsV0FBWCxNQUE0QixXQUY1QixJQUdBRyxNQUFNLENBQUNMLEtBQUssQ0FBQ0ksTUFBUCxDQUpELEVBS0w7QUFDQUgsUUFBQUEsVUFBVSxHQUFHO0FBQUVELFVBQUFBLEtBQUssRUFBRTtBQUFFRyxZQUFBQSxJQUFJLEVBQUUsV0FBUjtBQUFxQkMsWUFBQUEsTUFBTSxFQUFFSixLQUFLLENBQUNJO0FBQW5DO0FBQVQsU0FBYjtBQUNELE9BUE0sTUFPQSxJQUFJQyxNQUFNLENBQUNMLEtBQUQsQ0FBVixFQUFtQjtBQUN4QkMsUUFBQUEsVUFBVSxHQUFHO0FBQUVELFVBQUFBLEtBQUssRUFBRUE7QUFBVCxTQUFiO0FBQ0QsT0FGTSxNQUVBO0FBQ0wsY0FBTSxnRkFBTjtBQUNELE9BaEIrQixDQWtCaEM7OztBQUNBLFlBQU1NLFdBQVcsR0FBRyxtQ0FBdUJsQyxLQUF2QixDQUFwQjs7QUFDQXdCLE1BQUFBLFdBQVcsR0FBRyxNQUFNO0FBQ2xCO0FBQ0EsY0FBTVcsU0FBUyxHQUFHLElBQUlDLGtCQUFKLENBQWNuQyxNQUFkLEVBQXNCLGtCQUFPQSxNQUFQLENBQXRCLEVBQXNDLGVBQXRDLEVBQXVEaUMsV0FBdkQsQ0FBbEI7QUFDQSxlQUFPQyxTQUFTLENBQUNFLGNBQVYsR0FBMkJDLElBQTNCLENBQWdDLE1BQU07QUFDM0MsZ0JBQU1DLEtBQUssR0FBRyxJQUFJQyxrQkFBSixDQUNadkMsTUFEWSxFQUVaLGtCQUFPQSxNQUFQLENBRlksRUFHWixlQUhZLEVBSVprQyxTQUFTLENBQUNNLFNBSkUsRUFLWlosVUFMWSxDQUFkO0FBT0FVLFVBQUFBLEtBQUssQ0FBQ0csVUFBTixDQUFpQkMsSUFBakIsR0FBd0IsSUFBeEI7QUFDQSxpQkFBT0osS0FBSyxDQUFDSyxPQUFOLEVBQVA7QUFDRCxTQVZNLENBQVA7QUFXRCxPQWREO0FBZUQ7O0FBQ0QsVUFBTUMsVUFBVSxHQUFHLHNDQUFrQjVDLE1BQWxCLENBQW5CO0FBQ0EsV0FBT3dCLE9BQU8sQ0FBQ0MsT0FBUixHQUNKWSxJQURJLENBQ0MsTUFBTTtBQUNWLGFBQU9PLFVBQVUsQ0FBQ0MsVUFBWCxDQUFzQi9DLElBQXRCLEVBQTRCQyxLQUE1QixDQUFQO0FBQ0QsS0FISSxFQUlKc0MsSUFKSSxDQUlDLE1BQU07QUFDVm5DLE1BQUFBLGlCQUFpQixDQUFDMEMsVUFBVSxDQUFDRSxRQUFaLENBQWpCO0FBQ0EsYUFBT3ZCLFdBQVcsRUFBbEI7QUFDRCxLQVBJLEVBUUpjLElBUkksQ0FRQyxNQUFNO0FBQ1Y7QUFDQSxVQUFJdkMsSUFBSSxDQUFDaUQsV0FBVCxFQUFzQjtBQUNwQixjQUFNQyxVQUFVLEdBQUdsRCxJQUFJLENBQUNpRCxXQUF4QjtBQUVBLFlBQUlFLGNBQWMsR0FBRztBQUNuQkMsVUFBQUEsUUFBUSxFQUFFO0FBQUVDLFlBQUFBLE1BQU0sRUFBRSxNQUFWO0FBQWtCQyxZQUFBQSxHQUFHLEVBQUUsSUFBSWhELElBQUosR0FBV2lELFdBQVg7QUFBdkIsV0FEUztBQUVuQkMsVUFBQUEsU0FBUyxFQUFFO0FBQUV4QixZQUFBQSxJQUFJLEVBQUUsV0FBUjtBQUFxQkMsWUFBQUEsTUFBTSxFQUFFO0FBQTdCO0FBRlEsU0FBckI7QUFJQSxjQUFNTyxLQUFLLEdBQUcsSUFBSUMsa0JBQUosQ0FDWnZDLE1BRFksRUFFWixrQkFBT0EsTUFBUCxDQUZZLEVBR1osV0FIWSxFQUlaO0FBQUU4QyxVQUFBQSxRQUFRLEVBQUVFO0FBQVosU0FKWSxFQUtaQyxjQUxZLENBQWQ7QUFPQVgsUUFBQUEsS0FBSyxDQUFDSyxPQUFOO0FBQ0QsT0FqQlMsQ0FrQlY7OztBQUNBLGFBQU9uQixPQUFPLENBQUNDLE9BQVIsRUFBUDtBQUNELEtBNUJJLEVBNkJKWSxJQTdCSSxDQTZCQyxNQUFNO0FBQ1YsVUFDRXhCLE1BQU0sQ0FBQ0MsU0FBUCxDQUFpQkMsY0FBakIsQ0FBZ0NDLElBQWhDLENBQXFDbEIsSUFBckMsRUFBMkMsV0FBM0MsS0FDQUUsTUFBTSxDQUFDdUQsdUJBRlQsRUFHRTtBQUNBLGVBQU8vQixPQUFPLENBQUNDLE9BQVIsRUFBUDtBQUNEOztBQUNELGFBQU96QixNQUFNLENBQUN3RCxtQkFBUCxDQUEyQkMsT0FBM0IsQ0FBbUMzRCxJQUFuQyxFQUF5Q0MsS0FBekMsRUFBZ0RDLE1BQWhELEVBQXdEQyxJQUF4RCxFQUE4RDJDLFVBQTlELENBQVA7QUFDRCxLQXJDSSxFQXNDSmMsS0F0Q0ksQ0FzQ0VDLEdBQUcsSUFBSTtBQUNaLGFBQU9mLFVBQVUsQ0FBQ2dCLElBQVgsQ0FBZ0JELEdBQWhCLEVBQXFCdEIsSUFBckIsQ0FBMEIsTUFBTTtBQUNyQyxjQUFNc0IsR0FBTjtBQUNELE9BRk0sQ0FBUDtBQUdELEtBMUNJLENBQVA7QUEyQ0Q7QUFFRDtBQUNGO0FBQ0E7QUFDQTtBQUNBOzs7QUFDMEIsU0FBakJqRCxpQkFBaUIsQ0FBQ1osSUFBSSxHQUFHLEVBQVIsRUFBWTtBQUNsQyxRQUFJK0QsaUJBQWlCLEdBQUdoRCxNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ2xCLElBQXJDLEVBQTJDLGlCQUEzQyxDQUF4Qjs7QUFDQSxRQUFJLENBQUMrRCxpQkFBTCxFQUF3QjtBQUN0QjtBQUNEOztBQUNELFFBQUlDLG1CQUFtQixHQUFHaEUsSUFBSSxDQUFDLGlCQUFELENBQTlCO0FBQ0EsUUFBSWlFLGNBQUo7O0FBQ0EsUUFBSSxPQUFPRCxtQkFBUCxLQUErQixRQUFuQyxFQUE2QztBQUMzQ0MsTUFBQUEsY0FBYyxHQUFHLElBQUkzRCxJQUFKLENBQVMwRCxtQkFBbUIsR0FBRyxJQUEvQixDQUFqQjtBQUNELEtBRkQsTUFFTyxJQUFJLE9BQU9BLG1CQUFQLEtBQStCLFFBQW5DLEVBQTZDO0FBQ2xEQyxNQUFBQSxjQUFjLEdBQUcsSUFBSTNELElBQUosQ0FBUzBELG1CQUFULENBQWpCO0FBQ0QsS0FGTSxNQUVBO0FBQ0wsWUFBTSxJQUFJeEQsWUFBTUMsS0FBVixDQUNKRCxZQUFNQyxLQUFOLENBQVlDLGtCQURSLEVBRUpWLElBQUksQ0FBQyxpQkFBRCxDQUFKLEdBQTBCLHFCQUZ0QixDQUFOO0FBSUQsS0FoQmlDLENBaUJsQzs7O0FBQ0EsUUFBSSxDQUFDa0UsUUFBUSxDQUFDRCxjQUFELENBQWIsRUFBK0I7QUFDN0IsWUFBTSxJQUFJekQsWUFBTUMsS0FBVixDQUNKRCxZQUFNQyxLQUFOLENBQVlDLGtCQURSLEVBRUpWLElBQUksQ0FBQyxpQkFBRCxDQUFKLEdBQTBCLHFCQUZ0QixDQUFOO0FBSUQ7O0FBQ0QsV0FBT2lFLGNBQWMsQ0FBQzdDLE9BQWYsRUFBUDtBQUNEOztBQUUyQixTQUFyQk4scUJBQXFCLENBQUNkLElBQUksR0FBRyxFQUFSLEVBQVk7QUFDdEMsVUFBTW1FLHFCQUFxQixHQUFHcEQsTUFBTSxDQUFDQyxTQUFQLENBQWlCQyxjQUFqQixDQUFnQ0MsSUFBaEMsQ0FBcUNsQixJQUFyQyxFQUEyQyxxQkFBM0MsQ0FBOUI7O0FBQ0EsUUFBSSxDQUFDbUUscUJBQUwsRUFBNEI7QUFDMUI7QUFDRDs7QUFFRCxRQUFJQyx1QkFBdUIsR0FBR3BFLElBQUksQ0FBQyxxQkFBRCxDQUFsQzs7QUFDQSxRQUFJLE9BQU9vRSx1QkFBUCxLQUFtQyxRQUFuQyxJQUErQ0EsdUJBQXVCLElBQUksQ0FBOUUsRUFBaUY7QUFDL0UsWUFBTSxJQUFJNUQsWUFBTUMsS0FBVixDQUNKRCxZQUFNQyxLQUFOLENBQVlDLGtCQURSLEVBRUgscURBRkcsQ0FBTjtBQUlEOztBQUNELFdBQU8wRCx1QkFBUDtBQUNEO0FBRUQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTs7O0FBQ29CLFNBQVg5QyxXQUFXLENBQUN0QixJQUFJLEdBQUcsRUFBUixFQUFZO0FBQzVCLFFBQUlxRSxXQUFXLEdBQUd0RCxNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ2xCLElBQXJDLEVBQTJDLFdBQTNDLENBQWxCOztBQUNBLFFBQUksQ0FBQ3FFLFdBQUwsRUFBa0I7QUFDaEI7QUFDRDs7QUFDRCxRQUFJQyxhQUFhLEdBQUd0RSxJQUFJLENBQUMsV0FBRCxDQUF4QjtBQUNBLFFBQUl1QixJQUFKO0FBQ0EsUUFBSWdELFdBQVcsR0FBRyxJQUFsQjs7QUFFQSxRQUFJLE9BQU9ELGFBQVAsS0FBeUIsUUFBN0IsRUFBdUM7QUFDckMvQyxNQUFBQSxJQUFJLEdBQUcsSUFBSWpCLElBQUosQ0FBU2dFLGFBQWEsR0FBRyxJQUF6QixDQUFQO0FBQ0QsS0FGRCxNQUVPLElBQUksT0FBT0EsYUFBUCxLQUF5QixRQUE3QixFQUF1QztBQUM1Q0MsTUFBQUEsV0FBVyxHQUFHLENBQUN6RSxjQUFjLENBQUMwRSw0QkFBZixDQUE0Q0YsYUFBNUMsQ0FBZjtBQUNBL0MsTUFBQUEsSUFBSSxHQUFHLElBQUlqQixJQUFKLENBQVNnRSxhQUFULENBQVA7QUFDRCxLQUhNLE1BR0E7QUFDTCxZQUFNLElBQUk5RCxZQUFNQyxLQUFWLENBQ0pELFlBQU1DLEtBQU4sQ0FBWUMsa0JBRFIsRUFFSlYsSUFBSSxDQUFDLFdBQUQsQ0FBSixHQUFvQixxQkFGaEIsQ0FBTjtBQUlELEtBbkIyQixDQW9CNUI7OztBQUNBLFFBQUksQ0FBQ2tFLFFBQVEsQ0FBQzNDLElBQUQsQ0FBYixFQUFxQjtBQUNuQixZQUFNLElBQUlmLFlBQU1DLEtBQVYsQ0FDSkQsWUFBTUMsS0FBTixDQUFZQyxrQkFEUixFQUVKVixJQUFJLENBQUMsV0FBRCxDQUFKLEdBQW9CLHFCQUZoQixDQUFOO0FBSUQ7O0FBRUQsV0FBTztBQUNMdUIsTUFBQUEsSUFESztBQUVMZ0QsTUFBQUE7QUFGSyxLQUFQO0FBSUQ7QUFFRDtBQUNGO0FBQ0E7QUFDQTtBQUNBOzs7QUFDcUMsU0FBNUJDLDRCQUE0QixDQUFDRixhQUFELEVBQWlDO0FBQ2xFLFVBQU1HLGFBQWEsR0FBRyxzQkFBdEI7QUFDQSxXQUNFSCxhQUFhLENBQUNJLE9BQWQsQ0FBc0IsR0FBdEIsTUFBK0JKLGFBQWEsQ0FBQ0ssTUFBZCxHQUF1QixDQUF0RCxJQUEyREYsYUFBYSxDQUFDRyxJQUFkLENBQW1CTixhQUFuQixDQUQ3RCxDQUMrRjtBQUQvRixLQUZrRSxDQUkvRDtBQUNKO0FBRUQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDdUIsU0FBZDlDLGNBQWMsQ0FBQztBQUFFRCxJQUFBQSxJQUFGO0FBQVFnRCxJQUFBQTtBQUFSLEdBQUQsRUFBOEQ7QUFDakYsUUFBSUEsV0FBSixFQUFpQjtBQUNmO0FBQ0EsWUFBTU0sU0FBUyxHQUFHdEQsSUFBSSxDQUFDZ0MsV0FBTCxFQUFsQjtBQUNBLGFBQU9zQixTQUFTLENBQUNDLFNBQVYsQ0FBb0IsQ0FBcEIsRUFBdUJELFNBQVMsQ0FBQ0gsT0FBVixDQUFrQixHQUFsQixDQUF2QixDQUFQO0FBQ0Q7O0FBQ0QsV0FBT25ELElBQUksQ0FBQ2dDLFdBQUwsRUFBUDtBQUNEOztBQW5PeUI7OztlQXNPYnpELGMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXJzZSB9IGZyb20gJ3BhcnNlL25vZGUnO1xuaW1wb3J0IFJlc3RRdWVyeSBmcm9tICcuLi9SZXN0UXVlcnknO1xuaW1wb3J0IFJlc3RXcml0ZSBmcm9tICcuLi9SZXN0V3JpdGUnO1xuaW1wb3J0IHsgbWFzdGVyIH0gZnJvbSAnLi4vQXV0aCc7XG5pbXBvcnQgeyBwdXNoU3RhdHVzSGFuZGxlciB9IGZyb20gJy4uL1N0YXR1c0hhbmRsZXInO1xuaW1wb3J0IHsgYXBwbHlEZXZpY2VUb2tlbkV4aXN0cyB9IGZyb20gJy4uL1B1c2gvdXRpbHMnO1xuXG5leHBvcnQgY2xhc3MgUHVzaENvbnRyb2xsZXIge1xuICBzZW5kUHVzaChib2R5ID0ge30sIHdoZXJlID0ge30sIGNvbmZpZywgYXV0aCwgb25QdXNoU3RhdHVzU2F2ZWQgPSAoKSA9PiB7fSwgbm93ID0gbmV3IERhdGUoKSkge1xuICAgIGlmICghY29uZmlnLmhhc1B1c2hTdXBwb3J0KSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuUFVTSF9NSVNDT05GSUdVUkVELCAnTWlzc2luZyBwdXNoIGNvbmZpZ3VyYXRpb24nKTtcbiAgICB9XG5cbiAgICAvLyBSZXBsYWNlIHRoZSBleHBpcmF0aW9uX3RpbWUgYW5kIHB1c2hfdGltZSB3aXRoIGEgdmFsaWQgVW5peCBlcG9jaCBtaWxsaXNlY29uZHMgdGltZVxuICAgIGJvZHkuZXhwaXJhdGlvbl90aW1lID0gUHVzaENvbnRyb2xsZXIuZ2V0RXhwaXJhdGlvblRpbWUoYm9keSk7XG4gICAgYm9keS5leHBpcmF0aW9uX2ludGVydmFsID0gUHVzaENvbnRyb2xsZXIuZ2V0RXhwaXJhdGlvbkludGVydmFsKGJvZHkpO1xuICAgIGlmIChib2R5LmV4cGlyYXRpb25fdGltZSAmJiBib2R5LmV4cGlyYXRpb25faW50ZXJ2YWwpIHtcbiAgICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgICAgUGFyc2UuRXJyb3IuUFVTSF9NSVNDT05GSUdVUkVELFxuICAgICAgICAnQm90aCBleHBpcmF0aW9uX3RpbWUgYW5kIGV4cGlyYXRpb25faW50ZXJ2YWwgY2Fubm90IGJlIHNldCdcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gSW1tZWRpYXRlIHB1c2hcbiAgICBpZiAoYm9keS5leHBpcmF0aW9uX2ludGVydmFsICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYm9keSwgJ3B1c2hfdGltZScpKSB7XG4gICAgICBjb25zdCB0dGxNcyA9IGJvZHkuZXhwaXJhdGlvbl9pbnRlcnZhbCAqIDEwMDA7XG4gICAgICBib2R5LmV4cGlyYXRpb25fdGltZSA9IG5ldyBEYXRlKG5vdy52YWx1ZU9mKCkgKyB0dGxNcykudmFsdWVPZigpO1xuICAgIH1cblxuICAgIGNvbnN0IHB1c2hUaW1lID0gUHVzaENvbnRyb2xsZXIuZ2V0UHVzaFRpbWUoYm9keSk7XG4gICAgaWYgKHB1c2hUaW1lICYmIHB1c2hUaW1lLmRhdGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBib2R5WydwdXNoX3RpbWUnXSA9IFB1c2hDb250cm9sbGVyLmZvcm1hdFB1c2hUaW1lKHB1c2hUaW1lKTtcbiAgICB9XG5cbiAgICAvLyBUT0RPOiBJZiB0aGUgcmVxIGNhbiBwYXNzIHRoZSBjaGVja2luZywgd2UgcmV0dXJuIGltbWVkaWF0ZWx5IGluc3RlYWQgb2Ygd2FpdGluZ1xuICAgIC8vIHB1c2hlcyB0byBiZSBzZW50LiBXZSBwcm9iYWJseSBjaGFuZ2UgdGhpcyBiZWhhdmlvdXIgaW4gdGhlIGZ1dHVyZS5cbiAgICBsZXQgYmFkZ2VVcGRhdGUgPSAoKSA9PiB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfTtcblxuICAgIGlmIChib2R5LmRhdGEgJiYgYm9keS5kYXRhLmJhZGdlKSB7XG4gICAgICBjb25zdCBiYWRnZSA9IGJvZHkuZGF0YS5iYWRnZTtcbiAgICAgIGxldCByZXN0VXBkYXRlID0ge307XG4gICAgICBpZiAodHlwZW9mIGJhZGdlID09ICdzdHJpbmcnICYmIGJhZGdlLnRvTG93ZXJDYXNlKCkgPT09ICdpbmNyZW1lbnQnKSB7XG4gICAgICAgIHJlc3RVcGRhdGUgPSB7IGJhZGdlOiB7IF9fb3A6ICdJbmNyZW1lbnQnLCBhbW91bnQ6IDEgfSB9O1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgdHlwZW9mIGJhZGdlID09ICdvYmplY3QnICYmXG4gICAgICAgIHR5cGVvZiBiYWRnZS5fX29wID09ICdzdHJpbmcnICYmXG4gICAgICAgIGJhZGdlLl9fb3AudG9Mb3dlckNhc2UoKSA9PSAnaW5jcmVtZW50JyAmJlxuICAgICAgICBOdW1iZXIoYmFkZ2UuYW1vdW50KVxuICAgICAgKSB7XG4gICAgICAgIHJlc3RVcGRhdGUgPSB7IGJhZGdlOiB7IF9fb3A6ICdJbmNyZW1lbnQnLCBhbW91bnQ6IGJhZGdlLmFtb3VudCB9IH07XG4gICAgICB9IGVsc2UgaWYgKE51bWJlcihiYWRnZSkpIHtcbiAgICAgICAgcmVzdFVwZGF0ZSA9IHsgYmFkZ2U6IGJhZGdlIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBcIkludmFsaWQgdmFsdWUgZm9yIGJhZGdlLCBleHBlY3RlZCBudW1iZXIgb3IgJ0luY3JlbWVudCcgb3Ige2luY3JlbWVudDogbnVtYmVyfVwiO1xuICAgICAgfVxuXG4gICAgICAvLyBGb3JjZSBmaWx0ZXJpbmcgb24gb25seSB2YWxpZCBkZXZpY2UgdG9rZW5zXG4gICAgICBjb25zdCB1cGRhdGVXaGVyZSA9IGFwcGx5RGV2aWNlVG9rZW5FeGlzdHMod2hlcmUpO1xuICAgICAgYmFkZ2VVcGRhdGUgPSAoKSA9PiB7XG4gICAgICAgIC8vIEJ1aWxkIGEgcmVhbCBSZXN0UXVlcnkgc28gd2UgY2FuIHVzZSBpdCBpbiBSZXN0V3JpdGVcbiAgICAgICAgY29uc3QgcmVzdFF1ZXJ5ID0gbmV3IFJlc3RRdWVyeShjb25maWcsIG1hc3Rlcihjb25maWcpLCAnX0luc3RhbGxhdGlvbicsIHVwZGF0ZVdoZXJlKTtcbiAgICAgICAgcmV0dXJuIHJlc3RRdWVyeS5idWlsZFJlc3RXaGVyZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHdyaXRlID0gbmV3IFJlc3RXcml0ZShcbiAgICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICAgIG1hc3Rlcihjb25maWcpLFxuICAgICAgICAgICAgJ19JbnN0YWxsYXRpb24nLFxuICAgICAgICAgICAgcmVzdFF1ZXJ5LnJlc3RXaGVyZSxcbiAgICAgICAgICAgIHJlc3RVcGRhdGVcbiAgICAgICAgICApO1xuICAgICAgICAgIHdyaXRlLnJ1bk9wdGlvbnMubWFueSA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIHdyaXRlLmV4ZWN1dGUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBwdXNoU3RhdHVzID0gcHVzaFN0YXR1c0hhbmRsZXIoY29uZmlnKTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHB1c2hTdGF0dXMuc2V0SW5pdGlhbChib2R5LCB3aGVyZSk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBvblB1c2hTdGF0dXNTYXZlZChwdXNoU3RhdHVzLm9iamVjdElkKTtcbiAgICAgICAgcmV0dXJuIGJhZGdlVXBkYXRlKCk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAvLyBVcGRhdGUgYXVkaWVuY2UgbGFzdFVzZWQgYW5kIHRpbWVzVXNlZFxuICAgICAgICBpZiAoYm9keS5hdWRpZW5jZV9pZCkge1xuICAgICAgICAgIGNvbnN0IGF1ZGllbmNlSWQgPSBib2R5LmF1ZGllbmNlX2lkO1xuXG4gICAgICAgICAgdmFyIHVwZGF0ZUF1ZGllbmNlID0ge1xuICAgICAgICAgICAgbGFzdFVzZWQ6IHsgX190eXBlOiAnRGF0ZScsIGlzbzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0sXG4gICAgICAgICAgICB0aW1lc1VzZWQ6IHsgX19vcDogJ0luY3JlbWVudCcsIGFtb3VudDogMSB9LFxuICAgICAgICAgIH07XG4gICAgICAgICAgY29uc3Qgd3JpdGUgPSBuZXcgUmVzdFdyaXRlKFxuICAgICAgICAgICAgY29uZmlnLFxuICAgICAgICAgICAgbWFzdGVyKGNvbmZpZyksXG4gICAgICAgICAgICAnX0F1ZGllbmNlJyxcbiAgICAgICAgICAgIHsgb2JqZWN0SWQ6IGF1ZGllbmNlSWQgfSxcbiAgICAgICAgICAgIHVwZGF0ZUF1ZGllbmNlXG4gICAgICAgICAgKTtcbiAgICAgICAgICB3cml0ZS5leGVjdXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRG9uJ3Qgd2FpdCBmb3IgdGhlIGF1ZGllbmNlIHVwZGF0ZSBwcm9taXNlIHRvIHJlc29sdmUuXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgIH0pXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYm9keSwgJ3B1c2hfdGltZScpICYmXG4gICAgICAgICAgY29uZmlnLmhhc1B1c2hTY2hlZHVsZWRTdXBwb3J0XG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uZmlnLnB1c2hDb250cm9sbGVyUXVldWUuZW5xdWV1ZShib2R5LCB3aGVyZSwgY29uZmlnLCBhdXRoLCBwdXNoU3RhdHVzKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgcmV0dXJuIHB1c2hTdGF0dXMuZmFpbChlcnIpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZXhwaXJhdGlvbiB0aW1lIGZyb20gdGhlIHJlcXVlc3QgYm9keS5cbiAgICogQHBhcmFtIHtPYmplY3R9IHJlcXVlc3QgQSByZXF1ZXN0IG9iamVjdFxuICAgKiBAcmV0dXJucyB7TnVtYmVyfHVuZGVmaW5lZH0gVGhlIGV4cGlyYXRpb24gdGltZSBpZiBpdCBleGlzdHMgaW4gdGhlIHJlcXVlc3RcbiAgICovXG4gIHN0YXRpYyBnZXRFeHBpcmF0aW9uVGltZShib2R5ID0ge30pIHtcbiAgICB2YXIgaGFzRXhwaXJhdGlvblRpbWUgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYm9keSwgJ2V4cGlyYXRpb25fdGltZScpO1xuICAgIGlmICghaGFzRXhwaXJhdGlvblRpbWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGV4cGlyYXRpb25UaW1lUGFyYW0gPSBib2R5WydleHBpcmF0aW9uX3RpbWUnXTtcbiAgICB2YXIgZXhwaXJhdGlvblRpbWU7XG4gICAgaWYgKHR5cGVvZiBleHBpcmF0aW9uVGltZVBhcmFtID09PSAnbnVtYmVyJykge1xuICAgICAgZXhwaXJhdGlvblRpbWUgPSBuZXcgRGF0ZShleHBpcmF0aW9uVGltZVBhcmFtICogMTAwMCk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZXhwaXJhdGlvblRpbWVQYXJhbSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGV4cGlyYXRpb25UaW1lID0gbmV3IERhdGUoZXhwaXJhdGlvblRpbWVQYXJhbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgICAgUGFyc2UuRXJyb3IuUFVTSF9NSVNDT05GSUdVUkVELFxuICAgICAgICBib2R5WydleHBpcmF0aW9uX3RpbWUnXSArICcgaXMgbm90IHZhbGlkIHRpbWUuJ1xuICAgICAgKTtcbiAgICB9XG4gICAgLy8gQ2hlY2sgZXhwaXJhdGlvblRpbWUgaXMgdmFsaWQgb3Igbm90LCBpZiBpdCBpcyBub3QgdmFsaWQsIGV4cGlyYXRpb25UaW1lIGlzIE5hTlxuICAgIGlmICghaXNGaW5pdGUoZXhwaXJhdGlvblRpbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgIFBhcnNlLkVycm9yLlBVU0hfTUlTQ09ORklHVVJFRCxcbiAgICAgICAgYm9keVsnZXhwaXJhdGlvbl90aW1lJ10gKyAnIGlzIG5vdCB2YWxpZCB0aW1lLidcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBleHBpcmF0aW9uVGltZS52YWx1ZU9mKCk7XG4gIH1cblxuICBzdGF0aWMgZ2V0RXhwaXJhdGlvbkludGVydmFsKGJvZHkgPSB7fSkge1xuICAgIGNvbnN0IGhhc0V4cGlyYXRpb25JbnRlcnZhbCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChib2R5LCAnZXhwaXJhdGlvbl9pbnRlcnZhbCcpO1xuICAgIGlmICghaGFzRXhwaXJhdGlvbkludGVydmFsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGV4cGlyYXRpb25JbnRlcnZhbFBhcmFtID0gYm9keVsnZXhwaXJhdGlvbl9pbnRlcnZhbCddO1xuICAgIGlmICh0eXBlb2YgZXhwaXJhdGlvbkludGVydmFsUGFyYW0gIT09ICdudW1iZXInIHx8IGV4cGlyYXRpb25JbnRlcnZhbFBhcmFtIDw9IDApIHtcbiAgICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihcbiAgICAgICAgUGFyc2UuRXJyb3IuUFVTSF9NSVNDT05GSUdVUkVELFxuICAgICAgICBgZXhwaXJhdGlvbl9pbnRlcnZhbCBtdXN0IGJlIGEgbnVtYmVyIGdyZWF0ZXIgdGhhbiAwYFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cGlyYXRpb25JbnRlcnZhbFBhcmFtO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwdXNoIHRpbWUgZnJvbSB0aGUgcmVxdWVzdCBib2R5LlxuICAgKiBAcGFyYW0ge09iamVjdH0gcmVxdWVzdCBBIHJlcXVlc3Qgb2JqZWN0XG4gICAqIEByZXR1cm5zIHtOdW1iZXJ8dW5kZWZpbmVkfSBUaGUgcHVzaCB0aW1lIGlmIGl0IGV4aXN0cyBpbiB0aGUgcmVxdWVzdFxuICAgKi9cbiAgc3RhdGljIGdldFB1c2hUaW1lKGJvZHkgPSB7fSkge1xuICAgIHZhciBoYXNQdXNoVGltZSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChib2R5LCAncHVzaF90aW1lJyk7XG4gICAgaWYgKCFoYXNQdXNoVGltZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgcHVzaFRpbWVQYXJhbSA9IGJvZHlbJ3B1c2hfdGltZSddO1xuICAgIHZhciBkYXRlO1xuICAgIHZhciBpc0xvY2FsVGltZSA9IHRydWU7XG5cbiAgICBpZiAodHlwZW9mIHB1c2hUaW1lUGFyYW0gPT09ICdudW1iZXInKSB7XG4gICAgICBkYXRlID0gbmV3IERhdGUocHVzaFRpbWVQYXJhbSAqIDEwMDApO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHB1c2hUaW1lUGFyYW0gPT09ICdzdHJpbmcnKSB7XG4gICAgICBpc0xvY2FsVGltZSA9ICFQdXNoQ29udHJvbGxlci5wdXNoVGltZUhhc1RpbWV6b25lQ29tcG9uZW50KHB1c2hUaW1lUGFyYW0pO1xuICAgICAgZGF0ZSA9IG5ldyBEYXRlKHB1c2hUaW1lUGFyYW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgIFBhcnNlLkVycm9yLlBVU0hfTUlTQ09ORklHVVJFRCxcbiAgICAgICAgYm9keVsncHVzaF90aW1lJ10gKyAnIGlzIG5vdCB2YWxpZCB0aW1lLidcbiAgICAgICk7XG4gICAgfVxuICAgIC8vIENoZWNrIHB1c2hUaW1lIGlzIHZhbGlkIG9yIG5vdCwgaWYgaXQgaXMgbm90IHZhbGlkLCBwdXNoVGltZSBpcyBOYU5cbiAgICBpZiAoIWlzRmluaXRlKGRhdGUpKSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgIFBhcnNlLkVycm9yLlBVU0hfTUlTQ09ORklHVVJFRCxcbiAgICAgICAgYm9keVsncHVzaF90aW1lJ10gKyAnIGlzIG5vdCB2YWxpZCB0aW1lLidcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGUsXG4gICAgICBpc0xvY2FsVGltZSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBhIElTTzg2MDEgZm9ybWF0dGVkIGRhdGUgY29udGFpbnMgYSB0aW1lem9uZSBjb21wb25lbnRcbiAgICogQHBhcmFtIHB1c2hUaW1lUGFyYW0ge3N0cmluZ31cbiAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAqL1xuICBzdGF0aWMgcHVzaFRpbWVIYXNUaW1lem9uZUNvbXBvbmVudChwdXNoVGltZVBhcmFtOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCBvZmZzZXRQYXR0ZXJuID0gLyguKykoWystXSlcXGRcXGQ6XFxkXFxkJC87XG4gICAgcmV0dXJuIChcbiAgICAgIHB1c2hUaW1lUGFyYW0uaW5kZXhPZignWicpID09PSBwdXNoVGltZVBhcmFtLmxlbmd0aCAtIDEgfHwgb2Zmc2V0UGF0dGVybi50ZXN0KHB1c2hUaW1lUGFyYW0pIC8vIDIwMDctMDQtMDVUMTI6MzBaXG4gICAgKTsgLy8gMjAwNy0wNC0wNVQxMjozMC4wMDArMDI6MDAsIDIwMDctMDQtMDVUMTI6MzAuMDAwLTAyOjAwXG4gIH1cblxuICAvKipcbiAgICogQ29udmVydHMgYSBkYXRlIHRvIElTTyBmb3JtYXQgaW4gVVRDIHRpbWUgYW5kIHN0cmlwcyB0aGUgdGltZXpvbmUgaWYgYGlzTG9jYWxUaW1lYCBpcyB0cnVlXG4gICAqIEBwYXJhbSBkYXRlIHtEYXRlfVxuICAgKiBAcGFyYW0gaXNMb2NhbFRpbWUge2Jvb2xlYW59XG4gICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAqL1xuICBzdGF0aWMgZm9ybWF0UHVzaFRpbWUoeyBkYXRlLCBpc0xvY2FsVGltZSB9OiB7IGRhdGU6IERhdGUsIGlzTG9jYWxUaW1lOiBib29sZWFuIH0pIHtcbiAgICBpZiAoaXNMb2NhbFRpbWUpIHtcbiAgICAgIC8vIFN0cmlwICdaJ1xuICAgICAgY29uc3QgaXNvU3RyaW5nID0gZGF0ZS50b0lTT1N0cmluZygpO1xuICAgICAgcmV0dXJuIGlzb1N0cmluZy5zdWJzdHJpbmcoMCwgaXNvU3RyaW5nLmluZGV4T2YoJ1onKSk7XG4gICAgfVxuICAgIHJldHVybiBkYXRlLnRvSVNPU3RyaW5nKCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUHVzaENvbnRyb2xsZXI7XG4iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db250cm9sbGVycy9QdXNoQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJzZW5kUHVzaCIsImJvZHkiLCJ3aGVyZSIsIm9uUHVzaFN0YXR1c1NhdmVkIiwibm93IiwiY29uZmlnIiwiUGFyc2UiLCJQdXNoQ29udHJvbGxlciIsIk9iamVjdCIsInR0bE1zIiwicHVzaFRpbWUiLCJiYWRnZVVwZGF0ZSIsIlByb21pc2UiLCJiYWRnZSIsInJlc3RVcGRhdGUiLCJfX29wIiwiYW1vdW50IiwiTnVtYmVyIiwidXBkYXRlV2hlcmUiLCJyZXN0UXVlcnkiLCJSZXN0UXVlcnkiLCJ3cml0ZSIsIlJlc3RXcml0ZSIsInB1c2hTdGF0dXMiLCJhdWRpZW5jZUlkIiwidXBkYXRlQXVkaWVuY2UiLCJsYXN0VXNlZCIsIl9fdHlwZSIsImlzbyIsInRpbWVzVXNlZCIsIm9iamVjdElkIiwiZXJyIiwiZ2V0RXhwaXJhdGlvblRpbWUiLCJoYXNFeHBpcmF0aW9uVGltZSIsImV4cGlyYXRpb25UaW1lUGFyYW0iLCJleHBpcmF0aW9uVGltZSIsImlzRmluaXRlIiwiZ2V0RXhwaXJhdGlvbkludGVydmFsIiwiaGFzRXhwaXJhdGlvbkludGVydmFsIiwiZXhwaXJhdGlvbkludGVydmFsUGFyYW0iLCJnZXRQdXNoVGltZSIsImhhc1B1c2hUaW1lIiwicHVzaFRpbWVQYXJhbSIsImlzTG9jYWxUaW1lIiwiZGF0ZSIsInB1c2hUaW1lSGFzVGltZXpvbmVDb21wb25lbnQiLCJvZmZzZXRQYXR0ZXJuIiwiZm9ybWF0UHVzaFRpbWUiLCJpc29TdHJpbmciXSwibWFwcGluZ3MiOiJpcWhDQUlBO2tQQUpBLEdBQUEsQ0FBQSxLQUFBLDBCQUFBLE9BQUEsQ0FBQSxZQUFBLENBQUEsQ0FBQSxDQUNBLEdBQUEsQ0FBQSxVQUFBLDBCQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQSxDQUFBLENBQUEsQ0FDQSxHQUFBLENBQUEsVUFBQSwwQkFBQSxzQkFBQSxDQUFBLE9B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REksYUFBYSxDQUFiQSxJQUFBQSxDQUQ3RCxhQUM2REEsQ0FBM0RKLENBQTZGO0FBRC9GLENBRUc7QUFDSixDQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUN1QixNQUFkSyxDQUFBQSxjQUFjLENBQUMsQ0FBQSxJQUFBLENBQVFKLFdBQVIsQ0FBRCxDQUE4RCxtREFDakYsR0FBQSxXQUFBLENBQWlCLDZCQUNmO0FBQ0EsS0FBTUssQ0FBQUEsU0FBUywyQkFBR0osSUFBSSxDQUF0QixXQUFrQkEsRUFBSCxDQUFmLENBRmUseUJBR2YsTUFBT0ksQ0FBQUEsU0FBUyxDQUFUQSxTQUFBQSxDQUFBQSxDQUFBQSxDQUF1QkEsU0FBUyxDQUFUQSxPQUFBQSxDQUE5QixHQUE4QkEsQ0FBdkJBLENBQVAsQ0FDRCxDQUpELGtDQURpRix5QkFNakYsTUFBT0osQ0FBQUEsSUFBSSxDQUFYLFdBQU9BLEVBQVAsQ0FDRCxDQW5PeUIsQyxzR0FzT2JyQyxjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFyc2UgfSBmcm9tICdwYXJzZS9ub2RlJztcbmltcG9ydCBSZXN0UXVlcnkgZnJvbSAnLi4vUmVzdFF1ZXJ5JztcbmltcG9ydCBSZXN0V3JpdGUgZnJvbSAnLi4vUmVzdFdyaXRlJztcbmltcG9ydCB7IG1hc3RlciB9IGZyb20gJy4uL0F1dGgnO1xuaW1wb3J0IHsgcHVzaFN0YXR1c0hhbmRsZXIgfSBmcm9tICcuLi9TdGF0dXNIYW5kbGVyJztcbmltcG9ydCB7IGFwcGx5RGV2aWNlVG9rZW5FeGlzdHMgfSBmcm9tICcuLi9QdXNoL3V0aWxzJztcblxuZXhwb3J0IGNsYXNzIFB1c2hDb250cm9sbGVyIHtcbiAgc2VuZFB1c2goYm9keSA9IHt9LCB3aGVyZSA9IHt9LCBjb25maWcsIGF1dGgsIG9uUHVzaFN0YXR1c1NhdmVkID0gKCkgPT4ge30sIG5vdyA9IG5ldyBEYXRlKCkpIHtcbiAgICBpZiAoIWNvbmZpZy5oYXNQdXNoU3VwcG9ydCkge1xuICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLlBVU0hfTUlTQ09ORklHVVJFRCwgJ01pc3NpbmcgcHVzaCBjb25maWd1cmF0aW9uJyk7XG4gICAgfVxuXG4gICAgLy8gUmVwbGFjZSB0aGUgZXhwaXJhdGlvbl90aW1lIGFuZCBwdXNoX3RpbWUgd2l0aCBhIHZhbGlkIFVuaXggZXBvY2ggbWlsbGlzZWNvbmRzIHRpbWVcbiAgICBib2R5LmV4cGlyYXRpb25fdGltZSA9IFB1c2hDb250cm9sbGVyLmdldEV4cGlyYXRpb25UaW1lKGJvZHkpO1xuICAgIGJvZHkuZXhwaXJhdGlvbl9pbnRlcnZhbCA9IFB1c2hDb250cm9sbGVyLmdldEV4cGlyYXRpb25JbnRlcnZhbChib2R5KTtcbiAgICBpZiAoYm9keS5leHBpcmF0aW9uX3RpbWUgJiYgYm9keS5leHBpcmF0aW9uX2ludGVydmFsKSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgIFBhcnNlLkVycm9yLlBVU0hfTUlTQ09ORklHVVJFRCxcbiAgICAgICAgJ0JvdGggZXhwaXJhdGlvbl90aW1lIGFuZCBleHBpcmF0aW9uX2ludGVydmFsIGNhbm5vdCBiZSBzZXQnXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEltbWVkaWF0ZSBwdXNoXG4gICAgaWYgKGJvZHkuZXhwaXJhdGlvbl9pbnRlcnZhbCAmJiAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGJvZHksICdwdXNoX3RpbWUnKSkge1xuICAgICAgY29uc3QgdHRsTXMgPSBib2R5LmV4cGlyYXRpb25faW50ZXJ2YWwgKiAxMDAwO1xuICAgICAgYm9keS5leHBpcmF0aW9uX3RpbWUgPSBuZXcgRGF0ZShub3cudmFsdWVPZigpICsgdHRsTXMpLnZhbHVlT2YoKTtcbiAgICB9XG5cbiAgICBjb25zdCBwdXNoVGltZSA9IFB1c2hDb250cm9sbGVyLmdldFB1c2hUaW1lKGJvZHkpO1xuICAgIGlmIChwdXNoVGltZSAmJiBwdXNoVGltZS5kYXRlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgYm9keVsncHVzaF90aW1lJ10gPSBQdXNoQ29udHJvbGxlci5mb3JtYXRQdXNoVGltZShwdXNoVGltZSk7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogSWYgdGhlIHJlcSBjYW4gcGFzcyB0aGUgY2hlY2tpbmcsIHdlIHJldHVybiBpbW1lZGlhdGVseSBpbnN0ZWFkIG9mIHdhaXRpbmdcbiAgICAvLyBwdXNoZXMgdG8gYmUgc2VudC4gV2UgcHJvYmFibHkgY2hhbmdlIHRoaXMgYmVoYXZpb3VyIGluIHRoZSBmdXR1cmUuXG4gICAgbGV0IGJhZGdlVXBkYXRlID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH07XG5cbiAgICBpZiAoYm9keS5kYXRhICYmIGJvZHkuZGF0YS5iYWRnZSkge1xuICAgICAgY29uc3QgYmFkZ2UgPSBib2R5LmRhdGEuYmFkZ2U7XG4gICAgICBsZXQgcmVzdFVwZGF0ZSA9IHt9O1xuICAgICAgaWYgKHR5cGVvZiBiYWRnZSA9PSAnc3RyaW5nJyAmJiBiYWRnZS50b0xvd2VyQ2FzZSgpID09PSAnaW5jcmVtZW50Jykge1xuICAgICAgICByZXN0VXBkYXRlID0geyBiYWRnZTogeyBfX29wOiAnSW5jcmVtZW50JywgYW1vdW50OiAxIH0gfTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIHR5cGVvZiBiYWRnZSA9PSAnb2JqZWN0JyAmJlxuICAgICAgICB0eXBlb2YgYmFkZ2UuX19vcCA9PSAnc3RyaW5nJyAmJlxuICAgICAgICBiYWRnZS5fX29wLnRvTG93ZXJDYXNlKCkgPT0gJ2luY3JlbWVudCcgJiZcbiAgICAgICAgTnVtYmVyKGJhZGdlLmFtb3VudClcbiAgICAgICkge1xuICAgICAgICByZXN0VXBkYXRlID0geyBiYWRnZTogeyBfX29wOiAnSW5jcmVtZW50JywgYW1vdW50OiBiYWRnZS5hbW91bnQgfSB9O1xuICAgICAgfSBlbHNlIGlmIChOdW1iZXIoYmFkZ2UpKSB7XG4gICAgICAgIHJlc3RVcGRhdGUgPSB7IGJhZGdlOiBiYWRnZSB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgXCJJbnZhbGlkIHZhbHVlIGZvciBiYWRnZSwgZXhwZWN0ZWQgbnVtYmVyIG9yICdJbmNyZW1lbnQnIG9yIHtpbmNyZW1lbnQ6IG51bWJlcn1cIjtcbiAgICAgIH1cblxuICAgICAgLy8gRm9yY2UgZmlsdGVyaW5nIG9uIG9ubHkgdmFsaWQgZGV2aWNlIHRva2Vuc1xuICAgICAgY29uc3QgdXBkYXRlV2hlcmUgPSBhcHBseURldmljZVRva2VuRXhpc3RzKHdoZXJlKTtcbiAgICAgIGJhZGdlVXBkYXRlID0gKCkgPT4ge1xuICAgICAgICAvLyBCdWlsZCBhIHJlYWwgUmVzdFF1ZXJ5IHNvIHdlIGNhbiB1c2UgaXQgaW4gUmVzdFdyaXRlXG4gICAgICAgIGNvbnN0IHJlc3RRdWVyeSA9IG5ldyBSZXN0UXVlcnkoY29uZmlnLCBtYXN0ZXIoY29uZmlnKSwgJ19JbnN0YWxsYXRpb24nLCB1cGRhdGVXaGVyZSk7XG4gICAgICAgIHJldHVybiByZXN0UXVlcnkuYnVpbGRSZXN0V2hlcmUoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICBjb25zdCB3cml0ZSA9IG5ldyBSZXN0V3JpdGUoXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBtYXN0ZXIoY29uZmlnKSxcbiAgICAgICAgICAgICdfSW5zdGFsbGF0aW9uJyxcbiAgICAgICAgICAgIHJlc3RRdWVyeS5yZXN0V2hlcmUsXG4gICAgICAgICAgICByZXN0VXBkYXRlXG4gICAgICAgICAgKTtcbiAgICAgICAgICB3cml0ZS5ydW5PcHRpb25zLm1hbnkgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiB3cml0ZS5leGVjdXRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcHVzaFN0YXR1cyA9IHB1c2hTdGF0dXNIYW5kbGVyKGNvbmZpZyk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIHJldHVybiBwdXNoU3RhdHVzLnNldEluaXRpYWwoYm9keSwgd2hlcmUpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgb25QdXNoU3RhdHVzU2F2ZWQocHVzaFN0YXR1cy5vYmplY3RJZCk7XG4gICAgICAgIHJldHVybiBiYWRnZVVwZGF0ZSgpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgLy8gVXBkYXRlIGF1ZGllbmNlIGxhc3RVc2VkIGFuZCB0aW1lc1VzZWRcbiAgICAgICAgaWYgKGJvZHkuYXVkaWVuY2VfaWQpIHtcbiAgICAgICAgICBjb25zdCBhdWRpZW5jZUlkID0gYm9keS5hdWRpZW5jZV9pZDtcblxuICAgICAgICAgIHZhciB1cGRhdGVBdWRpZW5jZSA9IHtcbiAgICAgICAgICAgIGxhc3RVc2VkOiB7IF9fdHlwZTogJ0RhdGUnLCBpc286IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9LFxuICAgICAgICAgICAgdGltZXNVc2VkOiB7IF9fb3A6ICdJbmNyZW1lbnQnLCBhbW91bnQ6IDEgfSxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGNvbnN0IHdyaXRlID0gbmV3IFJlc3RXcml0ZShcbiAgICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICAgIG1hc3Rlcihjb25maWcpLFxuICAgICAgICAgICAgJ19BdWRpZW5jZScsXG4gICAgICAgICAgICB7IG9iamVjdElkOiBhdWRpZW5jZUlkIH0sXG4gICAgICAgICAgICB1cGRhdGVBdWRpZW5jZVxuICAgICAgICAgICk7XG4gICAgICAgICAgd3JpdGUuZXhlY3V0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIERvbid0IHdhaXQgZm9yIHRoZSBhdWRpZW5jZSB1cGRhdGUgcHJvbWlzZSB0byByZXNvbHZlLlxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGJvZHksICdwdXNoX3RpbWUnKSAmJlxuICAgICAgICAgIGNvbmZpZy5oYXNQdXNoU2NoZWR1bGVkU3VwcG9ydFxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbmZpZy5wdXNoQ29udHJvbGxlclF1ZXVlLmVucXVldWUoYm9keSwgd2hlcmUsIGNvbmZpZywgYXV0aCwgcHVzaFN0YXR1cyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIHJldHVybiBwdXNoU3RhdHVzLmZhaWwoZXJyKS50aGVuKCgpID0+IHtcbiAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGV4cGlyYXRpb24gdGltZSBmcm9tIHRoZSByZXF1ZXN0IGJvZHkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSByZXF1ZXN0IEEgcmVxdWVzdCBvYmplY3RcbiAgICogQHJldHVybnMge051bWJlcnx1bmRlZmluZWR9IFRoZSBleHBpcmF0aW9uIHRpbWUgaWYgaXQgZXhpc3RzIGluIHRoZSByZXF1ZXN0XG4gICAqL1xuICBzdGF0aWMgZ2V0RXhwaXJhdGlvblRpbWUoYm9keSA9IHt9KSB7XG4gICAgdmFyIGhhc0V4cGlyYXRpb25UaW1lID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGJvZHksICdleHBpcmF0aW9uX3RpbWUnKTtcbiAgICBpZiAoIWhhc0V4cGlyYXRpb25UaW1lKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBleHBpcmF0aW9uVGltZVBhcmFtID0gYm9keVsnZXhwaXJhdGlvbl90aW1lJ107XG4gICAgdmFyIGV4cGlyYXRpb25UaW1lO1xuICAgIGlmICh0eXBlb2YgZXhwaXJhdGlvblRpbWVQYXJhbSA9PT0gJ251bWJlcicpIHtcbiAgICAgIGV4cGlyYXRpb25UaW1lID0gbmV3IERhdGUoZXhwaXJhdGlvblRpbWVQYXJhbSAqIDEwMDApO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGV4cGlyYXRpb25UaW1lUGFyYW0gPT09ICdzdHJpbmcnKSB7XG4gICAgICBleHBpcmF0aW9uVGltZSA9IG5ldyBEYXRlKGV4cGlyYXRpb25UaW1lUGFyYW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgIFBhcnNlLkVycm9yLlBVU0hfTUlTQ09ORklHVVJFRCxcbiAgICAgICAgYm9keVsnZXhwaXJhdGlvbl90aW1lJ10gKyAnIGlzIG5vdCB2YWxpZCB0aW1lLidcbiAgICAgICk7XG4gICAgfVxuICAgIC8vIENoZWNrIGV4cGlyYXRpb25UaW1lIGlzIHZhbGlkIG9yIG5vdCwgaWYgaXQgaXMgbm90IHZhbGlkLCBleHBpcmF0aW9uVGltZSBpcyBOYU5cbiAgICBpZiAoIWlzRmluaXRlKGV4cGlyYXRpb25UaW1lKSkge1xuICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgICBQYXJzZS5FcnJvci5QVVNIX01JU0NPTkZJR1VSRUQsXG4gICAgICAgIGJvZHlbJ2V4cGlyYXRpb25fdGltZSddICsgJyBpcyBub3QgdmFsaWQgdGltZS4nXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gZXhwaXJhdGlvblRpbWUudmFsdWVPZigpO1xuICB9XG5cbiAgc3RhdGljIGdldEV4cGlyYXRpb25JbnRlcnZhbChib2R5ID0ge30pIHtcbiAgICBjb25zdCBoYXNFeHBpcmF0aW9uSW50ZXJ2YWwgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYm9keSwgJ2V4cGlyYXRpb25faW50ZXJ2YWwnKTtcbiAgICBpZiAoIWhhc0V4cGlyYXRpb25JbnRlcnZhbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBleHBpcmF0aW9uSW50ZXJ2YWxQYXJhbSA9IGJvZHlbJ2V4cGlyYXRpb25faW50ZXJ2YWwnXTtcbiAgICBpZiAodHlwZW9mIGV4cGlyYXRpb25JbnRlcnZhbFBhcmFtICE9PSAnbnVtYmVyJyB8fCBleHBpcmF0aW9uSW50ZXJ2YWxQYXJhbSA8PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgIFBhcnNlLkVycm9yLlBVU0hfTUlTQ09ORklHVVJFRCxcbiAgICAgICAgYGV4cGlyYXRpb25faW50ZXJ2YWwgbXVzdCBiZSBhIG51bWJlciBncmVhdGVyIHRoYW4gMGBcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBleHBpcmF0aW9uSW50ZXJ2YWxQYXJhbTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcHVzaCB0aW1lIGZyb20gdGhlIHJlcXVlc3QgYm9keS5cbiAgICogQHBhcmFtIHtPYmplY3R9IHJlcXVlc3QgQSByZXF1ZXN0IG9iamVjdFxuICAgKiBAcmV0dXJucyB7TnVtYmVyfHVuZGVmaW5lZH0gVGhlIHB1c2ggdGltZSBpZiBpdCBleGlzdHMgaW4gdGhlIHJlcXVlc3RcbiAgICovXG4gIHN0YXRpYyBnZXRQdXNoVGltZShib2R5ID0ge30pIHtcbiAgICB2YXIgaGFzUHVzaFRpbWUgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYm9keSwgJ3B1c2hfdGltZScpO1xuICAgIGlmICghaGFzUHVzaFRpbWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHB1c2hUaW1lUGFyYW0gPSBib2R5WydwdXNoX3RpbWUnXTtcbiAgICB2YXIgZGF0ZTtcbiAgICB2YXIgaXNMb2NhbFRpbWUgPSB0cnVlO1xuXG4gICAgaWYgKHR5cGVvZiBwdXNoVGltZVBhcmFtID09PSAnbnVtYmVyJykge1xuICAgICAgZGF0ZSA9IG5ldyBEYXRlKHB1c2hUaW1lUGFyYW0gKiAxMDAwKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwdXNoVGltZVBhcmFtID09PSAnc3RyaW5nJykge1xuICAgICAgaXNMb2NhbFRpbWUgPSAhUHVzaENvbnRyb2xsZXIucHVzaFRpbWVIYXNUaW1lem9uZUNvbXBvbmVudChwdXNoVGltZVBhcmFtKTtcbiAgICAgIGRhdGUgPSBuZXcgRGF0ZShwdXNoVGltZVBhcmFtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgICBQYXJzZS5FcnJvci5QVVNIX01JU0NPTkZJR1VSRUQsXG4gICAgICAgIGJvZHlbJ3B1c2hfdGltZSddICsgJyBpcyBub3QgdmFsaWQgdGltZS4nXG4gICAgICApO1xuICAgIH1cbiAgICAvLyBDaGVjayBwdXNoVGltZSBpcyB2YWxpZCBvciBub3QsIGlmIGl0IGlzIG5vdCB2YWxpZCwgcHVzaFRpbWUgaXMgTmFOXG4gICAgaWYgKCFpc0Zpbml0ZShkYXRlKSkge1xuICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgICBQYXJzZS5FcnJvci5QVVNIX01JU0NPTkZJR1VSRUQsXG4gICAgICAgIGJvZHlbJ3B1c2hfdGltZSddICsgJyBpcyBub3QgdmFsaWQgdGltZS4nXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBkYXRlLFxuICAgICAgaXNMb2NhbFRpbWUsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYSBJU084NjAxIGZvcm1hdHRlZCBkYXRlIGNvbnRhaW5zIGEgdGltZXpvbmUgY29tcG9uZW50XG4gICAqIEBwYXJhbSBwdXNoVGltZVBhcmFtIHtzdHJpbmd9XG4gICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgKi9cbiAgc3RhdGljIHB1c2hUaW1lSGFzVGltZXpvbmVDb21wb25lbnQocHVzaFRpbWVQYXJhbTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgb2Zmc2V0UGF0dGVybiA9IC8oLispKFsrLV0pXFxkXFxkOlxcZFxcZCQvO1xuICAgIHJldHVybiAoXG4gICAgICBwdXNoVGltZVBhcmFtLmluZGV4T2YoJ1onKSA9PT0gcHVzaFRpbWVQYXJhbS5sZW5ndGggLSAxIHx8IG9mZnNldFBhdHRlcm4udGVzdChwdXNoVGltZVBhcmFtKSAvLyAyMDA3LTA0LTA1VDEyOjMwWlxuICAgICk7IC8vIDIwMDctMDQtMDVUMTI6MzAuMDAwKzAyOjAwLCAyMDA3LTA0LTA1VDEyOjMwLjAwMC0wMjowMFxuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIGEgZGF0ZSB0byBJU08gZm9ybWF0IGluIFVUQyB0aW1lIGFuZCBzdHJpcHMgdGhlIHRpbWV6b25lIGlmIGBpc0xvY2FsVGltZWAgaXMgdHJ1ZVxuICAgKiBAcGFyYW0gZGF0ZSB7RGF0ZX1cbiAgICogQHBhcmFtIGlzTG9jYWxUaW1lIHtib29sZWFufVxuICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgKi9cbiAgc3RhdGljIGZvcm1hdFB1c2hUaW1lKHsgZGF0ZSwgaXNMb2NhbFRpbWUgfTogeyBkYXRlOiBEYXRlLCBpc0xvY2FsVGltZTogYm9vbGVhbiB9KSB7XG4gICAgaWYgKGlzTG9jYWxUaW1lKSB7XG4gICAgICAvLyBTdHJpcCAnWidcbiAgICAgIGNvbnN0IGlzb1N0cmluZyA9IGRhdGUudG9JU09TdHJpbmcoKTtcbiAgICAgIHJldHVybiBpc29TdHJpbmcuc3Vic3RyaW5nKDAsIGlzb1N0cmluZy5pbmRleE9mKCdaJykpO1xuICAgIH1cbiAgICByZXR1cm4gZGF0ZS50b0lTT1N0cmluZygpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFB1c2hDb250cm9sbGVyO1xuIl19