"use strict";function cov_cp5nnxlgj(){var path="/parse-server/lib/Push/utils.js";var hash="dfdfff690da7d4734494683f78f700cb3e80c378";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Push/utils.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:48}},"2":{start:{line:7,column:0},end:{line:7,column:48}},"3":{start:{line:8,column:0},end:{line:8,column:64}},"4":{start:{line:9,column:0},end:{line:9,column:52}},"5":{start:{line:10,column:0},end:{line:10,column:44}},"6":{start:{line:11,column:0},end:{line:11,column:58}},"7":{start:{line:12,column:0},end:{line:12,column:44}},"8":{start:{line:13,column:0},end:{line:13,column:56}},"9":{start:{line:15,column:12},end:{line:15,column:57}},"10":{start:{line:17,column:16},end:{line:17,column:59}},"11":{start:{line:19,column:39},end:{line:19,column:93}},"12":{start:{line:22,column:2},end:{line:24,column:3}},"13":{start:{line:23,column:4},end:{line:23,column:17}},"14":{start:{line:26,column:16},end:{line:26,column:31}},"15":{start:{line:28,column:2},end:{line:30,column:3}},"16":{start:{line:29,column:4},end:{line:29,column:16}},"17":{start:{line:32,column:2},end:{line:32,column:134}},"18":{start:{line:35,column:24},end:{line:35,column:42}},"19":{start:{line:38,column:15},end:{line:38,column:24}},"20":{start:{line:40,column:2},end:{line:42,column:3}},"21":{start:{line:41,column:4},end:{line:41,column:14}},"22":{start:{line:44,column:2},end:{line:51,column:11}},"23":{start:{line:45,column:4},end:{line:49,column:7}},"24":{start:{line:46,column:6},end:{line:48,column:7}},"25":{start:{line:47,column:8},end:{line:47,column:56}},"26":{start:{line:50,column:4},end:{line:50,column:16}},"27":{start:{line:55,column:15},end:{line:55,column:24}},"28":{start:{line:57,column:2},end:{line:59,column:3}},"29":{start:{line:58,column:4},end:{line:58,column:16}},"30":{start:{line:61,column:2},end:{line:61,column:38}},"31":{start:{line:62,column:2},end:{line:68,column:5}},"32":{start:{line:63,column:24},end:{line:63,column:53}},"33":{start:{line:65,column:4},end:{line:67,column:5}},"34":{start:{line:66,column:6},end:{line:66,column:35}},"35":{start:{line:69,column:2},end:{line:69,column:36}},"36":{start:{line:73,column:2},end:{line:75,column:3}},"37":{start:{line:74,column:4},end:{line:74,column:16}},"38":{start:{line:77,column:2},end:{line:83,column:5}},"39":{start:{line:78,column:4},end:{line:82,column:7}},"40":{start:{line:79,column:6},end:{line:81,column:7}},"41":{start:{line:80,column:8},end:{line:80,column:30}},"42":{start:{line:84,column:2},end:{line:84,column:14}},"43":{start:{line:89,column:17},end:{line:92,column:8}},"44":{start:{line:90,column:4},end:{line:90,column:60}},"45":{start:{line:91,column:4},end:{line:91,column:16}},"46":{start:{line:94,column:2},end:{line:94,column:46}},"47":{start:{line:95,column:2},end:{line:95,column:16}},"48":{start:{line:99,column:2},end:{line:120,column:5}},"49":{start:{line:100,column:16},end:{line:100,column:21}},"50":{start:{line:101,column:4},end:{line:111,column:7}},"51":{start:{line:102,column:6},end:{line:104,column:7}},"52":{start:{line:103,column:8},end:{line:103,column:15}},"53":{start:{line:106,column:6},end:{line:110,column:7}},"54":{start:{line:107,column:8},end:{line:107,column:21}},"55":{start:{line:108,column:8},end:{line:108,column:40}},"56":{start:{line:109,column:8},end:{line:109,column:39}},"57":{start:{line:113,column:4},end:{line:115,column:5}},"58":{start:{line:114,column:6},end:{line:114,column:37}},"59":{start:{line:117,column:4},end:{line:117,column:15}},"60":{start:{line:130,column:24},end:{line:130,column:46}},"61":{start:{line:131,column:20},end:{line:131,column:22}},"62":{start:{line:133,column:2},end:{line:137,column:3}},"63":{start:{line:134,column:4},end:{line:134,column:38}},"64":{start:{line:135,column:9},end:{line:137,column:3}},"65":{start:{line:136,column:4},end:{line:136,column:47}},"66":{start:{line:139,column:2},end:{line:145,column:3}},"67":{start:{line:139,column:15},end:{line:139,column:16}},"68":{start:{line:140,column:21},end:{line:140,column:35}},"69":{start:{line:142,column:4},end:{line:144,column:5}},"70":{start:{line:143,column:6},end:{line:143,column:121}},"71":{start:{line:149,column:2},end:{line:149,column:40}},"72":{start:{line:151,column:2},end:{line:155,column:3}},"73":{start:{line:152,column:4},end:{line:154,column:6}},"74":{start:{line:157,column:2},end:{line:157,column:15}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:19,column:9},end:{line:19,column:31}},loc:{start:{line:19,column:37},end:{line:19,column:95}},line:19},"1":{name:"isPushIncrementing",decl:{start:{line:21,column:9},end:{line:21,column:27}},loc:{start:{line:21,column:34},end:{line:33,column:1}},line:21},"2":{name:"getLocalesFromPush",decl:{start:{line:37,column:9},end:{line:37,column:27}},loc:{start:{line:37,column:34},end:{line:52,column:1}},line:37},"3":{name:"(anonymous_3)",decl:{start:{line:44,column:46},end:{line:44,column:47}},loc:{start:{line:44,column:61},end:{line:51,column:3}},line:44},"4":{name:"(anonymous_4)",decl:{start:{line:45,column:28},end:{line:45,column:29}},loc:{start:{line:45,column:46},end:{line:49,column:5}},line:45},"5":{name:"transformPushBodyForLocale",decl:{start:{line:54,column:9},end:{line:54,column:35}},loc:{start:{line:54,column:50},end:{line:70,column:1}},line:54},"6":{name:"(anonymous_6)",decl:{start:{line:62,column:26},end:{line:62,column:27}},loc:{start:{line:62,column:33},end:{line:68,column:3}},line:62},"7":{name:"stripLocalesFromBody",decl:{start:{line:72,column:9},end:{line:72,column:29}},loc:{start:{line:72,column:36},end:{line:85,column:1}},line:72},"8":{name:"(anonymous_8)",decl:{start:{line:77,column:33},end:{line:77,column:34}},loc:{start:{line:77,column:40},end:{line:83,column:3}},line:77},"9":{name:"(anonymous_9)",decl:{start:{line:78,column:28},end:{line:78,column:29}},loc:{start:{line:78,column:46},end:{line:82,column:5}},line:78},"10":{name:"bodiesPerLocales",decl:{start:{line:87,column:9},end:{line:87,column:25}},loc:{start:{line:87,column:46},end:{line:96,column:1}},line:87},"11":{name:"(anonymous_11)",decl:{start:{line:89,column:32},end:{line:89,column:33}},loc:{start:{line:89,column:50},end:{line:92,column:3}},line:89},"12":{name:"groupByLocaleIdentifier",decl:{start:{line:98,column:9},end:{line:98,column:32}},loc:{start:{line:98,column:62},end:{line:121,column:1}},line:98},"13":{name:"(anonymous_13)",decl:{start:{line:99,column:30},end:{line:99,column:31}},loc:{start:{line:99,column:53},end:{line:118,column:3}},line:99},"14":{name:"(anonymous_14)",decl:{start:{line:101,column:20},end:{line:101,column:21}},loc:{start:{line:101,column:30},end:{line:111,column:5}},line:101},"15":{name:"validatePushType",decl:{start:{line:129,column:9},end:{line:129,column:25}},loc:{start:{line:129,column:59},end:{line:146,column:1}},line:129},"16":{name:"applyDeviceTokenExists",decl:{start:{line:148,column:9},end:{line:148,column:31}},loc:{start:{line:148,column:39},end:{line:158,column:1}},line:148}},branchMap:{"0":{loc:{start:{line:19,column:46},end:{line:19,column:92}},type:"cond-expr",locations:[{start:{line:19,column:70},end:{line:19,column:73}},{start:{line:19,column:76},end:{line:19,column:92}}],line:19},"1":{loc:{start:{line:19,column:46},end:{line:19,column:67}},type:"binary-expr",locations:[{start:{line:19,column:46},end:{line:19,column:49}},{start:{line:19,column:53},end:{line:19,column:67}}],line:19},"2":{loc:{start:{line:22,column:2},end:{line:24,column:3}},type:"if",locations:[{start:{line:22,column:2},end:{line:24,column:3}},{start:{line:22,column:2},end:{line:24,column:3}}],line:22},"3":{loc:{start:{line:22,column:6},end:{line:22,column:36}},type:"binary-expr",locations:[{start:{line:22,column:6},end:{line:22,column:16}},{start:{line:22,column:20},end:{line:22,column:36}}],line:22},"4":{loc:{start:{line:28,column:2},end:{line:30,column:3}},type:"if",locations:[{start:{line:28,column:2},end:{line:30,column:3}},{start:{line:28,column:2},end:{line:30,column:3}}],line:28},"5":{loc:{start:{line:28,column:6},end:{line:28,column:68}},type:"binary-expr",locations:[{start:{line:28,column:6},end:{line:28,column:30}},{start:{line:28,column:34},end:{line:28,column:68}}],line:28},"6":{loc:{start:{line:32,column:9},end:{line:32,column:133}},type:"binary-expr",locations:[{start:{line:32,column:9},end:{line:32,column:33}},{start:{line:32,column:37},end:{line:32,column:66}},{start:{line:32,column:70},end:{line:32,column:109}},{start:{line:32,column:113},end:{line:32,column:133}}],line:32},"7":{loc:{start:{line:40,column:2},end:{line:42,column:3}},type:"if",locations:[{start:{line:40,column:2},end:{line:42,column:3}},{start:{line:40,column:2},end:{line:42,column:3}}],line:40},"8":{loc:{start:{line:46,column:6},end:{line:48,column:7}},type:"if",locations:[{start:{line:46,column:6},end:{line:48,column:7}},{start:{line:46,column:6},end:{line:48,column:7}}],line:46},"9":{loc:{start:{line:57,column:2},end:{line:59,column:3}},type:"if",locations:[{start:{line:57,column:2},end:{line:59,column:3}},{start:{line:57,column:2},end:{line:59,column:3}}],line:57},"10":{loc:{start:{line:65,column:4},end:{line:67,column:5}},type:"if",locations:[{start:{line:65,column:4},end:{line:67,column:5}},{start:{line:65,column:4},end:{line:67,column:5}}],line:65},"11":{loc:{start:{line:73,column:2},end:{line:75,column:3}},type:"if",locations:[{start:{line:73,column:2},end:{line:75,column:3}},{start:{line:73,column:2},end:{line:75,column:3}}],line:73},"12":{loc:{start:{line:79,column:6},end:{line:81,column:7}},type:"if",locations:[{start:{line:79,column:6},end:{line:81,column:7}},{start:{line:79,column:6},end:{line:81,column:7}}],line:79},"13":{loc:{start:{line:87,column:32},end:{line:87,column:44}},type:"default-arg",locations:[{start:{line:87,column:42},end:{line:87,column:44}}],line:87},"14":{loc:{start:{line:98,column:48},end:{line:98,column:60}},type:"default-arg",locations:[{start:{line:98,column:58},end:{line:98,column:60}}],line:98},"15":{loc:{start:{line:102,column:6},end:{line:104,column:7}},type:"if",locations:[{start:{line:102,column:6},end:{line:104,column:7}},{start:{line:102,column:6},end:{line:104,column:7}}],line:102},"16":{loc:{start:{line:106,column:6},end:{line:110,column:7}},type:"if",locations:[{start:{line:106,column:6},end:{line:110,column:7}},{start:{line:106,column:6},end:{line:110,column:7}}],line:106},"17":{loc:{start:{line:106,column:10},end:{line:106,column:94}},type:"binary-expr",locations:[{start:{line:106,column:10},end:{line:106,column:39}},{start:{line:106,column:43},end:{line:106,column:94}}],line:106},"18":{loc:{start:{line:108,column:22},end:{line:108,column:39}},type:"binary-expr",locations:[{start:{line:108,column:22},end:{line:108,column:33}},{start:{line:108,column:37},end:{line:108,column:39}}],line:108},"19":{loc:{start:{line:113,column:4},end:{line:115,column:5}},type:"if",locations:[{start:{line:113,column:4},end:{line:115,column:5}},{start:{line:113,column:4},end:{line:115,column:5}}],line:113},"20":{loc:{start:{line:129,column:26},end:{line:129,column:36}},type:"default-arg",locations:[{start:{line:129,column:34},end:{line:129,column:36}}],line:129},"21":{loc:{start:{line:129,column:38},end:{line:129,column:57}},type:"default-arg",locations:[{start:{line:129,column:55},end:{line:129,column:57}}],line:129},"22":{loc:{start:{line:130,column:24},end:{line:130,column:46}},type:"binary-expr",locations:[{start:{line:130,column:24},end:{line:130,column:40}},{start:{line:130,column:44},end:{line:130,column:46}}],line:130},"23":{loc:{start:{line:133,column:2},end:{line:137,column:3}},type:"if",locations:[{start:{line:133,column:2},end:{line:137,column:3}},{start:{line:133,column:2},end:{line:137,column:3}}],line:133},"24":{loc:{start:{line:135,column:9},end:{line:137,column:3}},type:"if",locations:[{start:{line:135,column:9},end:{line:137,column:3}},{start:{line:135,column:9},end:{line:137,column:3}}],line:135},"25":{loc:{start:{line:142,column:4},end:{line:144,column:5}},type:"if",locations:[{start:{line:142,column:4},end:{line:144,column:5}},{start:{line:142,column:4},end:{line:144,column:5}}],line:142},"26":{loc:{start:{line:151,column:2},end:{line:155,column:3}},type:"if",locations:[{start:{line:151,column:2},end:{line:155,column:3}},{start:{line:151,column:2},end:{line:155,column:3}}],line:151}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0],"14":[0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0],"21":[0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0]},inputSourceMap:{version:3,sources:["../../src/Push/utils.js"],names:["isPushIncrementing","body","data","badge","toLowerCase","__op","Number","amount","localizableKeys","getLocalesFromPush","Set","Object","keys","reduce","memo","key","forEach","localizableKey","indexOf","push","slice","length","transformPushBodyForLocale","locale","localeValue","stripLocalesFromBody","bodiesPerLocales","locales","result","default","groupByLocaleIdentifier","installations","map","installation","added","localeIdentifier","validatePushType","where","validPushTypes","deviceTypeField","deviceType","deviceTypes","Array","isArray","concat","i","Parse","Error","PUSH_MISCONFIGURED","applyDeviceTokenExists","prototype","hasOwnProperty","call","$exists"],mappings:"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",sourcesContent:["import Parse from 'parse/node';\nimport deepcopy from 'deepcopy';\n\nexport function isPushIncrementing(body) {\n  if (!body.data || !body.data.badge) {\n    return false;\n  }\n\n  const badge = body.data.badge;\n  if (typeof badge == 'string' && badge.toLowerCase() == 'increment') {\n    return true;\n  }\n\n  return (\n    typeof badge == 'object' &&\n    typeof badge.__op == 'string' &&\n    badge.__op.toLowerCase() == 'increment' &&\n    Number(badge.amount)\n  );\n}\n\nconst localizableKeys = ['alert', 'title'];\n\nexport function getLocalesFromPush(body) {\n  const data = body.data;\n  if (!data) {\n    return [];\n  }\n  return [\n    ...new Set(\n      Object.keys(data).reduce((memo, key) => {\n        localizableKeys.forEach(localizableKey => {\n          if (key.indexOf(`${localizableKey}-`) == 0) {\n            memo.push(key.slice(localizableKey.length + 1));\n          }\n        });\n        return memo;\n      }, [])\n    ),\n  ];\n}\n\nexport function transformPushBodyForLocale(body, locale) {\n  const data = body.data;\n  if (!data) {\n    return body;\n  }\n  body = deepcopy(body);\n  localizableKeys.forEach(key => {\n    const localeValue = body.data[`${key}-${locale}`];\n    if (localeValue) {\n      body.data[key] = localeValue;\n    }\n  });\n  return stripLocalesFromBody(body);\n}\n\nexport function stripLocalesFromBody(body) {\n  if (!body.data) {\n    return body;\n  }\n  Object.keys(body.data).forEach(key => {\n    localizableKeys.forEach(localizableKey => {\n      if (key.indexOf(`${localizableKey}-`) == 0) {\n        delete body.data[key];\n      }\n    });\n  });\n  return body;\n}\n\nexport function bodiesPerLocales(body, locales = []) {\n  // Get all tranformed bodies for each locale\n  const result = locales.reduce((memo, locale) => {\n    memo[locale] = transformPushBodyForLocale(body, locale);\n    return memo;\n  }, {});\n  // Set the default locale, with the stripped body\n  result.default = stripLocalesFromBody(body);\n  return result;\n}\n\nexport function groupByLocaleIdentifier(installations, locales = []) {\n  return installations.reduce(\n    (map, installation) => {\n      let added = false;\n      locales.forEach(locale => {\n        if (added) {\n          return;\n        }\n        if (installation.localeIdentifier && installation.localeIdentifier.indexOf(locale) === 0) {\n          added = true;\n          map[locale] = map[locale] || [];\n          map[locale].push(installation);\n        }\n      });\n      if (!added) {\n        map.default.push(installation);\n      }\n      return map;\n    },\n    { default: [] }\n  );\n}\n\n/**\n * Check whether the deviceType parameter in qury condition is valid or not.\n * @param {Object} where A query condition\n * @param {Array} validPushTypes An array of valid push types(string)\n */\nexport function validatePushType(where = {}, validPushTypes = []) {\n  var deviceTypeField = where.deviceType || {};\n  var deviceTypes = [];\n  if (typeof deviceTypeField === 'string') {\n    deviceTypes.push(deviceTypeField);\n  } else if (Array.isArray(deviceTypeField['$in'])) {\n    deviceTypes.concat(deviceTypeField['$in']);\n  }\n  for (var i = 0; i < deviceTypes.length; i++) {\n    var deviceType = deviceTypes[i];\n    if (validPushTypes.indexOf(deviceType) < 0) {\n      throw new Parse.Error(\n        Parse.Error.PUSH_MISCONFIGURED,\n        deviceType + ' is not supported push type.'\n      );\n    }\n  }\n}\n\nexport function applyDeviceTokenExists(where) {\n  where = deepcopy(where);\n  if (!Object.prototype.hasOwnProperty.call(where, 'deviceToken')) {\n    where['deviceToken'] = { $exists: true };\n  }\n  return where;\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"dfdfff690da7d4734494683f78f700cb3e80c378"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_cp5nnxlgj=function(){return actualCoverage;};}return actualCoverage;}cov_cp5nnxlgj();cov_cp5nnxlgj().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_cp5nnxlgj().s[1]++;exports.isPushIncrementing=isPushIncrementing;cov_cp5nnxlgj().s[2]++;exports.getLocalesFromPush=getLocalesFromPush;cov_cp5nnxlgj().s[3]++;exports.transformPushBodyForLocale=transformPushBodyForLocale;cov_cp5nnxlgj().s[4]++;exports.stripLocalesFromBody=stripLocalesFromBody;cov_cp5nnxlgj().s[5]++;exports.bodiesPerLocales=bodiesPerLocales;cov_cp5nnxlgj().s[6]++;exports.groupByLocaleIdentifier=groupByLocaleIdentifier;cov_cp5nnxlgj().s[7]++;exports.validatePushType=validatePushType;cov_cp5nnxlgj().s[8]++;exports.applyDeviceTokenExists=applyDeviceTokenExists;var _node=(cov_cp5nnxlgj().s[9]++,_interopRequireDefault(require("parse/node")));var _deepcopy=(cov_cp5nnxlgj().s[10]++,_interopRequireDefault(require("deepcopy")));function _interopRequireDefault(obj){cov_cp5nnxlgj().f[0]++;cov_cp5nnxlgj().s[11]++;return(cov_cp5nnxlgj().b[1][0]++,obj)&&(cov_cp5nnxlgj().b[1][1]++,obj.__esModule)?(cov_cp5nnxlgj().b[0][0]++,obj):(cov_cp5nnxlgj().b[0][1]++,{default:obj});}function isPushIncrementing(body){cov_cp5nnxlgj().f[1]++;cov_cp5nnxlgj().s[12]++;if((cov_cp5nnxlgj().b[3][0]++,!body.data)||(cov_cp5nnxlgj().b[3][1]++,!body.data.badge)){cov_cp5nnxlgj().b[2][0]++;cov_cp5nnxlgj().s[13]++;return false;}else{cov_cp5nnxlgj().b[2][1]++;}const badge=(cov_cp5nnxlgj().s[14]++,body.data.badge);cov_cp5nnxlgj().s[15]++;if((cov_cp5nnxlgj().b[5][0]++,typeof badge=='string')&&(cov_cp5nnxlgj().b[5][1]++,badge.toLowerCase()=='increment')){cov_cp5nnxlgj().b[4][0]++;cov_cp5nnxlgj().s[16]++;return true;}else{cov_cp5nnxlgj().b[4][1]++;}cov_cp5nnxlgj().s[17]++;return(cov_cp5nnxlgj().b[6][0]++,typeof badge=='object')&&(cov_cp5nnxlgj().b[6][1]++,typeof badge.__op=='string')&&(cov_cp5nnxlgj().b[6][2]++,badge.__op.toLowerCase()=='increment')&&(cov_cp5nnxlgj().b[6][3]++,Number(badge.amount));}const localizableKeys=(cov_cp5nnxlgj().s[18]++,['alert','title']);function getLocalesFromPush(body){cov_cp5nnxlgj().f[2]++;const data=(cov_cp5nnxlgj().s[19]++,body.data);cov_cp5nnxlgj().s[20]++;if(!data){cov_cp5nnxlgj().b[7][0]++;cov_cp5nnxlgj().s[21]++;return[];}else{cov_cp5nnxlgj().b[7][1]++;}cov_cp5nnxlgj().s[22]++;return[...new Set(Object.keys(data).reduce((memo,key)=>{cov_cp5nnxlgj().f[3]++;cov_cp5nnxlgj().s[23]++;localizableKeys.forEach(localizableKey=>{cov_cp5nnxlgj().f[4]++;cov_cp5nnxlgj().s[24]++;if(key.indexOf(`${localizableKey}-`)==0){cov_cp5nnxlgj().b[8][0]++;cov_cp5nnxlgj().s[25]++;memo.push(key.slice(localizableKey.length+1));}else{cov_cp5nnxlgj().b[8][1]++;}});cov_cp5nnxlgj().s[26]++;return memo;},[]))];}function transformPushBodyForLocale(body,locale){cov_cp5nnxlgj().f[5]++;const data=(cov_cp5nnxlgj().s[27]++,body.data);cov_cp5nnxlgj().s[28]++;if(!data){cov_cp5nnxlgj().b[9][0]++;cov_cp5nnxlgj().s[29]++;return body;}else{cov_cp5nnxlgj().b[9][1]++;}cov_cp5nnxlgj().s[30]++;body=(0,_deepcopy.default)(body);cov_cp5nnxlgj().s[31]++;localizableKeys.forEach(key=>{cov_cp5nnxlgj().f[6]++;const localeValue=(cov_cp5nnxlgj().s[32]++,body.data[`${key}-${locale}`]);cov_cp5nnxlgj().s[33]++;if(localeValue){cov_cp5nnxlgj().b[10][0]++;cov_cp5nnxlgj().s[34]++;body.data[key]=localeValue;}else{cov_cp5nnxlgj().b[10][1]++;}});cov_cp5nnxlgj().s[35]++;return stripLocalesFromBody(body);}function stripLocalesFromBody(body){cov_cp5nnxlgj().f[7]++;cov_cp5nnxlgj().s[36]++;if(!body.data){cov_cp5nnxlgj().b[11][0]++;cov_cp5nnxlgj().s[37]++;return body;}else{cov_cp5nnxlgj().b[11][1]++;}cov_cp5nnxlgj().s[38]++;Object.keys(body.data).forEach(key=>{cov_cp5nnxlgj().f[8]++;cov_cp5nnxlgj().s[39]++;localizableKeys.forEach(localizableKey=>{cov_cp5nnxlgj().f[9]++;cov_cp5nnxlgj().s[40]++;if(key.indexOf(`${localizableKey}-`)==0){cov_cp5nnxlgj().b[12][0]++;cov_cp5nnxlgj().s[41]++;delete body.data[key];}else{cov_cp5nnxlgj().b[12][1]++;}});});cov_cp5nnxlgj().s[42]++;return body;}function bodiesPerLocales(body,locales=(cov_cp5nnxlgj().b[13][0]++,[])){cov_cp5nnxlgj().f[10]++;// Get all tranformed bodies for each locale
const result=(cov_cp5nnxlgj().s[43]++,locales.reduce((memo,locale)=>{cov_cp5nnxlgj().f[11]++;cov_cp5nnxlgj().s[44]++;memo[locale]=transformPushBodyForLocale(body,locale);cov_cp5nnxlgj().s[45]++;return memo;},{}));// Set the default locale, with the stripped body
cov_cp5nnxlgj().s[46]++;result.default=stripLocalesFromBody(body);cov_cp5nnxlgj().s[47]++;return result;}function groupByLocaleIdentifier(installations,locales=(cov_cp5nnxlgj().b[14][0]++,[])){cov_cp5nnxlgj().f[12]++;cov_cp5nnxlgj().s[48]++;return installations.reduce((map,installation)=>{cov_cp5nnxlgj().f[13]++;let added=(cov_cp5nnxlgj().s[49]++,false);cov_cp5nnxlgj().s[50]++;locales.forEach(locale=>{cov_cp5nnxlgj().f[14]++;cov_cp5nnxlgj().s[51]++;if(added){cov_cp5nnxlgj().b[15][0]++;cov_cp5nnxlgj().s[52]++;return;}else{cov_cp5nnxlgj().b[15][1]++;}cov_cp5nnxlgj().s[53]++;if((cov_cp5nnxlgj().b[17][0]++,installation.localeIdentifier)&&(cov_cp5nnxlgj().b[17][1]++,installation.localeIdentifier.indexOf(locale)===0)){cov_cp5nnxlgj().b[16][0]++;cov_cp5nnxlgj().s[54]++;added=true;cov_cp5nnxlgj().s[55]++;map[locale]=(cov_cp5nnxlgj().b[18][0]++,map[locale])||(cov_cp5nnxlgj().b[18][1]++,[]);cov_cp5nnxlgj().s[56]++;map[locale].push(installation);}else{cov_cp5nnxlgj().b[16][1]++;}});cov_cp5nnxlgj().s[57]++;if(!added){cov_cp5nnxlgj().b[19][0]++;cov_cp5nnxlgj().s[58]++;map.default.push(installation);}else{cov_cp5nnxlgj().b[19][1]++;}cov_cp5nnxlgj().s[59]++;return map;},{default:[]});}/**
 * Check whether the deviceType parameter in qury condition is valid or not.
 * @param {Object} where A query condition
 * @param {Array} validPushTypes An array of valid push types(string)
 */function validatePushType(where=(cov_cp5nnxlgj().b[20][0]++,{}),validPushTypes=(cov_cp5nnxlgj().b[21][0]++,[])){cov_cp5nnxlgj().f[15]++;var deviceTypeField=(cov_cp5nnxlgj().s[60]++,(cov_cp5nnxlgj().b[22][0]++,where.deviceType)||(cov_cp5nnxlgj().b[22][1]++,{}));var deviceTypes=(cov_cp5nnxlgj().s[61]++,[]);cov_cp5nnxlgj().s[62]++;if(typeof deviceTypeField==='string'){cov_cp5nnxlgj().b[23][0]++;cov_cp5nnxlgj().s[63]++;deviceTypes.push(deviceTypeField);}else{cov_cp5nnxlgj().b[23][1]++;cov_cp5nnxlgj().s[64]++;if(Array.isArray(deviceTypeField['$in'])){cov_cp5nnxlgj().b[24][0]++;cov_cp5nnxlgj().s[65]++;deviceTypes.concat(deviceTypeField['$in']);}else{cov_cp5nnxlgj().b[24][1]++;}}cov_cp5nnxlgj().s[66]++;for(var i=(cov_cp5nnxlgj().s[67]++,0);i<deviceTypes.length;i++){var deviceType=(cov_cp5nnxlgj().s[68]++,deviceTypes[i]);cov_cp5nnxlgj().s[69]++;if(validPushTypes.indexOf(deviceType)<0){cov_cp5nnxlgj().b[25][0]++;cov_cp5nnxlgj().s[70]++;throw new _node.default.Error(_node.default.Error.PUSH_MISCONFIGURED,deviceType+' is not supported push type.');}else{cov_cp5nnxlgj().b[25][1]++;}}}function applyDeviceTokenExists(where){cov_cp5nnxlgj().f[16]++;cov_cp5nnxlgj().s[71]++;where=(0,_deepcopy.default)(where);cov_cp5nnxlgj().s[72]++;if(!Object.prototype.hasOwnProperty.call(where,'deviceToken')){cov_cp5nnxlgj().b[26][0]++;cov_cp5nnxlgj().s[73]++;where['deviceToken']={$exists:true};}else{cov_cp5nnxlgj().b[26][1]++;}cov_cp5nnxlgj().s[74]++;return where;}//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9QdXNoL3V0aWxzLmpzIl0sIm5hbWVzIjpbImlzUHVzaEluY3JlbWVudGluZyIsImJvZHkiLCJkYXRhIiwiYmFkZ2UiLCJ0b0xvd2VyQ2FzZSIsIl9fb3AiLCJOdW1iZXIiLCJhbW91bnQiLCJsb2NhbGl6YWJsZUtleXMiLCJnZXRMb2NhbGVzRnJvbVB1c2giLCJTZXQiLCJPYmplY3QiLCJrZXlzIiwicmVkdWNlIiwibWVtbyIsImtleSIsImZvckVhY2giLCJsb2NhbGl6YWJsZUtleSIsImluZGV4T2YiLCJwdXNoIiwic2xpY2UiLCJsZW5ndGgiLCJ0cmFuc2Zvcm1QdXNoQm9keUZvckxvY2FsZSIsImxvY2FsZSIsImxvY2FsZVZhbHVlIiwic3RyaXBMb2NhbGVzRnJvbUJvZHkiLCJib2RpZXNQZXJMb2NhbGVzIiwibG9jYWxlcyIsInJlc3VsdCIsImRlZmF1bHQiLCJncm91cEJ5TG9jYWxlSWRlbnRpZmllciIsImluc3RhbGxhdGlvbnMiLCJtYXAiLCJpbnN0YWxsYXRpb24iLCJhZGRlZCIsImxvY2FsZUlkZW50aWZpZXIiLCJ2YWxpZGF0ZVB1c2hUeXBlIiwid2hlcmUiLCJ2YWxpZFB1c2hUeXBlcyIsImRldmljZVR5cGVGaWVsZCIsImRldmljZVR5cGUiLCJkZXZpY2VUeXBlcyIsIkFycmF5IiwiaXNBcnJheSIsImNvbmNhdCIsImkiLCJQYXJzZSIsIkVycm9yIiwiUFVTSF9NSVNDT05GSUdVUkVEIiwiYXBwbHlEZXZpY2VUb2tlbkV4aXN0cyIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIiRleGlzdHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7Ozs7QUFFTyxTQUFTQSxrQkFBVCxDQUE0QkMsSUFBNUIsRUFBa0M7QUFDdkMsTUFBSSxDQUFDQSxJQUFJLENBQUNDLElBQU4sSUFBYyxDQUFDRCxJQUFJLENBQUNDLElBQUwsQ0FBVUMsS0FBN0IsRUFBb0M7QUFDbEMsV0FBTyxLQUFQO0FB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LENBQUwsR0FBdUI7QUFBRWdCLE1BQUFBLE9BQU8sRUFBRTtBQUFYLEtBQXZCO0FBQ0Q7O0FBQ0QsU0FBT2hCLEtBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQYXJzZSBmcm9tICdwYXJzZS9ub2RlJztcbmltcG9ydCBkZWVwY29weSBmcm9tICdkZWVwY29weSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1B1c2hJbmNyZW1lbnRpbmcoYm9keSkge1xuICBpZiAoIWJvZHkuZGF0YSB8fCAhYm9keS5kYXRhLmJhZGdlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgYmFkZ2UgPSBib2R5LmRhdGEuYmFkZ2U7XG4gIGlmICh0eXBlb2YgYmFkZ2UgPT0gJ3N0cmluZycgJiYgYmFkZ2UudG9Mb3dlckNhc2UoKSA9PSAnaW5jcmVtZW50Jykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICB0eXBlb2YgYmFkZ2UgPT0gJ29iamVjdCcgJiZcbiAgICB0eXBlb2YgYmFkZ2UuX19vcCA9PSAnc3RyaW5nJyAmJlxuICAgIGJhZGdlLl9fb3AudG9Mb3dlckNhc2UoKSA9PSAnaW5jcmVtZW50JyAmJlxuICAgIE51bWJlcihiYWRnZS5hbW91bnQpXG4gICk7XG59XG5cbmNvbnN0IGxvY2FsaXphYmxlS2V5cyA9IFsnYWxlcnQnLCAndGl0bGUnXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldExvY2FsZXNGcm9tUHVzaChib2R5KSB7XG4gIGNvbnN0IGRhdGEgPSBib2R5LmRhdGE7XG4gIGlmICghZGF0YSkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICByZXR1cm4gW1xuICAgIC4uLm5ldyBTZXQoXG4gICAgICBPYmplY3Qua2V5cyhkYXRhKS5yZWR1Y2UoKG1lbW8sIGtleSkgPT4ge1xuICAgICAgICBsb2NhbGl6YWJsZUtleXMuZm9yRWFjaChsb2NhbGl6YWJsZUtleSA9PiB7XG4gICAgICAgICAgaWYgKGtleS5pbmRleE9mKGAke2xvY2FsaXphYmxlS2V5fS1gKSA9PSAwKSB7XG4gICAgICAgICAgICBtZW1vLnB1c2goa2V5LnNsaWNlKGxvY2FsaXphYmxlS2V5Lmxlbmd0aCArIDEpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbWVtbztcbiAgICAgIH0sIFtdKVxuICAgICksXG4gIF07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2Zvcm1QdXNoQm9keUZvckxvY2FsZShib2R5LCBsb2NhbGUpIHtcbiAgY29uc3QgZGF0YSA9IGJvZHkuZGF0YTtcbiAgaWYgKCFkYXRhKSB7XG4gICAgcmV0dXJuIGJvZHk7XG4gIH1cbiAgYm9keSA9IGRlZXBjb3B5KGJvZHkpO1xuICBsb2NhbGl6YWJsZUtleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgIGNvbnN0IGxvY2FsZVZhbHVlID0gYm9keS5kYXRhW2Ake2tleX0tJHtsb2NhbGV9YF07XG4gICAgaWYgKGxvY2FsZVZhbHVlKSB7XG4gICAgICBib2R5LmRhdGFba2V5XSA9IGxvY2FsZVZhbHVlO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBzdHJpcExvY2FsZXNGcm9tQm9keShib2R5KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmlwTG9jYWxlc0Zyb21Cb2R5KGJvZHkpIHtcbiAgaWYgKCFib2R5LmRhdGEpIHtcbiAgICByZXR1cm4gYm9keTtcbiAgfVxuICBPYmplY3Qua2V5cyhib2R5LmRhdGEpLmZvckVhY2goa2V5ID0+IHtcbiAgICBsb2NhbGl6YWJsZUtleXMuZm9yRWFjaChsb2NhbGl6YWJsZUtleSA9PiB7XG4gICAgICBpZiAoa2V5LmluZGV4T2YoYCR7bG9jYWxpemFibGVLZXl9LWApID09IDApIHtcbiAgICAgICAgZGVsZXRlIGJvZHkuZGF0YVtrZXldO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgcmV0dXJuIGJvZHk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBib2RpZXNQZXJMb2NhbGVzKGJvZHksIGxvY2FsZXMgPSBbXSkge1xuICAvLyBHZXQgYWxsIHRyYW5mb3JtZWQgYm9kaWVzIGZvciBlYWNoIGxvY2FsZVxuICBjb25zdCByZXN1bHQgPSBsb2NhbGVzLnJlZHVjZSgobWVtbywgbG9jYWxlKSA9PiB7XG4gICAgbWVtb1tsb2NhbGVdID0gdHJhbnNmb3JtUHVzaEJvZHlGb3JMb2NhbGUoYm9keSwgbG9jYWxlKTtcbiAgICByZXR1cm4gbWVtbztcbiAgfSwge30pO1xuICAvLyBTZXQgdGhlIGRlZmF1bHQgbG9jYWxlLCB3aXRoIHRoZSBzdHJpcHBlZCBib2R5XG4gIHJlc3VsdC5kZWZhdWx0ID0gc3RyaXBMb2NhbGVzRnJvbUJvZHkoYm9keSk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBncm91cEJ5TG9jYWxlSWRlbnRpZmllcihpbnN0YWxsYXRpb25zLCBsb2NhbGVzID0gW10pIHtcbiAgcmV0dXJuIGluc3RhbGxhdGlvbnMucmVkdWNlKFxuICAgIChtYXAsIGluc3RhbGxhdGlvbikgPT4ge1xuICAgICAgbGV0IGFkZGVkID0gZmFsc2U7XG4gICAgICBsb2NhbGVzLmZvckVhY2gobG9jYWxlID0+IHtcbiAgICAgICAgaWYgKGFkZGVkKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpbnN0YWxsYXRpb24ubG9jYWxlSWRlbnRpZmllciAmJiBpbnN0YWxsYXRpb24ubG9jYWxlSWRlbnRpZmllci5pbmRleE9mKGxvY2FsZSkgPT09IDApIHtcbiAgICAgICAgICBhZGRlZCA9IHRydWU7XG4gICAgICAgICAgbWFwW2xvY2FsZV0gPSBtYXBbbG9jYWxlXSB8fCBbXTtcbiAgICAgICAgICBtYXBbbG9jYWxlXS5wdXNoKGluc3RhbGxhdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKCFhZGRlZCkge1xuICAgICAgICBtYXAuZGVmYXVsdC5wdXNoKGluc3RhbGxhdGlvbik7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWFwO1xuICAgIH0sXG4gICAgeyBkZWZhdWx0OiBbXSB9XG4gICk7XG59XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciB0aGUgZGV2aWNlVHlwZSBwYXJhbWV0ZXIgaW4gcXVyeSBjb25kaXRpb24gaXMgdmFsaWQgb3Igbm90LlxuICogQHBhcmFtIHtPYmplY3R9IHdoZXJlIEEgcXVlcnkgY29uZGl0aW9uXG4gKiBAcGFyYW0ge0FycmF5fSB2YWxpZFB1c2hUeXBlcyBBbiBhcnJheSBvZiB2YWxpZCBwdXNoIHR5cGVzKHN0cmluZylcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUHVzaFR5cGUod2hlcmUgPSB7fSwgdmFsaWRQdXNoVHlwZXMgPSBbXSkge1xuICB2YXIgZGV2aWNlVHlwZUZpZWxkID0gd2hlcmUuZGV2aWNlVHlwZSB8fCB7fTtcbiAgdmFyIGRldmljZVR5cGVzID0gW107XG4gIGlmICh0eXBlb2YgZGV2aWNlVHlwZUZpZWxkID09PSAnc3RyaW5nJykge1xuICAgIGRldmljZVR5cGVzLnB1c2goZGV2aWNlVHlwZUZpZWxkKTtcbiAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGRldmljZVR5cGVGaWVsZFsnJGluJ10pKSB7XG4gICAgZGV2aWNlVHlwZXMuY29uY2F0KGRldmljZVR5cGVGaWVsZFsnJGluJ10pO1xuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZGV2aWNlVHlwZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgZGV2aWNlVHlwZSA9IGRldmljZVR5cGVzW2ldO1xuICAgIGlmICh2YWxpZFB1c2hUeXBlcy5pbmRleE9mKGRldmljZVR5cGUpIDwgMCkge1xuICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgICBQYXJzZS5FcnJvci5QVVNIX01JU0NPTkZJR1VSRUQsXG4gICAgICAgIGRldmljZVR5cGUgKyAnIGlzIG5vdCBzdXBwb3J0ZWQgcHVzaCB0eXBlLidcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcHBseURldmljZVRva2VuRXhpc3RzKHdoZXJlKSB7XG4gIHdoZXJlID0gZGVlcGNvcHkod2hlcmUpO1xuICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh3aGVyZSwgJ2RldmljZVRva2VuJykpIHtcbiAgICB3aGVyZVsnZGV2aWNlVG9rZW4nXSA9IHsgJGV4aXN0czogdHJ1ZSB9O1xuICB9XG4gIHJldHVybiB3aGVyZTtcbn1cbiJdfQ==
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9QdXNoL3V0aWxzLmpzIl0sIm5hbWVzIjpbImJvZHkiLCJiYWRnZSIsIk51bWJlciIsImxvY2FsaXphYmxlS2V5cyIsImRhdGEiLCJsb2NhbGl6YWJsZUtleSIsImtleSIsIm1lbW8iLCJsb2NhbGVWYWx1ZSIsImxvY2FsZSIsInN0cmlwTG9jYWxlc0Zyb21Cb2R5IiwiT2JqZWN0IiwibG9jYWxlcyIsInJlc3VsdCIsInRyYW5zZm9ybVB1c2hCb2R5Rm9yTG9jYWxlIiwiYWRkZWQiLCJpbnN0YWxsYXRpb24iLCJtYXAiLCJkZWZhdWx0Iiwid2hlcmUiLCJ2YWxpZFB1c2hUeXBlcyIsImRldmljZVR5cGVGaWVsZCIsImRldmljZVR5cGVzIiwiQXJyYXkiLCJpIiwiZGV2aWNlVHlwZSIsIlBhcnNlIiwiJGV4aXN0cyJdLCJtYXBwaW5ncyI6IjsrdUJBQUEsR0FBQSxDQUFBLEtBQUEseUJBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUEsQ0FBQSxDQUNBLEdBQUEsQ0FBQSxTQUFBLDBCQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsQ0FBQSxDQUFBLENBQUEsQyxpUEFFTyxRQUFBLENBQUEsa0JBQUEsQ0FBQSxJQUFBLENBQWtDLGdEQUN2QyxHQUFJLDRCQUFDQSxJQUFJLENBQUwsSUFBQSw4QkFBYyxDQUFDQSxJQUFJLENBQUpBLElBQUFBLENBQW5CLEtBQUksQ0FBSixDQUFvQyxtREFDbEMsTUFBQSxNQUFBLENBQ0QsQ0FGRCxnQ0FJQSxLQUFNQyxDQUFBQSxLQUFLLDBCQUFHRCxJQUFJLENBQUpBLElBQUFBLENBQWQsS0FBVyxDQUFYLENBTHVDLHdCQU12QyxHQUFJLGlDQUFBLENBQUEsS0FBQSxFQUFBLFFBQUEsOEJBQTRCQyxLQUFLLENBQUxBLFdBQUFBLElBQWhDLFdBQUksQ0FBSixDQUFvRSxtREFDbEUsTUFBQSxLQUFBLENBQ0QsQ0FGRCxnQ0FOdUMsd0JBVXZDLE1BQ0UsaUNBQUEsQ0FBQSxLQUFBLEVB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SkEsS0FBQUEsQ0FBQUEsT0FBQUEsQ0FBQUEsS0FBQUEsQ0FESSxrQkFBQSxDQUVKRCxVQUFVLENBRlosOEJBQU0sQ0FBTixDQUlELENBTEQsaUNBTUQsQ0FDRixDQUVNLFFBQUEsQ0FBQSxzQkFBQSxDQUFBLEtBQUEsQ0FBdUMsaURBQzVDTixLQUFLLENBQUcsQ0FBQSxFQUFBLFNBQUEsQ0FBQSxPQUFBLEVBQVJBLEtBQVEsQ0FBUkEsQ0FENEMsd0JBRTVDLEdBQUksQ0FBQ1IsTUFBTSxDQUFOQSxTQUFBQSxDQUFBQSxjQUFBQSxDQUFBQSxJQUFBQSxDQUFBQSxLQUFBQSxDQUFMLGFBQUtBLENBQUwsQ0FBaUUsb0RBQy9EUSxLQUFLLENBQUxBLGFBQUssQ0FBTEEsQ0FBdUIsQ0FBRVEsT0FBTyxDQUFFLElBQVgsQ0FBdkJSLENBQ0QsQ0FGRCxpQ0FGNEMsd0JBSzVDLE1BQUEsQ0FBQSxLQUFBLENBQ0QsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQYXJzZSBmcm9tICdwYXJzZS9ub2RlJztcbmltcG9ydCBkZWVwY29weSBmcm9tICdkZWVwY29weSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1B1c2hJbmNyZW1lbnRpbmcoYm9keSkge1xuICBpZiAoIWJvZHkuZGF0YSB8fCAhYm9keS5kYXRhLmJhZGdlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgYmFkZ2UgPSBib2R5LmRhdGEuYmFkZ2U7XG4gIGlmICh0eXBlb2YgYmFkZ2UgPT0gJ3N0cmluZycgJiYgYmFkZ2UudG9Mb3dlckNhc2UoKSA9PSAnaW5jcmVtZW50Jykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICB0eXBlb2YgYmFkZ2UgPT0gJ29iamVjdCcgJiZcbiAgICB0eXBlb2YgYmFkZ2UuX19vcCA9PSAnc3RyaW5nJyAmJlxuICAgIGJhZGdlLl9fb3AudG9Mb3dlckNhc2UoKSA9PSAnaW5jcmVtZW50JyAmJlxuICAgIE51bWJlcihiYWRnZS5hbW91bnQpXG4gICk7XG59XG5cbmNvbnN0IGxvY2FsaXphYmxlS2V5cyA9IFsnYWxlcnQnLCAndGl0bGUnXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldExvY2FsZXNGcm9tUHVzaChib2R5KSB7XG4gIGNvbnN0IGRhdGEgPSBib2R5LmRhdGE7XG4gIGlmICghZGF0YSkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICByZXR1cm4gW1xuICAgIC4uLm5ldyBTZXQoXG4gICAgICBPYmplY3Qua2V5cyhkYXRhKS5yZWR1Y2UoKG1lbW8sIGtleSkgPT4ge1xuICAgICAgICBsb2NhbGl6YWJsZUtleXMuZm9yRWFjaChsb2NhbGl6YWJsZUtleSA9PiB7XG4gICAgICAgICAgaWYgKGtleS5pbmRleE9mKGAke2xvY2FsaXphYmxlS2V5fS1gKSA9PSAwKSB7XG4gICAgICAgICAgICBtZW1vLnB1c2goa2V5LnNsaWNlKGxvY2FsaXphYmxlS2V5Lmxlbmd0aCArIDEpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbWVtbztcbiAgICAgIH0sIFtdKVxuICAgICksXG4gIF07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2Zvcm1QdXNoQm9keUZvckxvY2FsZShib2R5LCBsb2NhbGUpIHtcbiAgY29uc3QgZGF0YSA9IGJvZHkuZGF0YTtcbiAgaWYgKCFkYXRhKSB7XG4gICAgcmV0dXJuIGJvZHk7XG4gIH1cbiAgYm9keSA9IGRlZXBjb3B5KGJvZHkpO1xuICBsb2NhbGl6YWJsZUtleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgIGNvbnN0IGxvY2FsZVZhbHVlID0gYm9keS5kYXRhW2Ake2tleX0tJHtsb2NhbGV9YF07XG4gICAgaWYgKGxvY2FsZVZhbHVlKSB7XG4gICAgICBib2R5LmRhdGFba2V5XSA9IGxvY2FsZVZhbHVlO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBzdHJpcExvY2FsZXNGcm9tQm9keShib2R5KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmlwTG9jYWxlc0Zyb21Cb2R5KGJvZHkpIHtcbiAgaWYgKCFib2R5LmRhdGEpIHtcbiAgICByZXR1cm4gYm9keTtcbiAgfVxuICBPYmplY3Qua2V5cyhib2R5LmRhdGEpLmZvckVhY2goa2V5ID0+IHtcbiAgICBsb2NhbGl6YWJsZUtleXMuZm9yRWFjaChsb2NhbGl6YWJsZUtleSA9PiB7XG4gICAgICBpZiAoa2V5LmluZGV4T2YoYCR7bG9jYWxpemFibGVLZXl9LWApID09IDApIHtcbiAgICAgICAgZGVsZXRlIGJvZHkuZGF0YVtrZXldO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgcmV0dXJuIGJvZHk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBib2RpZXNQZXJMb2NhbGVzKGJvZHksIGxvY2FsZXMgPSBbXSkge1xuICAvLyBHZXQgYWxsIHRyYW5mb3JtZWQgYm9kaWVzIGZvciBlYWNoIGxvY2FsZVxuICBjb25zdCByZXN1bHQgPSBsb2NhbGVzLnJlZHVjZSgobWVtbywgbG9jYWxlKSA9PiB7XG4gICAgbWVtb1tsb2NhbGVdID0gdHJhbnNmb3JtUHVzaEJvZHlGb3JMb2NhbGUoYm9keSwgbG9jYWxlKTtcbiAgICByZXR1cm4gbWVtbztcbiAgfSwge30pO1xuICAvLyBTZXQgdGhlIGRlZmF1bHQgbG9jYWxlLCB3aXRoIHRoZSBzdHJpcHBlZCBib2R5XG4gIHJlc3VsdC5kZWZhdWx0ID0gc3RyaXBMb2NhbGVzRnJvbUJvZHkoYm9keSk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBncm91cEJ5TG9jYWxlSWRlbnRpZmllcihpbnN0YWxsYXRpb25zLCBsb2NhbGVzID0gW10pIHtcbiAgcmV0dXJuIGluc3RhbGxhdGlvbnMucmVkdWNlKFxuICAgIChtYXAsIGluc3RhbGxhdGlvbikgPT4ge1xuICAgICAgbGV0IGFkZGVkID0gZmFsc2U7XG4gICAgICBsb2NhbGVzLmZvckVhY2gobG9jYWxlID0+IHtcbiAgICAgICAgaWYgKGFkZGVkKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpbnN0YWxsYXRpb24ubG9jYWxlSWRlbnRpZmllciAmJiBpbnN0YWxsYXRpb24ubG9jYWxlSWRlbnRpZmllci5pbmRleE9mKGxvY2FsZSkgPT09IDApIHtcbiAgICAgICAgICBhZGRlZCA9IHRydWU7XG4gICAgICAgICAgbWFwW2xvY2FsZV0gPSBtYXBbbG9jYWxlXSB8fCBbXTtcbiAgICAgICAgICBtYXBbbG9jYWxlXS5wdXNoKGluc3RhbGxhdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKCFhZGRlZCkge1xuICAgICAgICBtYXAuZGVmYXVsdC5wdXNoKGluc3RhbGxhdGlvbik7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWFwO1xuICAgIH0sXG4gICAgeyBkZWZhdWx0OiBbXSB9XG4gICk7XG59XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciB0aGUgZGV2aWNlVHlwZSBwYXJhbWV0ZXIgaW4gcXVyeSBjb25kaXRpb24gaXMgdmFsaWQgb3Igbm90LlxuICogQHBhcmFtIHtPYmplY3R9IHdoZXJlIEEgcXVlcnkgY29uZGl0aW9uXG4gKiBAcGFyYW0ge0FycmF5fSB2YWxpZFB1c2hUeXBlcyBBbiBhcnJheSBvZiB2YWxpZCBwdXNoIHR5cGVzKHN0cmluZylcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUHVzaFR5cGUod2hlcmUgPSB7fSwgdmFsaWRQdXNoVHlwZXMgPSBbXSkge1xuICB2YXIgZGV2aWNlVHlwZUZpZWxkID0gd2hlcmUuZGV2aWNlVHlwZSB8fCB7fTtcbiAgdmFyIGRldmljZVR5cGVzID0gW107XG4gIGlmICh0eXBlb2YgZGV2aWNlVHlwZUZpZWxkID09PSAnc3RyaW5nJykge1xuICAgIGRldmljZVR5cGVzLnB1c2goZGV2aWNlVHlwZUZpZWxkKTtcbiAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGRldmljZVR5cGVGaWVsZFsnJGluJ10pKSB7XG4gICAgZGV2aWNlVHlwZXMuY29uY2F0KGRldmljZVR5cGVGaWVsZFsnJGluJ10pO1xuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZGV2aWNlVHlwZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgZGV2aWNlVHlwZSA9IGRldmljZVR5cGVzW2ldO1xuICAgIGlmICh2YWxpZFB1c2hUeXBlcy5pbmRleE9mKGRldmljZVR5cGUpIDwgMCkge1xuICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgICBQYXJzZS5FcnJvci5QVVNIX01JU0NPTkZJR1VSRUQsXG4gICAgICAgIGRldmljZVR5cGUgKyAnIGlzIG5vdCBzdXBwb3J0ZWQgcHVzaCB0eXBlLidcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcHBseURldmljZVRva2VuRXhpc3RzKHdoZXJlKSB7XG4gIHdoZXJlID0gZGVlcGNvcHkod2hlcmUpO1xuICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh3aGVyZSwgJ2RldmljZVRva2VuJykpIHtcbiAgICB3aGVyZVsnZGV2aWNlVG9rZW4nXSA9IHsgJGV4aXN0czogdHJ1ZSB9O1xuICB9XG4gIHJldHVybiB3aGVyZTtcbn1cbiJdfQ==