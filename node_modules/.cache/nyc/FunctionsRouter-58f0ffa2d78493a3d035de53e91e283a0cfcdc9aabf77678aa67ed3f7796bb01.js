"use strict";function cov_3hq3dbr2o(){var path="/parse-server/lib/Routers/FunctionsRouter.js";var hash="3fb20bb56f1f06ee521758eda0000bcbaf20647a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/parse-server/lib/Routers/FunctionsRouter.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:6,column:0},end:{line:6,column:33}},"2":{start:{line:8,column:21},end:{line:8,column:72}},"3":{start:{line:10,column:19},end:{line:10,column:44}},"4":{start:{line:12,column:21},end:{line:12,column:48}},"5":{start:{line:14,column:14},end:{line:14,column:55}},"6":{start:{line:16,column:14},end:{line:16,column:34}},"7":{start:{line:18,column:39},end:{line:18,column:93}},"8":{start:{line:21,column:12},end:{line:21,column:39}},"9":{start:{line:22,column:15},end:{line:22,column:37}},"10":{start:{line:25,column:2},end:{line:37,column:3}},"11":{start:{line:26,column:4},end:{line:28,column:7}},"12":{start:{line:27,column:6},end:{line:27,column:31}},"13":{start:{line:29,column:9},end:{line:37,column:3}},"14":{start:{line:30,column:4},end:{line:30,column:49}},"15":{start:{line:31,column:9},end:{line:37,column:3}},"16":{start:{line:32,column:4},end:{line:32,column:36}},"17":{start:{line:33,column:9},end:{line:37,column:3}},"18":{start:{line:34,column:4},end:{line:34,column:28}},"19":{start:{line:36,column:4},end:{line:36,column:15}},"20":{start:{line:41,column:2},end:{line:41,column:56}},"21":{start:{line:46,column:4},end:{line:46,column:127}},"22":{start:{line:47,column:4},end:{line:49,column:7}},"23":{start:{line:48,column:6},end:{line:48,column:49}},"24":{start:{line:50,column:4},end:{line:52,column:7}},"25":{start:{line:51,column:6},end:{line:51,column:49}},"26":{start:{line:56,column:20},end:{line:56,column:58}},"27":{start:{line:57,column:26},end:{line:57,column:50}},"28":{start:{line:58,column:23},end:{line:58,column:71}},"29":{start:{line:59,column:24},end:{line:59,column:63}},"30":{start:{line:61,column:4},end:{line:63,column:5}},"31":{start:{line:62,column:6},end:{line:62,column:71}},"32":{start:{line:65,column:17},end:{line:65,column:55}},"33":{start:{line:66,column:4},end:{line:66,column:33}},"34":{start:{line:67,column:20},end:{line:74,column:5}},"35":{start:{line:75,column:4},end:{line:93,column:7}},"36":{start:{line:76,column:6},end:{line:76,column:41}},"37":{start:{line:78,column:6},end:{line:86,column:9}},"38":{start:{line:79,column:8},end:{line:85,column:11}},"39":{start:{line:80,column:10},end:{line:80,column:38}},"40":{start:{line:82,column:10},end:{line:82,column:42}},"41":{start:{line:84,column:10},end:{line:84,column:38}},"42":{start:{line:87,column:6},end:{line:92,column:8}},"43":{start:{line:97,column:4},end:{line:109,column:6}},"44":{start:{line:99,column:8},end:{line:103,column:11}},"45":{start:{line:106,column:22},end:{line:106,column:52}},"46":{start:{line:107,column:8},end:{line:107,column:22}},"47":{start:{line:113,column:25},end:{line:113,column:48}},"48":{start:{line:114,column:26},end:{line:114,column:50}},"49":{start:{line:115,column:24},end:{line:115,column:73}},"50":{start:{line:117,column:4},end:{line:119,column:5}},"51":{start:{line:118,column:6},end:{line:118,column:94}},"52":{start:{line:121,column:17},end:{line:121,column:55}},"53":{start:{line:122,column:4},end:{line:122,column:33}},"54":{start:{line:123,column:20},end:{line:133,column:5}},"55":{start:{line:134,column:4},end:{line:175,column:7}},"56":{start:{line:135,column:25},end:{line:135,column:81}},"57":{start:{line:137,column:25},end:{line:137,column:82}},"58":{start:{line:142,column:10},end:{line:169,column:8}},"59":{start:{line:143,column:8},end:{line:155,column:9}},"60":{start:{line:144,column:30},end:{line:144,column:103}},"61":{start:{line:146,column:10},end:{line:150,column:13}},"62":{start:{line:152,column:10},end:{line:152,column:26}},"63":{start:{line:154,column:10},end:{line:154,column:20}},"64":{start:{line:157,column:8},end:{line:168,column:9}},"65":{start:{line:158,column:10},end:{line:163,column:13}},"66":{start:{line:165,column:10},end:{line:165,column:24}},"67":{start:{line:167,column:10},end:{line:167,column:20}},"68":{start:{line:170,column:6},end:{line:174,column:30}},"69":{start:{line:171,column:8},end:{line:171,column:75}},"70":{start:{line:173,column:8},end:{line:173,column:36}},"71":{start:{line:180,column:0},end:{line:180,column:42}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:18,column:9},end:{line:18,column:31}},loc:{start:{line:18,column:37},end:{line:18,column:95}},line:18},"1":{name:"parseObject",decl:{start:{line:24,column:9},end:{line:24,column:20}},loc:{start:{line:24,column:26},end:{line:38,column:1}},line:24},"2":{name:"(anonymous_2)",decl:{start:{line:26,column:19},end:{line:26,column:20}},loc:{start:{line:26,column:27},end:{line:28,column:5}},line:26},"3":{name:"parseParams",decl:{start:{line:40,column:9},end:{line:40,column:20}},loc:{start:{line:40,column:29},end:{line:42,column:1}},line:40},"4":{name:"(anonymous_4)",decl:{start:{line:45,column:2},end:{line:45,column:3}},loc:{start:{line:45,column:16},end:{line:53,column:3}},line:45},"5":{name:"(anonymous_5)",decl:{start:{line:47,column:124},end:{line:47,column:125}},loc:{start:{line:47,column:139},end:{line:49,column:5}},line:47},"6":{name:"(anonymous_6)",decl:{start:{line:50,column:76},end:{line:50,column:77}},loc:{start:{line:50,column:91},end:{line:52,column:5}},line:50},"7":{name:"(anonymous_7)",decl:{start:{line:55,column:2},end:{line:55,column:3}},loc:{start:{line:55,column:29},end:{line:94,column:3}},line:55},"8":{name:"(anonymous_8)",decl:{start:{line:75,column:55},end:{line:75,column:56}},loc:{start:{line:75,column:68},end:{line:93,column:5}},line:75},"9":{name:"(anonymous_9)",decl:{start:{line:78,column:23},end:{line:78,column:24}},loc:{start:{line:78,column:29},end:{line:86,column:7}},line:78},"10":{name:"(anonymous_10)",decl:{start:{line:79,column:31},end:{line:79,column:32}},loc:{start:{line:79,column:37},end:{line:81,column:9}},line:79},"11":{name:"(anonymous_11)",decl:{start:{line:81,column:16},end:{line:81,column:17}},loc:{start:{line:81,column:26},end:{line:83,column:9}},line:81},"12":{name:"(anonymous_12)",decl:{start:{line:83,column:11},end:{line:83,column:12}},loc:{start:{line:83,column:20},end:{line:85,column:9}},line:83},"13":{name:"(anonymous_13)",decl:{start:{line:96,column:2},end:{line:96,column:3}},loc:{start:{line:96,column:47},end:{line:110,column:3}},line:96},"14":{name:"(anonymous_14)",decl:{start:{line:98,column:15},end:{line:98,column:16}},loc:{start:{line:98,column:33},end:{line:104,column:7}},line:98},"15":{name:"(anonymous_15)",decl:{start:{line:105,column:13},end:{line:105,column:14}},loc:{start:{line:105,column:32},end:{line:108,column:7}},line:105},"16":{name:"(anonymous_16)",decl:{start:{line:112,column:2},end:{line:112,column:3}},loc:{start:{line:112,column:34},end:{line:176,column:3}},line:112},"17":{name:"(anonymous_17)",decl:{start:{line:134,column:23},end:{line:134,column:24}},loc:{start:{line:134,column:50},end:{line:175,column:5}},line:134},"18":{name:"(anonymous_18)",decl:{start:{line:142,column:47},end:{line:142,column:48}},loc:{start:{line:142,column:57},end:{line:156,column:7}},line:142},"19":{name:"(anonymous_19)",decl:{start:{line:156,column:9},end:{line:156,column:10}},loc:{start:{line:156,column:18},end:{line:169,column:7}},line:156},"20":{name:"(anonymous_20)",decl:{start:{line:170,column:36},end:{line:170,column:37}},loc:{start:{line:170,column:42},end:{line:172,column:7}},line:170},"21":{name:"(anonymous_21)",decl:{start:{line:172,column:14},end:{line:172,column:15}},loc:{start:{line:172,column:20},end:{line:174,column:7}},line:172}},branchMap:{"0":{loc:{start:{line:18,column:46},end:{line:18,column:92}},type:"cond-expr",locations:[{start:{line:18,column:70},end:{line:18,column:73}},{start:{line:18,column:76},end:{line:18,column:92}}],line:18},"1":{loc:{start:{line:18,column:46},end:{line:18,column:67}},type:"binary-expr",locations:[{start:{line:18,column:46},end:{line:18,column:49}},{start:{line:18,column:53},end:{line:18,column:67}}],line:18},"2":{loc:{start:{line:25,column:2},end:{line:37,column:3}},type:"if",locations:[{start:{line:25,column:2},end:{line:37,column:3}},{start:{line:25,column:2},end:{line:37,column:3}}],line:25},"3":{loc:{start:{line:29,column:9},end:{line:37,column:3}},type:"if",locations:[{start:{line:29,column:9},end:{line:37,column:3}},{start:{line:29,column:9},end:{line:37,column:3}}],line:29},"4":{loc:{start:{line:29,column:13},end:{line:29,column:40}},type:"binary-expr",locations:[{start:{line:29,column:13},end:{line:29,column:16}},{start:{line:29,column:20},end:{line:29,column:40}}],line:29},"5":{loc:{start:{line:31,column:9},end:{line:37,column:3}},type:"if",locations:[{start:{line:31,column:9},end:{line:37,column:3}},{start:{line:31,column:9},end:{line:37,column:3}}],line:31},"6":{loc:{start:{line:31,column:13},end:{line:31,column:40}},type:"binary-expr",locations:[{start:{line:31,column:13},end:{line:31,column:16}},{start:{line:31,column:20},end:{line:31,column:40}}],line:31},"7":{loc:{start:{line:33,column:9},end:{line:37,column:3}},type:"if",locations:[{start:{line:33,column:9},end:{line:37,column:3}},{start:{line:33,column:9},end:{line:37,column:3}}],line:33},"8":{loc:{start:{line:33,column:13},end:{line:33,column:43}},type:"binary-expr",locations:[{start:{line:33,column:13},end:{line:33,column:16}},{start:{line:33,column:20},end:{line:33,column:43}}],line:33},"9":{loc:{start:{line:56,column:20},end:{line:56,column:58}},type:"binary-expr",locations:[{start:{line:56,column:20},end:{line:56,column:38}},{start:{line:56,column:42},end:{line:56,column:58}}],line:56},"10":{loc:{start:{line:61,column:4},end:{line:63,column:5}},type:"if",locations:[{start:{line:61,column:4},end:{line:63,column:5}},{start:{line:61,column:4},end:{line:63,column:5}}],line:61},"11":{loc:{start:{line:117,column:4},end:{line:119,column:5}},type:"if",locations:[{start:{line:117,column:4},end:{line:119,column:5}},{start:{line:117,column:4},end:{line:119,column:5}}],line:117},"12":{loc:{start:{line:125,column:14},end:{line:125,column:43}},type:"binary-expr",locations:[{start:{line:125,column:14},end:{line:125,column:22}},{start:{line:125,column:26},end:{line:125,column:43}}],line:125},"13":{loc:{start:{line:126,column:12},end:{line:126,column:37}},type:"binary-expr",locations:[{start:{line:126,column:12},end:{line:126,column:20}},{start:{line:126,column:24},end:{line:126,column:37}}],line:126},"14":{loc:{start:{line:135,column:25},end:{line:135,column:81}},type:"cond-expr",locations:[{start:{line:135,column:53},end:{line:135,column:69}},{start:{line:135,column:72},end:{line:135,column:81}}],line:135},"15":{loc:{start:{line:135,column:25},end:{line:135,column:50}},type:"binary-expr",locations:[{start:{line:135,column:25},end:{line:135,column:33}},{start:{line:135,column:37},end:{line:135,column:50}}],line:135}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},inputSourceMap:{version:3,sources:["../../src/Routers/FunctionsRouter.js"],names:["Parse","require","triggers","parseObject","obj","Array","isArray","map","item","__type","Object","assign","Date","iso","File","fromJSON","parseParams","params","_","mapValues","FunctionsRouter","PromiseRouter","mountRoutes","route","promiseEnsureIdempotency","handleCloudFunction","promiseEnforceMasterKeyAccess","req","handleCloudJob","jobName","body","applicationId","config","jobHandler","jobFunction","getJob","Error","SCRIPT_FAILED","query","request","log","loggerController","headers","ip","message","setMessage","bind","setRunning","then","jobStatus","jobId","objectId","process","nextTick","Promise","resolve","result","setSucceeded","error","setFailed","response","createResponseObject","reject","success","_encode","resolveError","functionName","theFunction","getFunction","master","auth","isMaster","user","installationId","info","context","userString","id","undefined","cleanInput","logger","truncateLogMessage","JSON","stringify","cleanResult","e","maybeRunValidator"],mappings:"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",sourcesContent:["// FunctionsRouter.js\n\nvar Parse = require('parse/node').Parse,\n  triggers = require('../triggers');\n\nimport PromiseRouter from '../PromiseRouter';\nimport { promiseEnforceMasterKeyAccess, promiseEnsureIdempotency } from '../middlewares';\nimport { jobStatusHandler } from '../StatusHandler';\nimport _ from 'lodash';\nimport { logger } from '../logger';\n\nfunction parseObject(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(item => {\n      return parseObject(item);\n    });\n  } else if (obj && obj.__type == 'Date') {\n    return Object.assign(new Date(obj.iso), obj);\n  } else if (obj && obj.__type == 'File') {\n    return Parse.File.fromJSON(obj);\n  } else if (obj && typeof obj === 'object') {\n    return parseParams(obj);\n  } else {\n    return obj;\n  }\n}\n\nfunction parseParams(params) {\n  return _.mapValues(params, parseObject);\n}\n\nexport class FunctionsRouter extends PromiseRouter {\n  mountRoutes() {\n    this.route(\n      'POST',\n      '/functions/:functionName',\n      promiseEnsureIdempotency,\n      FunctionsRouter.handleCloudFunction\n    );\n    this.route(\n      'POST',\n      '/jobs/:jobName',\n      promiseEnsureIdempotency,\n      promiseEnforceMasterKeyAccess,\n      function (req) {\n        return FunctionsRouter.handleCloudJob(req);\n      }\n    );\n    this.route('POST', '/jobs', promiseEnforceMasterKeyAccess, function (req) {\n      return FunctionsRouter.handleCloudJob(req);\n    });\n  }\n\n  static handleCloudJob(req) {\n    const jobName = req.params.jobName || req.body.jobName;\n    const applicationId = req.config.applicationId;\n    const jobHandler = jobStatusHandler(req.config);\n    const jobFunction = triggers.getJob(jobName, applicationId);\n    if (!jobFunction) {\n      throw new Parse.Error(Parse.Error.SCRIPT_FAILED, 'Invalid job.');\n    }\n    let params = Object.assign({}, req.body, req.query);\n    params = parseParams(params);\n    const request = {\n      params: params,\n      log: req.config.loggerController,\n      headers: req.config.headers,\n      ip: req.config.ip,\n      jobName,\n      message: jobHandler.setMessage.bind(jobHandler),\n    };\n\n    return jobHandler.setRunning(jobName, params).then(jobStatus => {\n      request.jobId = jobStatus.objectId;\n      // run the function async\n      process.nextTick(() => {\n        Promise.resolve()\n          .then(() => {\n            return jobFunction(request);\n          })\n          .then(\n            result => {\n              jobHandler.setSucceeded(result);\n            },\n            error => {\n              jobHandler.setFailed(error);\n            }\n          );\n      });\n      return {\n        headers: {\n          'X-Parse-Job-Status-Id': jobStatus.objectId,\n        },\n        response: {},\n      };\n    });\n  }\n\n  static createResponseObject(resolve, reject) {\n    return {\n      success: function (result) {\n        resolve({\n          response: {\n            result: Parse._encode(result),\n          },\n        });\n      },\n      error: function (message) {\n        const error = triggers.resolveError(message);\n        reject(error);\n      },\n    };\n  }\n  static handleCloudFunction(req) {\n    const functionName = req.params.functionName;\n    const applicationId = req.config.applicationId;\n    const theFunction = triggers.getFunction(functionName, applicationId);\n\n    if (!theFunction) {\n      throw new Parse.Error(Parse.Error.SCRIPT_FAILED, `Invalid function: \"${functionName}\"`);\n    }\n    let params = Object.assign({}, req.body, req.query);\n    params = parseParams(params);\n    const request = {\n      params: params,\n      master: req.auth && req.auth.isMaster,\n      user: req.auth && req.auth.user,\n      installationId: req.info.installationId,\n      log: req.config.loggerController,\n      headers: req.config.headers,\n      ip: req.config.ip,\n      functionName,\n      context: req.info.context,\n    };\n\n    return new Promise(function (resolve, reject) {\n      const userString = req.auth && req.auth.user ? req.auth.user.id : undefined;\n      const cleanInput = logger.truncateLogMessage(JSON.stringify(params));\n      const { success, error } = FunctionsRouter.createResponseObject(\n        result => {\n          try {\n            const cleanResult = logger.truncateLogMessage(JSON.stringify(result.response.result));\n            logger.info(\n              `Ran cloud function ${functionName} for user ${userString} with:\\n  Input: ${cleanInput}\\n  Result: ${cleanResult}`,\n              {\n                functionName,\n                params,\n                user: userString,\n              }\n            );\n            resolve(result);\n          } catch (e) {\n            reject(e);\n          }\n        },\n        error => {\n          try {\n            logger.error(\n              `Failed running cloud function ${functionName} for user ${userString} with:\\n  Input: ${cleanInput}\\n  Error: ` +\n                JSON.stringify(error),\n              {\n                functionName,\n                error,\n                params,\n                user: userString,\n              }\n            );\n            reject(error);\n          } catch (e) {\n            reject(e);\n          }\n        }\n      );\n      return Promise.resolve()\n        .then(() => {\n          return triggers.maybeRunValidator(request, functionName, req.auth);\n        })\n        .then(() => {\n          return theFunction(request);\n        })\n        .then(success, error);\n    });\n  }\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"3fb20bb56f1f06ee521758eda0000bcbaf20647a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_3hq3dbr2o=function(){return actualCoverage;};}return actualCoverage;}cov_3hq3dbr2o();cov_3hq3dbr2o().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_3hq3dbr2o().s[1]++;exports.FunctionsRouter=void 0;var _PromiseRouter=(cov_3hq3dbr2o().s[2]++,_interopRequireDefault(require("../PromiseRouter")));var _middlewares=(cov_3hq3dbr2o().s[3]++,require("../middlewares"));var _StatusHandler=(cov_3hq3dbr2o().s[4]++,require("../StatusHandler"));var _lodash=(cov_3hq3dbr2o().s[5]++,_interopRequireDefault(require("lodash")));var _logger=(cov_3hq3dbr2o().s[6]++,require("../logger"));function _interopRequireDefault(obj){cov_3hq3dbr2o().f[0]++;cov_3hq3dbr2o().s[7]++;return(cov_3hq3dbr2o().b[1][0]++,obj)&&(cov_3hq3dbr2o().b[1][1]++,obj.__esModule)?(cov_3hq3dbr2o().b[0][0]++,obj):(cov_3hq3dbr2o().b[0][1]++,{default:obj});}// FunctionsRouter.js
var Parse=(cov_3hq3dbr2o().s[8]++,require('parse/node').Parse),triggers=(cov_3hq3dbr2o().s[9]++,require('../triggers'));function parseObject(obj){cov_3hq3dbr2o().f[1]++;cov_3hq3dbr2o().s[10]++;if(Array.isArray(obj)){cov_3hq3dbr2o().b[2][0]++;cov_3hq3dbr2o().s[11]++;return obj.map(item=>{cov_3hq3dbr2o().f[2]++;cov_3hq3dbr2o().s[12]++;return parseObject(item);});}else{cov_3hq3dbr2o().b[2][1]++;cov_3hq3dbr2o().s[13]++;if((cov_3hq3dbr2o().b[4][0]++,obj)&&(cov_3hq3dbr2o().b[4][1]++,obj.__type=='Date')){cov_3hq3dbr2o().b[3][0]++;cov_3hq3dbr2o().s[14]++;return Object.assign(new Date(obj.iso),obj);}else{cov_3hq3dbr2o().b[3][1]++;cov_3hq3dbr2o().s[15]++;if((cov_3hq3dbr2o().b[6][0]++,obj)&&(cov_3hq3dbr2o().b[6][1]++,obj.__type=='File')){cov_3hq3dbr2o().b[5][0]++;cov_3hq3dbr2o().s[16]++;return Parse.File.fromJSON(obj);}else{cov_3hq3dbr2o().b[5][1]++;cov_3hq3dbr2o().s[17]++;if((cov_3hq3dbr2o().b[8][0]++,obj)&&(cov_3hq3dbr2o().b[8][1]++,typeof obj==='object')){cov_3hq3dbr2o().b[7][0]++;cov_3hq3dbr2o().s[18]++;return parseParams(obj);}else{cov_3hq3dbr2o().b[7][1]++;cov_3hq3dbr2o().s[19]++;return obj;}}}}}function parseParams(params){cov_3hq3dbr2o().f[3]++;cov_3hq3dbr2o().s[20]++;return _lodash.default.mapValues(params,parseObject);}class FunctionsRouter extends(_PromiseRouter.default){mountRoutes(){cov_3hq3dbr2o().f[4]++;cov_3hq3dbr2o().s[21]++;this.route('POST','/functions/:functionName',_middlewares.promiseEnsureIdempotency,FunctionsRouter.handleCloudFunction);cov_3hq3dbr2o().s[22]++;this.route('POST','/jobs/:jobName',_middlewares.promiseEnsureIdempotency,_middlewares.promiseEnforceMasterKeyAccess,function(req){cov_3hq3dbr2o().f[5]++;cov_3hq3dbr2o().s[23]++;return FunctionsRouter.handleCloudJob(req);});cov_3hq3dbr2o().s[24]++;this.route('POST','/jobs',_middlewares.promiseEnforceMasterKeyAccess,function(req){cov_3hq3dbr2o().f[6]++;cov_3hq3dbr2o().s[25]++;return FunctionsRouter.handleCloudJob(req);});}static handleCloudJob(req){cov_3hq3dbr2o().f[7]++;const jobName=(cov_3hq3dbr2o().s[26]++,(cov_3hq3dbr2o().b[9][0]++,req.params.jobName)||(cov_3hq3dbr2o().b[9][1]++,req.body.jobName));const applicationId=(cov_3hq3dbr2o().s[27]++,req.config.applicationId);const jobHandler=(cov_3hq3dbr2o().s[28]++,(0,_StatusHandler.jobStatusHandler)(req.config));const jobFunction=(cov_3hq3dbr2o().s[29]++,triggers.getJob(jobName,applicationId));cov_3hq3dbr2o().s[30]++;if(!jobFunction){cov_3hq3dbr2o().b[10][0]++;cov_3hq3dbr2o().s[31]++;throw new Parse.Error(Parse.Error.SCRIPT_FAILED,'Invalid job.');}else{cov_3hq3dbr2o().b[10][1]++;}let params=(cov_3hq3dbr2o().s[32]++,Object.assign({},req.body,req.query));cov_3hq3dbr2o().s[33]++;params=parseParams(params);const request=(cov_3hq3dbr2o().s[34]++,{params:params,log:req.config.loggerController,headers:req.config.headers,ip:req.config.ip,jobName,message:jobHandler.setMessage.bind(jobHandler)});cov_3hq3dbr2o().s[35]++;return jobHandler.setRunning(jobName,params).then(jobStatus=>{cov_3hq3dbr2o().f[8]++;cov_3hq3dbr2o().s[36]++;request.jobId=jobStatus.objectId;// run the function async
cov_3hq3dbr2o().s[37]++;process.nextTick(()=>{cov_3hq3dbr2o().f[9]++;cov_3hq3dbr2o().s[38]++;Promise.resolve().then(()=>{cov_3hq3dbr2o().f[10]++;cov_3hq3dbr2o().s[39]++;return jobFunction(request);}).then(result=>{cov_3hq3dbr2o().f[11]++;cov_3hq3dbr2o().s[40]++;jobHandler.setSucceeded(result);},error=>{cov_3hq3dbr2o().f[12]++;cov_3hq3dbr2o().s[41]++;jobHandler.setFailed(error);});});cov_3hq3dbr2o().s[42]++;return{headers:{'X-Parse-Job-Status-Id':jobStatus.objectId},response:{}};});}static createResponseObject(resolve,reject){cov_3hq3dbr2o().f[13]++;cov_3hq3dbr2o().s[43]++;return{success:function(result){cov_3hq3dbr2o().f[14]++;cov_3hq3dbr2o().s[44]++;resolve({response:{result:Parse._encode(result)}});},error:function(message){cov_3hq3dbr2o().f[15]++;const error=(cov_3hq3dbr2o().s[45]++,triggers.resolveError(message));cov_3hq3dbr2o().s[46]++;reject(error);}};}static handleCloudFunction(req){cov_3hq3dbr2o().f[16]++;const functionName=(cov_3hq3dbr2o().s[47]++,req.params.functionName);const applicationId=(cov_3hq3dbr2o().s[48]++,req.config.applicationId);const theFunction=(cov_3hq3dbr2o().s[49]++,triggers.getFunction(functionName,applicationId));cov_3hq3dbr2o().s[50]++;if(!theFunction){cov_3hq3dbr2o().b[11][0]++;cov_3hq3dbr2o().s[51]++;throw new Parse.Error(Parse.Error.SCRIPT_FAILED,`Invalid function: "${functionName}"`);}else{cov_3hq3dbr2o().b[11][1]++;}let params=(cov_3hq3dbr2o().s[52]++,Object.assign({},req.body,req.query));cov_3hq3dbr2o().s[53]++;params=parseParams(params);const request=(cov_3hq3dbr2o().s[54]++,{params:params,master:(cov_3hq3dbr2o().b[12][0]++,req.auth)&&(cov_3hq3dbr2o().b[12][1]++,req.auth.isMaster),user:(cov_3hq3dbr2o().b[13][0]++,req.auth)&&(cov_3hq3dbr2o().b[13][1]++,req.auth.user),installationId:req.info.installationId,log:req.config.loggerController,headers:req.config.headers,ip:req.config.ip,functionName,context:req.info.context});cov_3hq3dbr2o().s[55]++;return new Promise(function(resolve,reject){cov_3hq3dbr2o().f[17]++;const userString=(cov_3hq3dbr2o().s[56]++,(cov_3hq3dbr2o().b[15][0]++,req.auth)&&(cov_3hq3dbr2o().b[15][1]++,req.auth.user)?(cov_3hq3dbr2o().b[14][0]++,req.auth.user.id):(cov_3hq3dbr2o().b[14][1]++,undefined));const cleanInput=(cov_3hq3dbr2o().s[57]++,_logger.logger.truncateLogMessage(JSON.stringify(params)));const{success,error}=(cov_3hq3dbr2o().s[58]++,FunctionsRouter.createResponseObject(result=>{cov_3hq3dbr2o().f[18]++;cov_3hq3dbr2o().s[59]++;try{const cleanResult=(cov_3hq3dbr2o().s[60]++,_logger.logger.truncateLogMessage(JSON.stringify(result.response.result)));cov_3hq3dbr2o().s[61]++;_logger.logger.info(`Ran cloud function ${functionName} for user ${userString} with:\n  Input: ${cleanInput}\n  Result: ${cleanResult}`,{functionName,params,user:userString});cov_3hq3dbr2o().s[62]++;resolve(result);}catch(e){cov_3hq3dbr2o().s[63]++;reject(e);}},error=>{cov_3hq3dbr2o().f[19]++;cov_3hq3dbr2o().s[64]++;try{cov_3hq3dbr2o().s[65]++;_logger.logger.error(`Failed running cloud function ${functionName} for user ${userString} with:\n  Input: ${cleanInput}\n  Error: `+JSON.stringify(error),{functionName,error,params,user:userString});cov_3hq3dbr2o().s[66]++;reject(error);}catch(e){cov_3hq3dbr2o().s[67]++;reject(e);}}));cov_3hq3dbr2o().s[68]++;return Promise.resolve().then(()=>{cov_3hq3dbr2o().f[20]++;cov_3hq3dbr2o().s[69]++;return triggers.maybeRunValidator(request,functionName,req.auth);}).then(()=>{cov_3hq3dbr2o().f[21]++;cov_3hq3dbr2o().s[70]++;return theFunction(request);}).then(success,error);});}}cov_3hq3dbr2o().s[71]++;exports.FunctionsRouter=FunctionsRouter;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Sb3V0ZXJzL0Z1bmN0aW9uc1JvdXRlci5qcyJdLCJuYW1lcyI6WyJQYXJzZSIsInJlcXVpcmUiLCJ0cmlnZ2VycyIsInBhcnNlT2JqZWN0Iiwib2JqIiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwiaXRlbSIsIl9fdHlwZSIsIk9iamVjdCIsImFzc2lnbiIsIkRhdGUiLCJpc28iLCJGaWxlIiwiZnJvbUpTT04iLCJwYXJzZVBhcmFtcyIsInBhcmFtcyIsIl8iLCJtYXBWYWx1ZXMiLCJGdW5jdGlvbnNSb3V0ZXIiLCJQcm9taXNlUm91dGVyIiwibW91bnRSb3V0ZXMiLCJyb3V0ZSIsInByb21pc2VFbnN1cmVJZGVtcG90ZW5jeSIsImhhbmRsZUNsb3VkRnVuY3Rpb24iLCJwcm9taXNlRW5mb3JjZU1hc3RlcktleUFjY2VzcyIsInJlcSIsImhhbmRsZUNsb3VkSm9iIiwiam9iTmFtZSIsImJvZHkiLCJhcHBsaWNhdGlvbklkIiwiY29uZmlnIiwiam9iSGFuZGxlciIsImpvYkZ1bmN0aW9uIiwiZ2V0Sm9iIiwiRXJyb3IiLCJTQ1JJUFRfRkFJTEVEIiwicXVlcnkiLCJyZXF1ZXN0IiwibG9nIiwibG9nZ2VyQ29udHJvbGxlciIsImhlYWRlcnMiLCJpcCIsIm1lc3NhZ2UiLCJzZXRNZXNzYWdlIiwiYmluZCIsInNldFJ1bm5pbmciLCJ0aGVuIiwiam9iU3RhdHVzIiwiam9iSWQiLCJvYmplY3RJZCIsInByb2Nlc3MiLCJuZXh0VGljayIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVzdWx0Iiwic2V0U3VjY2VlZGVkIiwiZXJyb3IiLCJzZXRGYWlsZWQiLCJyZXNwb25zZSIsImNyZWF0ZVJlc3BvbnNlT2JqZWN0IiwicmVqZWN0Iiwic3VjY2VzcyIsIl9lbmNvZGUiLCJyZXNvbHZlRXJyb3IiLCJmdW5jdGlvbk5hbWUiLCJ0aGVGdW5jdGlvbiIsImdldEZ1bmN0aW9uIiwibWFzdGVyIiwiYXV0aCIsImlzTWFzdGVyIiwidXNlciIsImluc3RhbGxhdGlvbklkIiwiaW5mbyIsImNvbnRleHQiLCJ1c2VyU3RyaW5nIiwiaWQiLCJ1bmRlZmluZWQiLCJjbGVhbklucHV0IiwibG9nZ2VyIiwidHJ1bmNhdGVMb2dNZXNzYWdlIiwiSlNPTiIsInN0cmluZ2lmeSIsImNsZWFuUmVzdWx0IiwiZSIsIm1heWJlUnVuVmFsaWRhdG9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBS0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFUQTtBQUVBLElBQUlBLEtBQUssR0FBR0MsT0FBTyxDQUFDLFlBQUQsQ0FBUCxDQUFzQkQsS0FBbEM7QUFBQSxJQUNFRSxRQUFRLEdBQUdELE9BQU8sQ0FBQyxhQUFELENBRHBCOztBQVNBLFNBQVNFLFdBQVQsQ0FBcUJDLEdBQXJCLEVBQTBCO0FBQ3hCLE1BQUlDLEtBQUssQ0FBQ0MsT0FBTixDQUFjRixHQUFkLENBQUosRUFBd0I7QUFDdEIsV0FBT0EsR0FBRyxDQUFDRyxHQUFKLENBQVFDLElBQUksSUFBSTtBQUNyQixhQUFPTCxXQUFXLENBQUNLLElBQUQsQ0FBbEI7QUFDRCxLQUZNLENBQVA7QUFHRCxHQUpELE1BSU8sSUFBSUosR0FBRyxJQUFJQSxHQUFHLENBQUNLLE1BQUosSUFBYyxNQUF6QixFQUFpQztBQUN0QyxXQUFPQyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxJQUFJQyxJQUFKLENBQVNSLEdBQUcsQ0FBQ1MsR0FBYixDQUFkLEVBQWlDVCxHQUFqQyxDQUFQO0FBQ0QsR0FGTSxNQUVBLElBQUlBLEdBQUcsSUFBSUEsR0FBRyxDQUFDSyxNQUFKLElBQWMsTUFBekIsRUFBaUM7QUFDdEMsV0FBT1QsS0FBSyxDQUFDYyxJQUFOLENBQVdDLFFBQVgsQ0FBb0JYLEdBQXBCLENBQVA7QUFDRCxHQUZNLE1BRUEsSUFBSUEsR0FBRyxJQUFJLE9BQU9BLEdBQVAsS0FBZSxRQUExQixFQUFvQztBQUN6QyxXQUFPWSxXQUFXLENBQUNaLEdBQUQsQ0FBbEI7QUFDRCxHQUZNLE1BRUE7QUFDTCxXQUFPQSxHQUFQO0FBQ0Q7QUFDRjs7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QW9DMkIsWUFBcEMsRUFBa0R2QyxHQUFHLENBQUMyQyxJQUF0RCxDQUFQO0FBQ0QsT0FISSxFQUlKdEIsSUFKSSxDQUlDLE1BQU07QUFDVixlQUFPbUIsV0FBVyxDQUFDNUIsT0FBRCxDQUFsQjtBQUNELE9BTkksRUFPSlMsSUFQSSxDQU9DZSxPQVBELEVBT1VMLEtBUFYsQ0FBUDtBQVFELEtBOUNNLENBQVA7QUErQ0Q7O0FBdkpnRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZ1bmN0aW9uc1JvdXRlci5qc1xuXG52YXIgUGFyc2UgPSByZXF1aXJlKCdwYXJzZS9ub2RlJykuUGFyc2UsXG4gIHRyaWdnZXJzID0gcmVxdWlyZSgnLi4vdHJpZ2dlcnMnKTtcblxuaW1wb3J0IFByb21pc2VSb3V0ZXIgZnJvbSAnLi4vUHJvbWlzZVJvdXRlcic7XG5pbXBvcnQgeyBwcm9taXNlRW5mb3JjZU1hc3RlcktleUFjY2VzcywgcHJvbWlzZUVuc3VyZUlkZW1wb3RlbmN5IH0gZnJvbSAnLi4vbWlkZGxld2FyZXMnO1xuaW1wb3J0IHsgam9iU3RhdHVzSGFuZGxlciB9IGZyb20gJy4uL1N0YXR1c0hhbmRsZXInO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL2xvZ2dlcic7XG5cbmZ1bmN0aW9uIHBhcnNlT2JqZWN0KG9iaikge1xuICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG4gICAgcmV0dXJuIG9iai5tYXAoaXRlbSA9PiB7XG4gICAgICByZXR1cm4gcGFyc2VPYmplY3QoaXRlbSk7XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAob2JqICYmIG9iai5fX3R5cGUgPT0gJ0RhdGUnKSB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24obmV3IERhdGUob2JqLmlzbyksIG9iaik7XG4gIH0gZWxzZSBpZiAob2JqICYmIG9iai5fX3R5cGUgPT0gJ0ZpbGUnKSB7XG4gICAgcmV0dXJuIFBhcnNlLkZpbGUuZnJvbUpTT04ob2JqKTtcbiAgfSBlbHNlIGlmIChvYmogJiYgdHlwZW9mIG9iaiA9PT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gcGFyc2VQYXJhbXMob2JqKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gb2JqO1xuICB9XG59XG5cbmZ1bmN0aW9uIHBhcnNlUGFyYW1zKHBhcmFtcykge1xuICByZXR1cm4gXy5tYXBWYWx1ZXMocGFyYW1zLCBwYXJzZU9iamVjdCk7XG59XG5cbmV4cG9ydCBjbGFzcyBGdW5jdGlvbnNSb3V0ZXIgZXh0ZW5kcyBQcm9taXNlUm91dGVyIHtcbiAgbW91bnRSb3V0ZXMoKSB7XG4gICAgdGhpcy5yb3V0ZShcbiAgICAgICdQT1NUJyxcbiAgICAgICcvZnVuY3Rpb25zLzpmdW5jdGlvbk5hbWUnLFxuICAgICAgcHJvbWlzZUVuc3VyZUlkZW1wb3RlbmN5LFxuICAgICAgRnVuY3Rpb25zUm91dGVyLmhhbmRsZUNsb3VkRnVuY3Rpb25cbiAgICApO1xuICAgIHRoaXMucm91dGUoXG4gICAgICAnUE9TVCcsXG4gICAgICAnL2pvYnMvOmpvYk5hbWUnLFxuICAgICAgcHJvbWlzZUVuc3VyZUlkZW1wb3RlbmN5LFxuICAgICAgcHJvbWlzZUVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MsXG4gICAgICBmdW5jdGlvbiAocmVxKSB7XG4gICAgICAgIHJldHVybiBGdW5jdGlvbnNSb3V0ZXIuaGFuZGxlQ2xvdWRKb2IocmVxKTtcbiAgICAgIH1cbiAgICApO1xuICAgIHRoaXMucm91dGUoJ1BPU1QnLCAnL2pvYnMnLCBwcm9taXNlRW5mb3JjZU1hc3RlcktleUFjY2VzcywgZnVuY3Rpb24gKHJlcSkge1xuICAgICAgcmV0dXJuIEZ1bmN0aW9uc1JvdXRlci5oYW5kbGVDbG91ZEpvYihyZXEpO1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGhhbmRsZUNsb3VkSm9iKHJlcSkge1xuICAgIGNvbnN0IGpvYk5hbWUgPSByZXEucGFyYW1zLmpvYk5hbWUgfHwgcmVxLmJvZHkuam9iTmFtZTtcbiAgICBjb25zdCBhcHBsaWNhdGlvbklkID0gcmVxLmNvbmZpZy5hcHBsaWNhdGlvbklkO1xuICAgIGNvbnN0IGpvYkhhbmRsZXIgPSBqb2JTdGF0dXNIYW5kbGVyKHJlcS5jb25maWcpO1xuICAgIGNvbnN0IGpvYkZ1bmN0aW9uID0gdHJpZ2dlcnMuZ2V0Sm9iKGpvYk5hbWUsIGFwcGxpY2F0aW9uSWQpO1xuICAgIGlmICgham9iRnVuY3Rpb24pIHtcbiAgICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5TQ1JJUFRfRkFJTEVELCAnSW52YWxpZCBqb2IuJyk7XG4gICAgfVxuICAgIGxldCBwYXJhbXMgPSBPYmplY3QuYXNzaWduKHt9LCByZXEuYm9keSwgcmVxLnF1ZXJ5KTtcbiAgICBwYXJhbXMgPSBwYXJzZVBhcmFtcyhwYXJhbXMpO1xuICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgIGxvZzogcmVxLmNvbmZpZy5sb2dnZXJDb250cm9sbGVyLFxuICAgICAgaGVhZGVyczogcmVxLmNvbmZpZy5oZWFkZXJzLFxuICAgICAgaXA6IHJlcS5jb25maWcuaXAsXG4gICAgICBqb2JOYW1lLFxuICAgICAgbWVzc2FnZTogam9iSGFuZGxlci5zZXRNZXNzYWdlLmJpbmQoam9iSGFuZGxlciksXG4gICAgfTtcblxuICAgIHJldHVybiBqb2JIYW5kbGVyLnNldFJ1bm5pbmcoam9iTmFtZSwgcGFyYW1zKS50aGVuKGpvYlN0YXR1cyA9PiB7XG4gICAgICByZXF1ZXN0LmpvYklkID0gam9iU3RhdHVzLm9iamVjdElkO1xuICAgICAgLy8gcnVuIHRoZSBmdW5jdGlvbiBhc3luY1xuICAgICAgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiB7XG4gICAgICAgIFByb21pc2UucmVzb2x2ZSgpXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGpvYkZ1bmN0aW9uKHJlcXVlc3QpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oXG4gICAgICAgICAgICByZXN1bHQgPT4ge1xuICAgICAgICAgICAgICBqb2JIYW5kbGVyLnNldFN1Y2NlZWRlZChyZXN1bHQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgam9iSGFuZGxlci5zZXRGYWlsZWQoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnWC1QYXJzZS1Kb2ItU3RhdHVzLUlkJzogam9iU3RhdHVzLm9iamVjdElkLFxuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZToge30sXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJlc3BvbnNlT2JqZWN0KHJlc29sdmUsIHJlamVjdCkge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgIHJlc3BvbnNlOiB7XG4gICAgICAgICAgICByZXN1bHQ6IFBhcnNlLl9lbmNvZGUocmVzdWx0KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSB0cmlnZ2Vycy5yZXNvbHZlRXJyb3IobWVzc2FnZSk7XG4gICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICB9LFxuICAgIH07XG4gIH1cbiAgc3RhdGljIGhhbmRsZUNsb3VkRnVuY3Rpb24ocmVxKSB7XG4gICAgY29uc3QgZnVuY3Rpb25OYW1lID0gcmVxLnBhcmFtcy5mdW5jdGlvbk5hbWU7XG4gICAgY29uc3QgYXBwbGljYXRpb25JZCA9IHJlcS5jb25maWcuYXBwbGljYXRpb25JZDtcbiAgICBjb25zdCB0aGVGdW5jdGlvbiA9IHRyaWdnZXJzLmdldEZ1bmN0aW9uKGZ1bmN0aW9uTmFtZSwgYXBwbGljYXRpb25JZCk7XG5cbiAgICBpZiAoIXRoZUZ1bmN0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuU0NSSVBUX0ZBSUxFRCwgYEludmFsaWQgZnVuY3Rpb246IFwiJHtmdW5jdGlvbk5hbWV9XCJgKTtcbiAgICB9XG4gICAgbGV0IHBhcmFtcyA9IE9iamVjdC5hc3NpZ24oe30sIHJlcS5ib2R5LCByZXEucXVlcnkpO1xuICAgIHBhcmFtcyA9IHBhcnNlUGFyYW1zKHBhcmFtcyk7XG4gICAgY29uc3QgcmVxdWVzdCA9IHtcbiAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgbWFzdGVyOiByZXEuYXV0aCAmJiByZXEuYXV0aC5pc01hc3RlcixcbiAgICAgIHVzZXI6IHJlcS5hdXRoICYmIHJlcS5hdXRoLnVzZXIsXG4gICAgICBpbnN0YWxsYXRpb25JZDogcmVxLmluZm8uaW5zdGFsbGF0aW9uSWQsXG4gICAgICBsb2c6IHJlcS5jb25maWcubG9nZ2VyQ29udHJvbGxlcixcbiAgICAgIGhlYWRlcnM6IHJlcS5jb25maWcuaGVhZGVycyxcbiAgICAgIGlwOiByZXEuY29uZmlnLmlwLFxuICAgICAgZnVuY3Rpb25OYW1lLFxuICAgICAgY29udGV4dDogcmVxLmluZm8uY29udGV4dCxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGNvbnN0IHVzZXJTdHJpbmcgPSByZXEuYXV0aCAmJiByZXEuYXV0aC51c2VyID8gcmVxLmF1dGgudXNlci5pZCA6IHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IGNsZWFuSW5wdXQgPSBsb2dnZXIudHJ1bmNhdGVMb2dNZXNzYWdlKEpTT04uc3RyaW5naWZ5KHBhcmFtcykpO1xuICAgICAgY29uc3QgeyBzdWNjZXNzLCBlcnJvciB9ID0gRnVuY3Rpb25zUm91dGVyLmNyZWF0ZVJlc3BvbnNlT2JqZWN0KFxuICAgICAgICByZXN1bHQgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBjbGVhblJlc3VsdCA9IGxvZ2dlci50cnVuY2F0ZUxvZ01lc3NhZ2UoSlNPTi5zdHJpbmdpZnkocmVzdWx0LnJlc3BvbnNlLnJlc3VsdCkpO1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oXG4gICAgICAgICAgICAgIGBSYW4gY2xvdWQgZnVuY3Rpb24gJHtmdW5jdGlvbk5hbWV9IGZvciB1c2VyICR7dXNlclN0cmluZ30gd2l0aDpcXG4gIElucHV0OiAke2NsZWFuSW5wdXR9XFxuICBSZXN1bHQ6ICR7Y2xlYW5SZXN1bHR9YCxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgdXNlcjogdXNlclN0cmluZyxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgICAgYEZhaWxlZCBydW5uaW5nIGNsb3VkIGZ1bmN0aW9uICR7ZnVuY3Rpb25OYW1lfSBmb3IgdXNlciAke3VzZXJTdHJpbmd9IHdpdGg6XFxuICBJbnB1dDogJHtjbGVhbklucHV0fVxcbiAgRXJyb3I6IGAgK1xuICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGVycm9yKSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgdXNlcjogdXNlclN0cmluZyxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRyaWdnZXJzLm1heWJlUnVuVmFsaWRhdG9yKHJlcXVlc3QsIGZ1bmN0aW9uTmFtZSwgcmVxLmF1dGgpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRoZUZ1bmN0aW9uKHJlcXVlc3QpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbihzdWNjZXNzLCBlcnJvcik7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Sb3V0ZXJzL0Z1bmN0aW9uc1JvdXRlci5qcyJdLCJuYW1lcyI6WyJQYXJzZSIsInJlcXVpcmUiLCJ0cmlnZ2VycyIsIkFycmF5IiwiaXRlbSIsInBhcnNlT2JqZWN0Iiwib2JqIiwiT2JqZWN0IiwicGFyc2VQYXJhbXMiLCJfIiwiUHJvbWlzZVJvdXRlciIsIm1vdW50Um91dGVzIiwicHJvbWlzZUVuc3VyZUlkZW1wb3RlbmN5IiwiRnVuY3Rpb25zUm91dGVyIiwicHJvbWlzZUVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MiLCJoYW5kbGVDbG91ZEpvYiIsImpvYk5hbWUiLCJyZXEiLCJhcHBsaWNhdGlvbklkIiwiam9iSGFuZGxlciIsImpvYkZ1bmN0aW9uIiwicGFyYW1zIiwicmVxdWVzdCIsImxvZyIsImhlYWRlcnMiLCJpcCIsIm1lc3NhZ2UiLCJqb2JTdGF0dXMiLCJwcm9jZXNzIiwiUHJvbWlzZSIsInJlc3VsdCIsImVycm9yIiwib2JqZWN0SWQiLCJyZXNwb25zZSIsImNyZWF0ZVJlc3BvbnNlT2JqZWN0Iiwic3VjY2VzcyIsInJlc29sdmUiLCJyZWplY3QiLCJoYW5kbGVDbG91ZEZ1bmN0aW9uIiwiZnVuY3Rpb25OYW1lIiwidGhlRnVuY3Rpb24iLCJtYXN0ZXIiLCJ1c2VyIiwiaW5zdGFsbGF0aW9uSWQiLCJjb250ZXh0IiwidXNlclN0cmluZyIsImNsZWFuSW5wdXQiLCJsb2dnZXIiLCJKU09OIiwiY2xlYW5SZXN1bHQiXSwibWFwcGluZ3MiOiIyaHZCQVNBOytOQUpBLEdBQUEsQ0FBQSxjQUFBLHlCQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGtCQUFBLENBQUEsQ0FBQSxDQUFBLENBQ0EsR0FBQSxDQUFBLFlBQUEseUJBQUEsT0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQSxDQUNBLEdBQUEsQ0FBQSxjQUFBLHlCQUFBLE9BQUEsQ0FBQSxrQkFBQSxDQUFBLENBQUEsQ0FDQSxHQUFBLENBQUEsT0FBQSx5QkFBQSxzQkFBQSxDQUFB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QUFBLE1BQUEsQ0FJRUwsSUFBSSxDQUFFRyxVQUpSLENBSEZFLEVBREUsd0JBV0ZWLE1BQU0sQ0FBTkEsS0FBTSxDQUFOQSxDQVhGLENBWUUsTUFBQSxDQUFBLENBQVUseUJBQ1ZBLE1BQU0sQ0FBTkEsQ0FBTSxDQUFOQSxDQUNELENBaENMLENBQTJCLENBQXJCLENBQU4sQ0FINEMsd0JBc0M1QyxNQUFPLENBQUEsT0FBTyxDQUFQLE9BQUEsR0FBQSxJQUFBLENBQ0MsSUFBTSxpREFDVixNQUFPbkMsQ0FBQUEsUUFBUSxDQUFSQSxpQkFBQUEsQ0FBQUEsT0FBQUEsQ0FBQUEsWUFBQUEsQ0FBa0RlLEdBQUcsQ0FBNUQsSUFBT2YsQ0FBUCxDQUZHLENBQUEsRUFBQSxJQUFBLENBSUMsSUFBTSxpREFDVixNQUFPc0MsQ0FBQUEsV0FBVyxDQUFsQixPQUFrQixDQUFsQixDQUxHLENBQUEsRUFBQSxJQUFBLENBQUEsT0FBQSxDQUFQLEtBQU8sQ0FBUCxDQXRDRixDQUFPLENBQVAsQ0ErQ0QsQ0F2SmdELEMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGdW5jdGlvbnNSb3V0ZXIuanNcblxudmFyIFBhcnNlID0gcmVxdWlyZSgncGFyc2Uvbm9kZScpLlBhcnNlLFxuICB0cmlnZ2VycyA9IHJlcXVpcmUoJy4uL3RyaWdnZXJzJyk7XG5cbmltcG9ydCBQcm9taXNlUm91dGVyIGZyb20gJy4uL1Byb21pc2VSb3V0ZXInO1xuaW1wb3J0IHsgcHJvbWlzZUVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MsIHByb21pc2VFbnN1cmVJZGVtcG90ZW5jeSB9IGZyb20gJy4uL21pZGRsZXdhcmVzJztcbmltcG9ydCB7IGpvYlN0YXR1c0hhbmRsZXIgfSBmcm9tICcuLi9TdGF0dXNIYW5kbGVyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi9sb2dnZXInO1xuXG5mdW5jdGlvbiBwYXJzZU9iamVjdChvYmopIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuICAgIHJldHVybiBvYmoubWFwKGl0ZW0gPT4ge1xuICAgICAgcmV0dXJuIHBhcnNlT2JqZWN0KGl0ZW0pO1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKG9iaiAmJiBvYmouX190eXBlID09ICdEYXRlJykge1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBEYXRlKG9iai5pc28pLCBvYmopO1xuICB9IGVsc2UgaWYgKG9iaiAmJiBvYmouX190eXBlID09ICdGaWxlJykge1xuICAgIHJldHVybiBQYXJzZS5GaWxlLmZyb21KU09OKG9iaik7XG4gIH0gZWxzZSBpZiAob2JqICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnKSB7XG4gICAgcmV0dXJuIHBhcnNlUGFyYW1zKG9iaik7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG9iajtcbiAgfVxufVxuXG5mdW5jdGlvbiBwYXJzZVBhcmFtcyhwYXJhbXMpIHtcbiAgcmV0dXJuIF8ubWFwVmFsdWVzKHBhcmFtcywgcGFyc2VPYmplY3QpO1xufVxuXG5leHBvcnQgY2xhc3MgRnVuY3Rpb25zUm91dGVyIGV4dGVuZHMgUHJvbWlzZVJvdXRlciB7XG4gIG1vdW50Um91dGVzKCkge1xuICAgIHRoaXMucm91dGUoXG4gICAgICAnUE9TVCcsXG4gICAgICAnL2Z1bmN0aW9ucy86ZnVuY3Rpb25OYW1lJyxcbiAgICAgIHByb21pc2VFbnN1cmVJZGVtcG90ZW5jeSxcbiAgICAgIEZ1bmN0aW9uc1JvdXRlci5oYW5kbGVDbG91ZEZ1bmN0aW9uXG4gICAgKTtcbiAgICB0aGlzLnJvdXRlKFxuICAgICAgJ1BPU1QnLFxuICAgICAgJy9qb2JzLzpqb2JOYW1lJyxcbiAgICAgIHByb21pc2VFbnN1cmVJZGVtcG90ZW5jeSxcbiAgICAgIHByb21pc2VFbmZvcmNlTWFzdGVyS2V5QWNjZXNzLFxuICAgICAgZnVuY3Rpb24gKHJlcSkge1xuICAgICAgICByZXR1cm4gRnVuY3Rpb25zUm91dGVyLmhhbmRsZUNsb3VkSm9iKHJlcSk7XG4gICAgICB9XG4gICAgKTtcbiAgICB0aGlzLnJvdXRlKCdQT1NUJywgJy9qb2JzJywgcHJvbWlzZUVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MsIGZ1bmN0aW9uIChyZXEpIHtcbiAgICAgIHJldHVybiBGdW5jdGlvbnNSb3V0ZXIuaGFuZGxlQ2xvdWRKb2IocmVxKTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBoYW5kbGVDbG91ZEpvYihyZXEpIHtcbiAgICBjb25zdCBqb2JOYW1lID0gcmVxLnBhcmFtcy5qb2JOYW1lIHx8IHJlcS5ib2R5LmpvYk5hbWU7XG4gICAgY29uc3QgYXBwbGljYXRpb25JZCA9IHJlcS5jb25maWcuYXBwbGljYXRpb25JZDtcbiAgICBjb25zdCBqb2JIYW5kbGVyID0gam9iU3RhdHVzSGFuZGxlcihyZXEuY29uZmlnKTtcbiAgICBjb25zdCBqb2JGdW5jdGlvbiA9IHRyaWdnZXJzLmdldEpvYihqb2JOYW1lLCBhcHBsaWNhdGlvbklkKTtcbiAgICBpZiAoIWpvYkZ1bmN0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuU0NSSVBUX0ZBSUxFRCwgJ0ludmFsaWQgam9iLicpO1xuICAgIH1cbiAgICBsZXQgcGFyYW1zID0gT2JqZWN0LmFzc2lnbih7fSwgcmVxLmJvZHksIHJlcS5xdWVyeSk7XG4gICAgcGFyYW1zID0gcGFyc2VQYXJhbXMocGFyYW1zKTtcbiAgICBjb25zdCByZXF1ZXN0ID0ge1xuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICBsb2c6IHJlcS5jb25maWcubG9nZ2VyQ29udHJvbGxlcixcbiAgICAgIGhlYWRlcnM6IHJlcS5jb25maWcuaGVhZGVycyxcbiAgICAgIGlwOiByZXEuY29uZmlnLmlwLFxuICAgICAgam9iTmFtZSxcbiAgICAgIG1lc3NhZ2U6IGpvYkhhbmRsZXIuc2V0TWVzc2FnZS5iaW5kKGpvYkhhbmRsZXIpLFxuICAgIH07XG5cbiAgICByZXR1cm4gam9iSGFuZGxlci5zZXRSdW5uaW5nKGpvYk5hbWUsIHBhcmFtcykudGhlbihqb2JTdGF0dXMgPT4ge1xuICAgICAgcmVxdWVzdC5qb2JJZCA9IGpvYlN0YXR1cy5vYmplY3RJZDtcbiAgICAgIC8vIHJ1biB0aGUgZnVuY3Rpb24gYXN5bmNcbiAgICAgIHByb2Nlc3MubmV4dFRpY2soKCkgPT4ge1xuICAgICAgICBQcm9taXNlLnJlc29sdmUoKVxuICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBqb2JGdW5jdGlvbihyZXF1ZXN0KTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKFxuICAgICAgICAgICAgcmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgam9iSGFuZGxlci5zZXRTdWNjZWVkZWQocmVzdWx0KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgIGpvYkhhbmRsZXIuc2V0RmFpbGVkKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ1gtUGFyc2UtSm9iLVN0YXR1cy1JZCc6IGpvYlN0YXR1cy5vYmplY3RJZCxcbiAgICAgICAgfSxcbiAgICAgICAgcmVzcG9uc2U6IHt9LFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVSZXNwb25zZU9iamVjdChyZXNvbHZlLCByZWplY3QpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICByZXNwb25zZToge1xuICAgICAgICAgICAgcmVzdWx0OiBQYXJzZS5fZW5jb2RlKHJlc3VsdCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIGNvbnN0IGVycm9yID0gdHJpZ2dlcnMucmVzb2x2ZUVycm9yKG1lc3NhZ2UpO1xuICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgfSxcbiAgICB9O1xuICB9XG4gIHN0YXRpYyBoYW5kbGVDbG91ZEZ1bmN0aW9uKHJlcSkge1xuICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9IHJlcS5wYXJhbXMuZnVuY3Rpb25OYW1lO1xuICAgIGNvbnN0IGFwcGxpY2F0aW9uSWQgPSByZXEuY29uZmlnLmFwcGxpY2F0aW9uSWQ7XG4gICAgY29uc3QgdGhlRnVuY3Rpb24gPSB0cmlnZ2Vycy5nZXRGdW5jdGlvbihmdW5jdGlvbk5hbWUsIGFwcGxpY2F0aW9uSWQpO1xuXG4gICAgaWYgKCF0aGVGdW5jdGlvbikge1xuICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLlNDUklQVF9GQUlMRUQsIGBJbnZhbGlkIGZ1bmN0aW9uOiBcIiR7ZnVuY3Rpb25OYW1lfVwiYCk7XG4gICAgfVxuICAgIGxldCBwYXJhbXMgPSBPYmplY3QuYXNzaWduKHt9LCByZXEuYm9keSwgcmVxLnF1ZXJ5KTtcbiAgICBwYXJhbXMgPSBwYXJzZVBhcmFtcyhwYXJhbXMpO1xuICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgIG1hc3RlcjogcmVxLmF1dGggJiYgcmVxLmF1dGguaXNNYXN0ZXIsXG4gICAgICB1c2VyOiByZXEuYXV0aCAmJiByZXEuYXV0aC51c2VyLFxuICAgICAgaW5zdGFsbGF0aW9uSWQ6IHJlcS5pbmZvLmluc3RhbGxhdGlvbklkLFxuICAgICAgbG9nOiByZXEuY29uZmlnLmxvZ2dlckNvbnRyb2xsZXIsXG4gICAgICBoZWFkZXJzOiByZXEuY29uZmlnLmhlYWRlcnMsXG4gICAgICBpcDogcmVxLmNvbmZpZy5pcCxcbiAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgIGNvbnRleHQ6IHJlcS5pbmZvLmNvbnRleHQsXG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBjb25zdCB1c2VyU3RyaW5nID0gcmVxLmF1dGggJiYgcmVxLmF1dGgudXNlciA/IHJlcS5hdXRoLnVzZXIuaWQgOiB1bmRlZmluZWQ7XG4gICAgICBjb25zdCBjbGVhbklucHV0ID0gbG9nZ2VyLnRydW5jYXRlTG9nTWVzc2FnZShKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICAgIGNvbnN0IHsgc3VjY2VzcywgZXJyb3IgfSA9IEZ1bmN0aW9uc1JvdXRlci5jcmVhdGVSZXNwb25zZU9iamVjdChcbiAgICAgICAgcmVzdWx0ID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgY2xlYW5SZXN1bHQgPSBsb2dnZXIudHJ1bmNhdGVMb2dNZXNzYWdlKEpTT04uc3RyaW5naWZ5KHJlc3VsdC5yZXNwb25zZS5yZXN1bHQpKTtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKFxuICAgICAgICAgICAgICBgUmFuIGNsb3VkIGZ1bmN0aW9uICR7ZnVuY3Rpb25OYW1lfSBmb3IgdXNlciAke3VzZXJTdHJpbmd9IHdpdGg6XFxuICBJbnB1dDogJHtjbGVhbklucHV0fVxcbiAgUmVzdWx0OiAke2NsZWFuUmVzdWx0fWAsXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgICAgICAgIHVzZXI6IHVzZXJTdHJpbmcsXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgICAgICAgIGBGYWlsZWQgcnVubmluZyBjbG91ZCBmdW5jdGlvbiAke2Z1bmN0aW9uTmFtZX0gZm9yIHVzZXIgJHt1c2VyU3RyaW5nfSB3aXRoOlxcbiAgSW5wdXQ6ICR7Y2xlYW5JbnB1dH1cXG4gIEVycm9yOiBgICtcbiAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShlcnJvciksXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgICAgICAgIHVzZXI6IHVzZXJTdHJpbmcsXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJldHVybiB0cmlnZ2Vycy5tYXliZVJ1blZhbGlkYXRvcihyZXF1ZXN0LCBmdW5jdGlvbk5hbWUsIHJlcS5hdXRoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJldHVybiB0aGVGdW5jdGlvbihyZXF1ZXN0KTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oc3VjY2VzcywgZXJyb3IpO1xuICAgIH0pO1xuICB9XG59XG4iXX0=